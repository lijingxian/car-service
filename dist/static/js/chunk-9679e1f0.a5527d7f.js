(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9679e1f0"],{2497:function(e,t,n){"use strict";var a=n("4360"),r=n("a18c");t["a"]=function(e,t){return function(n){var i=n.data;"100"===i.resultCode?e(i):"709"===i.resultCode?(a["a"].commit("updateUser",{shop:{}}),console.log("未登录: ",a["a"].getters.currentUser),r["a"].push("/login")):t(i)}}},"2bd4":function(e,t,n){},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,n){var a=n("1d80"),r=n("5899"),i="["+r+"]",o=RegExp("^"+i+i+"*"),s=RegExp(i+i+"*$"),c=function(e){return function(t){var n=String(a(t));return 1&e&&(n=n.replace(o,"")),2&e&&(n=n.replace(s,"")),n}};e.exports={start:c(1),end:c(2),trim:c(3)}},"5b8e":function(e,t,n){"use strict";var a=n("9678"),r=n.n(a);r.a},7132:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"biz-fade-t"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.open,expression:"open"}],staticClass:"biz-popup",on:{click:function(t){return t.target!==t.currentTarget?null:e.close(t)}}},[n("transition",{attrs:{name:"biz-fade-t-right"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.open,expression:"open"}],staticClass:"popup-content",style:e.contentStyle},[e._t("default")],2)])],1)])},r=[],i={name:"BizPopup",props:{open:{type:Boolean,default:function(){return!1}},contentStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{close:function(){this.$emit("close")}}},o=i,s=(n("5b8e"),n("2877")),c=Object(s["a"])(o,a,r,!1,null,null,null),l=c.exports,u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"biz-popup-tabs"},[n("biz-popup",{attrs:{open:e.open,contentStyle:e.contentStyle},on:{close:e.close}},[n("el-tabs",{attrs:{type:"border-card",value:e.value},on:{"tab-click":e.tabClick}},[e._t("default")],2)],1)],1)},f=[],p=(n("b0c0"),{name:"BizPopupTabs",data:function(){return{}},props:{open:{type:Boolean,default:!1},value:{type:String,required:!0},contentStyle:{type:Object,default:function(){return{}}}},components:{BizPopup:l},methods:{close:function(){var e=this;this.$confirm("是否保存当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$emit("close")}))},tabClick:function(e){this.$emit("input",e.name)}}}),d=p,h=(n("d4c2"),Object(s["a"])(d,u,f,!1,null,null,null)),m=h.exports;n.d(t,"a",(function(){return m}))},"8bf6":function(e,t,n){"use strict";var a=n("2497"),r=n("bc3a"),i=n.n(r),o=n("c596");t["a"]={getList:function(e,t,n){i.a.get(o["g"].staffMgmt.getRoleList,{params:e}).then(Object(a["a"])(t,n)).catch((function(e){console.error(e)}))},init:function(e,t,n){i.a.get(o["g"].staffMgmt.roleInit,{params:e}).then(Object(a["a"])(t,n)).catch((function(e){console.error(e)}))},delete:function(e,t,n){i.a.post(o["g"].staffMgmt.roleDelete,e).then(Object(a["a"])(t,n)).catch((function(e){console.error(e)}))},get:function(e,t,n){i.a.get(o["g"].staffMgmt.queryAuth,{params:e}).then(Object(a["a"])(t,n)).catch((function(e){console.error(e)}))},create:function(e,t,n){i.a.post(o["g"].staffMgmt.roleCreate,e).then(Object(a["a"])(t,n)).catch((function(e){console.error(e)}))},update:function(e,t,n){i.a.post(o["g"].staffMgmt.updateAuth,e).then(Object(a["a"])(t,n)).catch((function(e){console.error(e)}))},getAuthority:function(e,t,n){i.a.get(o["g"].staffMgmt.roleGetAuth,{params:e}).then(Object(a["a"])(t,n)).catch((function(e){console.error(e)}))}}},"8c20":function(e,t,n){},"8db9":function(e,t,n){},"91d8":function(e,t,n){"use strict";var a=n("8c20"),r=n.n(a);r.a},9678:function(e,t,n){},"9fe5":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"staff-mgmt-role-mgmt"},[n("biz-flex-table",{attrs:{operations:e.operations,filters:e.filters,tableData:e.tableData,pagination:e.pagination},on:{operate:e.operate,"filter-data-change":e.filterDataChange,"row-click":e.rowClick,"selection-change":e.handleSelectionChange,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[n("el-table-column",{attrs:{prop:"name",label:"角色名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.name)+" "),"0"===t.row.hierarchy?n("el-popover",{staticClass:"button-tshi",attrs:{placement:"bottom-start",trigger:"hover",content:"系统预置，不支持修改"}},[n("el-button",{staticStyle:{"border-radius":"10px"},attrs:{slot:"reference",size:"mini",type:"primary"},slot:"reference"},[e._v("预置")])],1):e._e()]}}])}),n("el-table-column",{attrs:{prop:"type",label:"角色类别"}}),n("el-table-column",{attrs:{prop:"description",label:"角色描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"description-cell"},[e._v(" "+e._s(t.row.description||"无")+" ")])]}}])}),n("el-table-column",{attrs:{prop:"option",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasAuthDel?n("el-button",{staticStyle:{color:"red"},attrs:{size:"mini",type:"text"},on:{click:function(n){return n.stopPropagation(),e.del(t.row.id)}}},[e._v(" 删除 ")]):e._e()]}}])})],1),n("biz-popup-tabs",{attrs:{open:e.open},on:{close:function(t){e.open=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[n("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[n("role-info",{ref:"baseInfo",attrs:{id:e.itemId},on:{created:e.refresh}})],1)],1),n("biz-popup-tabs",{attrs:{open:e.openEdit},on:{close:function(t){e.openEdit=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[n("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[n("role-info",{attrs:{id:e.itemId},on:{created:e.refresh}})],1),n("el-tab-pane",{attrs:{label:"角色权限",name:"second"}},[n("role-permissions",{attrs:{itemId:e.selectedId},on:{created:e.refresh}})],1)],1)],1)},r=[],i=(n("99af"),n("d81d"),n("fb6a"),n("b0c0"),n("a9e3"),n("5530")),o=n("04d3"),s=n("8bf6"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("biz-grid",{staticClass:"staff-mgmt-role-info"},[n("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small","inline-message":!0}},[n("el-form-item",{attrs:{label:"角色类别",prop:"type"}},[n("el-select",{attrs:{placeholder:"请选择角色类别"},on:{change:e.typeChange},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.typeList,(function(e){return n("el-option",{key:e.type,attrs:{label:e.name,value:e.type}})})),1)],1),n("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"角色描述",prop:"description"}},[n("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入角色描述"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)},l=[],u=(n("a4d3"),n("e01a"),n("f36f")),f=n("8330"),p={name:"RoleInfo",props:{id:{type:String,default:""}},data:function(){return{rules:{type:[{required:!0,message:"请选择角色类别",trigger:"submit"}],name:[{required:!0,message:"请填写角色名称",trigger:"blur"},{max:20,message:"长度不大于20位",trigger:"blur"}],description:[{max:100,message:"不多于100字",trigger:"blur"}]},form:{type:"",name:"",description:"",authorityIds:[]},typeList:[],authorityList:[],operations:[{label:"保存",name:"save",type:"primary"}],loading:!1,isSave:!1}},methods:{operate:function(e){this[e]()},showMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},roleChange:function(){this.$refs.form.clearValidate("type")},refresh:function(){var e=this;if(void 0===this.id||""===this.id){var t={};s["a"].init(t,(function(t){e.$refs.form.resetFields(),e.typeList=t.types}),(function(t){e.$message.warning(t.errorMessage)}))}else{var n={id:this.id};s["a"].get(n,(function(t){e.typeList=t.types,e.id=t.role.id,e.form.name=t.role.name,e.form.description=t.role.description,e.form.authorityIds=[],t.authority.map((function(t){e.form.authorityIds.push(t.id)})),e.form.type=t.role.roleTypeData.type}),(function(t){e.$message.warning(t.errorMessage)}))}},save:function(){var e=this;this.isSave=!0,this.$refs.form.validate((function(t){t&&e.submit()}))},submit:function(){void 0===this.id||""===this.id?this.create():this.update()},create:function(){var e=this,t={name:this.form.name,type:this.form.type,description:this.form.description,authorityIds:this.form.authorityIds};s["a"].create(t,(function(t){e.$emit("created"),e.$message.success("保存成功")}),(function(t){e.$message.warning(t.errorMessage)}))},update:function(){var e=this,t={id:this.id,name:this.form.name,type:this.form.type,authorityIds:this.form.authorityIds,description:this.form.description};s["a"].update(t,(function(t){e.$emit("created"),e.$message.success("更新成功")}),(function(t){e.$message.warning(t.errorMessage)}))},continue:function(){var e=this;this.isSave=!1,this.$refs.form.validate((function(t){if(!t)return e.form.authorityIds.length||e.$message.warning("请选择角色权限"),!1;e.submit()}))},getAuthority:function(e){var t=this,n={roleType:e};s["a"].getAuthority(n,(function(e){t.form.authorityIds=[],e.authority.map((function(e){t.form.authorityIds.push(e.id)})),t.authorityList=e.authorityList}),(function(e){t.$message.warning(e.errorMessage)}))},back:function(){this.$router.go(-1)},typeChange:function(e){this.getAuthority(e),this.$refs.form.clearValidate("type")}},watch:{id:function(e,t){e&&(this.$refs.form.clearValidate(),this.refresh())}},created:function(){this.refresh()},components:{BizSaveButton:f["a"],BizGrid:u["a"]}},d=p,h=(n("b682"),n("2877")),m=Object(h["a"])(d,c,l,!1,null,null,null),g=m.exports,b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("biz-grid",{staticClass:"staff-mgmt-role-permissions"},[n("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),n("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},e._l(e.authorityList,(function(t,a){return n("el-tab-pane",{key:t.id,staticClass:"role-pane",attrs:{label:t.name,name:String(a)}},[n("el-tree",{ref:"tree",refInFor:!0,attrs:{"node-key":"id",props:e.treeProps,data:t.children,"default-expanded-keys":e.selectedKeys,"show-checkbox":""}})],1)})),1)],1)},y=[],v=(n("4160"),n("159b"),n("96cf"),n("1da1")),w=n("1ab1"),I=n("c596"),$={name:"RoleSetting",props:{itemId:{type:Object,default:function(){return{id:""}}}},data:function(){return{treeProps:{label:"name",children:"children"},activeTab:"0",name:"",type:"",description:"",selectedKeys:[],authorityList:[],operations:[{label:"保存",name:"save",type:"primary"}],loading:!1}},watch:{itemId:function(e,t){console.log("watched"),this.activeTab="0",e.id&&this.refresh()}},components:{BizSaveButton:f["a"],BizGrid:u["a"]},computed:{id:function(){return this.itemId.id||""}},methods:{operate:function(e){this[e]()},showMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";this.$message({showClose:!0,message:e,type:t})},formatAuthList:function(e){var t=e.concat(),n=function e(t){t.forEach((function(t){t.keyword;var n=[],a=["child","authorities","subAuthority"];for(var r in a)t[a[r]]&&(n=n.concat(t[a[r]]),delete t[a[r]]);n.length&&(t.children=n,e(t.children))}))};return n(e),t},refresh:function(){var e=this;return Object(v["a"])(regeneratorRuntime.mark((function t(){var n,a,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.id,a=null,t.prev=2,n){t.next=10;break}return t.next=6,w["a"].get(I["g"].staffMgmt.roleInit,{});case 6:a=t.sent,e.authorityList=e.formatAuthList(a.authorityList),t.next=21;break;case 10:return r={id:n},t.next=13,w["a"].get(I["g"].staffMgmt.queryAuth,r);case 13:a=t.sent,e.name=a.role.name,e.type=a.role.roleTypeData.type,e.description=a.role.description,e.authorityList=e.formatAuthList(a.authorityList),i=a.authority.map((function(e){return e.id})),e.selectedKeys=i,e.$nextTick((function(){i.forEach((function(t){e.$refs.tree.forEach((function(e){e.getNode(t)&&e.setChecked(t,!0)}))}))}));case 21:t.next=27;break;case 23:t.prev=23,t.t0=t["catch"](2),console.log("ERR_REFRESH: ",t.t0),e.$message.warning(t.t0.errorMessage);case 27:case"end":return t.stop()}}),t,null,[[2,23]])})))()},save:function(){var e=[];this.$refs.tree.forEach((function(t){e=e.concat(t.getCheckedNodes(!1,!0).map((function(e){return e.id})))})),console.log("selectedIds: ",e),e.length?this.submit(e):this.$message.warning("请选择角色权限")},submit:function(e){var t=this;return Object(v["a"])(regeneratorRuntime.mark((function n(){var a,r,i,o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.id,r=t.name,i=t.type,o=t.description,s={name:r,type:i,description:o,authorityIds:e},n.prev=2,a){n.next=10;break}return n.next=6,w["a"].post(I["g"].staffMgmt.updateAuth,s);case 6:t.$emit("created"),t.$message.success("保存成功"),n.next=14;break;case 10:return n.next=12,w["a"].post(I["g"].staffMgmt.updateAuth,Object.assign(s,{id:a}));case 12:t.$emit("created"),t.$message.success("更新成功");case 14:n.next=19;break;case 16:n.prev=16,n.t0=n["catch"](2),t.$message.warning(n.t0.errorMessage);case 19:case"end":return n.stop()}}),n,null,[[2,16]])})))()}}},x=$,k=(n("cdc53"),Object(h["a"])(x,b,y,!1,null,null,null)),C=k.exports,S=n("7132"),N=n("2497"),_=n("bc3a"),E=n.n(_),z={getNavInfo:function(e,t,n){E.a.get(I["g"].staffMgmt.getNavInfo,{params:e}).then(Object(N["a"])(t,n)).catch((function(e){console.error(e)}))}},A=n("2f62"),M={name:"RoleMgmt",data:function(){return{operations:[{label:"添加",name:"add",type:"primary"},{label:"删除",name:"del",type:"",disabled:!0}],originData:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},multiSelected:[],itemId:"",selectedId:{id:""},open:!1,openEdit:!1,tabName:"first",filters:[{type:"select",placeholder:"请选择角色",label:"角色类别",value:"",options:[]},{type:"input",placeholder:"请输入角色名称",name:"searchbar",value:""}]}},methods:{operate:function(e){this[e]()},filterDataChange:function(e){this.pagination.currentPage=1,this.refresh()},getRoleList:function(){var e=this;s["a"].init({},(function(t){e.filters[0].options=[{label:"全部",value:""}].concat(t.types.map((function(e){return{label:e.name,value:e.type}})))}),(function(t){e.$message.warning(t.errorMessage)}))},getKpi:function(){var e=this,t={params:""};z.getNavInfo(t,(function(t){var n="您当前已有"+t.data.roleCount+"种角色啦，当前已有角色不满足使用要求的话可自定义新增哦";e.$message({customClass:"motorists-club-activity__kpi",showClose:!0,message:n,duration:3e3})}))},showMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},handleSelectionChange:function(e){var t=this;this.operations[1].disabled=!0,e.length>0&&(this.operations[1].disabled=!1),this.multiSelected=[],e.map((function(e){t.multiSelected=t.multiSelected.concat(e.id)}))},handleSizeChange:function(e){this.pagination.pageSize=e},handleCurrentChange:function(e){this.pagination.currentPage=e},add:function(){this.itemId="",this.tabName="first",this.openEdit=!1,this.open=!0,this.$refs.baseInfo.$refs.form.resetFields()},rowClick:function(e){this.itemId=e.id,this.selectedId={id:e.id},this.open=!1,this.openEdit=!0},del:function(e){var t=this,n=e?Array(e):0===this.multiSelected.length?[]:this.multiSelected;0!==n.length?this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={ids:n};s["a"].delete(e,(function(e){t.$message.success("操作成功"),t.refresh()}),(function(e){t.$message.warning(e.errorMessage)}))})):this.$message.warning("未选择删除条目")},refresh:function(){var e=this,t={roleType:this.filters[0].value,keyword:this.filters[1].value};s["a"].getList(t,(function(t){e.originData=t.roleList,e.pagination.total=Number(t.totalCount)}),(function(t){console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},sort:function(e,t){return Number(e.level-t.level)}},mounted:function(){this.refresh(),this.getKpi(),this.getRoleList()},computed:Object(i["a"])(Object(i["a"])({tableData:function(){var e=this.pagination.currentPage,t=this.pagination.pageSize;return this.originData.slice((e-1)*t,e*t)}},Object(A["c"])("Authority",["currentAuth"])),{},{hasAuthDel:function(){return!0}}),components:{BizFlexTable:o["c"],RoleInfo:g,RolePermissions:C,BizPopupTabs:S["a"]}},L=M,O=(n("91d8"),Object(h["a"])(L,a,r,!1,null,null,null));t["default"]=O.exports},a9e3:function(e,t,n){"use strict";var a=n("83ab"),r=n("da84"),i=n("94ca"),o=n("6eeb"),s=n("5135"),c=n("c6b6"),l=n("7156"),u=n("c04e"),f=n("d039"),p=n("7c73"),d=n("241c").f,h=n("06cf").f,m=n("9bf2").f,g=n("58a8").trim,b="Number",y=r[b],v=y.prototype,w=c(p(v))==b,I=function(e){var t,n,a,r,i,o,s,c,l=u(e,!1);if("string"==typeof l&&l.length>2)if(l=g(l),t=l.charCodeAt(0),43===t||45===t){if(n=l.charCodeAt(2),88===n||120===n)return NaN}else if(48===t){switch(l.charCodeAt(1)){case 66:case 98:a=2,r=49;break;case 79:case 111:a=8,r=55;break;default:return+l}for(i=l.slice(2),o=i.length,s=0;s<o;s++)if(c=i.charCodeAt(s),c<48||c>r)return NaN;return parseInt(i,a)}return+l};if(i(b,!y(" 0o1")||!y("0b1")||y("+0x1"))){for(var $,x=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof x&&(w?f((function(){v.valueOf.call(n)})):c(n)!=b)?l(new y(I(t)),n,x):I(t)},k=a?d(y):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),C=0;k.length>C;C++)s(y,$=k[C])&&!s(x,$)&&m(x,$,h(y,$));x.prototype=v,v.constructor=x,o(r,b,x)}},b682:function(e,t,n){"use strict";var a=n("2bd4"),r=n.n(a);r.a},cdc53:function(e,t,n){"use strict";var a=n("8db9"),r=n.n(a);r.a},d4c2:function(e,t,n){"use strict";var a=n("e725"),r=n.n(a);r.a},e725:function(e,t,n){}}]);