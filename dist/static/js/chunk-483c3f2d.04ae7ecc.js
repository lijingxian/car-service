(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-483c3f2d"],{"0943":function(e,t,a){"use strict";var i=a("1fac"),r=a.n(i);r.a},"0a05":function(e,t,a){},"0e5e":function(e,t,a){"use strict";var i=a("2497"),r=a("bc3a"),o=a.n(r),n=a("c596");t["a"]={query:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_query,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryShopList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.Component_queryShops,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryBrandList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.Component_queryBrands,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},querySeriesList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.Component_querySeries,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryTypeList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.Component_queryTypes,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryDimList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_queryDimList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryInsuranceList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_queryInsuranceList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryTerminalList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_queryTerminalList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryTerminalInfo:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_queryTerminalInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},update:function(e,t,a){o.a.post(n["g"].vehicleMgmt.VehicleBaseInfo_update,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},add:function(e,t,a){o.a.post(n["g"].vehicleMgmt.VehicleBaseInfo_add,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))}}},"0f32":function(e,t,a){"use strict";var i=a("75e2"),r=a.n(i);r.a},1029:function(e,t,a){"use strict";var i=a("f9a5"),r=a.n(i);r.a},"11e9":function(e,t,a){"use strict";var i=a("2497"),r=a("bc3a"),o=a.n(r),n=a("c596");t["a"]={getCommodityList:function(e,t,a){o.a.get(n["g"].commodity.getCommodityList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delete:function(e,t,a){o.a.delete(n["g"].commodity.delete,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},query:function(e,t,a){o.a.get(n["g"].commodity.query,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},soldoutAndPutaway:function(e,t,a){o.a.post(n["g"].commodity.soldoutAndPutaway,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},cloneProduct:function(e,t,a){o.a.post(n["g"].commodity.cloneProduct,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryPlatformCategoryTree:function(e,t,a){o.a.get(n["g"].commodity.queryPlatformCategoryTree,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryPlatformImportInfo:function(e,t,a){o.a.get(n["g"].commodity.queryPlatformImportInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},importPlatformProduct:function(e,t,a){o.a.post(n["g"].commodity.importPlatformProduct,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},audit:function(e,t,a){o.a.post(n["g"].commodity.audit,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},auditTarget:function(e,t,a){o.a.post(n["g"].commodity.auditTarget,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},recallProduct:function(e,t,a){o.a.get(n["g"].commodity.recallProduct,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryFilters:function(e,t,a){o.a.get(n["g"].commodity.queryFilters,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))}}},"150f":function(e,t,a){},"172f":function(e,t,a){"use strict";var i=a("3b38"),r=a.n(i);r.a},"18eb":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"biz-tag-select"},[a("div",{staticClass:"tag-content"},[a("div",{staticClass:"tag-show-eara"},e._l(e.curSelectedTags,(function(t,i){return a("el-tag",{key:i,staticClass:"sel-tag",attrs:{closable:""},on:{close:function(a){return e.onClose(t,i)}}},[e._v(" "+e._s(t.name?t.name:t)+" ")])})),1),a("div",{staticClass:"select-area"},[a("div",{staticClass:"search-container"},[e.bAddTag?a("el-input",{attrs:{placeholder:"请输入关键词，按回车添加新标签"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.tagName,callback:function(t){e.tagName=t},expression:"tagName"}}):e._e()],1),e.tagList.length?a("div",{staticClass:"tag-container"},[a("el-checkbox-group",{attrs:{size:"small"},on:{change:e.onChange},model:{value:e.curSelectedTags,callback:function(t){e.curSelectedTags=t},expression:"curSelectedTags"}},e._l(e.curShowTags,(function(t,i){return a("el-checkbox-button",{key:i,staticClass:"tag-column",attrs:{label:t.name}},[e._v(e._s(t.name)+" ")])})),1),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showMore,expression:"showMore"}],staticClass:"more-btn",attrs:{small:"",type:"primary"},on:{click:e.onMore}},[e._v("更多...")])],1):a("div",{staticClass:"empty"},[e._v("暂无标签数据")])])])])},r=[],o=(a("4160"),a("d81d"),a("a434"),a("b0c0"),a("ac1f"),a("5319"),a("159b"),a("1ab1")),n=a("c596"),s={name:"biz-tag-select",data:function(){return{curSelectedTags:[],tagName:"",tagCatrgoryId:"",showMore:!1,curShowTags:[]}},props:{tagList:{type:Array},selectedTags:{type:Array},bAddTag:{type:Boolean,default:!0},selectType:{type:String},categoryType:{type:String,default:function(){return""}}},components:{},computed:{},watch:{selectedTags:function(e){this.curSelectedTags=e.map((function(e){return e.name?e.name:e}))},tagList:function(e){var t=this;e&&e.length&&(this.curShowTags.splice(0,this.curShowTags.length),this.tagCatrgoryId=e[0].tagCategory.id,this.showMore=e.length>6,e.forEach((function(e,a){a<6&&t.curShowTags.push(e)})))}},methods:{getCurSelectedTags:function(e){var t,a,i=this;return t=[],this.curSelectedTags.forEach((function(e){i.tagList.forEach((function(i){i.name===e&&(a={},a.id=i.id,a.name=i.name,t.push(a))}))})),t},onChange:function(e){"order"===this.selectType&&this.curSelectedTags.length>1&&(this.curSelectedTags.pop(),this.$message.warning("您已选择标签，如需要变更请先删除之前的选择")),this.$emit("change",e)},onClose:function(e,t){console.log(e),this.curSelectedTags.splice(t,1)},handleInputConfirm:function(){this.tagName=this.tagName.replace(/\s+/g,""),this.tagName&&(this.tagCatrgoryId?this.addTag():"店铺特色"===this.categoryType&&this.getTagCatrgoryId())},getTagCatrgoryId:function(){var e=this,t={categoryType:"店铺特色",isIncludeParent:"1"};o["a"].get(n["g"].systemSetting.storeTagcategories,t).then((function(t){t.content.length&&(e.tagCatrgoryId=t.content[0].id,e.addTag())})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},addTag:function(){var e=this,t={name:this.tagName,hierarchy:"1",tagCategory:{id:this.tagCatrgoryId}};o["a"].post(n["g"].systemSetting.deleteTag,t).then((function(t){e.$emit("addSuccess"),console.log(e.curSelectedTags),e.tagName=""})).catch((function(t){e.$message.warning(t.errorMessage),console.log(t.errorMessage)}))},onMore:function(){"shopProfile"===this.selectType?this.$emit("showMore"):(this.showMore=!1,this.curShowTags=this.tagList)}}},l=s,c=(a("663e"),a("2877")),d=Object(c["a"])(l,i,r,!1,null,null,null),p=d.exports;t["a"]=p},"1fac":function(e,t,a){},2086:function(e,t,a){"use strict";var i=a("2497"),r=a("bc3a"),o=a.n(r),n=a("c596");t["a"]={getList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getMemberCardList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getRightsList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listDistributeRights:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.listDistributeRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listCardTemplate:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.listCardTemplate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistVbean:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getlistVbean,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getIntegralList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getIntegralList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listProduct:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.listProduct,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryUserRights:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.queryUserRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryUserCoupons:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.queryUserCoupons,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listByRights:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.listByRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardInfo:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getVipCardInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardTemplate:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getVipCardTemplate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},memberRankList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.memberRankList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},setting:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.setting,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},settingUpdate:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.setting,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryPeople:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.queryPeople,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delete:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.memberCard.deleteManage,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},verification:function(e,t,a){o.a.post(n["g"].memberCardMgmt.vipRights.verification,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateTemplate:function(e,t,a){o.a.put(n["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createTemplate:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delTemplate:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.memberCard.updateTemplate,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},distributeRights:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.distributeRights,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},distributeAssignedRights:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.distributeAssignedRights,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateVipCardState:function(e,t,a){o.a.put(n["g"].memberCardMgmt.memberCard.updateVipCardState,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createVipCard:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.createVipCard,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createBean:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.createBean,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createPoint:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.createPoint,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},addScore:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.addScore,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},reduceDeposit:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.reduceDeposit,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistUpgrade:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getlistUpgrade,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistStore:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getlistStore,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateGrade:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.updateGrade,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardGradeInfo:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getVipCardGradeInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},editVipCardGrade:function(e,t,a){o.a.put(n["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},addVipCardGrade:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delVipCardGrade:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.memberCard.VipCardGrade,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listAuthority:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.listAuthority,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},vipRightsList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryrightsClass:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.get,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getFirstClassifies:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.getFirstClassifies,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.rightsCouponList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryRightsCoupon:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.queryRightsCoupon,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},memberCardBox:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.memberCardBox,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},editRightsClass:function(e,t,a){o.a.put(n["g"].memberCardMgmt.vipRights.edit,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createRightsClass:function(e,t,a){o.a.post(n["g"].memberCardMgmt.vipRights.add,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponUpdate:function(e,t,a){o.a.put(n["g"].memberCardMgmt.vipRights.rightsCouponUpdate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponCreate:function(e,t,a){o.a.post(n["g"].memberCardMgmt.vipRights.rightsCouponCreate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},deleteRightscoupon:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.vipRights.deleteRightscoupon,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},deleteRights:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.vipRights.delete,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},certificate:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.certificate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))}}},2119:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"biz-avatar-uploader-multi"},[a("div",{staticClass:"el-upload-list el-upload-list--picture-card"},[e._l(e.value,(function(t){return a("div",{key:t.index,staticClass:"el-upload-list__item is-success",attrs:{tabindex:"0"}},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:t,alt:""}}),a("span",{staticClass:"el-upload-list__item-actions"},[a("span",{staticClass:"el-upload-list__item-preview",on:{click:function(a){return e.handlePictureCardPreview(t)}}},[a("i",{staticClass:"el-icon-zoom-in"})]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isShowDelete,expression:"isShowDelete"}],staticClass:"el-upload-list__item-delete",on:{click:function(a){return e.handleRemove(t)}}},[a("i",{staticClass:"el-icon-delete"})])])])})),e.showUploader?a("el-upload",{ref:"upload",class:e.disabled?"avatar-uploader-disabled":"avatar-uploader",style:e.avatarStyle,attrs:{multiple:"","show-file-list":!1,accept:"image/*",limit:Number(e.limit),"file-list":e.fileList,data:e.fileData,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,name:"file",action:"/admin/file/uploads.jhtml",disabled:e.disabled}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:e.plusStyle})]):e._e()],2),a("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},r=[],o=(a("99af"),a("d81d"),a("a434"),a("ac1f"),a("1276"),{name:"ImgUploader",props:{value:{type:Array,default:function(){return[]}},imageForm:{type:Array,default:function(){return[]}},showUploader:{type:Boolean,default:function(){return!0}},size:{type:Object,default:function(){return{width:100,height:100}}},limit:{default:"9"},disabled:{type:Boolean,default:function(){return!1}},isShowDelete:{type:Boolean,default:function(){return!0}}},data:function(){return{fileData:{type:"0"},fileList:[],dialogVisible:!1,dialogImageUrl:""}},methods:{handleSuccess:function(e){var t=this.value.concat(e.fis[0].url);this.$emit("input",t)},handleExceed:function(e,t){this.$message.warning("只能上传".concat(this.limit,"张图片"))},handleRemove:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.removePic(e)}))},removePic:function(e){for(var t=this.value,a=0;a<t.length;a++)t[a]===e&&t.splice(a,1);this.$emit("input",t)},handlePictureCardPreview:function(e){this.dialogImageUrl=e,this.dialogVisible=!0}},computed:{plusStyle:function(){return{"line-height":this.size.height+"px"}},avatarStyle:function(){return{height:this.size.height+"px",width:this.size.width+"px"}}},watch:{value:function(e,t){console.log("value: ",this.value),this.fileList=e.map((function(e){return{name:e.split("/")[e.split("/").length-1],url:e}}))}},components:{}}),n=o,s=(a("d74a"),a("2877")),l=Object(s["a"])(n,i,r,!1,null,null,null);t["a"]=l.exports},"21c5":function(e,t,a){},2413:function(e,t,a){},2828:function(e,t,a){"use strict";var i=a("7b53"),r=a.n(i);r.a},"28d7":function(e,t,a){},2992:function(e,t,a){"use strict";var i=a("d437"),r=a.n(i);r.a},"29b8":function(e,t,a){"use strict";var i=a("150f"),r=a.n(i);r.a},"3b38":function(e,t,a){},"3f67":function(e,t,a){},"443b":function(e,t,a){"use strict";a("4de4");var i=a("c596"),r=a("1ab1"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":"",visible:e.visible,title:"自定义列","custom-class":"biz-columns",width:"500px"},on:{close:e.onClose}},[a("div",{staticClass:"columns-wrap"},[a("biz-flex-table",{ref:"table",attrs:{checkable:!1,tableData:e.tableData},on:{"selection-change":e.selectionChangeHandler}},[a("el-table-column",{attrs:{type:"selection",width:"50",selectable:e.getSelectable}}),a("el-table-column",{attrs:{label:"信息",prop:"name"}}),a("el-table-column",{attrs:{prop:"tag",label:"排序"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.$index;return[a("el-button",{attrs:{icon:"el-icon-sort-up",type:"text",disabled:0===i},on:{click:function(t){return e.onUp(i)}}}),a("el-button",{attrs:{icon:"el-icon-sort-down",type:"text",disabled:i===e.tableData.length-1},on:{click:function(t){return e.onBottom(i)}}})]}}])})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.onClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确 定")])],1)])},n=[],s=(a("7db0"),a("a434"),a("b85c")),l=a("04d3"),c={name:"biz-columns",components:{BizFlexTable:l["c"]},props:{visible:Boolean,tableId:String},data:function(){return{id:"",tableName:"",selections:[],tableData:[]}},computed:{},watch:{visible:function(e){e?this.makeRowDisplayable():this.saveSelection()},tableId:function(){this.getTableColumns()}},mounted:function(){this.getTableColumns()},methods:{getTableColumns:function(){var e=this;r["a"].get(i["g"].user.columns,{tableId:this.tableId}).then((function(t){e.tableData=t.data.columnDatas,e.id=t.data.id,e.tableName=t.data.tableName}))},getSelectable:function(e){return e.isEditable},selectionChangeHandler:function(e){this.selections=e},saveSelection:function(){var e,t=this,a=Object(s["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var i=e.value;i.displayable=!1}}catch(l){a.e(l)}finally{a.f()}var r,o=Object(s["a"])(this.selections);try{var n=function(){var e=r.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(o.s();!(r=o.n()).done;)n()}catch(l){o.e(l)}finally{o.f()}},onUp:function(e){this.tableData[e]=this.tableData.splice(e-1,1,this.tableData[e])[0]},onBottom:function(e){this.tableData[e]=this.tableData.splice(e+1,1,this.tableData[e])[0]},onClose:function(){this.$emit("update:visible",!1)},update:function(){var e,t=this,a=Object(s["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var o=e.value;o.displayable=!1}}catch(p){a.e(p)}finally{a.f()}var n,l=Object(s["a"])(this.selections);try{var c=function(){var e=n.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(l.s();!(n=l.n()).done;)c()}catch(p){l.e(p)}finally{l.f()}var d={columnDatas:this.tableData,id:this.id,tableId:this.tableId,tableName:this.tableName};console.log(d),r["a"].put(i["g"].user.columns,d).then((function(e){t.$emit("update"),t.$emit("update:visible",!1)}))},makeRowDisplayable:function(){var e=this;setTimeout((function(){var t,a=Object(s["a"])(e.tableData);try{for(a.s();!(t=a.n()).done;){var i=t.value;e.$refs.table.$refs.table.toggleRowSelection(i,i.displayable)}}catch(r){a.e(r)}finally{a.f()}}),20)}}},d=c,p=(a("ec6b"),a("2877")),u=Object(p["a"])(d,o,n,!1,null,null,null),m=u.exports,f=m;t["a"]={components:{BizColumnOperation:l["a"],BizColumns:f},data:function(){return{columnsSettingVisible:!1,columns:[]}},created:function(){this.getTableId(),this.getColumns()},methods:{onCustomColumns:function(){this.columnsSettingVisible=!0},getColumns:function(){var e=this;console.log(12),r["a"].get(i["A"].columns,{tableId:this.tableId}).then((function(t){e.columns=[],setTimeout((function(){e.columns=t.data.columnDatas.filter((function(e){return e.displayable})),e.$refs.table&&setTimeout((function(){e.$refs.table.doLayout()}),50)}),20)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getTableId:function(){}}}},"46fc":function(e,t,a){"use strict";a("ac1f"),a("1276");t["a"]=function(e,t){if(!e||!t)return 0;var a=t.split(":"),i=e.split(":"),r=60*(i[0]-a[0])+(i[1]-a[1]);return r<0?0:r}},"4c36":function(e,t,a){"use strict";var i=a("9ba4"),r=a.n(i);r.a},"53b5":function(e,t,a){"use strict";var i=a("2413"),r=a.n(i);r.a},54889:function(e,t,a){"use strict";var i=a("c0a6"),r=a.n(i);r.a},5801:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"order-product-info"},[e.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),a("el-form",{attrs:{inline:!0,disabled:!e.isEdit,"inline-message":!0}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addProduct}},[e._v("新增")]),a("el-form-item",{staticClass:"subTotal",attrs:{label:"合计:",prop:"subTotal"}},[e._v(e._s(e.subTotal))])],1),a("biz-list",{key:Math.random(),ref:"table",staticStyle:{width:"100%",height:"100%"},attrs:{tableData:e.tableData,loading:e.loading}},[a("el-table-column",{attrs:{prop:"sn",label:"编号"}}),a("el-table-column",{attrs:{prop:"fullName",label:"商品名称"}}),a("el-table-column",{attrs:{prop:"barCode",label:"条码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product&&t.row.product.barCode?t.row.product.barCode:""))]}}])}),a("el-table-column",{attrs:{prop:"price",label:"商品价格"}}),a("el-table-column",{attrs:{prop:"minimumPackQuantity",label:"最小包装数","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product&&t.row.product.minimumPackQuantity?t.row.product.minimumPackQuantity:""))]}}])}),a("el-table-column",{attrs:{prop:"quantity",label:"数量","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{attrs:{size:"mini",min:1},on:{change:function(a){return e.quantityChange(t.row.quantity)}},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[e._v(e._s(t.row.quantity?(Number(t.row.quantity)*Number(t.row.price)).toFixed(2):"")+" ")])])}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作",type:"index"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[e.isEdit?a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteHandeler(t)}}},[e._v("删除")])],1):e._e()])}}])})],1),a("biz-pagination",{attrs:{pagination:e.pagination},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),a("el-dialog",{attrs:{visible:e.dialogTableVisible,center:"",width:"1200px","append-to-body":""},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"right"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.print}},[e._v("打印")])],1)])],1),a("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[e._v(e._s(e.title))])]),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"right"}},[e._v("打印日期："+e._s(e.formatDate((new Date).getTime())))])])],1),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("订单编号："+e._s(e.shippingData.sn))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("配送方式："+e._s(e.shippingData.shippingMethod))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("收货人："+e._s(e.shippingData.consignee))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("电话："+e._s(e.shippingData.phone))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("地址："+e._s(e.shippingData.address))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("买家留言："+e._s(e.shippingData.memo))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"})])],1),a("el-table",{staticClass:"table-class",attrs:{data:e.gridData}},[a("el-table-column",{attrs:{property:"isTotal",width:"50",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isTotal?a("div",[e._v("合计")]):a("div",[e._v(e._s(t.$index+1))])]}}])}),a("el-table-column",{attrs:{property:"name",label:"商品名",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(e._s(t.row.name))]}}],null,!0)}),a("el-table-column",{attrs:{property:"address",label:"规格"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(e._s(-1!==t.row.fullName.indexOf("[")?t.row.fullName.split("[")[1].split("]")[0]:""))]}}],null,!0)}),a("el-table-column",{attrs:{property:"price",label:"单价"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v("￥"+e._s(t.row.price))]}}],null,!0)}),a("el-table-column",{attrs:{property:"quantity",label:"数量"}}),a("el-table-column",{attrs:{property:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("￥"+e._s(t.row.subTotal))]}}])})],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("运费：￥"+e._s(e.formData.freight))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("优惠金额：￥"+e._s(e.formData.couponDiscount))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("调整金额：￥"+e._s(e.formData.offsetAmount))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("订单金额：￥"+e._s(e.formData.originalAmount))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("仓库签字：")])])],1)],1)])],1),a("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:e.showDialog,tableData:e.giftList,pagination:e.dialogPagination,filters:e.dialogFilters,selectionKeys:e.selectedGiftIds},on:{"update:visibility":function(t){e.showDialog=t},pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,confirmed:e.confirmedProduct,filterDataChange:e.dialogFilterDataChange,selectionChange:e.selectionChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"dialog-column"},[a("img",{staticClass:"productImg",attrs:{src:t.row.image||e.DefaultImg,onerror:e.errorImg}}),a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.fullName))])])]}}])}),a("el-table-column",{attrs:{property:"barCode",label:"条码"}}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),a("el-table-column",{attrs:{property:"price",label:"价格"}}),a("el-table-column",{attrs:{label:"剩余库存/库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.availableStock)+"/"+e._s(t.row.stock))])]}}])})],1)],1)},r=[],o=(a("99af"),a("4de4"),a("4160"),a("c975"),a("d81d"),a("a434"),a("b0c0"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("159b"),a("5530")),n=a("7558"),s=a("5c40"),l=a("8330"),c=a("f36f"),d=a("e42c"),p=a("2086"),u=a("225d"),m=a("2f62"),f=a("c596"),h=a("1ab1"),g=a("af3f"),b=a("f3ac"),v=a.n(b),y={name:"NewsMgmt",props:{itemId:{type:String},agentId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},errorImg:'this.src="/resources/admin/images/default/product-default.png"',DefaultImg:v.a,selectedGiftList:[],selectedGiftIds:[],showDialog:!1,dialogFilters:[{type:"input",placeholder:"请输入编号/商品名/条码",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,subTotal:"",height:"585",subTotalAll:"",tableData:[],restaurants:[],selections:[],orderItems:[],selectionList:[],dialogTableVisible:!1,gridData:[],formData:{},shippingData:{},title:"",form:{products:""},operations:[{label:"保存",name:"save",type:"primary"},{label:"打印",name:"certificate",type:"primary"}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:n["a"],BizPagination:s["a"],BizGrid:c["a"],BizSaveButton:l["a"],vueEasyPrint:u["a"],BizDialogSelector:g["a"]},watch:{itemId:function(e){this.tableData=[],this.subTotal="",this.itemId&&this.getList()}},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},methods:Object(o["a"])(Object(o["a"])({},Object(m["c"])(["getUser"])),{},{addProduct:function(){this.dialogFilters[0].value="",this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getGiftList()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getGiftList()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getGiftList()},getGiftList:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[0].value,shopId:window.top.SHOP_ID||"",isOutOfStock:"0",agentId:this.agentId,type:"couponOrder"===this.$route.params.orderType?"7":""};h["a"].get("purchaseOrder"===window.top.dType?"/admin/purchaseOrderManage/product/list.jhtml":f["g"].memberCardMgmt.memberCard.listProduct,t).then((function(t){e.giftList=t.content,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},confirmedProduct:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(e.quantity="1",t.selectedGiftList.push(e))}));this.selectedGiftList.map((function(e){Number(e.quantity)*Number(e.price)})),this.selectedGiftList.forEach((function(e){t.handleSelect(e),t.listProduct(e)}))},print:function(){this.$refs.easyPrint.print()},certificate:function(){var e=this;if(!this.itemId)return this.$message.warning("请先生成一个订单"),!1;var t={orderId:this.itemId,shopId:window.top.SHOP_ID||""};h["a"].get("purchaseOrder"===window.dType?f["l"].delivery.queryShippingVoucherPurchase:f["l"].delivery.queryShippingVoucher,t).then((function(t){e.dialogTableVisible=!0,e.title=e.getUser().shop?e.getUser().shop.name+"发货单":"发货单",e.formData=t.order,e.shippingData=t.shipping||{},e.userCard=t.userCard,e.gridData=t.order.orderItems})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},formatDate:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=a+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r);return o},resize:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},operate:function(e){this[e]()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},getList:function(){var e=this;console.log("window.top.dType"+window.top.dType),this.loading=!0;var t={orderId:this.itemId,pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};d["a"].viewProducts(t,(function(t){e.loading=!1,e.tableData=t.orderItems,e.subTotal=t.order.price,e.pagination.total=Number(t.total),console.log("this.tableData",e.tableData)}),(function(e){console.log(e)}))},handleSelect:function(e){var t=!1;if(e.productId=e.id,e.id="",this.subTotal=(Number(this.subTotal)+Number(e.quantity)*Number(e.price)).toFixed(2),0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].productId===e.productId){this.tableData[a].quantity=(Number(this.tableData[a].quantity)+1).toString(),t=!0;break}t||this.tableData.push(Object.assign(e,{product:{minimumPackQuantity:e.minimumPackQuantity,barCode:e.barCode}}))}else this.tableData.push(e)},deleteHandeler:function(e){this.tableData.splice(e.$index,1),this.subTotal=(Number(this.subTotal)-Number(e.row.price)*Number(e.row.quantity)).toFixed(2)},quantityChange:function(e){var t=0;this.tableData.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.subTotal=t?t.toFixed(2):""},save:function(){var e=this;this.orderItems=this.tableData.map((function(e){return{id:e.id||"",productId:e.productId?e.productId:e.id,quantity:e.quantity||"",price:e.price||""}}));var t=!1;if(this.tableData.forEach((function(a){console.log(a.quantity),-1!==String(a.quantity).indexOf(".")&&(e.$message.warning("数量不能为小数"),t=!0),a.quantity%a.product.minimumPackQuantity!==0&&(e.$message.warning("数量为最小包装数的整数倍"),t=!0)})),t)return!1;!this.itemId&&this.$emit("setOrderItems",this.orderItems),this.itemId&&d["a"].addOrderItems({orderId:this.itemId,orderData:{orderItems:this.orderItems},shopId:window.top.SHOP_ID},(function(t){e.$emit("setOrderItems",e.orderItems),e.$emit("operationSuccess"),e.loading=!1}),(function(t){e.loading=!1,e.getList(),e.$message.warning(t.errorMessage)}))},listProduct:function(e){var t=this;p["a"].listProduct({searchValue:e.name},(function(e){t.restaurants=e.content.map((function(e){return{fullName:e.fullName,sn:e.sn,price:e.price,quantity:"1",subTotal:e.price,productId:e.id,value:e.fullName}})),t.loading=!1}),(function(e){console.log(e),console.log("code错误")}))},querySearchAsync:function(e,t){var a=this.restaurants,i=e?a.filter(this.createStateFilter(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout((function(){t(i)}),300*Math.random())},createStateFilter:function(e){return function(e){return!0}},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()}})},C=y,I=(a("8f05"),a("2877")),w=Object(I["a"])(C,i,r,!1,null,null,null);t["a"]=w.exports},"5ffc":function(e,t,a){"use strict";var i=a("df22"),r=a.n(i);r.a},"663e":function(e,t,a){"use strict";var i=a("3f67"),r=a.n(i);r.a},"697f":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:e.title,visible:e.dialogVisible,"append-to-body":e.appendToBody},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close,open:e.open}},[e._t("top"),a("biz-flex-table",{ref:"table",attrs:{showTable:e.showTable,operations:e.operations,filters:e.filters,tags:e.tags,rowKeys:e.rowKeys,pagination:e.pagination,tableData:e.tableData,rowClassName:e.rowClassName,loading:e.loading,memberIds:e.memberIds,checkable:e.checkable,isDepotOutNew:e.isDepotOutNew,checkedTable:e.checkedTable},on:{operate:e.operate,"row-click":e.rowClick,"filter-data-change":e.filterDataChange,"select-all":e.handleSelectAll,select:e.handleSelectionChange,"size-change":e.pageSizeChange,"current-change":e.currentPageChange,"cascader-change":e.cascaderChange,"active-item-change":e.activeItemChange,"sort-change":e.handleSortChange}},[e._t("default")],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isClear?a("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v("清除")]):e._e(),a("el-button",{attrs:{size:"small"},on:{click:e.close}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmed}},[e._v("确定")])],1)],2)},r=[],o=(a("99af"),a("4160"),a("c975"),a("a434"),a("a9e3"),a("159b"),a("04d3")),n={name:"BizDialogSelector",components:{BizFlexTable:o["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},max:{type:Number,default:0},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},isClear:{default:!0,type:Boolean},rowClassName:{type:Function,default:function(){return null}},selectionKeys:{type:Array,default:function(){return[]}},memberIds:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},isDepotOut:{type:Boolean,default:function(){return!1}},checkTable:{type:Array,default:function(){return[]}},showTable:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],isDepotOutNew:!1,checkedTable:[],innerSelection:[]}},methods:{rowKeys:function(e){return e.id},generateSelectionKeys:function(e,t){if(e.indexOf(t)>=0)this.innerSelectionKeys.push(t[this.keyField]),this.innerSelection.push(t);else{var a=this.innerSelectionKeys.indexOf(t[this.keyField]);this.innerSelectionKeys.splice(a,1),this.innerSelection.splice(a,1)}},open:function(e){this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(e){this.innerSelectionKeys=[],this.innerSelection=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){if(this.innerSelectionKeys.length>0||!this.showTable){if(!this.showTable&&!/(http|https):\/\/([\w.]+\/?)\S*/.test(this.filters[2].value))return void this.$message.warning("必须以http,https开头,且需符合URL规范,检查格式是否正确");this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1}else this.$message("请选择一项")},clear:function(){var e=this;this.tableData.forEach((function(t){e.$refs.table.toggleRowSelection(t,!1)})),this.innerSelectionKeys=[],this.innerSelection=[]},updateSelection:function(){var e=this;this.$refs&&this.$refs.table&&this.tableData.forEach((function(t){e.innerSelectionKeys.indexOf(t[e.keyField])>=0?(e.$refs.table.toggleRowSelection(t,!0),"single"===e.selectionMode&&(e.$refs.table.$refs.table.setCurrentRow(t),e.innerSelection=[t])):e.$refs.table.toggleRowSelection(t,!1)}))},operate:function(e){this.$emit("operate",e)},filterDataChange:function(e){this.$emit("filterDataChange",e)},handleSelectAll:function(e){var t=this;0===e.length?this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a>=0&&t.innerSelectionKeys.splice(a,1)})):this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a<0&&t.innerSelectionKeys.push(e[t.keyField])})),this.$emit("selectionChange",e)},handleSelectionChange:function(e,t){this.generateSelectionKeys(e,t),this.$emit("selectionChange",e)},pageSizeChange:function(e){this.$emit("pageSizeChange",e)},currentPageChange:function(e){this.$emit("currentPageChange",e)},cascaderChange:function(e){this.$emit("cascaderChange",e)},activeItemChange:function(e){this.$emit("active-item-change",e)},handleSortChange:function(e){this.$emit("sort-change",e)},rowClick:function(e,t,a){"single"===this.selectionMode&&(this.innerSelectionKeys=[e[this.keyField]],this.innerSelection=[e])}},watch:{visibility:function(e,t){this.dialogVisible=e,this.isDepotOutNew=this.isDepotOut,this.checkedTable=this.checkTable}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){},updated:function(){this.updateSelection()}},s=n,l=(a("0943"),a("2877")),c=Object(l["a"])(s,i,r,!1,null,null,null);t["a"]=c.exports},7039:function(e,t,a){var i=a("23e7"),r=a("d039"),o=a("057f").f,n=r((function(){return!Object.getOwnPropertyNames(1)}));i({target:"Object",stat:!0,forced:n},{getOwnPropertyNames:o})},7339:function(e,t,a){"use strict";var i=a("f604"),r=a.n(i);r.a},"75e2":function(e,t,a){},"7b53":function(e,t,a){},"8f05":function(e,t,a){"use strict";var i=a("28d7"),r=a.n(i);r.a},"9b2e":function(e,t,a){"use strict";var i=a("0a05"),r=a.n(i);r.a},"9ba4":function(e,t,a){},a9f4:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"apply-info"},[a("div",{staticClass:"apply-info-div"},[a("div",{staticClass:"apply-info-content"},[a("div",{staticClass:"apply-top-content"},[a("div",{staticClass:"apply-follow-up",on:{click:function(t){return e.onOrderSchedules(e.orderData.id)}}},[a("span",[e._v("申请单跟踪")]),a("div",{staticClass:"apply-state"},[a("span",[e._v(e._s(e.getOrderState))]),a("i",{staticClass:"el-icon-arrow-right",staticStyle:{"margin-left":"10px",color:"#808080"}})])]),a("div",{staticClass:"receiver-info"},[a("span",[e._v(e._s(e.orderData.depot?e.orderData.depot.contactor:""))]),a("span",[e._v(e._s(e.orderData.depot?e.orderData.depot.phone:""))]),a("p",[a("i",{staticClass:"el-icon-location-outline",staticStyle:{"margin-right":"5px"}}),e._v(" "+e._s(e.orderData.depot?e.orderData.depot.address:"")+" ")])])]),a("div",{staticClass:"apply-info-new"},[a("div",{staticClass:"shop-name",on:{click:e.goSupplier}},[a("img",{attrs:{src:e.iconShop}}),a("span",{staticStyle:{fontSize:"14px"}},[e._v(e._s(e.orderData.relatePartnerName))])]),e._l(e.orderData.itemDatas,(function(t,i){return a("div",{key:i},[a("div",{staticClass:"good-info"},[a("div",{staticClass:"goods-img"},[a("img",{ref:"img",refInFor:!0,staticClass:"img",attrs:{src:t.thumbnail&&t.thumbnail.indexOf("/")>=0?t.thumbnail:e.defaultImg},on:{error:function(t){return e.imgError(i)}}})]),a("div",{staticClass:"good-right"},[a("div",{staticClass:"good-name"},[a("span",{staticStyle:{flex:"1"}},[e._v(" "+e._s(t.specValue)+" ")])]),a("div",{staticStyle:{"margin-bottom":"10px"}},[t.product.barCode?a("span",{staticStyle:{"font-size":"14px","margin-right":"10px"}},[e._v(e._s(t.product.barCode))]):e._e()]),a("div",{staticClass:"good-price"},[a("span",[e._v("￥"+e._s(t.price))]),a("span",[e._v("X"+e._s(t.amount))])])])])])}))],2),a("div",{staticClass:"price-info-content"},[a("div",{staticClass:"total-price"},[a("span",[e._v("合计")]),a("span",{staticStyle:{color:"red"}},[e._v("￥"+e._s(e.orderData.totalFee))])])]),a("div",{staticClass:"pay-type"},[a("span",[e._v("单据编号: "+e._s(e.orderData.sn))]),a("span",[e._v("创建时间: "+e._s(e.orderData.createDate))]),a("span",[e._v("申请人: "+e._s(e.orderData.applierName))])])])]),e.isPend?a("div",{staticStyle:{float:"right"},attrs:{slot:"bottom"},slot:"bottom"},[e.hasAuthExamine&&("1"===e.orderData.state&&"1"===e.orderData.audit||"2"===e.orderData.state&&"1"===e.orderData.audit)?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.toPass(e.orderData,"1")}}},[e._v("审核")]):e._e(),"0"===e.orderData.state?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.statusChange(e.orderData,"0")}}},[e._v("提交")]):e._e(),"1"===e.orderData.state&&"1"===e.orderData.isApplier?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.statusChange(e.orderData,"3")}}},[e._v("撤回")]):e._e()],1):e._e(),a("el-dialog",{attrs:{visible:e.dialogVisiable,center:"",width:"800px","min-height":"400px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(t){e.dialogVisiable=t}}},[a("apply-follow",{ref:"invoice"})],1),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.showPassOrder,center:"","append-to-body":"","custom-class":"close-order-dialog",title:"审核"},on:{"update:visible":function(t){e.showPassOrder=t}}},[a("div",[a("div",{staticClass:"reson-container"},[a("span",[e._v("审核结果：")]),a("el-radio",{attrs:{label:"1",size:"mini"},model:{value:e.auditState,callback:function(t){e.auditState=t},expression:"auditState"}},[e._v("通过")]),a("el-radio",{attrs:{label:"2",size:"mini"},model:{value:e.auditState,callback:function(t){e.auditState=t},expression:"auditState"}},[e._v("驳回")]),a("div",{directives:[{name:"show",rawName:"v-show",value:"2"===e.auditState,expression:"auditState==='2'"}],staticStyle:{padding:"5px 0px","margin-top":"15px"}},[a("span",[e._v("驳回理由：")]),a("el-select",{staticClass:"order-select",attrs:{placeholder:"请选择驳回理由",size:"mini"},model:{value:e.curSelectCloseReason,callback:function(t){e.curSelectCloseReason=t},expression:"curSelectCloseReason"}},e._l(e.reasonList,(function(e){return a("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-input",{staticStyle:{"margin-top":"15px"},attrs:{type:"textarea"},model:{value:e.remarks,callback:function(t){e.remarks=t},expression:"remarks"}})],1)]),a("div",{staticClass:"close-button",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.showPassOrder=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.statusChange(e.row,e.auditState)}}},[e._v("确定")])],1)])],1)},r=[],o=(a("caad"),a("d3b7"),a("2532"),a("5530")),n=a("f36f"),s=a("2f62"),l=a("1ab1"),c=a("c596"),d=a("e83a"),p=a.n(d),u=a("f606"),m=a.n(u),f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"order-log-info"},[a("div",{staticStyle:{"text-align":"center","font-size":"15px","margin-bottom":"20px"}},[e._v("单据进度跟踪")]),a("el-steps",{attrs:{direction:"vertical",space:"auto"}},[a("el-step",{attrs:{title:"新申请",status:"1"===e.active?"finish":"wait "}},[a("div",{attrs:{slot:"description"},slot:"description"},e._l(e.orderData.schedules,(function(t,i){return"0"===t.state||"1"===t.state?a("div",{key:i,staticClass:"logInfo"},[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s("0"===t.state?"已创建":"已提交"))]),a("p",[e._v(e._s(t.time))])]):e._e()})),0)]),a("el-step",{attrs:{title:"审核",status:"2"===e.active?"finish":"wait "}},[a("div",{attrs:{slot:"description"},slot:"description"},[e._l(e.orderData.schedules,(function(t,i){return"2"===t.state||"3"===t.state?a("div",{key:i},[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(t.adminName+"已通过"))]),a("p",[e._v("备注："+e._s(t.remarks))]),a("p",[e._v(e._s(t.time))])]):e._e()})),e._l(e.orderData.schedules,(function(t,i){return"4"===t.state?a("div",{key:i},[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(t.adminName+"审核不通过"))]),a("p",[e._v("理由："+e._s(t.details))]),a("p",[e._v("备注："+e._s(t.remarks))]),a("p",[e._v(e._s(t.time))])]):e._e()}))],2)]),a("el-step",{attrs:{title:"审核通过/驳回",status:"3"===e.active?"finish":"wait "}},[a("div",{attrs:{slot:"description"},slot:"description"},["3"===e.orderData.state?a("div",[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s("审核通过"))])]):e._e(),"4"===e.orderData.state?a("div",[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s("审核驳回"))])]):e._e()])])],1)],1)},h=[],g={name:"NewsMgmt",props:{},data:function(){return{loading:!1,orderData:[],active:"",state:""}},components:{},watch:{},created:function(){},computed:{getOrderLogState:function(e){switch(this.state){case"0":return"已创建";case"1":return"已提交";case"2":return"审核中";case"3":return"已通过";case"4":return"审核通过";default:return""}}},methods:{operate:function(e){this[e]()},getList:function(e){var t=this,a={id:e};l["a"].get(c["g"].invoicing.purchaseApplyMgmt.purchaseApplyNew,a).then((function(e){t.orderData=e.data})).catch((function(){})).finally((function(){}))}}},b=g,v=(a("2992"),a("2877")),y=Object(v["a"])(b,f,h,!1,null,null,null),C=y.exports,I={name:"apply-info",data:function(){return{orderData:{},iconShop:m.a,defaultImg:p.a,dialogVisiable:!1,showPassOrder:!1,loading:!1,remarks:"",auditState:"1",row:{},curSelectCloseReason:"申报的商品与实际需要采购的商品不符",reasonList:[{label:"申报的商品与实际需要采购的商品不符",value:"申报的商品与实际需要采购的商品不符"},{label:"送达仓库地址填写错误",value:"送达仓库地址填写错误"},{label:"申报的商品供应方已停售或缺货",value:"申报的商品供应方已停售或缺货"},{label:"申报的商品数量有误",value:"申报的商品数量有误"},{label:"已与部分商品供应商终止合作",value:"已与部分商品供应商终止合作"},{label:"其他原因",value:"其他原因"}]}},props:{itemId:{type:String,default:""},isPend:{type:Boolean,default:!1}},watch:{itemId:function(e){this.getOrderInfo()}},components:{BizGrid:n["a"],ApplyFollow:C},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(s["c"])(["getUser"])),Object(s["c"])("Authority",["currentAuth"])),{},{hasAuthExamine:function(){return this.currentAuth.includes("admin:purchaseApplication.examine")},getOrderState:function(){switch(this.orderData.state){case"0":return"已创建";case"1":return"已提交";case"2":return"审核中";case"3":return"已通过";case"4":return"已驳回";default:return""}}}),methods:{goSupplier:function(){},showToast:function(e){this.$createToast({time:1e3,txt:e,type:"warn"}).show()},toPass:function(e,t){this.remarks="",this.row=e,this.showPassOrder=!0},onOrderSchedules:function(e){var t=this;this.dialogVisiable=!0,this.$nextTick((function(){t.$refs.invoice.getList(e)}))},getOrderInfo:function(){var e=this,t={id:this.itemId};l["a"].get(c["g"].invoicing.purchaseApplyMgmt.purchaseApplyNew,t).then((function(t){e.orderData=t.data})).catch((function(){})).finally((function(){}))},statusChange:function(e,t){var a=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0;var i={shopId:window.top.SHOP_ID||"",id:e.id,actionType:t,details:"2"===t?a.curSelectCloseReason:"",remarks:a.remarks};l["a"].post("/admin/invoicing/purchase/shopPurchaseApplyState.jhtml",i).then((function(e){a.$message.success("操作成功！"),a.loading=!1,a.showPassOrder=!1,a.$emit("operationSuccess")})).catch((function(e){a.loading=!1,e.errorMessage&&a.$message.warning(e.errorMessage)})).finally((function(){}))}))}},created:function(){}},w=I,S=(a("7339"),Object(v["a"])(w,i,r,!1,null,null,null));t["a"]=S.exports},af3f:function(e,t,a){"use strict";var i=a("697f");t["a"]=i["a"]},b06a:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"order-base-info"},[e.isEdit?i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"120px",size:"small",disabled:!e.isEdit,"inline-message":!0}},[e.itemId?i("el-form-item",{attrs:{label:"订单编号",prop:"sn"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.sn,callback:function(t){e.$set(e.form,"sn",t)},expression:"form.sn"}})],1):e._e(),i("el-form-item",{attrs:{label:"订单状态"}},[e.itemId?i("el-input",{attrs:{disabled:!0},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}}):i("el-select",{attrs:{disabled:"couponOrder"===this.$route.params.orderType},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.orderStateTypeList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e.showInfo?i("el-form-item",{attrs:{label:"订单原价",prop:"originalAmount"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.originalAmount,callback:function(t){e.$set(e.form,"originalAmount",t)},expression:"form.originalAmount"}})],1):e._e(),e.form.amountPrepay?i("el-form-item",{attrs:{label:"订金",prop:"amountPrepay"}},[i("el-input",{attrs:{disabled:""!==e.itemId&&("交易完成"===e.form.type||"订单关闭"===e.form.type||"已评价"===e.form.type)},model:{value:e.form.amountPrepay,callback:function(t){e.$set(e.form,"amountPrepay",t)},expression:"form.amountPrepay"}})],1):e._e(),e.form.amountFinalpay?i("el-form-item",{attrs:{label:"尾款",prop:"amountFinalpay"}},[i("el-input",{attrs:{disabled:""!==e.itemId&&("交易完成"===e.form.type||"订单关闭"===e.form.type||"已评价"===e.form.type)},model:{value:e.form.amountFinalpay,callback:function(t){e.$set(e.form,"amountFinalpay",t)},expression:"form.amountFinalpay"}})],1):e._e(),e.showInfo?i("el-form-item",{attrs:{label:"调整金额",prop:"offsetAmount"}},[i("el-input-number",{attrs:{"controls-position":"right",disabled:""!==e.itemId&&"2"===e.form.paymentStatus||"订单关闭"===e.form.type},on:{change:e.offsetAmountChange},model:{value:e.form.offsetAmount,callback:function(t){e.$set(e.form,"offsetAmount",t)},expression:"form.offsetAmount"}})],1):e._e(),e.showInfo?i("el-form-item",{attrs:{label:"订单现价",prop:"amount"}},[i("el-input",{attrs:{disabled:""!==e.itemId&&"2"===e.form.paymentStatus||"订单关闭"===e.form.type},on:{change:e.curAmountChange},model:{value:e.form.curAmount,callback:function(t){e.$set(e.form,"curAmount",t)},expression:"form.curAmount"}})],1):e._e(),i("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[i("el-collapse-item",{attrs:{name:"1"}},[-1!==e.activeNames.indexOf("1")&&e.handler?i("template",{slot:"title"},[i("div",{staticClass:"title-class"},[i("div",{staticClass:"title-class-one"},[i("el-badge",{staticClass:"item",attrs:{"is-dot":""}},[e._v("客户信息")])],1)])]):e._e(),-1!==e.activeNames.indexOf("1")&&e.handler?e._e():i("template",{slot:"title"},[e._v("客户信息")]),i("el-form-item",{staticClass:"isRequired",attrs:{label:"会员昵称",prop:"member.nickname"}},[i("el-input",{attrs:{disabled:!!e.itemId,placeholder:"请选择或添加会员"},on:{focus:e.showDialogFc},model:{value:e.form.member.nickname,callback:function(t){e.$set(e.form.member,"nickname",t)},expression:"form.member.nickname"}},[e.itemId?e._e():i("el-button",{attrs:{slot:"append",icon:"el-icon-plus"},on:{click:e.addMember},slot:"append"})],1)],1),i("el-form-item",{attrs:{label:"性别",prop:"member.gender"}},[i("el-select",{attrs:{disabled:!1===!e.itemId},model:{value:e.form.member.gender,callback:function(t){e.$set(e.form.member,"gender",t)},expression:"form.member.gender"}},[i("el-option",{attrs:{label:"男",value:"0"}}),i("el-option",{attrs:{label:"女",value:"1"}}),i("el-option",{attrs:{label:"保密",value:"2"}})],1)],1),i("el-form-item",{attrs:{label:"电话",prop:"member.mobile"}},[i("el-input",{attrs:{disabled:!1===!e.itemId,placeholder:"请输入电话"},model:{value:e.form.member.mobile,callback:function(t){e.$set(e.form.member,"mobile",t)},expression:"form.member.mobile"}})],1),i("el-form-item",{attrs:{label:"车辆",prop:"car.id"}},[i("el-select",{attrs:{placeholder:"请选择车辆",disabled:""!==e.itemId},on:{change:e.carChange},model:{value:e.form.car.id,callback:function(t){e.$set(e.form.car,"id",t)},expression:"form.car.id"}},e._l(e.cars,(function(e,t){return i("el-option",{key:t,attrs:{label:e.plateNumber,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"车型",prop:"car.type"}},[i("el-input",{attrs:{disabled:!0,placeholder:"选择车辆自动带入"},model:{value:e.form.car.type,callback:function(t){e.$set(e.form.car,"type",t)},expression:"form.car.type"}})],1),e.form.plateNumber?e._e():i("el-form-item",{attrs:{label:"行驶里程",prop:"car.drivingRange"}},[i("el-input",{attrs:{disabled:!0,placeholder:"选择车辆自动带入"},model:{value:e.form.car.drivingRange,callback:function(t){e.$set(e.form.car,"drivingRange",t)},expression:"form.car.drivingRange"}})],1),e.form.plateNumber?i("el-form-item",{attrs:{label:"行驶里程",prop:"drivingRange"}},[i("el-input",{attrs:{disabled:!0,placeholder:"选择车辆自动带入"},model:{value:e.form.drivingRange,callback:function(t){e.$set(e.form,"drivingRange",t)},expression:"form.drivingRange"}})],1):e._e()],2),i("el-collapse-item",{attrs:{name:"2"}},[-1!==e.activeNames.indexOf("2")&&e.handler?i("template",{slot:"title"},[i("div",{staticClass:"title-class"},[i("div",{staticClass:"title-class-one"},[i("el-badge",{staticClass:"item",attrs:{"is-dot":""}},[e._v("服务信息")])],1)])]):e._e(),-1!==e.activeNames.indexOf("2")&&e.handler?e._e():i("template",{slot:"title"},[e._v("服务信息")]),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"呼叫方式",prop:"orderItems[0].appointment.way"}},[i("el-select",{attrs:{placeholder:"请选择呼叫方式"},model:{value:e.form.orderItems[0].appointment.way,callback:function(t){e.$set(e.form.orderItems[0].appointment,"way",t)},expression:"form.orderItems[0].appointment.way"}},[i("el-option",{attrs:{label:"电话",value:"0"}}),i("el-option",{attrs:{label:"在线",value:"1"}})],1)],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"救援机构",prop:"orderItems[0].appointment.rescueUnit"}},[i("el-select",{attrs:{placeholder:"请选择救援机构"},model:{value:e.form.orderItems[0].appointment.rescueUnit,callback:function(t){e.$set(e.form.orderItems[0].appointment,"rescueUnit",t)},expression:"form.orderItems[0].appointment.rescueUnit"}},e._l(e.rescueOrganizations,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"救援人员",prop:"orderItems[0].appointment.rescuerId"}},[i("el-select",{attrs:{placeholder:"请选择救援人员"},model:{value:e.form.orderItems[0].appointment.rescuerId,callback:function(t){e.$set(e.form.orderItems[0].appointment,"rescuerId",t)},expression:"form.orderItems[0].appointment.rescuerId"}},e._l(e.workers,(function(e,t){return i("el-option",{key:t,attrs:{label:e.nickname,value:e.id}})})),1)],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"救援地点",prop:"orderItems[0].appointment.workerLocation"}},[i("el-input",{attrs:{placeholder:"请输入救援地点"},model:{value:e.form.orderItems[0].appointment.workerLocation,callback:function(t){e.$set(e.form.orderItems[0].appointment,"workerLocation",t)},expression:"form.orderItems[0].appointment.workerLocation"}})],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"服务项目",prop:"orderItems[0].appointment.reasons"}},[i("el-checkbox-group",{model:{value:e.form.orderItems[0].appointment.reasons,callback:function(t){e.$set(e.form.orderItems[0].appointment,"reasons",t)},expression:"form.orderItems[0].appointment.reasons"}},e._l(e.reasons,(function(t,a){return i("el-checkbox",{key:a,attrs:{label:t.id}},[e._v(e._s(t.content))])})),1)],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{staticClass:"imgUpload",attrs:{label:"图片信息"}},[i("el-upload",{attrs:{action:"/admin/file/uploads.jhtml","before-upload":e.beforeAvatarUpload,"file-list":e.imageList,"list-type":"picture-card",name:"file",accept:"image/*",data:{type:"0"},"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,"on-success":e.handleSuccess}},[i("i",{staticClass:"el-icon-plus"})]),i("el-dialog",{attrs:{visible:e.picDialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.picDialogVisible=t}}},[i("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1):e._e(),"rescue"===this.$route.params.orderType&&e.itemId?i("el-form-item",{attrs:{label:"语音信息"}},e._l(e.form.orderItems[0].appointment.voices,(function(e,t){return i("div",{key:t},[i("audio",{attrs:{src:e.path,controls:""}})])})),0):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"服务日期",prop:"orderItems[0].appointment.appontmentDate"}},[i("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd HH:mm:ss",type:"date",placeholder:"请选择服务日期"},model:{value:e.form.orderItems[0].appointment.appontmentDate,callback:function(t){e.$set(e.form.orderItems[0].appointment,"appontmentDate",t)},expression:"form.orderItems[0].appointment.appontmentDate"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"开始时间",prop:"orderItems[0].appointment.driveStartDate"}},[i("el-time-picker",{attrs:{format:"HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择开始时间",disabled:!!e.itemId&&"service"!==e.handler},model:{value:e.form.orderItems[0].appointment.driveStartDate,callback:function(t){e.$set(e.form.orderItems[0].appointment,"driveStartDate",t)},expression:"form.orderItems[0].appointment.driveStartDate"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"结束时间",prop:"orderItems[0].appointment.driveEndDate"}},[i("el-time-picker",{attrs:{format:"HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择结束时间",disabled:!!e.itemId&&"service"!==e.handler},model:{value:e.form.orderItems[0].appointment.driveEndDate,callback:function(t){e.$set(e.form.orderItems[0].appointment,"driveEndDate",t)},expression:"form.orderItems[0].appointment.driveEndDate"}})],1):e._e(),"service"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"服务日期",prop:"appointmentDate"}},[i("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd HH:mm:ss",type:"date",placeholder:"请选择服务日期",clearable:!1,editable:!1},model:{value:e.appointmentDate,callback:function(t){e.appointmentDate=t},expression:"appointmentDate"}})],1):e._e(),"service"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"开始时间",prop:"appointmentStartDate"}},[i("el-time-picker",{attrs:{format:"HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择开始时间",editable:!1,clearable:!1},model:{value:e.form.appointmentDate,callback:function(t){e.$set(e.form,"appointmentDate",t)},expression:"form.appointmentDate"}})],1):e._e(),"service"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"结束时间",prop:"appointmentEndDate"}},[i("el-time-picker",{attrs:{format:"HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择结束时间",editable:!1,clearable:!1},model:{value:e.form.appointmentEndDate,callback:function(t){e.$set(e.form,"appointmentEndDate",t)},expression:"form.appointmentEndDate"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"使用时间(分)",prop:"useTime"}},[i("el-input",{attrs:{value:e.dateInterval(e.form.orderItems[0].appointment.driveEndDate,e.form.orderItems[0].appointment.driveStartDate),disabled:!0}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"开始里程",prop:"orderItems[0].appointment.startMileage"}},[i("el-input-number",{attrs:{"controls-position":"right",precision:0,min:0,disabled:!!e.itemId&&"service"!==e.handler},model:{value:e.form.orderItems[0].appointment.startMileage,callback:function(t){e.$set(e.form.orderItems[0].appointment,"startMileage",t)},expression:"form.orderItems[0].appointment.startMileage"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"结束里程",prop:"orderItems[0].appointment.endMileage"}},[i("el-input-number",{attrs:{"controls-position":"right",precision:0,min:0,disabled:!!e.itemId&&"service"!==e.handler},model:{value:e.form.orderItems[0].appointment.endMileage,callback:function(t){e.$set(e.form.orderItems[0].appointment,"endMileage",t)},expression:"form.orderItems[0].appointment.endMileage"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"使用里程(公里)"}},[i("el-input",{attrs:{value:e.form.orderItems[0].appointment.endMileage-e.form.orderItems[0].appointment.startMileage,disabled:!0}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"试驾车号",prop:"orderItems[0].appointment.plateNumber"}},[i("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入试驾车号"},on:{select:e.handleSelect},model:{value:e.form.orderItems[0].appointment.plateNumber,callback:function(t){e.$set(e.form.orderItems[0].appointment,"plateNumber",t)},expression:"form.orderItems[0].appointment.plateNumber"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"试驾车型",prop:"orderItems[0].appointment.product.fullName"}},[i("el-input",{attrs:{placeholder:"请选择试驾车型"},on:{focus:e.queryProduct},model:{value:e.form.orderItems[0].appointment.product.fullName,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"fullName",t)},expression:"form.orderItems[0].appointment.product.fullName"}})],1):e._e(),"replace"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"已有车型",prop:"orderItems[0].appointment.car.type"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.orderItems[0].appointment.car.type,callback:function(t){e.$set(e.form.orderItems[0].appointment.car,"type",t)},expression:"form.orderItems[0].appointment.car.type"}})],1):e._e(),"replace"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"行驶里程",prop:"orderItems[0].appointment.drivingRange"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.form.orderItems[0].appointment.drivingRange,callback:function(t){e.$set(e.form.orderItems[0].appointment,"drivingRange",t)},expression:"form.orderItems[0].appointment.drivingRange"}})],1):e._e(),"replace"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"上牌时间",prop:"orderItems[0].appointment.onTime"}},[i("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.orderItems[0].appointment.onTime,callback:function(t){e.$set(e.form.orderItems[0].appointment,"onTime",t)},expression:"form.orderItems[0].appointment.onTime"}})],1):e._e(),"replace"===this.$route.params.orderType||"loan"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"心仪车型",prop:"orderItems[0].appointment.product.brandId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择品牌",filterable:""},on:{change:e.handleBrandChange},model:{value:e.form.orderItems[0].appointment.product.brandId,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"brandId",t)},expression:"form.orderItems[0].appointment.product.brandId"}},e._l(e.brandList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"replace"===this.$route.params.orderType||"loan"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"",prop:"orderItems[0].appointment.product.seriesId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择系列",filterable:""},on:{change:e.handleSeriesChange},model:{value:e.form.orderItems[0].appointment.product.seriesId,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"seriesId",t)},expression:"form.orderItems[0].appointment.product.seriesId"}},e._l(e.seriesList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"replace"===this.$route.params.orderType||"loan"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"",prop:"orderItems[0].appointment.product.id"}},[i("el-select",{staticClass:"isRequired",staticStyle:{width:"100%"},attrs:{placeholder:"请选择车型"},on:{change:e.productChange},model:{value:e.form.orderItems[0].appointment.product.id,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"id",t)},expression:"form.orderItems[0].appointment.product.id"}},e._l(e.modeList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"裸车总价",prop:"orderItems[0].appointment.product.price"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.orderItems[0].appointment.product.price,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"price",t)},expression:"form.orderItems[0].appointment.product.price"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"金融方案",prop:"orderItems[0].appointment.financialPlan.id"}},[i("el-select",{attrs:{placeholder:"请选择金融方案"},on:{change:function(t){return e.loanTerm(e.form.orderItems[0].appointment.financialPlan.id)}},model:{value:e.form.orderItems[0].appointment.financialPlan.id,callback:function(t){e.$set(e.form.orderItems[0].appointment.financialPlan,"id",t)},expression:"form.orderItems[0].appointment.financialPlan.id"}},e._l(e.financialPlans,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"首付比例",prop:"orderItems[0].appointment.downPayment"}},[i("el-select",{attrs:{placeholder:"请选择首付比例"},on:{change:e.monthPay},model:{value:e.form.orderItems[0].appointment.downPayment,callback:function(t){e.$set(e.form.orderItems[0].appointment,"downPayment",t)},expression:"form.orderItems[0].appointment.downPayment"}},e._l(e.form.orderItems[0].appointment.financialPlan.downPayments,(function(e,t){return i("el-option",{key:t,attrs:{label:Math.round(e)+"%",value:e}})})),1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"还款期限",prop:"orderItems[0].appointment.year"}},[i("el-select",{attrs:{placeholder:"请选择还款年限"},on:{change:e.monthPay},model:{value:e.form.orderItems[0].appointment.year,callback:function(t){e.$set(e.form.orderItems[0].appointment,"year",t)},expression:"form.orderItems[0].appointment.year"}},e._l(e.form.orderItems[0].appointment.financialPlan.loanTerms,(function(e,t){return i("el-option",{key:t,attrs:{label:e.year+"年",value:e.year}})})),1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"首付金额"}},[i("el-input",{attrs:{value:e.form.orderItems[0].appointment.product.price?e.form.orderItems[0].appointment.product.price*e.form.orderItems[0].appointment.downPayment/100:e.form.orderItems[0].appointment.product.price,disabled:!0}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"贷款额度"}},[i("el-input",{attrs:{value:e.form.orderItems[0].appointment.product.price?e.form.orderItems[0].appointment.product.price-e.form.orderItems[0].appointment.product.price*e.form.orderItems[0].appointment.downPayment/100:e.form.orderItems[0].appointment.product.price,disabled:!0}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"月供"}},[i("el-input",{attrs:{value:e.monthPay(),disabled:!0}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"手续费",prop:"orderItems[0].appointment.fee"}},[i("el-input",{attrs:{placeholder:"请输入手续费"},model:{value:e.form.orderItems[0].appointment.fee,callback:function(t){e.$set(e.form.orderItems[0].appointment,"fee",t)},expression:"form.orderItems[0].appointment.fee"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"身份证",prop:"orderItems[0].appointment.personId"}},[i("el-input",{attrs:{placeholder:"请输入身份证"},model:{value:e.form.orderItems[0].appointment.personId,callback:function(t){e.$set(e.form.orderItems[0].appointment,"personId",t)},expression:"form.orderItems[0].appointment.personId"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"工作单位",prop:"orderItems[0].appointment.workUnit"}},[i("el-input",{attrs:{placeholder:"请输入工作单位"},model:{value:e.form.orderItems[0].appointment.workUnit,callback:function(t){e.$set(e.form.orderItems[0].appointment,"workUnit",t)},expression:"form.orderItems[0].appointment.workUnit"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"房屋情况",prop:"orderItems[0].appointment.houseState"}},[i("el-select",{model:{value:e.form.orderItems[0].appointment.houseState,callback:function(t){e.$set(e.form.orderItems[0].appointment,"houseState",t)},expression:"form.orderItems[0].appointment.houseState"}},[i("el-option",{attrs:{label:"有",value:"1"}}),i("el-option",{attrs:{label:"无",value:"0"}})],1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"上牌城市",prop:"orderItems[0].appointment.onCity"}},[i("el-input",{attrs:{placeholder:"请输入上牌城市"},model:{value:e.form.orderItems[0].appointment.onCity,callback:function(t){e.$set(e.form.orderItems[0].appointment,"onCity",t)},expression:"form.orderItems[0].appointment.onCity"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"意向购车时间",prop:"orderItems[0].appointment.intentionTime"}},[i("el-select",{attrs:{placeholder:"请选择意向购车时间"},model:{value:e.form.orderItems[0].appointment.intentionTime,callback:function(t){e.$set(e.form.orderItems[0].appointment,"intentionTime",t)},expression:"form.orderItems[0].appointment.intentionTime"}},[i("el-option",{attrs:{label:"一年",value:"4"}}),i("el-option",{attrs:{label:"半年",value:"3"}}),i("el-option",{attrs:{label:"三个月",value:"2"}}),i("el-option",{attrs:{label:"两个月",value:"1"}}),i("el-option",{attrs:{label:"一个月",value:"0"}})],1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"月收入",prop:"orderItems[0].appointment.monthIncome"}},[i("el-select",{attrs:{placeholder:"请选择月收入"},model:{value:e.form.orderItems[0].appointment.monthIncome,callback:function(t){e.$set(e.form.orderItems[0].appointment,"monthIncome",t)},expression:"form.orderItems[0].appointment.monthIncome"}},[i("el-option",{attrs:{label:"20000以上",value:"4"}}),i("el-option",{attrs:{label:"15000-19999",value:"3"}}),i("el-option",{attrs:{label:"10000-14999",value:"2"}}),i("el-option",{attrs:{label:"5000-9999",value:"1"}}),i("el-option",{attrs:{label:"0-4999",value:"0"}})],1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"有车情况",prop:"orderItems[0].appointment.carState"}},[i("el-select",{attrs:{placeholder:"请选择有车情况"},model:{value:e.form.orderItems[0].appointment.carState,callback:function(t){e.$set(e.form.orderItems[0].appointment,"carState",t)},expression:"form.orderItems[0].appointment.carState"}},[i("el-option",{attrs:{label:"有",value:"1"}}),i("el-option",{attrs:{label:"无",value:"0"}})],1)],1):e._e(),i("el-form-item",{staticClass:"isRequired",attrs:{label:"顾问",prop:"consultant.id"}},[i("el-select",{attrs:{placeholder:"请选择顾问"},model:{value:e.form.consultant.id,callback:function(t){e.$set(e.form.consultant,"id",t)},expression:"form.consultant.id"}},e._l(e.consultants,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name||"未填写",value:e.id}})})),1)],1),"service"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"业务类型"}},[i("tag-select",{ref:"tagSelect",attrs:{tagList:e.tagList,bAddTag:!1,selectType:"order",selectedTags:e.selectedTags},on:{addSuccess:e.onAddSuccess}})],1):e._e(),i("el-form-item",{attrs:{label:"买家留言",prop:"memo"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.memo,callback:function(t){e.$set(e.form,"memo",t)},expression:"form.memo"}})],1),i("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[i("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],2),e.showPayment?i("el-collapse-item",{attrs:{name:"4"}},[-1!==e.activeNames.indexOf("4")&&e.handler?i("template",{slot:"title"},[i("div",{staticClass:"title-class"},[i("div",{staticClass:"title-class-one"},[i("el-badge",{staticClass:"item",attrs:{"is-dot":""}},[e._v("付款信息")])],1)])]):e._e(),-1!==e.activeNames.indexOf("4")&&e.handler?e._e():i("template",{slot:"title"},[e._v("付款信息")]),e.itemId?i("el-form-item",{staticClass:"isRequired",attrs:{label:"支付方式",prop:"paymentMethodId"}},[i("el-select",{attrs:{disabled:"1"!==e.form.type&&"2"!==e.form.type,placeholder:"请选择支付方式"},model:{value:e.form.paymentMethodId,callback:function(t){e.$set(e.form,"paymentMethodId",t)},expression:"form.paymentMethodId"}},e._l(e.paymentMethods,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),i("el-form-item",{staticClass:"isRequired",attrs:{label:"付款方式",prop:"payments[0].paymentType"}},[i("el-select",{attrs:{disabled:!!e.itemId&&"payment"!==e.handler,placeholder:"请选择付款方式"},on:{change:e.paymentTypeChange},model:{value:e.form.payments[0].paymentType,callback:function(t){e.$set(e.form.payments[0],"paymentType",t)},expression:"form.payments[0].paymentType"}},e._l(e.paymentTypes,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.name}})})),1)],1),"会员卡余额"===e.form.payments[0].paymentType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"会员卡",prop:"memberCardId"}},[i("el-select",{attrs:{disabled:!!e.itemId&&"payment"!==e.handler,placeholder:"请选择会员卡"},on:{change:e.memberCardChange},model:{value:e.form.memberCardId,callback:function(t){e.$set(e.form,"memberCardId",t)},expression:"form.memberCardId"}},e._l(e.listExistCard,(function(e,t){return i("el-option",{key:t,attrs:{label:e.template.name,value:e.id}})})),1)],1):e._e(),"刷卡"===e.form.payments[0].paymentType||"汇款"===e.form.payments[0].paymentType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"付款银行",prop:"payments[0].payBank"}},[i("el-select",{attrs:{disabled:!!e.itemId&&"payment"!==e.handler,placeholder:"请选择付款银行"},model:{value:e.form.payments[0].payBank,callback:function(t){e.$set(e.form.payments[0],"payBank",t)},expression:"form.payments[0].payBank"}},[i("el-option",{attrs:{label:"中国工商银行",value:"中国工商银行"}}),i("el-option",{attrs:{label:"中国农业银行",value:"中国农业银行"}}),i("el-option",{attrs:{label:"中国银行",value:"中国银行"}}),i("el-option",{attrs:{label:"中国建设银行",value:"中国建设银行"}}),i("el-option",{attrs:{label:"交通银行",value:"交通银行"}}),i("el-option",{attrs:{label:"中信银行",value:"中信银行"}}),i("el-option",{attrs:{label:"广发银行",value:"广发银行"}}),e._v("、 "),i("el-option",{attrs:{label:"深圳发展银行",value:"深圳发展银行"}}),i("el-option",{attrs:{label:"招商银行",value:"招商银行"}}),i("el-option",{attrs:{label:"中国光大银行",value:"中国光大银行"}}),i("el-option",{attrs:{label:"华夏银行",value:"华夏银行"}}),i("el-option",{attrs:{label:"中国民生银行",value:"中国民生银行"}}),i("el-option",{attrs:{label:"兴业银行",value:"兴业银行"}}),i("el-option",{attrs:{label:"上海浦东发展银行",value:"上海浦东发展银行"}}),i("el-option",{attrs:{label:"恒丰银行",value:"恒丰银行"}}),i("el-option",{attrs:{label:"浙商银行",value:"浙商银行"}}),i("el-option",{attrs:{label:"渤海银行",value:"渤海银行"}}),i("el-option",{attrs:{label:"中国邮政储蓄银行",value:"中国邮政储蓄银行"}}),i("el-option",{attrs:{label:"其他银行",value:"其他银行"}})],1)],1):e._e(),"刷卡"===e.form.payments[0].paymentType||"汇款"===e.form.payments[0].paymentType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"付款帐号",prop:"payments[0].payAccount"}},[i("el-input",{attrs:{disabled:!!e.itemId&&"payment"!==e.handler,placeholder:"请输入付款帐号"},model:{value:e.form.payments[0].payAccount,callback:function(t){e.$set(e.form.payments[0],"payAccount",t)},expression:"form.payments[0].payAccount"}})],1):e._e()],2):e._e(),e.showInfo?i("el-collapse-item",{attrs:{title:"优惠信息",name:"3"}},[e.itemId?i("div",[i("el-form-item",{attrs:{label:"优惠券折扣",prop:"couponDiscount"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.couponDiscount,callback:function(t){e.$set(e.form,"couponDiscount",t)},expression:"form.couponDiscount"}})],1),i("el-form-item",{attrs:{label:"赠送积分",prop:"point"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.point,callback:function(t){e.$set(e.form,"point",t)},expression:"form.point"}})],1)],1):i("div",[i("el-form-item",{attrs:{label:"福利",prop:"couponDiscount"}},[i("el-select",{attrs:{placeholder:"请选择"},on:{change:e.couponChange},model:{value:e.form.couponCodeId,callback:function(t){e.$set(e.form,"couponCodeId",t)},expression:"form.couponCodeId"}},e._l(e.form.couponList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.coupon.name,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"V豆抵扣",prop:"beanDiscount"}},[i("el-input",{attrs:{disabled:!("会员卡余额"===e.form.payments[0].paymentType&&e.form.memberCardId&&e.form.bean),min:0},on:{change:e.beanChange},model:{value:e.form.beanDiscount,callback:function(t){e.$set(e.form,"beanDiscount",t)},expression:"form.beanDiscount"}}),"会员卡余额"===e.form.payments[0].paymentType&&e.form.memberCardId?i("div",[e._v(e._s(e.beanCanUse))]):e._e()],1)],1)]):e._e(),e.showInfo?i("el-collapse-item",{attrs:{title:"其他信息",name:"7"}},[i("el-form-item",{attrs:{label:"创建时间"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.orderTime,callback:function(t){e.$set(e.form,"orderTime",t)},expression:"form.orderTime"}})],1),i("el-form-item",{attrs:{label:"执行时间"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.deliveryTime,callback:function(t){e.$set(e.form,"deliveryTime",t)},expression:"form.deliveryTime"}})],1),i("el-form-item",{attrs:{label:"付款时间"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.paymentTime,callback:function(t){e.$set(e.form,"paymentTime",t)},expression:"form.paymentTime"}})],1),i("el-form-item",{attrs:{label:"完成时间"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.completeTime,callback:function(t){e.$set(e.form,"completeTime",t)},expression:"form.completeTime"}})],1)],1):e._e()],1)],1),i("el-dialog",{attrs:{title:"创建会员",visible:e.dialogVisible,width:"50%",appendToBody:!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"dialogFormModel",attrs:{model:e.formModel,"label-width":"120px",size:"small",rules:e.dialogRules,"inline-message":!0}},[i("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[i("el-input",{attrs:{placeholder:"请输入手机号，如1888888888"},on:{blur:e.mobileBlur},model:{value:e.formModel.mobile,callback:function(t){e.$set(e.formModel,"mobile",t)},expression:"formModel.mobile"}})],1),i("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[i("el-input",{attrs:{placeholder:"请输入用户名，如1888888888"},model:{value:e.formModel.userName,callback:function(t){e.$set(e.formModel,"userName",t)},expression:"formModel.userName"}})],1),i("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[i("el-input",{attrs:{placeholder:"请输入昵称，如1888888888"},model:{value:e.formModel.nickname,callback:function(t){e.$set(e.formModel,"nickname",t)},expression:"formModel.nickname"}})],1),i("el-form-item",{attrs:{label:"姓名",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入姓名，如张三"},model:{value:e.formModel.name,callback:function(t){e.$set(e.formModel,"name",t)},expression:"formModel.name"}})],1),i("el-form-item",{attrs:{label:"密码",prop:"password"}},[i("el-input",{attrs:{type:"text",placeholder:"请输入密码"},model:{value:e.formModel.password,callback:function(t){e.$set(e.formModel,"password",t)},expression:"formModel.password"}})],1),i("el-form-item",{attrs:{label:"性别",prop:"gender"}},[i("el-radio-group",{model:{value:e.formModel.gender,callback:function(t){e.$set(e.formModel,"gender",t)},expression:"formModel.gender"}},[i("el-radio",{attrs:{label:"0"}},[e._v("男")]),i("el-radio",{attrs:{label:"1"}},[e._v("女")]),i("el-radio",{attrs:{label:"2"}},[e._v("保密")])],1)],1),i("el-form-item",{attrs:{label:"车牌号"}},[i("el-input",{attrs:{placeholder:"请输入车牌号，如浙12345"},model:{value:e.formModel.defaultCarInfo.plateNumber,callback:function(t){e.$set(e.formModel.defaultCarInfo,"plateNumber",t)},expression:"formModel.defaultCarInfo.plateNumber"}})],1),i("el-form-item",{attrs:{label:"品牌"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择，如宝马",filterable:""},on:{change:e.brandChange},model:{value:e.formModel.defaultCarInfo.brand,callback:function(t){e.$set(e.formModel.defaultCarInfo,"brand",t)},expression:"formModel.defaultCarInfo.brand"}},e._l(e.brandData,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),i("el-form-item",{attrs:{label:"系列"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择，如宝马3系",filterable:""},on:{change:e.seriesChange},model:{value:e.formModel.defaultCarInfo.series,callback:function(t){e.$set(e.formModel.defaultCarInfo,"series",t)},expression:"formModel.defaultCarInfo.series"}},e._l(e.seriesData,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),i("el-form-item",{attrs:{label:"车型"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择，如宝马3系2016款"},model:{value:e.formModel.defaultCarInfo.type,callback:function(t){e.$set(e.formModel.defaultCarInfo,"type",t)},expression:"formModel.defaultCarInfo.type"}},e._l(e.modeData,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),i("el-form-item",{attrs:{label:"车辆识别代码"}},[i("el-input",{attrs:{placeholder:"请输入车辆识别代码，如1G1BL52P7TR115520"},model:{value:e.formModel.defaultCarInfo.vin,callback:function(t){e.$set(e.formModel.defaultCarInfo,"vin",t)},expression:"formModel.defaultCarInfo.vin"}})],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.createMember()}}},[e._v("确 定")])],1)],1),i("biz-dialog-selector",{staticClass:"memberDialog",attrs:{title:"选择会员",visibility:e.showDialog,appendToBody:!0,keyField:"id",selectionKeys:e.selectionKeys,loading:e.dialogLoading,tableData:e.dialogTableData,pagination:e.dialogPagination,selectionMode:"single",filters:e.dialogFilters},on:{"update:visibility":function(t){e.showDialog=t},confirmed:e.handleConfirmed,open:e.opened,operate:e.dialogOperate,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange}},[i("el-table-column",{attrs:{label:"用户名",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"customer-info"},[t.row.head?i("img",{attrs:{src:t.row.head}}):i("img",{attrs:{src:a("624d")}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"title"},[e._v(e._s(t.row.name))]),i("div",{staticClass:"gender"},["0"===t.row.gender?i("i",{staticClass:"male iconfont biz-icon-i-web-m"}):e._e(),"1"===t.row.gender?i("i",{staticClass:"female iconfont biz-icon-i-web-f"}):e._e(),"2"===t.row.gender?i("i",{staticClass:"none iconfont biz-icon-i-web-bm"}):e._e(),i("span",[e._v(e._s(t.row.mobile))])])])])]}}])}),i("el-table-column",{attrs:{prop:"mobile",label:"手机号"}}),i("el-table-column",{attrs:{prop:"createDate",label:"创建日期",formatter:e.createDateConverter,sortable:"custom"}}),i("el-table-column",{attrs:{label:"状态",formatter:e.stateConverter}}),i("el-table-column",{attrs:{prop:"",label:"店铺名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",e._l(t.row.shops,(function(t,a){return i("div",{key:a,staticClass:"customer-info"},[e._v(e._s(t.name))])})),0)]}}])}),i("el-table-column",{attrs:{prop:"lastLoginIp",label:"最后登录地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"customer-info"},[i("span",{staticStyle:{display:"block"}},[e._v(e._s(t.row.loginAddress||t.row.lastLoginIp))])])]}}])}),i("el-table-column",{attrs:{prop:"lastLoginDate",label:"最后登录时间",formatter:e.loginDateConverter,sortable:"custom"}})],1),i("biz-dialog-selector",{attrs:{title:"选择车型",visibility:e.showProductSelector,tableData:e.productTableData,pagination:e.productPagination,selectionMode:"single"},on:{"update:visibility":function(t){e.showProductSelector=t},pageSizeChange:e.productPageSizeChange,currentPageChange:e.productCurrentPageChange,confirmed:e.confirmedProduct}},[i("el-table-column",{attrs:{property:"fullName",label:"名称"}}),i("el-table-column",{attrs:{property:"price",label:"销售价"}})],1)],1)},r=[],o=(a("99af"),a("4de4"),a("7db0"),a("c740"),a("4160"),a("c975"),a("d81d"),a("a434"),a("b0c0"),a("a9e3"),a("b680"),a("d3b7"),a("ac1f"),a("25f0"),a("3ca3"),a("5319"),a("1276"),a("159b"),a("ddb0"),a("b85c")),n=(a("96cf"),a("1da1")),s=a("5530"),l=a("f36f"),c=a("e42c"),d=a("8330"),p=a("46fc"),u=a("c466"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:e.title,visible:e.dialogVisible,"append-to-body":e.appendToBody},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close,open:e.open}},[a("biz-flex-table",{ref:"table",attrs:{operations:e.operations,filters:e.filters,tags:e.tags,pagination:e.pagination,tableData:e.tableData,loading:e.loading,checkable:e.checkable},on:{operate:e.operate,"row-click":e.rowClick,"filter-data-change":e.filterDataChange,"select-all":e.handleSelectAll,select:e.handleSelectionChange,"size-change":e.pageSizeChange,"current-change":e.currentPageChange}},[e._t("default")],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmed}},[e._v("确定")])],1)],1)},f=[],h=a("04d3"),g={name:"BizDialogSelector",components:{BizFlexTable:h["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},selectionKeys:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],innerSelection:[]}},methods:{generateSelectionKeys:function(e,t){if(e.indexOf(t)>=0)this.innerSelectionKeys.push(t[this.keyField]);else{var a=this.innerSelectionKeys.indexOf(t[this.keyField]);this.innerSelectionKeys.splice(a,1)}},open:function(e){console.log(this.selectionKeys),this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(e){this.innerSelectionKeys=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){this.innerSelectionKeys.length>0?(this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1):this.$message("请选择一项")},operate:function(e){this.$emit("operate",e)},filterDataChange:function(e){this.$emit("filterDataChange",e)},handleSelectAll:function(e){var t=this;0===e.length?this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a>=0&&t.innerSelectionKeys.splice(a,1)})):this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a<0&&t.innerSelectionKeys.push(e[t.keyField])}))},handleSelectionChange:function(e,t){this.generateSelectionKeys(e,t)},pageSizeChange:function(e){this.$emit("pageSizeChange",e)},currentPageChange:function(e){this.$emit("currentPageChange",e)},rowClick:function(e,t,a){"single"===this.selectionMode&&(this.innerSelectionKeys=[e[this.keyField]],this.innerSelection=[e])}},watch:{visibility:function(e,t){this.dialogVisible=e}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){}},b=g,v=(a("1029"),a("2877")),y=Object(v["a"])(b,m,f,!1,null,null,null),C=y.exports,I=a("2f62"),w=a("18eb"),S=a("0e5e"),_=a("1ab1"),T=a("c596"),k={stateConverter:function(e){return"0"===e.enableState?"停用":"1"===e.enableState?"启用":"--"},createDateConverter:function(e){if(e.createDate){e.createDate=e.createDate.replace(/-/g,"/");var t=new Date(e.createDate);return u["a"].dateConverter(t)}return"--"},loginDateConverter:function(e){if(e.lastLoginDate){e.lastLoginDate=e.lastLoginDate.replace(/-/g,"/");var t=new Date(e.lastLoginDate);return u["a"].dateConverter(t)}return"--"},ipConverter:function(e){return e.lastLoginIp?e.lastLoginIp:"--"}},D={name:"baseInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},open:{type:Boolean,default:function(){return!1}},handler:{type:String},activeNames:{type:Array,default:function(){return["1","2","3","4","5"]}}},components:{BizGrid:l["a"],BizSaveButton:d["a"],BizDialogSelector:C,TagSelect:w["a"]},data:function(){var e=this;return{isShipped:!1,beanCanUse:"",maxOffsetBean:0,minOffsetBean:0,originalAmount:"",orderStateTypeList:[{label:"订单已执行",value:"1"},{label:"交易完成",value:"2"}],beanRate:0,tagList:[],selectedTags:[],restaurants:[],dialogRules:{userName:[{required:!0,trigger:"blur",message:"请输入用户名"},{pattern:/^[0-9a-zA-Z]+$/,message:"用户名只能为数字或字母",trigger:"blur"},{min:4,max:20,message:"长度在4-20位",trigger:"blur"}],mobile:[{required:!0,trigger:"blur",message:"请输入手机号"}],nickname:[{required:!0,trigger:"blur",message:"请输入昵称"}],name:[{required:!0,trigger:"blur",message:"请输入姓名"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:20,message:"密码应在6-20位之间",trigger:"blur"}],rePassword:[{required:!0,trigger:"blur",message:"请再次输入密码"},{trigger:"blur",validator:function(t,a,i){e.formModel.password===e.formModel.rePassword?i():i(new Error("两次输入密码不一致"))}}]},loading:!1,picDialogVisible:!1,showProductSelector:!1,dialogImageUrl:"",isFirst:!0,showDialog:!1,dialogVisible:!1,showDelivery:!1,showReceiver:!1,flag:!1,data:{type:"",method:""},productTableData:[],imageList:[],consultants:[],shippingMethod:[],deliveryCorps:[],paymentTypes:[],paymentMethods:[],listExistCard:[],brandList:[],seriesList:[],modeList:[],brandData:[],seriesData:[],modeData:[],financialPlans:[],selectionKeys:[],rescueOrganizations:[],cars:[],reasons:[],workers:[],orderItems:[],areaId:"1568",useTime:"",useMileage:"",appointmentDate:"",downPaymentPrice:"",loanPrice:"",formModel:{userName:"",mobile:"",name:"",password:"123456",nickname:"",gender:"2",defaultCarInfo:{plateNumber:"",brand:"",series:"",type:"",vin:""}},form:{bean:"",appointmentData:{appontmentDate:"",driveEndDate:"",driveStartDate:"",startMileage:"",endMileage:"",level:"",palteNumber:"",productId:"",drivingRange:"",onTime:"",downPayment:"",year:"",price:"",fee:"",personId:"",workUnit:"",houseState:"",onCity:"",intentionTime:"",monthIncome:"",carState:"",way:"",rescueUnit:"",rescuerId:"",rescueCar:"",distance:"",workerLocation:"",reasons:[],images:[],voices:[],financialPlan:{id:"",name:"",loanTerm:[],downPayments:[]},product:{brandId:"",seriesIs:"",id:"",fullName:""},car:{type:""}},appointmentDate:"",appointmentEndDate:"",sn:"",type:"",amount:"",amountPrepay:"",amountFinalpay:"",originalAmount:"",offsetAmount:"",curAmount:"",memberCardId:"",userId:"",consultant:{id:""},area:{id:"1568"},car:{id:"",tpye:"",drivingRange:""},address:"",areaName:"",consignee:"",phone:"",zipCode:"",remarks:"",memo:"",promotionDiscount:"",couponDiscount:"",couponCodeId:"",couponCode:{},couponList:[],beanDiscount:"",point:"",giftBean:"",shippingMethodName:"",paymentMethodId:"",shippingMethodId:"",invoiceState:"",orderTime:"",deliveryTime:"",paymentTime:"",completeTime:"",orderItems:[{appointment:{appontmentDate:"",driveEndDate:"",driveStartDate:"",startMileage:"",endMileage:"",level:"",palteNumber:"",productId:"",drivingRange:"",onTime:"",downPayment:"",year:"",price:"",fee:"",personId:"",workUnit:"",houseState:"",onCity:"",intentionTime:"",monthIncome:"",carState:"",way:"",rescueUnit:"",rescuerId:"",rescueCar:"",distance:"",plateNumber:"",workerLocation:"",reasons:[],images:[],voices:[],financialPlan:{id:"",name:"",loanTerm:[],downPayments:[]},product:{brandId:"",seriesIs:"",id:"",fullName:""},car:{type:""}}}],payments:[{paymentType:"",payBank:"",payAccount:""}],member:{nickname:"",gender:"",mobile:""},shippings:[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:"",consignee:"",isLCL:"0",phone:"",zipCode:""}]},operations:[{label:"保存",name:"save",type:"primary"}],adminCurrent:[],dialogLoading:!0,dialogTableData:[],dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},productPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},isCreated:!1,dialogFilters:[{type:"input",label:"",placeholder:"请输入店铺名称",name:"searchValue",value:""}]}},computed:Object(s["a"])(Object(s["a"])({},Object(I["c"])(["currentUser"])),{},{getCouponCode:function(){var e,t=this;return this.form.couponList.forEach((function(a){if(a.id===t.form.couponCodeId)return e=a,!1})),e},showInfo:function(){return!0},showPayment:function(){return!!this.itemId||"1"!==this.form.type},isCreate:function(){return!this.itemId}}),created:function(){this.queryBrandList(),this.getBrandList(),this.getFinancialPlans(),!this.itemId&&this.orderOptions(),this.getStoreTags(),this.testDrives()},watch:{itemId:function(e){this.itemId&&this.init(),this.itemId||(this.resetFormData(),this.form.type="2",this.getStoreTags())},open:function(e){this.isShipped=!1,!this.itemId&&e&&this.isCreated&&this.resetFormData()},form:{deep:!0,immediate:!0,handler:function(e){var t=this;this.showDelivery=!1,this.showReceiver=!1,this.shippingMethod.map((function(a){a.name===e.shippingMethodName&&"1"===a.isNeedDelivery&&(t.showDelivery=!0),a.name===e.shippingMethodName&&"1"===a.isNeedReceiver&&(t.showReceiver=!0)}))}}},methods:Object(s["a"])(Object(s["a"])(Object(s["a"])({},Object(I["c"])(["getUser"])),k),{},{getDefaultForm:function(){return{bean:"",curAmount:"",couponCodeId:"",couponCode:{},couponList:[],appointmentData:{appontmentDate:"",driveEndDate:"",driveStartDate:"",startMileage:"",endMileage:"",level:"",palteNumber:"",productId:"",drivingRange:"",onTime:"",downPayment:"",year:"",price:"",fee:"",personId:"",workUnit:"",houseState:"",onCity:"",intentionTime:"",monthIncome:"",carState:"",way:"",rescueUnit:"",rescuerId:"",rescueCar:"",distance:"",workerLocation:"",reasons:[],images:[],voices:[],financialPlan:{id:"",name:"",loanTerm:[],downPayments:[]},product:{brandId:"",seriesIs:"",id:"",fullName:""},car:{type:""}},appointmentDate:"",appointmentEndDate:"",sn:"",type:"",amount:"",amountPrepay:"",amountFinalpay:"",originalAmount:"",offsetAmount:"0",memberCardId:"",userId:"",consultant:{id:""},area:{id:"1568",fullanme:""},car:{id:"",tpye:"",drivingRange:""},address:"",areaName:"",consignee:"",phone:"",zipCode:"",remarks:"",memo:"",promotionDiscount:"",couponDiscount:"",beanDiscount:"",point:"",giftBean:"",shippingMethodName:"",paymentMethodId:"",shippingMethodId:"",invoiceState:"",orderTime:"",deliveryTime:"",paymentTime:"",completeTime:"",orderItems:[{appointment:{appontmentDate:"",driveEndDate:"",driveStartDate:"",startMileage:"",endMileage:"",level:"",palteNumber:"",productId:"",drivingRange:"",onTime:"",downPayment:"",year:"",price:"",fee:"",plateNumber:"",personId:"",workUnit:"",houseState:"",onCity:"",intentionTime:"",monthIncome:"",carState:"",way:"",rescueUnit:"",rescuerId:"",rescueCar:"",distance:"",workerLocation:"",reasons:[],images:[],voices:[],financialPlan:{id:"",name:"",loanTerm:[],downPayments:[]},product:{brandId:"",seriesIs:"",id:"",fullName:""},car:{type:""}}}],payments:[{paymentType:"",payBank:"",payAccount:""}],member:{nickname:"",gender:"",mobile:""},shippings:[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:"",consignee:"",phone:"",zipCode:""}]}},onShippingChange:function(){this.form.shippingMethodName&&this.showDelivery||(this.form.shippings[0].freight="",this.getOriginalAmount())},mobileBlur:function(){this.formModel.id||this.formModel.nickname||this.$set(this.formModel,"nickname",this.formModel.mobile),this.formModel.id||this.formModel.userName||this.$set(this.formModel,"userName",this.formModel.mobile)},brandChange:function(e){this.getSeriesList(e),this.formModel.defaultCarInfo.series="",this.formModel.defaultCarInfo.type=""},seriesChange:function(e){this.getModeList(e),this.formModel.defaultCarInfo.type=""},getStoreTags:function(){var e=this,t={categoryType:"订单/服务业务类型",shopId:window.top.SHOP_ID||""};_["a"].get(T["g"].systemSetting.storeTags,t).then((function(t){console.log("订单/服务业务类型标签",t),e.tagList=t.content})).catch((function(e){console.log(e.errorMessage)}))},beanChange:function(){this.getOriginalAmount()},getOriginalAmount:function(){this.isCreate&&(this.form.originalAmount=(Number(this.originalAmount)-Number(this.form.beanDiscount*this.beanRate||"0")-Number(this.form.couponDiscount||"0")+Number(this.form.shippings[0].freight||"0")).toFixed(2),this.getCurAmount())},getCurAmount:function(){this.form.curAmount=(Number(this.form.originalAmount)+Number(this.form.offsetAmount||"0")).toFixed(2),this.form.curAmount<=0&&(this.form.curAmount=0),this.form.curAmount=this.form.curAmount.toString()},freightChange:function(){this.getOriginalAmount()},offsetAmountChange:function(){this.getCurAmount()},curAmountChange:function(){this.form.offsetAmount=Number(this.form.curAmount)+Number(this.form.beanDiscount*this.beanRate)+Number(this.form.couponDiscount)-Number(this.form.originalAmount),this.form.offsetAmount=this.form.offsetAmount.toString()},couponChange:function(){var e=this;this.form.couponList.forEach((function(t){if(t.id===e.form.couponCodeId)return e.form.couponDiscount=t.coupon.amount,!1})),this.getOriginalAmount()},tagMapping:function(){var e={refId:this.itemId,type:"7",tags:this.$refs.tagSelect.getCurSelectedTags(),shopId:window.top.SHOP_ID||""};_["a"].post(T["g"].systemSetting.tagMapping,e).then((function(e){console.log("映射成功")})).catch((function(e){console.log(e.errorMessage)}))},getTagMapping:function(){var e=this;this.selectedTags=[];var t={refId:this.itemId,type:"7",shopId:window.top.SHOP_ID||""};_["a"].get(T["g"].systemSetting.tagMapping,t).then((function(t){console.log("查看映射信息",t),t.data.tags&&(e.selectedTags=t.data.tags)})).catch((function(e){console.log(e.errorMessage)}))},onAddSuccess:function(){this.getStoreTags()},operate:function(e){this[e]()},dateInterval:function(e,t){if(e&&t)return Object(p["a"])(e.split(" ")[1],t.split(" ")[1])},showDialogFc:function(){this.showDialog=!0,this.dialogFilters[0].value=""},monthPay:function(){var e=this;if(this.form.orderItems[0].appointment.year)return this.form.orderItems[0].appointment.financialPlan.loanTerms.map((function(t){t.year===e.form.orderItems[0].appointment.year&&(e.form.orderItems[0].appointment.rate=t.rate)})),((this.form.orderItems[0].appointment.product.price-this.form.orderItems[0].appointment.product.price*this.form.orderItems[0].appointment.downPayment/100)*this.form.orderItems[0].appointment.rate/12*Math.pow(1+this.form.orderItems[0].appointment.rate/12,12*this.form.orderItems[0].appointment.year)/(Math.pow(1+this.form.orderItems[0].appointment.rate/12,12*this.form.orderItems[0].appointment.year)-1)).toFixed(2)},queryProduct:function(){var e=this;c["a"].listProductByTestDrive({clientType:"2",methodName:"ListProductByTestDrive",shopId:this.getUser().shop?this.getUser().shop.id:window.top.SHOP_ID,pageSize:this.productPagination.pageSize,pageNumber:this.productPagination.currentPage},(function(t){e.productTableData=t.content,e.showProductSelector=!0}),(function(t){e.$message.warning(t.errorMessage)}))},confirmedProduct:function(e,t){this.form.orderItems[0].appointment.product.id=t[0].id,this.form.orderItems[0].appointment.product.fullName=t[0].fullName},handleConfirmed:function(e,t){this.form.member.nickname=t[0].nickname,this.form.member.mobile=t[0].mobile,this.form.memberCardId="",this.form.userId=t[0].id,this.$set(this.form.member,"gender",t[0].gender),this.$set(this.form,"selectionKeys",e),this.listExistCardTemplate(),this.form.plateNumber=t[0].defaultCarInfo.plateNumber,this.form.drivingRange=t[0].defaultCarInfo.drivingRange||"",this.form.car.type=t[0].defaultCarInfo.type||"",this.form.car.drivingRange="",this.form.shippings[0].address&&this.itemId||(this.form.shippings[0].address=t[0].defaultReceiver.areaName+t[0].defaultReceiver.address),this.form.shippings[0].consignee&&this.itemId||(this.form.shippings[0].consignee=t[0].name),this.form.shippings[0].phone&&this.itemId||(this.form.shippings[0].phone=t[0].mobile),this.carOptions(this.form.userId),this.getCouponList()},carOptions:function(e){var t,a=this;c["a"].carOptions({memberId:e},(function(e){a.cars=e.cars,a.cars.length>0&&(a.cars.forEach((function(e){if(e.plateNumber===a.form.plateNumber)return t=e,!1})),a.form.car.id=t?t.id:"",a.cars.map((function(e){if(e.id===a.form.car.id)return a.form.car.type=e.type,!1})))}),(function(e){a.$message.warning(e.errorMessage)}))},carChange:function(e){var t=this;this.cars.map((function(a){a.id===e&&(t.form.car.type=a.type,t.form.car.drivingRange=a.drivingRange,t.form.drivingRange=a.drivingRange)}))},createMember:function(){var e=this;this.$refs.dialogFormModel.validate((function(t,a){t&&c["a"].createMember(e.formModel,(function(t){e.loading=!1,e.$message.success("保存成功"),e.dialogVisible=!1,e.form.member.nickname=t.data.name,e.form.member.gender=t.data.gender,e.form.member.mobile=t.data.mobile,e.form.userId=t.data.id,t.data.defaultCarInfo&&(e.cars.push({plateNumber:t.data.defaultCarInfo.plateNumber,id:t.data.defaultCarInfo.id,type:t.data.defaultCarInfo.type}),e.form.car.id=t.data.defaultCarInfo.id,e.form.car.type=t.data.defaultCarInfo.type)}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))}))},resetFormData:function(){this.form=this.getDefaultForm(),this.form.userId="",this.form.memberCardId="",this.listExistCard=[],this.form.member={},this.form.couponList=[],this.form.couponCodeId="",this.form.beanDiscount="",this.paymentTypes=[],this.form.payments[0].paymentType="",this.form.shippings[0].deliveryCorpId="",this.form.originalAmount="",this.form.curAmount="",this.form.car.type="",this.form.car.drivingRange="",this.form.drivingRange="",this.form.plateNumber="",this.form.car.id="",this.form.offsetAmount="",this.form.orderItems[0].appointment.product.brandId="",this.form.orderItems[0].appointment.product.seriesId="",this.form.orderItems[0].appointment.product.id=""},init:function(){var e=this;c["a"].viewOrder(this.getSaveParams(),(function(t){e.form=Object.assign(e.getDefaultForm(),t.order),e.form.curAmount=Number(e.form.originalAmount)+Number(e.form.offsetAmount),console.log(e.form),0===e.form.payments.length?(e.form.payments=[{paymentType:"",payBank:"",payAccount:""}],e.form.payments[0].paymentType=e.form.paymentTypeName):e.form.memberCardId=e.form.payments[0].memberCardId,0===e.form.shippings.length&&(e.form.shippings=[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:e.form.area&&e.form.area.fullName?e.form.area.fullName+e.form.address:e.form.address,consignee:e.form.consignee,phone:e.form.phone,zipCode:e.form.zipCode}]),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.product&&e.form.orderItems[0].appointment.product.brandId&&e.querySeriesList(e.form.orderItems[0].appointment.product.brandId),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.product&&e.form.orderItems[0].appointment.product.seriesId&&e.queryTypeList(e.form.orderItems[0].appointment.product.seriesId),t.order.appointmentDate&&(e.appointmentDate=t.order.appointmentDate),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.reasons&&(e.form.orderItems[0].appointment.reasons=e.form.orderItems[0].appointment.reasons.map((function(e){return e.id}))),e.carOptions(e.form.member.id),e.shippingMethod=t.shippingMethods,e.deliveryCorps=t.deliveryCorps,e.paymentTypes=t.paymentTypes,e.paymentMethods=t.paymentMethods,e.paymentMethods.map((function(a){a.name===t.order.paymentMethodName&&(e.form.paymentMethodId=a.id)})),e.reasons=t.reasons,e.adminCurrent=[{id:t.adminCurrent.id,name:t.adminCurrent.realName}],e.form.consultant.id?e.adminCurrent=[{id:e.form.consultant.id,name:e.form.consultant.realName}]:e.form.consultant={id:t.adminCurrent.id},e.form.area&&(e.areaId=e.form.area.id),"rescue"===e.$route.params.orderType&&(e.imageList=e.form.orderItems[0].appointment.images.map((function(e){return{url:e.path}}))),e.form.type=e.getOrderStatus(e.form.type),e.listExistCardTemplate(),e.listAdminByRole(),"2"===e.form.orderType&&(console.log("查询映射",e.form.orderType),e.getTagMapping(),e.getStoreTags()),e.offsetAmountChange()}),(function(t){e.$message.warning(t.errorMessage)}))},paymentTypeChange:function(e){"会员卡余额"!==e&&(this.form.memberCardId="",this.form.beanDiscount="",this.getOriginalAmount())},memberCardChange:function(){this.getMemberCardInfo(),this.getBeanRate()},getMemberCardInfo:function(){var e=this,t={userCardId:this.form.memberCardId};_["a"].get("/admin/memberCard/memberCard.jhtml",t).then((function(t){e.form.bean=t.content.bean,e.getCouponList()})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getBeanRate:function(){var e=this,t={id:this.form.memberCardId};_["a"].get("/admin/memberCard/memberCard.jhtml",t).then((function(t){e.beanRate=Number(t.rewardSet.cash)/Number(t.rewardSet.vBean)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getCouponList:function(){var e=this;if(0!==this.orderItems.length){this.form.couponList=[];var t=this.orderItems.map((function(e){return{product:{id:e.productId},quantity:e.quantity||""}})),a={shopId:window.top.SHOP_ID||"",cartItems:t,userId:this.form.userId,userCardId:this.form.memberCardId};_["a"].post("/admin/order/couponCodes.jhtml",a).then((function(t){e.form.couponList=t.content,e.maxOffsetBean=t.maxOffsetBean,e.minOffsetBean=t.minOffsetBean})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))}},listAdminByRole:function(){var e=this,t="";t="car"===this.$route.params.orderType?["salesman"]:["afterSale","reception","testDriver"],c["a"].listAdminByRole({roleTypes:t},(function(t){e.loading=!1,e.flag=!1,console.log(e.form.consultant.id),t.dataList.map((function(t){t.id===e.adminCurrent[0].id&&(e.flag=!0)})),e.flag?e.consultants=t.dataList:e.consultants=t.dataList.concat(e.adminCurrent)}),(function(e){console.log(e)}))},loanTerm:function(e){var t=this;c["a"].loanTerms({financialId:e},(function(e){t.loading=!1,t.form.orderItems[0].appointment.financialPlan.downPayments=[e.downPayment,e.downPayment+10,e.downPayment+20,e.downPayment+30],t.form.orderItems[0].appointment.downPayment="",t.form.orderItems[0].appointment.financialPlan.loanTerms=e.loanTerms}),(function(e){t.loading=!1,t.$message.warning(e.errorMessage)}))},orderOptions:function(){var e=this,t=!1;this.form.type="交易完成",c["a"].options({shopId:window.top.SHOP_ID},(function(a){e.loading=!1,e.paymentMethods=a.paymentMethods,e.paymentTypes=a.paymentTypes,e.shippingMethod=a.shippingMethods,e.deliveryCorps=a.deliveryCorps,e.reasons=a.reasons,e.rescueOrganizations=a.rescueOrganizations,e.workers=a.workers,e.adminCurrent=[{id:a.adminCurrent.id,name:a.adminCurrent.realName}],e.form.consultant={id:a.adminCurrent.id},e.listAdminByRole(),!e.itemId&&e.showInfo&&(e.paymentTypes.forEach((function(e){if("会员卡余额"===e.name)return t=!0,!1})),e.form.payments[0].paymentType=t?"会员卡余额":e.paymentTypes[0].name),e.form.userId&&e.listExistCardTemplate()}),(function(t){e.loading=!1,"店铺不存在"!==t.errorMessage&&e.$message.warning(t.errorMessage)}))},submitOrder:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,s,l,c,d,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.analysisAddress(e.currentUser.shop.address);case 2:return a=t.sent,t.next=5,e.analysisAddress(e.form.shippings[0].address);case 5:i=t.sent,r=e.form.orderItems,n=[],s=Object(o["a"])(r);try{for(s.s();!(l=s.n()).done;)for(c=l.value,d=0;d<c.quantity;d++)p={cname:e.currentUser.shop.name,spro:a.province,scity:a.city,num:c.product.vins[d].number,epro:i.province,ecity:i.city,depname:e.form.shippings[0].consignee},n.push(_["a"].post("/admin/order/shipping2XinYue.jhtml",p))}catch(u){s.e(u)}finally{s.f()}Promise.all(n).then((function(t){e.$emit("xrorder")})).catch((function(t){e.$emit("xrorder")}));case 11:case"end":return t.stop()}}),t)})))()},analysisAddress:function(e){return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("开始解析, "+e),t.abrupt("return",new Promise((function(t,a){var i=new window.BMap.Geocoder;i.getPoint(e,(function(e){i.getLocation(e,(function(e){console.log(e),t({province:e.addressComponents.province,city:e.addressComponents.city})}))}))})));case 2:case"end":return t.stop()}}),t)})))()},save:function(){var e=this;if(this.reasons&&this.reasons.length>0&&this.itemId&&this.form.orderItems[0].appointment&&(this.form.orderItems[0].appointment.reasons=this.reasons.map((function(t){return e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.reasons&&-1!==e.form.orderItems[0].appointment.reasons.indexOf(t.id)?{id:t.id,content:t.content}:{id:"",content:""}}))),""===this.form.consultant.id)return this.$message.warning("请输入顾问"),!1;if("ride"===this.$route.params.orderType){if(console.log(this.form.orderItems[0].appointment.plateNumber),""===this.form.orderItems[0].appointment.plateNumber)return this.$message.warning("请输入试驾车号"),!1;if(""===this.form.orderItems[0].appointment.product.fullName)return this.$message.warning("请输入试驾车型"),!1}if(this.itemId)if("shipping"===this.handler){if(this.loading=!0,this.shippingMethod.map((function(t){t.name===e.form.shippingMethodName&&(e.form.shippingMethodId=t.id)})),this.form.deliveryCorpId=this.form.shippings[0].deliveryCorpId,this.showDelivery){if(""===this.form.shippings[0].deliveryCorpId&&"0"===this.form.shippings[0].isLCL)return this.$message.warning("请输入物流公司"),this.loading=!1,!1;if(""===this.form.shippings[0].expressSn&&"0"===this.form.shippings[0].isLCL)return this.$message.warning("请输入物流单号"),this.loading=!1,!1;if(""===this.form.shippings[0].freight||!/^(0|[0-9][0-9]*)(\.\d+)?$/.test(this.form.shippings[0].freight))return this.$message.warning("请输入正确的物流费用"),this.loading=!1,!1;this.showReceiver?this.$set(this.form,"shippingData",{isLCL:this.form.shippings[0].isLCL,phone:this.form.shippings[0].phone||this.form.phone,address:this.form.shippings[0].address||this.form.areaName,consignee:this.form.shippings[0].consignee||this.form.consignee,expressSn:this.form.shippings[0].expressSn,freight:this.form.shippings[0].freight}):this.$set(this.form,"shippingData",{expressSn:this.form.shippings[0].expressSn,freight:this.form.shippings[0].freight})}else this.showReceiver&&!this.showDelivery&&(this.$set(this.form,"shippingData",{phone:this.form.shippings[0].phone||this.form.phone,address:this.form.shippings[0].address||this.form.areaName,consignee:this.form.shippings[0].consignee||this.form.consignee}),this.$set(this.form,"deliveryCorpId",this.form.shippings[0].deliveryCorpId));this.loading=!0,c["a"].shippingOrder(this.form,(function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("operationSuccess"),console.log("shipping-success"),e.isShipped=!0}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))}else if("service"===this.handler)this.loading=!0,c["a"].excuteOrder(this.form,(function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("operationSuccess")}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}));else if("payment"===this.handler){if(this.loading=!0,this.paymentTypes.map((function(t){t.name===e.form.payments[0].paymentType&&(e.form.paymentTypeId=t.id)})),this.form.payment={payBank:this.form.payments[0].payBank,payAccount:this.form.payments[0].payAccount,amount:this.form.amount},!this.form.payments[0].paymentType||("刷卡"===this.form.payments[0].paymentType||"汇款"===this.form.payments[0].paymentType)&&(""===this.form.payments[0].payBank||""===this.form.payments[0].payAccount))return this.$message.warning("请输入付款信息"),this.loading=!1,!1;this.$refs.form.validate((function(t,a){t?c["a"].paymentOrder(e.form,(function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("operationSuccess")}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)})):e.loading=!1}))}else this.loading=!0,c["a"].updateOrder(this.form,(function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("operationSuccess"),"2"===e.form.orderType&&e.tagMapping()}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}));else{if(!this.form.payments[0].paymentType)return this.$message.warning("请输入付款信息"),this.loading=!1,!1;this.createOrder()}var t=this.deliveryCorps.find((function(t){return t.id===e.form.shippings[0].deliveryCorpId})).name;"shipping"===this.handler&&"新悦物流"===t&&this.submitOrder()},setOrderItems:function(e){this.orderItems=e,this.orderItems.forEach((function(e){e.productId=e.productId?e.productId:e.id}));var t=0;e.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.originalAmount=t,this.form.originalAmount=t,this.offsetAmountChange(),this.form.member.nickname&&this.getCouponList()},createOrder:function(){var e=this;if(this.shippingMethod.map((function(t){t.name===e.form.shippingMethodName&&(e.form.shippingMethodId=t.id)})),this.paymentTypes.map((function(t){t.name===e.form.payments[0].paymentType&&(e.form.paymentTypeId=t.id)})),this.form.appointmentData=this.form.orderItems[0].appointment,"rescue"===this.$route.params.orderType&&(this.form.appointmentData.reasons=this.reasons.map((function(t){return-1!==e.form.appointmentData.reasons.indexOf(t.id)?{id:t.id,content:t.content}:{id:"",content:""}}))),this.showInfo&&!this.form.payments[0].paymentType||this.showInfo&&("刷卡"===this.form.payments[0].paymentType||"汇款"===this.form.payments[0].paymentType)&&(""===this.form.payments[0].payBank||""===this.form.payments[0].payAccount))return this.$message.warning("请输入付款信息"),this.loading=!1,!1;this.loading=!0,this.$refs.form.validate((function(t,a){t&&c["a"].createOrder({appointmentData:e.form.orderItems[0].appointment,appointmentDate:e.form.appointmentDate,appointmentEndDate:e.form.appointmentEndDate,sn:e.form.sn,type:e.form.type,orderType:e.$route.params.orderType,orderStatus:"交易完成"===e.form.type?"2":e.form.type,bean:e.form.beanDiscount,couponCode:e.getCouponCode,amount:e.form.amount,amountPrepay:e.form.amountPrepay,paymentTypeId:e.form.paymentTypeId,shippingMethod:{id:e.form.shippingMethodId},amountFinalpay:e.form.amountFinalpay,originalAmount:e.form.originalAmount,offsetAmount:e.form.offsetAmount,freight:e.form.shippings&&e.form.shippings.length?e.form.shippings[0].freight:"",memberCardId:e.form.memberCardId,amountPaid:e.form.curAmount,userId:e.form.userId,consultant:{id:e.form.consultant.id},car:{id:e.form.car.id},area:{id:e.areaId},address:e.form.address,areaName:e.form.areaName,consignee:e.form.consignee,phone:e.form.phone,zipCode:e.form.zipCode,remarks:e.form.remarks,memo:e.form.memo,promotionDiscount:e.form.promotionDiscount,couponDiscount:e.form.couponDiscount,beanDiscount:e.form.beanDiscount,point:e.form.point,giftBean:e.form.giftBean,shippingMethodName:e.form.shippingMethodName,paymentMethodId:e.form.paymentMethodId,invoiceState:e.form.invoiceState,orderTime:e.form.orderTime,deliveryTime:e.form.deliveryTime,paymentTime:e.form.paymentTime,completeTime:e.form.completeTime,orderItems:e.orderItems,payments:[{paymentType:e.form.payments[0].paymentType,payBank:e.form.payments[0].payBank,payAccount:e.form.payments[0].payAccount}],member:{nickname:e.form.member.nickname,gender:e.form.member.gender,mobile:e.form.member.mobile},shippings:[{isLCL:e.form.shippings[0].isLCL,shippingMethod:e.form.shippings[0].shippingMethod,deliveryCorpId:e.form.shippings[0].deliveryCorpId,expressSn:e.form.shippings[0].expressSn,freight:e.form.shippings[0].freight,address:e.form.shippings[0].address,consignee:e.form.shippings[0].consignee,phone:e.form.shippings[0].phone,zipCode:e.form.shippings[0].zipCode}]},(function(t){e.loading=!1,e.$message.success("保存成功"),e.form=e.getDefaultForm(),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.driveStartDate&&(e.form.orderItems[0].appointment.driveStartDate=e.form.orderItems[0].appointment.driveStartDate.split(" ")[1]),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.driveEndDate&&(e.form.orderItems[0].appointment.driveEndDate=e.form.orderItems[0].appointment.driveEndDate.split(" ")[1]),e.$emit("operationSuccess"),e.isCreated=!0,e.itemId=t.id,e.tagMapping()}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))}))},productChange:function(){var e=this;this.modeList.map((function(t){t.id===e.form.orderItems[0].appointment.product.id&&(e.form.orderItems[0].appointment.product.price=t.price)}))},listExistCardTemplate:function(){var e=this;c["a"].listExistCardTemplate({userId:this.form.userId},(function(t){e.loading=!1,e.listExistCard=t.content,e.listExistCard.forEach((function(e){e.template.name+=" ¥"+e.balance}))}),(function(e){console.log(e)}))},getFinancialPlans:function(){var e=this;c["a"].getFinancialPlans({shopId:window.top.SHOP_ID||""},(function(t){e.loading=!1,e.financialPlans=t.financials}),(function(e){console.log(e)}))},getSaveParams:function(){return{orderId:this.itemId}},areaChanged:function(e){this.areaId=e,this.isFirst&&(this.areaId="1568",this.isFirst=!1)},handleBrandChange:function(e){this.querySeriesList(e),this.$set(this.form.orderItems[0].appointment.product,"seriesId",""),this.$set(this.form.orderItems[0].appointment.product,"id","")},handleSeriesChange:function(e){this.queryTypeList(e),this.$set(this.form.orderItems[0].appointment.product,"id","")},queryMemberList:function(e){var t=this;c["a"].memberList(e,(function(e){t.dialogLoading=!1,t.dialogTableData=e.content,t.dialogPagination.total=Number(e.total)}),(function(e){console.log(e),console.log("code错误")}))},opened:function(){this.dialogPagination.currentPage=1,this.dialogPagination.pageSize=20,this.dialogFilters=[{type:"input",label:"",placeholder:"请输入名称或手机号",name:"searchValue",value:""}],this.queryMemberList(this.getDialogQueryParams())},getDialogQueryParams:function(){return{pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[0].value}},productPageSizeChange:function(e){this.$set(this.productPagination,"pageSize",e)},productCurrentPageChange:function(e){this.$set(this.productPagination,"currentPage",e)},dialogFilterDataChange:function(e){this.dialogPagination.currentPage=1,this.queryMemberList(this.getDialogQueryParams())},dialogPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.queryMemberList(this.getDialogQueryParams())},dialogCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.queryMemberList(this.getDialogQueryParams())},handleSuccess:function(e,t,a){this.form.orderItems[0].appointment.images.push({path:e.fis[0].url})},handleRemove:function(e,t){var a=this.form.orderItems[0].appointment.images.findIndex((function(t){return t.path===e.path}));-1!==a&&this.form.orderItems[0].appointment.images.splice(a,1)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.picDialogVisible=!0},dialogOperate:function(e){},queryBrandList:function(){var e=this;c["a"].brands({},(function(t){e.brandList=t.dataList}),(function(e){console.log(e),console.log("code错误")}))},querySeriesList:function(e){var t=this;c["a"].series({brandId:e},(function(e){t.seriesList=e.dataList}),(function(e){console.log(e),console.log("code错误")}))},getBrandList:function(){var e=this;S["a"].queryBrandList({},(function(t){e.brandData=t.dataList}),(function(e){console.log(e),console.log("code错误")}))},getSeriesList:function(e){var t=this;S["a"].querySeriesList({brand:e},(function(e){t.seriesData=e.dataList}),(function(e){console.log(e),console.log("code错误")}))},getModeList:function(e){var t=this;S["a"].queryTypeList({series:e,brand:this.formModel.defaultCarInfo.brand},(function(e){t.modeData=e.dataList}),(function(e){console.log(e),console.log("code错误")}))},queryTypeList:function(e){var t=this;c["a"].types({seriesId:e,brandId:this.form.brand},(function(e){t.modeList=e.dataList}),(function(e){console.log(e),console.log("code错误")}))},beforeAvatarUpload:function(e){var t=/^image\/(.*)$/.test(e.type);if(!t)return this.$message.error("请选择符合图片格式的文件上传!"),!1;var a=e.size/1024<=200;return!!a||(this.$message.error("上传图片大小不能超过 200K!"),!1)},addMember:function(){this.formModel={userName:"",mobile:"",name:"",password:"123456",nickname:"",gender:"2",defaultCarInfo:{plateNumber:"",vin:"",brand:"",series:"",type:""}},this.dialogVisible=!0},getOrderStatus:function(e){switch(e){case"11":return"卖家已发货";case"10":return"退款退货完成";case"9":return"退款退货中";case"8":return"已过期";case"7":return"已评价";case"6":return"订单关闭";case"5":return"交易完成";case"4":return"订单已执行";case"3":return"买家已付款";case"2":return"商家已确认";case"1":return"待商家确认";default:return"无"}},testDrives:function(){var e=this,t={pageSize:1e3,pageNumber:1,shopId:window.top.SHOP_ID||""};_["a"].get("/admin/testDriveMgmt/testDrives.jhtml",t).then((function(t){e.restaurants=t.dataList.map((function(e){return{value:e.car.plateNumber,id:e.car.id,type:e.car.type}}))})).catch((function(e){console.log(e.errorMessage)}))},querySearchAsync:function(e,t){var a=this.restaurants,i=e?a.filter(this.createStateFilter(e)):a;t(i)},createStateFilter:function(e){return function(e){return!0}},handleSelect:function(e){this.form.orderItems[0].appointment.product.fullName=e.type}})},x=D,M=(a("0f32"),Object(v["a"])(x,i,r,!1,null,null,null));t["a"]=M.exports},b547:function(e,t,a){},c0a6:function(e,t,a){},c396:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"order-purchase"},[a("div",{staticClass:"toggle-btn",on:{click:e.isShow}},[e._v(" "+e._s(e.toggleRecommendTxt)+" "),a("div",{staticClass:"iconfont biz-icon-i-web-zd1",class:{"rotate-180":e.showRecommend}})]),a("biz-flex-table",{ref:"table",staticClass:"order-mgmt-tabel",attrs:{operations:e.operations,filters:e.filters,tableData:e.tableData,loading:e.loading,pagination:e.pagination,isMergeInvoice:!0,showSummary:!0},on:{operate:e.operate,"filter-data-change":e.filterDataChange,"selection-change":e.handleSelectionChange,"row-click":e.rowClick,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[a("div",{staticClass:"operate-container",attrs:{slot:"operation"},slot:"operation"},[a("el-radio-group",{attrs:{size:"mini"},on:{change:e.onChangeDateType},model:{value:e.curSelectDateType,callback:function(t){e.curSelectDateType=t},expression:"curSelectDateType"}},e._l(e.dateTypeList,(function(t){return a("el-radio-button",{key:t,attrs:{label:t}},[e._v(e._s(t))])})),1)],1),a("el-table-column",{attrs:{label:"订单","min-width":"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(e._s(t.row.sn))]),a("div",{staticClass:"overflow"},[e._v("创建日期："+e._s(t.row.orderTime))]),a("div",{staticClass:"overflow"},[e._v("状态："+e._s(e.getOrderStatus(t.row)))])])]}}])}),a("el-table-column",{attrs:{label:"供应商","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" "+e._s(t.row.supplier?t.row.supplier.name:"")+" ")])])]}}])}),a("el-table-column",{attrs:{label:"关联单据","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},e._l(t.row.relateBills,(function(t,i){return a("div",{key:i,staticClass:"overflow"},[a("div",{staticClass:"shop-over overflow",staticStyle:{color:"#ff7300",cursor:"pointer"},attrs:{title:t.relateBillSn?t.relateBillSn:""},on:{click:function(a){return e.clickRelateBill(a,t)}}},[e._v(" "+e._s(t.relateBillSn?t.relateBillSn:"")+" ")])])})),0)]}}])}),a("el-table-column",{attrs:{label:"金额","min-width":"120px",prop:"amount"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("div",[e._v(" 不含税： ")]),a("div",[e._v(" 税额： ")]),a("div",[e._v(" 含税："+e._s(t.row.amount)+" ")])])]}}])}),a("el-table-column",{attrs:{label:"商品信息","min-width":"220px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[a("div",{staticStyle:{width:"100%"}},e._l(t.row.orderItems.length>0?[t.row.orderItems[0]]:[],(function(i){return a("div",{key:i.sn,staticClass:"product-info-content"},[i.thumbnail&&" "!==i.thumbnail?a("img",{attrs:{src:i.thumbnail,onerror:e.errorImg}}):a("img",{attrs:{src:"/resources/admin/images/default/product-default-100.png"}}),a("div",{staticClass:"wrapper"},[a("div",{staticClass:"titleClass",attrs:{title:i.name}},[e._v(e._s(i.name))]),a("div",{staticClass:"overflow"},[e._v(e._s(i.product?i.product.barCode:""))]),a("div",{staticClass:"overflow"},[e._v("单价(不含税)：")]),a("div",{staticClass:"overflow"},[e._v("单价(含税)："+e._s(i.price))])]),a("div",{staticClass:"amount"},[e._v(e._s(i.quantity)+e._s(t.row.orderItems.length>1?"...":""))])])})),0)])]}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("biz-column-operation",{attrs:{row:t.row}},["0"===t.row.hasSyncOrder&&"4"===t.row.state?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.confirmOrderShipping(t.row)}}},[e._v("确认收货")]):e._e(),t.row.shippings.length>0&&("0"===t.row.hasSyncOrder&&"5"!==t.row.state&&"6"!==t.row.state&&"7"!==t.row.state||"13"===t.row.state)?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.logisticsHandler(t.row)}}},[e._v("物流跟踪")]):e._e(),"0"===t.row.hasSyncOrder&&("2"===t.row.state&&"0"===t.row.shippingWay||"12"===t.row.state&&"0"===t.row.shippingWay)?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.paymentHandler(t.row)}}},[e._v("付款")]):e._e(),"0"===t.row.hasSyncOrder&&"2"===t.row.state&&"0"===t.row.shippingWay?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.closeOrder(t.row)}}},[e._v("取消")]):e._e(),"0"===t.row.hasSyncOrder?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.certificate(t.row)}}},[e._v("凭证")]):e._e(),"0"!==t.row.hasSyncOrder||"6"===t.row.state||t.row.invoiceId?e._e():a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.invoiceHandler(t.row)}}},[e._v("申请发票")]),"0"===t.row.hasSyncOrder&&"5"===t.row.state?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.review(t.row)}}},[e._v("评价")]):e._e(),"0"===t.row.hasSyncOrder&&"1"===t.row.state&&("1"===t.row.auditState&&"1"===t.row.audit||"2"===t.row.auditState&&"1"===t.row.audit)?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.toPass(t.row)}}},[e._v("审核")]):e._e()],1)]}}])})],1),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.showPassOrder,center:"","append-to-body":"","custom-class":"close-order-dialog",title:"审核"},on:{"update:visible":function(t){e.showPassOrder=t}}},[a("div",[a("div",{staticClass:"reson-container"},[a("span",[e._v("审核结果：")]),a("el-radio",{attrs:{label:"1",size:"mini"},model:{value:e.auditState,callback:function(t){e.auditState=t},expression:"auditState"}},[e._v("通过")]),a("el-radio",{attrs:{label:"2",size:"mini"},model:{value:e.auditState,callback:function(t){e.auditState=t},expression:"auditState"}},[e._v("驳回")]),a("div",{directives:[{name:"show",rawName:"v-show",value:"2"===e.auditState,expression:"auditState==='2'"}],staticStyle:{padding:"5px 0px","margin-top":"15px"}},[a("span",[e._v("驳回理由：")]),a("el-select",{staticClass:"order-select",attrs:{placeholder:"请选择驳回理由",size:"mini"},model:{value:e.curSelectAjectReason,callback:function(t){e.curSelectAjectReason=t},expression:"curSelectAjectReason"}},e._l(e.reasonAjectList,(function(e){return a("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-input",{staticStyle:{"margin-top":"15px"},attrs:{type:"textarea"},model:{value:e.remarks,callback:function(t){e.remarks=t},expression:"remarks"}})],1)]),a("div",{staticClass:"close-button",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.showPassOrder=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.statusChange(e.row,e.auditState)}}},[e._v("确定")])],1)]),a("biz-popup-tabs",{attrs:{open:e.openAdd},on:{close:function(t){e.openAdd=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"添加订单",name:"addinfo"}},[e.step1?a("add-step-1",{ref:"step1",attrs:{step1Data:e.step1Data},on:{step1Confirm:e.step1Confirm}}):e._e(),e.step2?a("add-step-2",{ref:"step2",attrs:{supplierId:e.supplierId,step2Data:e.step2Data,step2SubTotal:e.step2SubTotal},on:{step2Confirm:e.step2Confirm,stepToOne:e.stepToOne}}):e._e(),e.step3?a("add-step-3",{attrs:{supplierId:e.supplierId},on:{step3Confirm:e.step3Confirm,stepToTwo:e.stepToTwo,complate:e.complate}}):e._e()],1)],1),a("biz-popup-tabs",{attrs:{open:e.open},on:{close:function(t){e.open=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[a("order-info",{ref:"info",attrs:{orderId:e.itemId,isPend:e.isPend,isRalateBill:e.isRalateBill,hasSyncOrder:e.hasSyncOrder},on:{closeTabByLogistics:e.closeTabByLogistics,closeTabByEvaluate:e.closeTabByEvaluate}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openLogistics},on:{close:function(t){e.openLogistics=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[e.sn?a("el-tab-pane",{attrs:{label:"物流追踪",name:"loginfo"}},[a("logistics-following",{ref:"logistics",attrs:{orderId:e.itemId,sn:e.sn}})],1):e._e()],1),a("biz-popup-tabs",{attrs:{open:e.openPay},on:{close:function(t){e.openPay=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"付款",name:"payinfo"}},[a("pay-info",{attrs:{orderId:e.itemId,amountPaid:e.amountPaid,amount:e.amount,amountPayable:e.amountPayable},on:{operateSuccess:e.operateSuccess}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openInvoice},on:{close:function(t){e.openInvoice=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"发票",name:"invoiceinfo"}},[a("invoice-info",{attrs:{orderIds:e.orderIds,invoiceAmount:e.invoiceAmount},on:{close:e.close}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openReview},on:{close:function(t){e.openReview=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"评价",name:"reviewinfo"}},[a("my-evaluate",{ref:"reviewinfo",attrs:{orderId:e.orderId,editable:e.editable},on:{operationSuccess:e.operationSuccess}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openPurchase},on:{close:function(t){e.openPurchase=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[a("purchase-apply-info",{attrs:{itemId:e.purchaseId,isEdit:e.isEdit},on:{operationSuccess:e.operationSuccess}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openPurchaseOrder},on:{close:function(t){e.openPurchaseOrder=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[a("purchase-order-info",{ref:"orderinfo",attrs:{orderId:e.purchaseOrderId,isRalateBill:e.isRalateBill,isEdit:e.isEdit},on:{closeTabByLogistics:e.closeTabByLogistics}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openOrderSale},on:{close:function(t){e.openOrderSale=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"orderinfo"}},[a("order-sale-info",{ref:"orderSaleInfo",attrs:{itemId:e.orderSaleId,isEdit:e.isEdit},on:{operationSuccess:e.refresh}})],1),a("el-tab-pane",{attrs:{label:"商品信息",name:"OrderSaleProductInfo"}},[a("order-sale-product-info",{ref:"OrderSaleProductInfo",attrs:{itemId:e.orderSaleId,isEdit:e.isEdit},on:{operationSuccess:e.refresh}})],1)],1),a("el-dialog",{attrs:{visible:e.dialogTableVisible,center:"",width:"1200px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"left"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.printExport}},[e._v("导出")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.print}},[e._v("打印")])],1)])],1),a("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[e._v(e._s(e.title))])]),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"center"}},[e._v("打印日期："+e._s(e.formatDate((new Date).getTime())))])])],1),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("订单编号："+e._s(e.form.sn))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("下单时间："+e._s(e.form.orderTime))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("收件人："+e._s(e.form.consignee))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("收件人电话："+e._s(e.form.phone))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("收件人地址："+e._s(e.form.areaName?e.form.areaName+e.form.address:e.form.address))])])],1),a("el-table",{staticClass:"table-class",attrs:{data:e.gridData}},[a("el-table-column",{attrs:{property:"isTotal",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isTotal?a("div",[e._v("合计")]):a("div",[e._v(e._s(t.$index+1))])]}}])}),a("el-table-column",{attrs:{property:"fullName",label:"商品名称"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(e._s(t.row.fullName))]}}],null,!0)}),a("el-table-column",{attrs:{property:"barCode",label:"条码"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.product?[e._v(e._s(t.row.product.barCode))]:void 0}}],null,!0)}),a("el-table-column",{attrs:{property:"price",label:"单价"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v("￥"+e._s(t.row.price))]}}],null,!0)}),a("el-table-column",{attrs:{property:"quantity",label:"数量"}}),a("el-table-column",{attrs:{property:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("￥"+e._s(t.row.subTotal))]}}])})],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:3}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("运费：￥"+e._s(e.form.freight))])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("优惠金额：￥"+e._s(e.form.couponDiscount))])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("调整金额：￥"+e._s(e.form.offsetAmount))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("实收金额：￥"+e._s(e.form.amountPaid))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("客户签字：")])])],1)],1)])],1),a("el-dialog",{attrs:{visible:e.showCloseOrder,center:"","append-to-body":"","custom-class":"close-order-dialog"},on:{"update:visible":function(t){e.showCloseOrder=t}}},[a("div",[a("div",[e._v("取消订单后，本订单享有的优惠将一并取消，是否继续")]),a("div",{staticClass:"reson-container"},[a("span",{staticClass:"start"},[e._v("*")]),a("span",[e._v("请选择取消订单的理由：")]),a("el-select",{staticClass:"order-select",attrs:{placeholder:"请选择取消理由",size:"mini"},model:{value:e.curSelectCloseReason,callback:function(t){e.curSelectCloseReason=t},expression:"curSelectCloseReason"}},e._l(e.reasonList,(function(e){return a("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})})),1)],1)]),a("div",{staticClass:"close-button",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.cancelClose}},[e._v("取消")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.confirmClose}},[e._v("确定")])],1)])],1)},r=[],o=(a("99af"),a("4160"),a("c975"),a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("ac1f"),a("3ca3"),a("466d"),a("1276"),a("159b"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),n=a("5530"),s=a("7132"),l=a("04d3"),c=a("e42c"),d=a("1ab1"),p=a("2f62"),u=a("c596"),m=a("225d"),f=a("2c2c"),h=a("fc46"),g=a("276c"),b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"payInfo"},[a("div",{staticClass:"price-label"},[a("span",{staticClass:"price-title"},[e._v("已付款金额")]),a("el-input",{attrs:{disabled:!0},model:{value:e.amountPaid,callback:function(t){e.amountPaid=t},expression:"amountPaid"}},[a("template",{slot:"append"},[e._v("元")])],2)],1),a("div",{staticClass:"price-label"},[a("span",{staticClass:"price-title"},[e._v("本次付款金额")]),a("el-input",{model:{value:e.amount,callback:function(t){e.amount=t},expression:"amount"}},[a("template",{slot:"append"},[e._v("元")])],2)],1),e._l(e.paymentTypes,(function(t){return a("div",{key:t.id,staticClass:"content-item"},[a("div",{staticClass:"radio-class"},[a("el-radio",{attrs:{size:"mini",label:t.type},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[a("span")])],1),a("div",{staticClass:"item"},[t.icon?a("img",{staticStyle:{margin:"10px"},attrs:{src:t.icon,width:"30",height:"30"}}):a("img",{attrs:{src:e.vfacLogo,width:"50",height:"50"}}),a("div",[e._v(e._s(t.name))]),"2"===t.type&&"2"===e.radio?a("div",[a("el-select",{attrs:{placeholder:"请选择会员卡",size:"mini"},model:{value:e.memberCardId,callback:function(t){e.memberCardId=t},expression:"memberCardId"}},e._l(t.memberCards,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e()])])})),a("el-form",{ref:"form",attrs:{"label-width":"140px",size:"small",model:e.form,rules:e.rules}},["2"===e.radio?a("el-form-item",{attrs:{label:"会员卡支付密码",prop:"password"}},[a("div",{staticStyle:{display:"flex"}},[a("el-input",{attrs:{type:"password",maxlength:"6",minlength:"6"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}}),"0"===e.form.hasSetPayPassword&&"2"===e.radio?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.setPass}},[e._v("设置密码")]):e._e()],1)]):e._e(),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirm}},[e._v("确定")])],1),a("el-dialog",{attrs:{visible:e.dialogVisible,title:"设置支付密码",width:"40%","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"valid-div"},[a("el-form",{ref:"formPass",attrs:{"label-width":"140px",size:"small",model:e.formPass,rules:e.rulesPass}},[a("el-form-item",{attrs:{label:"请输入支付密码",prop:"pass"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入支付密码",size:"mini",maxlength:"6"},model:{value:e.formPass.pass,callback:function(t){e.$set(e.formPass,"pass",t)},expression:"formPass.pass"}})],1),a("el-form-item",{attrs:{label:"请确认支付密码",prop:"checkpass"}},[a("el-input",{attrs:{type:"password",placeholder:"请确认支付密码",size:"mini",maxlength:"6"},model:{value:e.formPass.checkpass,callback:function(t){e.$set(e.formPass,"checkpass",t)},expression:"formPass.checkpass"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirmByDialog}},[e._v("确 定")])],1)])],2)},v=[],y=a("f36f"),C=a("624d"),I=a.n(C),w={components:{BizGrid:y["a"]},data:function(){var e=this,t=function(t,a,i){""===a?i(new Error("请输入支付密码")):(""!==e.formPass.checkpass&&e.$refs.formPass.validateField("checkpass"),i())},a=function(t,a,i){""===a?i(new Error("请确认支付密码")):a!==e.formPass.pass?i(new Error("两次输入密码不一致!")):i()};return{vfacLogo:I.a,radio:"7",memberCardId:"",paymentTypes:[],nbzz:!0,hykye:!1,loading:!1,dialogVisible:!1,form:{hasSetPayPassword:"",password:""},formPass:{pass:"",checkpass:""},rules:{password:[{required:!0,message:"请输入密码",trigger:"blur"}]},rulesPass:{pass:[{validator:t,trigger:"blur"},{required:!0,min:6,max:6,message:"长度为6位数字",trigger:"blur"}],checkpass:[{required:!0,validator:a,trigger:"blur"}]}}},props:{orderId:{type:String,default:""},amountPaid:{type:String,default:""},amountPayable:{type:String,default:""},amount:{type:String,default:""}},computed:Object(n["a"])({},Object(p["c"])(["getUser"])),watch:{orderId:function(e,t){e&&(this.getPaymentType(),this.form.password="",this.radio="7")}},methods:{getPaymentType:function(){var e=this,t={shopId:this.getUser.shop.id,orderId:this.orderId,userId:this.getUser.id};d["a"].get("/admin/purchaseOrder/paymentTypes.jhtml",t).then((function(t){e.paymentTypes=t.paymentTypes,e.form.hasSetPayPassword=t.hasSetPayPassword})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},setPass:function(){this.formPass.pass="",this.formPass.checkpass="",this.dialogVisible=!0},confirmByDialog:function(){var e=this;this.$refs.formPass.validate((function(t,a){if(t){var i={type:"2",userNewPwd:e.formPass.pass,userPwd:e.formPass.checkpass,clientType:"2",methodName:"BalancePayment",shopId:e.getUser.shop.id,userId:e.getUser.id};e.loading=!0,d["a"].put("/rest/member/password.jhtml",i).then((function(t){e.$message.success("支付密码设置成功"),e.loading=!1,e.dialogVisible=!1})).catch((function(t){console.log(t),e.loading=!1,e.$message.warning(t.errorMessage)}))}}))},confirm:function(){var e=this;this.$refs.form.validate((function(t,a){if(t){if(Number(e.amount)<0)return e.$message.warning("本次付款金额不能为负数"),!1;if(!/^[0-9]+\.?[0-9]*$/.test(e.amount))return e.$message.warning("本次付款金额格式错误!"),!1;if(Number(e.amount)>e.amountPayable)return e.$message.warning("本次付款金额大于需付款金额!"),!1;if("2"===e.radio&&!e.memberCardId)return void e.$message.warning("请选择会员卡");var i={amount:e.amount,orderId:e.orderId,memberCardId:e.memberCardId,password:e.form.password,methodName:"BalancePayment",clientType:"2",shopId:e.getUser.shop.id,userId:e.getUser.id};e.loading=!0,"2"===e.radio?d["a"].post(u["g"].hypermarketMgmt.balancePayment,i).then((function(t){e.$message.success("支付成功"),e.loading=!1,e.$emit("operateSuccess")})).catch((function(t){console.log(t),e.loading=!1,e.$message.warning(t.errorMessage)})):d["a"].post(u["g"].hypermarketMgmt.internalTransferPayment,i).then((function(t){e.$message.success("支付成功"),e.loading=!1,e.$emit("operateSuccess")})).catch((function(t){console.log(t),e.loading=!1,e.$message.warning(t.errorMessage)}))}}))}}},S=w,_=(a("172f"),a("2877")),T=Object(_["a"])(S,b,v,!1,null,null,null),k=T.exports,D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"invoice-info-p"},[a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),e._l(e.invoiceList,(function(t){return a("el-card",{key:t.id},[a("div",[a("div",{staticClass:"radio-i",on:{click:function(a){return e.applyFor(t)}}},[a("el-radio",{attrs:{label:"1",size:"mini"},on:{change:function(a){return e.selectChange(t)}},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"invoice.checked"}},[a("span",{staticStyle:{color:"#ffffff"}},[e._v(".")])]),a("div",[a("div",{staticClass:"default"},[a("span",[e._v("发票抬头：")]),a("span",[e._v(e._s(t.invoiceTitle))]),"1"===t.isDefault?a("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary",size:"mini"}},[e._v("默认")]):e._e()],1),a("div",{staticStyle:{"padding-top":"10px"}},[a("span",[e._v("发票类型：")]),a("span",[e._v(e._s("0"===t.invoiceType?"个人":"1"===t.invoiceType?"增值税普通发票":"2"===t.invoiceType?"增值税专用发票":""))])]),a("div",{staticStyle:{padding:"10px 0px"}},[a("span",[e._v("联系人：")]),a("span",[e._v(e._s(t.contacts))])]),a("div",[a("span",[e._v("联系电话：")]),a("span",[e._v(e._s(t.mobile))])]),a("div",{staticClass:"content-d"},[a("span",[e._v("详细地址：")]),a("span",[e._v(e._s(t.areaName+t.address))])])])],1),e.hasAuthEdit?a("div",{staticClass:"bottom-d"},["0"===t.isDefault?a("span",{on:{click:function(a){return a.stopPropagation(),e.setDefault(t)}}},[e._v("设为默认")]):e._e(),a("span",{on:{click:function(a){return a.stopPropagation(),e.editForm(t)}}},[e._v("编辑")]),a("span",{on:{click:function(a){return a.stopPropagation(),e.deleteForm(t.id)}}},[e._v("删除")])]):e._e()])])})),0===e.invoiceList.length?a("div",{style:e.styleObject}):e._e(),a("el-dialog",{attrs:{visible:e.showForm,"append-to-body":"",height:"40%",width:"30%",center:""},on:{"update:visible":function(t){e.showForm=t}}},[a("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small","inline-message":!0}},[a("el-form-item",{attrs:{label:"发票信息"}}),a("el-form-item",{attrs:{label:"发票类型",prop:"consignee"}},[a("el-select",{model:{value:e.form.invoiceType,callback:function(t){e.$set(e.form,"invoiceType",t)},expression:"form.invoiceType"}},[a("el-option",{attrs:{label:"个人",value:"0"}}),a("el-option",{attrs:{label:"增值税普通发票",value:"1"}}),a("el-option",{attrs:{label:"增值税专用发票",value:"2"}})],1)],1),a("el-form-item",{attrs:{label:"发票抬头",prop:"invoiceTitle"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.invoiceTitle,callback:function(t){e.$set(e.form,"invoiceTitle",t)},expression:"form.invoiceTitle"}})],1),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"纳税人识别号",prop:"code"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1):e._e(),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"注册地址",prop:"registerAddress"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.registerAddress,callback:function(t){e.$set(e.form,"registerAddress",t)},expression:"form.registerAddress"}})],1):e._e(),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"注册电话",prop:"registerMobile"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.registerMobile,callback:function(t){e.$set(e.form,"registerMobile",t)},expression:"form.registerMobile"}})],1):e._e(),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"开户银行",prop:"bank"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.bank,callback:function(t){e.$set(e.form,"bank",t)},expression:"form.bank"}})],1):e._e(),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"银行账户",prop:"account"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],1):e._e(),a("el-form-item",{attrs:{label:"邮寄地址"}}),a("el-form-item",{attrs:{label:"联系人",prop:"contacts"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.contacts,callback:function(t){e.$set(e.form,"contacts",t)},expression:"form.contacts"}})],1),a("el-form-item",{attrs:{label:"联系电话",prop:"mobile"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1),a("el-form-item",{attrs:{label:"所在地区"}},[a("biz-area-select",{staticStyle:{width:"220px"},attrs:{areaId:e.form.area.id},on:{areaChanged:e.handleAreaChanged}})],1),a("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"area",maxlength:"100"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),a("biz-save-button",{attrs:{operations:e.formOperations},on:{operate:e.operate}})],1)],1),a("el-dialog",{attrs:{visible:e.dialogVisiable,"append-to-body":"","custom-class":"bill-dialog"},on:{"update:visible":function(t){e.dialogVisiable=t}}},[a("my-invoice",{attrs:{invoiceInfoId:e.invoiceInfoId,orderIds:e.orderIds},on:{close:e.close,cancle:e.cancle}})],1)],2)},x=[],M=(a("caad"),a("b680"),a("2532"),a("8330")),O=a("ce2e"),P=a("a57d"),$=a("f260"),N=a.n($),z={components:{BizGrid:y["a"],BizSaveButton:M["a"],BizAreaSelect:O["a"],MyInvoice:P["a"]},data:function(){return{invoiceList:[],invoiceInfoId:"",checked:"1",showForm:!1,dialogVisiable:!1,operations:[{label:"添加",name:"add",type:"primary",auth:["admin:purchaseOrder.edit"]}],formOperations:[{label:"保存",name:"save",type:"primary",auth:["admin:purchaseOrder.edit"]},{label:"取消",name:"cancel",type:"primary",auth:["admin:purchaseOrder.edit"]}],rules:{invoiceType:[{required:!0,message:"请输入发票类型",trigger:"blur"}],invoiceTitle:[{required:!0,message:"请输入发票抬头",trigger:"blur"}],code:[{required:!0,message:"请输入纳税人识别号",trigger:"blur"}],registerAddress:[{required:!0,message:"请输入注册地址",trigger:"blur"}],registerMobile:[{required:!0,message:"请输入注册电话",trigger:"blur"}],bank:[{required:!0,message:"请输入开户银行",trigger:"blur"}],account:[{required:!0,message:"请输入银行账户",trigger:"blur"}],contacts:[{required:!0,message:"请输入联系人",trigger:"blur"}],address:[{required:!0,message:"请输入详细地址",trigger:"blur"}],mobile:[{required:!0,message:"请输入联系电话",trigger:"blur"},{len:11,message:"手机号位数错误",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"手机号格式错误",trigger:"blur"}]},form:this.getDetaultModel()}},props:{orderIds:{type:Array},invoiceAmount:{type:Number}},computed:Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(p["c"])(["getUser"])),Object(p["c"])("Authority",["currentAuth"])),{},{hasAuthEdit:function(){return this.currentAuth.includes("admin:purchaseOrder.edit")},styleObject:function(){return{position:"absolute",top:0,bottom:0,left:0,right:0,margin:"auto",width:"200px",background:"url("+N.a+") 50% 50% / 300px no-repeat"}}}),created:function(){this.query()},methods:Object(n["a"])(Object(n["a"])({},Object(p["d"])("Order",["updateCurInvoice"])),{},{operate:function(e){this[e]()},applyFor:function(e){this.invoiceInfoId=e.id,this.$set(e,"invoiceAmount",this.invoiceAmount.toFixed(2)),this.updateCurInvoice(e),this.dialogVisiable=!0},cancle:function(){this.dialogVisiable=!1},close:function(){this.dialogVisiable=!1,this.$emit("close")},selectChange:function(e){this.invoiceList.map((function(t){t.id!==e.id&&(t.checked="0")}))},getDetaultModel:function(){return{account:"",address:"",areaId:"",area:{id:"1568"},areaName:"",bank:"",code:"",contacts:"",invoiceTitle:"",invoiceType:"0",isDefault:"",mobile:"",registerAddress:"",registerMobile:""}},add:function(){this.showForm=!0,this.form=this.getDetaultModel()},cancel:function(){this.showForm=!1},editForm:function(e){this.form=Object.assign(this.getDetaultModel(),e),this.showForm=!0},deleteForm:function(e){var t=this,a={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,ids:[e]};this.$confirm("是否确认删除发票?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d["a"].delete(u["g"].hypermarketMgmt.invoiceInfo,a).then((function(e){t.$message.success("删除成功"),t.query()})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(e){}))}))},save:function(){var e=this;this.$refs.form.validate((function(t,a){t&&(e.form.areaId=e.form.area.id,e.form.id?e.update():e.create())}))},create:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,invoice:this.form};d["a"].post(u["g"].hypermarketMgmt.invoiceInfo,t).then((function(t){e.$message.success("添加成功"),e.query(),e.showForm=!1,"1"===e.form.isDefault&&e.updateCurInvoice(e.form)})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},setDefault:function(e){e.isDefault="1",this.form=Object.assign(this.getDetaultModel(),e),this.update()},update:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,invoice:this.form};d["a"].put(u["g"].hypermarketMgmt.invoiceInfo,t).then((function(t){e.$message.success("更新成功"),e.query(),e.showForm=!1,"1"===e.form.isDefault&&e.updateCurInvoice(e.form)})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},handleAreaChanged:function(e){this.form.area.id=e},query:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id};d["a"].get(u["g"].hypermarketMgmt.invoiceInfos,t).then((function(t){e.invoiceList=t.invoices||[],e.invoiceList.map((function(t){e.$set(t,"checked",t.isDefault)}))})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))}})},L=z,R=(a("29b8"),Object(_["a"])(L,D,x,!1,null,null,null)),A=R.exports,F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"add-step-1"},[a("div",{attrs:{slot:"top"},slot:"top"},[a("div",{staticClass:"header-step"},[a("div",{staticClass:"step-1"},[a("span",[e._v("①")]),a("span",[e._v("选择供应商")]),a("span",[e._v(">")])]),a("div",{staticClass:"step-2"},[a("span",[e._v("②")]),a("span",[e._v("选择商品")]),a("span",[e._v(">")])]),a("div",{staticClass:"step-3"},[a("span",[e._v("③")]),a("span",[e._v("确认订单")])])])]),a("biz-save-button",{attrs:{slot:"bottom",operations:e.operations},on:{operate:e.operate},slot:"bottom"}),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px",size:"small",disabled:!e.isEdit,"inline-message":!0}},[a("el-form-item",{attrs:{label:"供应商",prop:"relatePartnerName"}},[a("el-input",{attrs:{placeholder:"请选择供应商",disabled:!("0"===e.form.state||!e.itemId)},on:{focus:function(t){e.showDialog=!0}},model:{value:e.form.relatePartnerName,callback:function(t){e.$set(e.form,"relatePartnerName",t)},expression:"form.relatePartnerName"}})],1)],1),a("biz-dialog-selector",{staticClass:"supplierDialog",attrs:{title:"选择供应商",visibility:e.showDialog,appendToBody:!0,tableData:e.dialogTableData,pagination:e.dialogPagination,selectionMode:"single",isClear:!1,filters:e.dialogFilters},on:{"update:visibility":function(t){e.showDialog=t},open:e.opened,confirmed:e.handleConfirmed,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange}},[a("el-table-column",{attrs:{label:"供应商名称",prop:"name"}}),a("el-table-column",{attrs:{prop:"address",label:"地址"}}),a("el-table-column",{attrs:{label:"电话",prop:"phone"}})],1)],1)},j=[],B=a("af3f"),q=function(){return{relatePartnerId:"",relatePartnerName:"",relatePartnerType:"",totalFee:"",billType:"",sn:"",applierId:"",applierName:"",relateBill:"",relateBillType:"",discountRate:"0",discontFee:"",auditLevel:"",state:"",id:"",createDate:"",shopId:"",shop:{}}},E={name:"baseInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},isPend:{type:Boolean,default:function(){return!1}},step1Data:{type:Object}},components:{BizGrid:y["a"],BizSaveButton:M["a"],BizDialogSelector:B["a"]},data:function(){return{loading:!1,showDialog:!1,dialogVisible:!1,form:q(),totalFee:0,itemDatas:[],operations:[{label:"确定",name:"save",type:"primary",auth:["admin:purchaseOrder.edit"]}],shopList:[],dialogTableData:[],dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},dialogFilters:[{type:"input",label:"",placeholder:"请输入供应商名称",name:"searchValue",value:""}],rules:{relatePartnerName:[{required:!0,message:"请选择供应商",trigger:["blur","change"]}]}}},computed:{},created:function(){},watch:{},methods:Object(n["a"])(Object(n["a"])({},Object(p["c"])(["getUser"])),{},{operate:function(e){this[e]()},initModel:function(e){e?(this.form=Object.assign(this.getDefaultModel(),e),this.totalFee=Number(e.totalFee)+Number(e.discontFee)):this.resetModel(),this.$refs.form.resetFields()},resetModel:function(){this.form=this.getDefaultModel()},getDefaultModel:function(){return q()},getSaveParams:function(){return{id:this.form.id,relatePartnerId:this.form.relatePartnerId,totalFee:this.form.totalFee,discountRate:this.form.discountRate,discontFee:this.form.discontFee,remark:this.form.remark,shopId:window.top.SHOP_ID||""}},save:function(){var e=this;this.$refs.form.validate((function(t,a){if(!t)return!1;e.$emit("step1Confirm",e.form)}))},opened:function(){this.dialogTableData=[],this.getSupplier()},getSupplier:function(){var e=this;this.loading=!0;var t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[0].value,shopId:window.top.SHOP_ID||"",cooperationType:"0"};d["a"].get(u["g"].hypermarketMgmt.cooperationInfos,t).then((function(t){e.loading=!1,e.dialogTableData=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(t){e.loading=!1,t.errorMessage&&console.log(t.errorMessage)}))},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getSupplier()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getSupplier()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getSupplier()},handleConfirmed:function(e,t){this.form.relatePartnerName=t[0].name,this.form.relatePartnerId=t[0].id},query:function(){this.form=this.step1Data}})},V=E,U=(a("2828"),Object(_["a"])(V,F,j,!1,null,null,null)),H=U.exports,G=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"add-step-2"},[a("div",{attrs:{slot:"bottom"},slot:"bottom"},[a("div",{staticClass:"subTotal"},[a("div",[e._v(" 合计: "),a("span",{staticClass:"price"},[e._v("￥"+e._s(e.subTotal))])]),a("biz-save-button",{attrs:{operations:e.operations},on:{operate:e.operate}})],1)]),a("div",{attrs:{slot:"top"},slot:"top"},[a("div",{staticClass:"header-step"},[a("div",{staticClass:"step-1",on:{click:e.stepOne}},[a("span",[e._v("①")]),a("span",[e._v("选择供应商")]),a("span",[e._v(">")])]),a("div",{staticClass:"step-2"},[a("span",[e._v("②")]),a("span",[e._v("选择商品")]),a("span",[e._v(">")])]),a("div",{staticClass:"step-3"},[a("span",[e._v("③")]),a("span",[e._v("确认订单")])])]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addProduct}},[e._v("添加商品")])],1),a("biz-list",{key:Math.random(),ref:"table",attrs:{tableData:e.tableData,loading:e.loading,height:"100%"}},[a("el-table-column",{attrs:{prop:"fullName",label:"商品名称","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[a("div",{staticStyle:{width:"100%","margin-right":"30px"}},[a("div",{staticClass:"product-info"},[t.row.image?a("img",{attrs:{src:t.row.image}}):a("img",{attrs:{src:"/resources/admin/images/default/product-default-100.png"}}),a("div",{staticClass:"wrapper"},[a("div",{staticClass:"titleClass",attrs:{title:t.row.fullName}},[e._v(e._s(t.row.fullName))])]),a("div",{staticClass:"info-bottom"},[a("div",{staticStyle:{"margin-left":"7px",color:"red"}},[e._v("￥"+e._s(t.row.price))])])])])])]}}])}),a("el-table-column",{attrs:{prop:"barCode",label:"条码"}}),a("el-table-column",{attrs:{prop:"quantity",label:"数量","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{attrs:{size:"mini",min:1},on:{change:function(a){return e.quantityChange(t.row.quantity)}},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作",type:"index"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[e.isEdit?a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteHandeler(t)}}},[e._v("删除")])],1):e._e()])}}])})],1),a("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:e.showDialog,tableData:e.giftList,pagination:e.dialogPagination,filters:e.dialogFilters,selectionKeys:e.selectedGiftIds},on:{"update:visibility":function(t){e.showDialog=t},pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,confirmed:e.confirmedProduct,filterDataChange:e.dialogFilterDataChange,selectionChange:e.selectionChange,"active-item-change":e.activeItemChange,cascaderChange:e.cascaderChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"dialog-column"},[a("img",{staticClass:"productImg",attrs:{src:t.row.image||e.DefaultImg,onerror:e.errorImg}}),a("div",{staticClass:"biz-two-row"},[a("div",{staticClass:"titleClass",staticStyle:{"margin-left":"10px"},attrs:{title:t.row.fullName}},[e._v(e._s(t.row.fullName))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("编号："+e._s(t.row.sn))])])])]}}])}),a("el-table-column",{attrs:{property:"barCode",label:"条码"}}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),a("el-table-column",{attrs:{property:"price",label:"价格"}}),a("el-table-column",{attrs:{label:"在库库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.realStock))])]}}])})],1)],1)},K=[],Y=(a("4de4"),a("a434"),a("25f0"),a("7558")),Q=a("2086"),W=a("f3ac"),X=a.n(W),J=a("11e9"),Z={name:"NewsMgmt",props:{itemId:{type:String},supplierId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},step2Data:{type:Array},step2SubTotal:{type:String}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},errorImg:'this.src="/resources/admin/images/default/product-default.png"',DefaultImg:X.a,selectedGiftList:[],selectedGiftIds:[],categoryDatas:[],showDialog:!1,dialogFilters:[{type:"cascader",label:"分类",name:"category",filterable:!1,value:[],options:[]},{type:"select",label:"品牌",value:"",options:[]},{type:"input",placeholder:"请输入编号/商品名/条码",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,subTotal:"",height:"585",productCategoryId:"",subTotalAll:"",tableData:[],restaurants:[],selections:[],orderItems:[],selectionList:[],dialogTableVisible:!1,gridData:[],formData:{},shippingData:{},title:"",form:{products:""},operations:[{label:"确定",name:"save",type:"primary",auth:["admin:purchaseOrder.edit"]}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:Y["a"],BizGrid:y["a"],BizSaveButton:M["a"],BizDialogSelector:B["a"]},computed:Object(n["a"])({},Object(p["c"])(["getUser"])),watch:{itemId:function(e){this.tableData=[],this.subTotal="",this.itemId&&this.getList()}},created:function(){this.queryFilters()},mounted:function(){},methods:Object(n["a"])(Object(n["a"])({},Object(p["d"])("Order",["updatedRouterFrom","updateProducts","updateFinalPayment","updateOperatingShop"])),{},{stepOne:function(){this.$emit("stepToOne")},queryFilters:function(){var e=this,t={shopId:window.top.SHOP_ID||""};J["a"].queryFilters(t,(function(t){e.categoryDatas=t.categoryDatas,e.setCategoryFilters(),e.setBrandFilters(t.brandDatas)}),(function(a){""!==a.errorMessage&&e.$message.error(a.errorMessage),console.log("获取过滤器失败",t)}))},cascaderChange:function(e){this.productCategoryId=e[e.length-1],e.length>1&&""===this.productCategoryId&&(this.productCategoryId=e[e.length-2]),this.getGiftList()},activeItemChange:function(e){var t=this,a={shopId:this.getUser.shop.id,parentId:e.toString()};d["a"].get("/admin/shopProduct/productCategorys.jhtml",a).then((function(a){var i;t.setCategoryFilters(),t.dialogFilters[0].options.forEach((function(t){t.value===e[0]&&(i=t.children)})),a.dateList.forEach((function(e){i.push({value:e.id,label:e.name})}))})).catch((function(){}))},setCategoryFilters:function(){var e=[{value:"",label:"全部"}];this.categoryDatas.forEach((function(t){e.push({value:t.id,label:t.name,children:[{label:"全部",value:""}]})})),this.dialogFilters[0].options=e},setBrandFilters:function(e){this.dialogFilters[1].options=e.map((function(e){return{value:e.id,label:e.name}})),this.dialogFilters[1].options.splice(0,0,{value:"",label:"全部"})},getSelectedBrandId:function(){return this.dialogFilters[1].value},addProduct:function(){this.dialogFilters[1].value="",this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getGiftList()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getGiftList()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.giftList=[],this.getGiftList()},getGiftList:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,productCategoryId:this.productCategoryId,brandId:this.getSelectedBrandId(),searchValue:this.dialogFilters[2].value,shopId:window.top.SHOP_ID||"",isOutOfStock:"0",supplierId:this.supplierId,type:"couponOrder"===this.$route.params.orderType?"7":""};d["a"].get("/admin/purchaseOrder/supplierProducts.jhtml",t).then((function(t){e.giftList=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},confirmedProduct:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(e.quantity="1",t.selectedGiftList.push(e))}));this.selectedGiftList.map((function(e){Number(e.quantity)*Number(e.price)})),this.selectedGiftList.forEach((function(e){t.handleSelect(e),t.listProduct(e)}))},formatDate:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=a+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r);return o},resize:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},operate:function(e){this[e]()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},getList:function(){var e=this;this.loading=!0;var t={orderId:this.itemId,pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};c["a"].viewProducts(t,(function(t){e.loading=!1,e.tableData=t.orderItems,e.subTotal=t.order.price,e.pagination.total=Number(t.total),console.log("this.tableData",e.tableData)}),(function(e){console.log(e)}))},handleSelect:function(e){var t=!1;if(e.productId=e.id,e.id="",this.subTotal=(Number(this.subTotal)+Number(e.quantity)*Number(e.price)).toFixed(2),0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].productId===e.productId){this.tableData[a].quantity=(Number(this.tableData[a].quantity)+1).toString(),t=!0;break}t||this.tableData.push(e)}else this.tableData.push(e)},deleteHandeler:function(e){this.tableData.splice(e.$index,1),this.subTotal=(Number(this.subTotal)-Number(e.row.price)*Number(e.row.quantity)).toFixed(2)},quantityChange:function(e){var t=0;this.tableData.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.subTotal=t?t.toFixed(2):""},save:function(){if(!this.tableData.length)return this.$message.warning("采购订单项目为空"),!1;var e=[];e=this.tableData.map((function(e){return{effectivePrice:e.price,product:{availableStock:e.availableStock,categoryType:e.categoryType,fullName:e.fullName,id:e.productId,image:e.image,productType:e.productType},quantity:e.quantity}}));var t=!1;if(this.tableData.forEach((function(e){console.log(e.quantity),-1!==String(e.quantity).indexOf(".")&&(t=!0)})),t)return this.$message.warning("数量不能为小数"),!1;this.updateProducts(e),this.$emit("step2Confirm",this.tableData,this.subTotal)},listProduct:function(e){var t=this;Q["a"].listProduct({searchValue:e.name},(function(e){t.restaurants=e.content.map((function(e){return{fullName:e.fullName,sn:e.sn,price:e.price,quantity:"1",subTotal:e.price,productId:e.id,value:e.fullName}})),t.loading=!1}),(function(e){console.log(e),console.log("code错误")}))},querySearchAsync:function(e,t){var a=this.restaurants,i=e?a.filter(this.createStateFilter(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout((function(){t(i)}),300*Math.random())},createStateFilter:function(e){return function(e){return!0}},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()},query:function(){this.tableData=this.step2Data,this.subTotal=this.step2SubTotal}})},ee=Z,te=(a("53b5"),Object(_["a"])(ee,G,K,!1,null,null,null)),ae=te.exports,ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"add-step-3"},[a("div",{attrs:{slot:"top"},slot:"top"},[a("div",{staticClass:"header-step"},[a("div",{staticClass:"step-1"},[a("span",[e._v("①")]),a("span",[e._v("选择供应商")]),a("span",[e._v(">")])]),a("div",{staticClass:"step-2",on:{click:e.stepToTwo}},[a("span",[e._v("②")]),a("span",[e._v("选择商品")]),a("span",[e._v(">")])]),a("div",{staticClass:"step-3"},[a("span",[e._v("③")]),a("span",[e._v("确认订单")])])])]),a("div",{staticClass:"order-confirm"},[a("div",{staticClass:"order-confirm-content"},[e.showAddress?a("div",{staticClass:"order-address",on:{click:e.clickAdress}},[a("div",{staticClass:"left"},[a("div",{staticClass:"address"},[a("div",{staticClass:"receiver-address"},[a("span",[e._v(e._s(e.getAddress?e.getAddress.consignee:""))]),a("span",[e._v(e._s(e.getAddress?e.getAddress.phone:""))])]),a("div",{staticClass:"icon"},[a("span",[a("i",{staticClass:"el-icon-location-outline"}),e._v(" "+e._s(e.getAddress?e.getAddress.areaName+e.getAddress.address:"请设置收货地址")+" ")]),a("span",[a("i",{staticClass:"right-arrow iconfont biz-icon-i-web-zk1"})])])])]),a("div",[a("i",{staticClass:"right-arrow iconfont icon-i-sh-man-tz"})])]):e._e(),a("div",{staticClass:"order-goods"},[a("div",{staticClass:"shop-name"},[a("img",{attrs:{src:e.iconShop}}),a("span",{staticStyle:{fontSize:"14px"}},[e._v(e._s(e.getUser.shop.name))])]),e._l(e.orderConfim.products,(function(t,i){return a("div",{key:i},[a("div",{staticClass:"order-goods-div"},[a("div",{staticClass:"img-div"},[a("img",{staticClass:"img",attrs:{src:t.product&&t.product.image?t.product.image:e.vfacLogo},on:{error:e.imgError}})]),a("div",{staticClass:"goods-info"},[a("span",{staticClass:"name"},[e._v(e._s(t.product.fullName))]),a("div",{staticClass:"money-info"},[a("span",{staticClass:"count-money"},[e._v("￥"+e._s(t.effectivePrice))]),a("span",{staticClass:"count-num"},[e._v("X"+e._s(t.quantity))])])])])])}))],2),a("div",{staticClass:"order-info"},["1"===e.orderConfim.products[0].product.productType||e.priceCoupon?e._e():a("div",{staticClass:"select-tyle"},[a("span",[e._v("支付方式")]),a("el-select",{attrs:{size:"mini"},on:{change:e.paymentChange},model:{value:e.payType,callback:function(t){e.payType=t},expression:"payType"}},e._l(e.payOptions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("div",{staticClass:"select-tyle"},[a("span",[e._v("配送方式")]),a("el-select",{attrs:{size:"mini"},on:{change:e.inputChange},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.options,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("div",{staticClass:"buy-leave-mes"},[a("span",[e._v("买家留言")]),a("el-input",{attrs:{type:"textarea",size:"mini",placeholder:"选填：填写内容已和卖家协商确认"},model:{value:e.leaveMessage,callback:function(t){e.leaveMessage=t},expression:"leaveMessage"}})],1)]),a("div",{staticClass:"order-info"},["1"!==e.orderConfim.products[0].product.productType&&parseFloat(e.getRealAmount)&&e.showInvoince?a("div",{staticClass:"order-dispatch"},[a("span",{staticStyle:{display:"flex","align-items":"center"}},[a("el-checkbox",{on:{change:e.invoiceChange},model:{value:e.invoiceChecked,callback:function(t){e.invoiceChecked=t},expression:"invoiceChecked"}}),a("span",{staticClass:"label"},[e._v("发票信息")])],1),a("div",{staticClass:"invoice-info",on:{click:e.clickInvoiceInfo}},[e.invoiceChecked?a("span",{staticClass:"invoice-title",staticStyle:{"font-size":"14px"}},[e._v(e._s(e.curInvoice?e.curInvoice.invoiceTitle:"暂无发票"))]):e._e(),e.invoiceChecked?e._e():a("span",{staticClass:"invoice-title",staticStyle:{"font-size":"14px"}},[e._v(e._s("不开具发票"))]),a("i",{staticClass:"right-arrow iconfont biz-icon-i-web-zk1"})])]):e._e()]),a("div",{staticClass:"order-count-div"},[a("div",{staticClass:"order-count"},[a("span",{staticClass:"pro-count"},[e._v("产品总额")]),a("span",[e._v("￥"+e._s(e.getCountMouny))])]),a("div",{staticClass:"order-count"},[a("span",{staticClass:"pro-count"},[e._v("邮费")]),a("span",[e._v("+￥"+e._s(e.freight))])]),e.discount&&"1"!==e.orderConfim.products[0].product.productType?a("div",{staticClass:"order-count"},[a("span",{staticClass:"pro-count"},[e._v("优惠")]),a("span",[e._v("-￥"+e._s(e.discount.toFixed(2)))])]):e._e(),a("div",{staticClass:"order-count"},[a("span",{staticClass:"pro-count",staticStyle:{color:"#333"}},[e._v("合计")]),a("span",{staticClass:"count-money"},[e._v("￥"+e._s(e.getAmount?e.getAmount:e.getAmount.toFixed(2)))])])]),a("div",{staticClass:"foot",attrs:{slot:"bottom"},slot:"bottom"},[a("p",{staticClass:"pay-for"},[e._v(" 需付款 "),a("span",{staticClass:"count-money"},[e._v("￥"+e._s(e.getRealAmount?e.getRealAmount:e.getRealAmount.toFixed(2)))])]),a("span",{staticClass:"submit",on:{click:e.submit}},[e._v("提交订单")])])]),a("el-dialog",{attrs:{visible:e.dialogVisiable,"append-to-body":"","custom-class":"bill-dialog"},on:{"update:visible":function(t){e.dialogVisiable=t}}},[a("bill-info",{on:{selectedItem:e.selectedItem}})],1),a("el-dialog",{attrs:{visible:e.dialogVisiableInvoice,"append-to-body":"","custom-class":"bill-dialog"},on:{"update:visible":function(t){e.dialogVisiableInvoice=t}}},[a("invoice-info",{on:{selectedItem:e.selectedItem}})],1)],1)])},re=[],oe=(a("7db0"),a("7039"),a("5319"),a("f606")),ne=a.n(oe),se=a("efa0"),le=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"invoice-info-p-order"},[a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),e._l(e.invoiceList,(function(t){return a("el-card",{key:t.id},[a("div",{on:{click:function(a){return e.selectItem(t)}}},[a("div",[a("span",[e._v("发票抬头：")]),a("span",[e._v(e._s(t.invoiceTitle))])]),a("div",[a("span",[e._v("联系人：")]),a("span",[e._v(e._s(t.contacts))])]),a("div",{staticClass:"top"},[a("div",[a("span",[e._v("联系电话：")]),a("span",[e._v(e._s(t.mobile))])]),a("div",[a("span",[a("el-checkbox",{attrs:{"true-label":"1","false-label":"0",size:"mini"},on:{change:function(a){return e.setDefault(t)}},model:{value:t.isDefault,callback:function(a){e.$set(t,"isDefault",a)},expression:"invoice.isDefault"}})],1)])]),a("div",{staticClass:"content"},[a("span",[e._v("详细地址：")]),a("span",[e._v(e._s(t.areaName+t.address))])]),a("div",{staticClass:"bottom"},[a("span",{on:{click:function(a){return e.editForm(t)}}},[e._v("编辑")]),a("span",{on:{click:function(a){return e.deleteForm(t.id)}}},[e._v("删除")])])])])})),0===e.invoiceList.length?a("div",{style:e.styleObject}):e._e(),a("el-dialog",{attrs:{visible:e.showForm,"append-to-body":"",height:"40%",center:""},on:{"update:visible":function(t){e.showForm=t}}},[a("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small","inline-message":!0}},[a("el-form-item",{attrs:{label:"发票信息"}}),a("el-form-item",{attrs:{label:"发票类型",prop:"consignee"}},[a("el-select",{staticStyle:{width:"220px"},model:{value:e.form.invoiceType,callback:function(t){e.$set(e.form,"invoiceType",t)},expression:"form.invoiceType"}},[a("el-option",{attrs:{label:"个人",value:"0"}}),a("el-option",{attrs:{label:"增值税普通发票",value:"1"}}),a("el-option",{attrs:{label:"增值税专用发票",value:"2"}})],1)],1),a("el-form-item",{attrs:{label:"发票抬头",prop:"invoiceTitle"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.invoiceTitle,callback:function(t){e.$set(e.form,"invoiceTitle",t)},expression:"form.invoiceTitle"}})],1),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"纳税人识别号",prop:"code"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1):e._e(),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"注册地址",prop:"registerAddress"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.registerAddress,callback:function(t){e.$set(e.form,"registerAddress",t)},expression:"form.registerAddress"}})],1):e._e(),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"注册电话",prop:"registerMobile"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.registerMobile,callback:function(t){e.$set(e.form,"registerMobile",t)},expression:"form.registerMobile"}})],1):e._e(),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"开户银行",prop:"bank"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.bank,callback:function(t){e.$set(e.form,"bank",t)},expression:"form.bank"}})],1):e._e(),"0"!==e.form.invoiceType?a("el-form-item",{attrs:{label:"银行账户",prop:"account"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],1):e._e(),a("el-form-item",{attrs:{label:"邮寄地址"}}),a("el-form-item",{attrs:{label:"联系人",prop:"contacts"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.contacts,callback:function(t){e.$set(e.form,"contacts",t)},expression:"form.contacts"}})],1),a("el-form-item",{attrs:{label:"联系电话",prop:"mobile"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1),a("el-form-item",{attrs:{label:"所在地区"}},[a("biz-area-select",{staticStyle:{width:"220px"},attrs:{areaId:e.form.area.id},on:{areaChanged:e.handleAreaChanged}})],1),a("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"area",maxlength:"100"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),a("biz-save-button",{attrs:{operations:e.formOperations},on:{operate:e.operate}})],1)],1)],2)},ce=[],de={components:{BizGrid:y["a"],BizSaveButton:M["a"],BizAreaSelect:O["a"]},data:function(){return{invoiceList:[],showForm:!1,operations:[{label:"添加",name:"add",type:"primary"}],formOperations:[{label:"保存",name:"save",type:"primary"},{label:"取消",name:"cancel",type:"primary",auth:["admin:purchaseOrder.edit"]}],rules:{invoiceType:[{required:!0,message:"请输入发票类型",trigger:"blur"}],invoiceTitle:[{required:!0,message:"请输入发票抬头",trigger:"blur"}],code:[{required:!0,message:"请输入纳税人识别号",trigger:"blur"}],registerAddress:[{required:!0,message:"请输入注册地址",trigger:"blur"}],registerMobile:[{required:!0,message:"请输入注册电话",trigger:"blur"}],bank:[{required:!0,message:"请输入开户银行",trigger:"blur"}],account:[{required:!0,message:"请输入银行账户",trigger:"blur"}],contacts:[{required:!0,message:"请输入联系人",trigger:"blur"}],address:[{required:!0,message:"请输入详细地址",trigger:"blur"}],mobile:[{required:!0,message:"请输入联系电话",trigger:"blur"},{len:11,message:"手机号位数错误",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"手机号格式错误",trigger:"blur"}]},form:this.getDetaultModel()}},computed:Object(n["a"])(Object(n["a"])({},Object(p["c"])(["getUser"])),{},{styleObject:function(){return{position:"absolute",top:0,bottom:0,left:0,right:0,margin:"auto",width:"200px",height:"200px",background:"url("+N.a+") 50% 50% / 300px no-repeat"}}}),created:function(){this.query()},methods:Object(n["a"])(Object(n["a"])({},Object(p["d"])("Order",["updateCurInvoice"])),{},{operate:function(e){this[e]()},getDetaultModel:function(){return{account:"",address:"",areaId:"",area:{id:"1568"},areaName:"",bank:"",code:"",contacts:"",invoiceTitle:"",invoiceType:"",isDefault:"",mobile:"",registerAddress:"",registerMobile:""}},add:function(){this.showForm=!0,this.form=this.getDetaultModel()},cancel:function(){this.showForm=!1},editForm:function(e){this.form=Object.assign(this.getDetaultModel(),e),this.showForm=!0},deleteForm:function(e){var t=this,a={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,ids:[e]};this.$confirm("是否确认删除收货地址?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d["a"].delete(u["g"].hypermarketMgmt.invoiceInfo,a).then((function(e){t.$message.success("删除成功"),t.query()})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(e){}))}))},save:function(){var e=this;this.$refs.form.validate((function(t,a){t&&(e.form.areaId=e.form.area.id,e.form.id?e.update():e.create())}))},create:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,invoice:this.form};d["a"].post(u["g"].hypermarketMgmt.invoiceInfo,t).then((function(t){e.$message.success("添加成功"),e.query(),e.showForm=!1,"1"===e.form.isDefault&&e.updateCurInvoice(e.form)})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},setDefault:function(e){e.isDefault="1",this.form=Object.assign(this.getDetaultModel(),e),this.update()},update:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,invoice:this.form};d["a"].put(u["g"].hypermarketMgmt.invoiceInfo,t).then((function(t){e.$message.success("设置成功"),e.query(),e.$emit("selectedItem"),e.showForm=!1,"1"===e.form.isDefault&&e.updateCurInvoice(e.form)})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},selectItem:function(e){console.log(e),this.$emit("selectedItem"),this.updateCurInvoice(e)},handleAreaChanged:function(e){this.form.area.id=e},query:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id};d["a"].get(u["g"].hypermarketMgmt.invoiceInfos,t).then((function(t){e.invoiceList=t.invoices||[]})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))}})},pe=de,ue=(a("5ffc"),Object(_["a"])(pe,le,ce,!1,null,null,null)),me=ue.exports,fe={name:"order-confirm",data:function(){return{iconShop:ne.a,invoiceId:"",vfacLogo:I.a,leaveMessage:"",type:"",shippingMethodId:"",options:[],receiverId:"",open:!1,dialogVisiable:!1,dialogVisiableInvoice:!1,id:"0",payType:"",payOptions:[],openSelect:!1,selectDiscount:[],vdChecked:!1,invoiceChecked:!1,showVdDiscount:!1,option:{label:""},bean:0,vdiscount:0,discount:0,showVd:!1,disSelect:"",freight:0,computedBean:{},showAddress:!0}},props:{supplierId:{type:String}},computed:Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(p["c"])(["getUser"])),Object(p["c"])("Order",["orderConfim","orderInfo","curInvoice","payment","defaultReceive","clickItemSelect"])),{},{getFinallyPayment:function(){return(this.orderConfim.products[0].effectivePrice*this.orderConfim.products[0].quantity-this.getSubscription).toFixed(2)},getIsSubscription:function(){return this.orderConfim.products[0].product.isSubscription},getSubscription:function(){return this.orderConfim.products[0].product.subscription},getRealAmount:function(){return this.orderConfim.finalPayment?this.orderConfim.finalPayment:this.getAmount},showInvoince:function(){return!(this.vdChecked&&this.getCountMouny-this.vdiscount-this.discount<=0)},getAmount:function(){var e=0;return this.vdChecked?e=Number(Number(this.getCountMouny)-Number(this.vdiscount)-Number(this.discount)+Number(this.freight)).toFixed(2):(console.log("amount: ",this.getCountMouny-this.discount+this.freight),e=Number(Number(this.getCountMouny)-Number(this.discount)+Number(this.freight)).toFixed(2)),e>=0?e:0},getCountMouny:function(){for(var e=this.orderConfim.products,t=e.length,a=0,i=0;i<t;i++)a+=e[i].effectivePrice*e[i].quantity;return parseFloat(a).toFixed(2)},getCountNum:function(){return"X "+this.orderConfim.quantity},getAddress:function(){return Object.getOwnPropertyNames(this.orderConfim.selAddress).length>1?this.orderConfim.selAddress:this.defaultReceive?this.defaultReceive:this.orderConfim.receivers&&this.orderConfim.receivers.length>0?this.orderConfim.receivers[0]:null},isActivityOrder:function(){return!1},priceCoupon:function(){return"7"===this.orderConfim.products[0].product.productType},orderType:function(){return this.priceCoupon?"5":"0"}}),components:{BillInfo:se["a"],InvoiceInfo:me,BizGrid:y["a"]},methods:Object(n["a"])(Object(n["a"])({},Object(p["d"])("Order",["updateOrderInfo","updateOrderConfim","updateOrderId","updatePayment","updateFreight","updateCouponSelect","updateClickItemSelect","updateCurInvoice"])),{},{goShop:function(){this.$router.push({path:"/shop-about/".concat(this.orderConfim.shop.id)})},stepToTwo:function(){this.$emit("stepToTwo")},selectedItem:function(){this.dialogVisiable=!1,this.dialogVisiableInvoice=!1,this.invoiceChecked=!0},calculateOrder:function(){for(var e,t,a=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0",r={cartItems:[],methodName:"CalculateOrder",clientType:"2",shopId:this.getUser.shop.id||"",userId:this.getUser.id||"",couponIds:this.selectDiscount,shippingMethodId:this.shippingMethodId||"",bean:i},o=this.orderConfim.products,n=o.length,s=0;s<n;s++)e={},e.quantity=o[s].quantity,e.amount=o[s].quantity*o[s].effectivePrice,t={},t.id=o[s].product.id,t.price=o[s].effectivePrice,e.product=t,r.cartItems.push(e);d["a"].post(u["g"].hypermarketMgmt.calculate,r).then((function(e){console.log("选择优惠券",e),a.discount=parseFloat(e.discount),a.freight=e.freight,a.beanComputed()})).catch((function(){})).finally((function(){}))},onSelect:function(e){this.disSelect=e.name,this.selectDiscount=e.id?[e.id]:[],this.calculateOrder()},imgError:function(e){},onCancel:function(){this.open=!1},clickAdress:function(){this.dialogVisiable=!0},submit:function(){this.getAddress&&this.getAddress.address||!("在线支付"===this.payment.name&&this.showAddress||"货到付款"===this.payment.name)||this.priceCoupon?this.createOrder():this.$message.warning("请设置收货地址")},clickInvoiceInfo:function(){this.updateClickItemSelect(!0),this.dialogVisiableInvoice=!0},getQueryHandle:function(){this.updateOrderInfo({amount:this.orderConfim.quantity*this.orderConfim.effectivePrice,count:this.orderConfim.quantity});var e,t=this.orderConfim.shippingMethods,a=t.length;for(e=0;e<a;e++)this.options.push(t[e].name);a>0&&(this.type=this.options[0],this.refreshFreight())},refreshFreight:function(){var e,t=this.orderConfim.shippingMethods,a=t.length;for(e=0;e<a;e++)this.type===t[e].name&&this.updateFreight({freight:t[e].freight,shippingMethodId:t[e].id});"顺丰速递"===this.type?this.freight=20:this.freight=0},inputChange:function(){var e=this;this.shippingMethodId=this.orderConfim.shippingMethods.find((function(t){return t.name===e.type})).id,this.calculateOrder();for(var t=this.orderConfim.shippingMethods,a=this.orderConfim.shippingMethods.length,i=0;i<a;i++)if(this.type===t[i].name)return"0"===t[i].isNeedReceiver?this.showAddress=!1:this.showAddress=!0,void this.refreshFreight()},orderConfirm:function(){var e=this,t="",a={cartItems:[],methodName:"",clientType:"2",shopId:this.getUser.shop.id,userId:this.getUser.id,orderType:this.orderType};a.methodName="FillInOrder",t=u["g"].hypermarketMgmt.fillIn;for(var i,r,o=this.orderConfim.products,n=o.length,s=0;s<n;s++)i={},i.id=o[s].id,i.quantity=o[s].quantity,i.amount=o[s].quantity*o[s].effectivePrice,r={},r.id=o[s].product.id,r.price=o[s].effectivePrice,i.product=r,a.cartItems.push(i);d["a"].post(t,a).then((function(t){!e.shippingMethodId&&t.shippingMethods.length&&(e.shippingMethodId=t.shippingMethods[0].id),console.log(111,t),e.updateOrderConfim({quantity:e.orderConfim.quantity,receivers:t.receivers,shippingMethods:t.shippingMethods,paymentMethods:t.paymentMethods,couponGroups:t.couponGroups}),e.setReceiveId(),e.payType=t.paymentMethods[0].name,e.updatePayment(t.paymentMethods[0]),e.getQueryHandle();for(var a=t.paymentMethods,i=a.length,r=0;r<i;r++)e.payOptions.push(a[r].name);e.computedBean={bean:t.bean,maxOffsetBean:t.maxOffsetBean,minOffsetBean:t.minOffsetBean,beanRate:t.beanRate},t.couponGroups&&t.couponGroups.length&&"1"!==e.orderConfim.products[0].product.productType&&!e.orderConfim.finalPayment&&(t.couponGroups[0].couponList[0].select=!0,e.disSelect=t.couponGroups[0].couponList[0].name,e.selectDiscount=[t.couponGroups[0].couponList[0].id],e.updateCouponSelect({couponGroups:t.couponGroups})),e.bean=t.bean,e.beanComputed(),t.shippingMethods&&t.shippingMethods.length&&("0"===t.shippingMethods[0].isNeedReceiver?e.showAddress=!1:e.showAddress=!0),e.isActivityOrder||(e.vdChecked?e.calculateOrder(e.bean):e.calculateOrder("0"))})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){}))},beanComputed:function(){if(console.log("computedBean",this.computedBean),parseFloat(this.computedBean.bean)>0){var e=parseFloat(this.computedBean.bean),t=parseFloat(this.computedBean.minOffsetBean),a=parseFloat(this.computedBean.maxOffsetBean);e>t&&e<=a?(this.bean=e,this.vdiscount=(this.bean*parseFloat(this.computedBean.beanRate)).toFixed(2)):e>a&&(console.log("discount",this.discount),a*parseFloat(this.computedBean.beanRate)>this.getCountMouny-this.discount?this.bean=(this.getCountMouny-this.discount)*(1/parseFloat(this.computedBean.beanRate)):this.bean=a,this.vdiscount=(this.bean*parseFloat(this.computedBean.beanRate)).toFixed(2)),console.log("bean",this.bean),console.log("vdiscount",this.vdiscount),this.bean&&(this.showVd=!0)}else this.showVd=!1;this.computedBean.beanRate||(this.showVd=!1)},createOrder:function(){var e=this;console.log("createOrder"),Object.getOwnPropertyNames(this.orderConfim.selAddress).length>1?this.receiverId=this.orderConfim.selAddress.id:this.defaultReceive?this.receiverId=this.defaultReceive.id:this.orderConfim.receivers&&this.orderConfim.receivers.length&&(this.receiverId=this.orderConfim.receivers[0].id);var t={cartItems:[],amount:this.orderConfim.quantity*this.orderConfim.price,freight:this.freight.toString(),receiverId:this.showAddress&&!this.priceCoupon?this.receiverId:"",paymentMethodId:this.priceCoupon?"":this.payment.id,shippingMethodId:this.shippingMethodId,methodName:"CreateOrder",clientType:"2",shopId:this.orderConfim.shop.id||this.getUser.shop.id,userId:this.getUser.id,orderType:this.orderType,invoiceId:this.invoiceChecked&&this.curInvoice?this.curInvoice.id:"",bean:"0",couponIds:this.selectDiscount,memo:this.leaveMessage,supplierId:this.supplierId};this.vdChecked&&(t.bean=this.bean.toString());for(var a,i,r=this.orderConfim.products,o=r.length,n=this.getAmount,s=0;s<o;s++)a={},a.id=r[s].id,a.quantity=r[s].quantity,a.amount=r[s].quantity*r[s].effectivePrice,a.isMatch=r[s].isMatch,a.packageId=r[s].packageId,i={},i.id=r[s].product.id,i.price=r[s].effectivePrice,a.product=i,t.cartItems.push(a);console.log("this.getAmount"+this.getAmount),d["a"].post(u["g"].hypermarketMgmt.createOrder,t).then((function(t){console.log("订单id",t.id),e.updateOrderId(t.id),e.id=t.id,"在线支付"===e.payment.name&&0!==parseFloat(e.getRealAmount)?e.$emit("step3Confirm",t.id,n):e.$emit("complate",t.id)})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){}))},invoiceChange:function(e){var t=this;if(console.log(e),e){var a={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id};d["a"].get(u["g"].hypermarketMgmt.invoiceInfos,a).then((function(e){t.updateCurInvoice(e.invoices[0])})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(e){}))}},payNow:function(){var e=this,t={orderId:this.id,methodName:"BalancePayment",clientType:"2",shopId:this.getUser.shop.id,userId:this.getUser.id};d["a"].post(u["g"].hypermarketMgmt.balancePayment,t).then((function(t){e.$emit("complate",e.id)})).catch((function(t){"377"===t.resultCode?e.$message.warning("会员卡余额不足，请使用其他支付方式"):"378"===t.resultCode?e.$message.warning("用户支付密码未设定，请先设定支付密码"):"380"===t.resultCode?(e.$message.warning("支付密码输入错误，请重试"),e.passValue=""):e.$message.warning(t.errorMessage)})).finally((function(){}))},successHandle:function(e){console.log("支付成功回调函数",e),this.$router.replace({path:"/orderInfo/"+this.id})},failHandle:function(){this.$router.replace({path:"/orderInfo/"+this.id})},setReceiveId:function(){Object.getOwnPropertyNames(this.orderConfim.selAddress).length>1&&(this.receiverId=this.orderConfim.selAddress.id),this.defaultReceive&&(this.receiverId=this.defaultReceive.id),this.orderConfim.receivers&&this.orderConfim.receivers.length>0&&(this.receiverId=this.orderConfim.receivers[0].id)},paymentChange:function(){var e,t=this.orderConfim.paymentMethods,a=t.length;for(e=0;e<a;e++)this.payType===t[e].name&&this.updatePayment(t[e])},hideSelect:function(){this.openSelect=!1},onSelectDiscount:function(){this.openSelect=!0},deleteInvoice:function(){this.updateCurInvoice({})}}),created:function(){this.orderConfirm(),console.log("订单确认商品",this.orderConfim),"1"===this.orderConfim.products[0].product.productType&&(this.vdChecked=!0)}},he=fe,ge=(a("4c36"),Object(_["a"])(he,ie,re,!1,null,null,null)),be=ge.exports,ve=a("bc3a"),ye=a.n(ve),Ce=a("a9f4"),Ie=a("b06a"),we=a("5801"),Se=a("443b"),_e=a("ce0c"),Te={name:"OrderMgmtList",data:function(){return{sn:"",auditState:"1",remarks:"",row:{},isPend:!1,amountPaid:"",amount:"",amountPayable:"",isRalateBill:!1,curSelectAjectReason:"申报的商品与实际需要采购的商品不符",reasonAjectList:[{label:"申报的商品与实际需要采购的商品不符",value:"申报的商品与实际需要采购的商品不符"},{label:"送达仓库地址填写错误",value:"送达仓库地址填写错误"},{label:"申报的商品供应方已停售或缺货",value:"申报的商品供应方已停售或缺货"},{label:"申报的商品数量有误",value:"申报的商品数量有误"},{label:"已与部分商品供应商终止合作",value:"已与部分商品供应商终止合作"},{label:"其他原因",value:"其他原因"}],closeDeccription:"",curSelectCloseReason:"",supplierId:"",reasonList:[{label:"我不想买了",value:"我不想买了"},{label:"信息填写有误, 重新拍",value:"信息填写有误, 重新拍"},{label:"卖家缺货",value:"卖家缺货"},{label:"忘记使用优惠券",value:"忘记使用优惠券"},{label:"重复下单,误下单",value:"重复下单,误下单"},{label:"支付方式有误,无法支付",value:"支付方式有误,无法支付"}],errorImg:'this.src="/resources/admin/images/default/product-default.png"',showCloseOrder:!1,curSelectDateType:"全部",dateTypeList:["全部","今日订单","近一周订单","近一月订单","近三月订单"],tabName:"info",itemId:"",invoiceInfoId:"",invoiceId:"",title:"",form:{},userCard:{},orderType:"",orderState:"",invoiceState:"",price:"",realName:"",orderId:"",invoiceAmount:0,defaultTab:"0",activeNames:["1"],orderIds:[],hasSyncOrder:"",editable:!0,loading:!1,open:!1,openPurchase:!1,purchaseId:"",purchaseOrderId:"",openPurchaseOrder:!1,openOrderSale:!1,orderSaleId:"",isEdit:!0,dialogTableVisible:!1,openReview:!1,openPay:!1,openLogistics:!1,openInvoice:!1,openAdd:!1,showRecommend:!1,step1:!0,step2:!1,step3:!1,step2Data:[],step1Data:{},step2SubTotal:"",showPassOrder:!1,selections:[],operations:[{label:"添加",name:"add",type:"primary",class:"show",auth:["admin:purchaseOrder.add"]},{label:"刷新",name:"refresh",type:""},{label:"导出",name:"export",type:"",auth:["admin:purchaseOrder.export"]},{label:"合并发票",name:"mergeInvoice",type:"",disabled:!0}],filters:[{type:"select",label:"供应商",name:"name",value:[],class:"hidden",filterable:!0,multiple:!0,collapseTags:!0,options:[]},{type:"select",label:"代理商",name:"shop",value:[],class:"hidden",filterable:!0,multiple:!0,collapseTags:!0,options:[{value:"",label:"全部"}]},{type:"select",label:"订单状态",name:"state",value:"",class:"hidden",options:[{value:"",label:"全部"},{value:"2",label:"商家已确认"},{value:"3",label:"买家已付款"},{value:"4",label:"订单已执行"},{value:"5",label:"交易完成"},{value:"6",label:"订单关闭"},{value:"7",label:"已评价"},{value:"9",label:"退款退货中"},{value:"10",label:"退款退货完成"},{value:"11",label:"已确认收货"},{value:"12",label:"部分支付"},{value:"13",label:"部分发货"}]},{type:"daterange",label:"创建日期",name:"publishDate",class:"hidden",value:[]},{type:"input",label:"",placeholder:"请输入订单编号/条码",name:"searchValue",value:""}],tableData:[],gridData:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizPopupTabs:s["a"],BizFlexTable:l["c"],vueEasyPrint:m["a"],LogisticsFollowing:f["a"],OrderInfo:g["a"],PayInfo:k,InvoiceInfo:A,AddStep1:H,AddStep2:ae,AddStep3:be,MyEvaluate:h["a"],PurchaseOrderInfo:g["a"],PurchaseApplyInfo:Ce["a"],OrderSaleInfo:Ie["a"],OrderSaleProductInfo:we["a"]},created:function(){this.getList(),this.queryKpi(),this.getEditableStoresByAgent(),this.getSupplier(),this.getIsEdit()},mixins:[Se["a"]],watch:{},computed:{showInvoice:function(){var e=["service","product","car","general","rescue","couponOrder"];return-1!==e.indexOf(this.$route.params.orderType)},toggleRecommendTxt:function(){var e=this.showRecommend;return e?"收起":"筛选"}},mounted:function(){},methods:Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(p["c"])(["getUser"])),Object(p["d"])("Order",["updateOrderInfo","updateOrderId","updateApplySaleItem","updateClickItemSelect"])),{},{operate:function(e){this[e]()},clickRelateBill:function(e,t){var a=this;e.stopPropagation(),"0"===t.relateBillType?(this.tabName="info",this.purchaseId=t.relateBill,this.openPurchase=!0,this.isEdit=!1):"2"===t.relateBillType?(this.purchaseOrderId=t.relateBill,this.openPurchaseOrder=!0,this.$nextTick((function(){a.$refs.orderinfo.getOrderInfo()})),this.isEdit=!1,this.isRalateBill=!0):(this.tabName="orderSaleInfo",this.orderSaleId=t.relateBill,this.openOrderSale=!0,this.$nextTick((function(){a.$refs.orderSaleInfo.init()})),this.isEdit=!1)},getEditableStoresByAgent:function(){var e=this;d["a"].get("/admin/cooperationInfo/cooperationInfos.jhtml",{cooperationType:"1",pageSize:1e3,pageNumber:1}).then((function(t){e.filters[1].options=[{value:"",label:"全部"}].concat(t.dataList.map((function(e){return{label:e.name,value:e.id}})))})).catch((function(e){console.log(e),console.log("code错误")}))},isShow:function(){this.showRecommend?(this.filters[0].class="hidden",this.filters[1].class="hidden",this.filters[2].class="hidden",this.filters[3].class="hidden",document.getElementsByClassName("biz-table-filter")[0].style.marginTop=""):(this.filters[0].class="show",this.filters[1].class="show",this.filters[2].class="show",this.filters[3].class="show",document.getElementsByClassName("biz-table-filter")[0].style.marginTop="30px"),this.showRecommend=!this.showRecommend},getIsEdit:function(){var e=this;d["a"].get("/admin/invoicing/config/setting.jhtml",{shopId:this.getUser().shop.id}).then((function(t){"0"===t.purchaseOrder?e.operations[0].class="hidden":e.operations[0].class="show"})).catch((function(t){t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){}))},toPass:function(e,t){this.remarks="",this.row=e,this.showPassOrder=!0},mergeInvoice:function(){var e=this;this.orderIds=[],this.invoiceAmount=0,this.selections.forEach((function(t){e.orderIds.push(t.id),e.invoiceAmount+=Number(t.amount)})),this.tabName="invoiceinfo",this.openInvoice=!0},closeTabByLogistics:function(e){var t=this;this.open=!1,this.tabName="loginfo",this.sn=e,this.openPay=!1,this.openLogistics=!0,this.$nextTick((function(){t.$refs.logistics.getLogisticsInfo()}))},closeTabByEvaluate:function(e,t){var a=this;this.open=!1,this.tabName="reviewinfo",this.itemId="","5"!==t&&(this.editable=!1),this.openReview=!0,this.$nextTick((function(){a.$refs.reviewinfo.getOrderInfo(e)}))},operateSuccess:function(){this.getList(),this.openPay=!1},close:function(){this.getList(),this.openInvoice=!1},add:function(){this.tabName="addinfo",this.step1=!0,this.step2=!1,this.step3=!1,this.openAdd=!0},step1Confirm:function(e){this.supplierId=e.relatePartnerId,this.step1=!1,this.step2=!0,this.step1Data=e},step2Confirm:function(e,t){this.step2=!1,this.step3=!0,this.step2Data=e,this.step2SubTotal=t},step3Confirm:function(e,t){this.tabName="payinfo",this.itemId=e,this.openAdd=!1,this.amountPaid="0.00",this.amount=t,this.amountPayable=t,this.openPay=!0},stepToOne:function(e){var t=this;this.step1=!0,this.step2=!1,this.$nextTick((function(){t.$refs.step1.query()}))},stepToTwo:function(){var e=this;this.step2=!0,this.step3=!1,this.$nextTick((function(){e.$refs.step2.query()}))},complate:function(e){this.openAdd=!1,this.getList()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},statusChange:function(e,t){var a=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0;var i={shopId:window.top.SHOP_ID||"",id:e.id,actionType:t,details:"2"===t?a.curSelectAjectReason:"",remarks:a.remarks};d["a"].post("/admin/purchaseOrderManage/audit.jhtml",i).then((function(e){a.$message.success("操作成功！"),a.showPassOrder=!1,a.loading=!1,a.refresh()})).catch((function(e){a.loading=!1,e.errorMessage&&a.$message.warning(e.errorMessage)})).finally((function(){}))}))},formatDate:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=a+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r);return o},print:function(){this.$refs.easyPrint.print()},printExport:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={orderId:e.orderId},t.prev=1,t.next=4,ye.a.post("/admin/purchaseOrder/voucher/export/Purchase.jhtml",a,{responseType:"blob"});case 4:return i=t.sent,console.log("response => ",i),r=new Blob([i.data],{type:"application/vnd.ms-excel"}),o=decodeURI(i.headers["content-disposition"].split("filename=")[1]),n=document.createElement("a"),n.download=o.match(/"(\S*)"/)[1],n.style.display="none",n.href=URL.createObjectURL(r),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n),t.abrupt("return");case 19:throw t.prev=19,t.t0=t["catch"](1),new Error(t.t0);case 22:case"end":return t.stop()}}),t,null,[[1,19]])})))()},certificate:function(e){var t=this;window.dType="purchaseOrder",c["a"].certificate({orderId:e.id,shopId:window.top.SHOP_ID||""},(function(a){t.dialogTableVisible=!0,t.title=t.getUser().shop?t.getUser().shop.name+"采购单":"采购单",t.form=a.order,t.orderId=e.id,t.realName=a.adminCurrent?a.adminCurrent.realName:"",t.userCard=a.userCard,t.gridData=a.order.orderItems}),(function(e){t.loading=!1,t.$message.warning(e.errorMessage)}))},onChangeDateType:function(e){switch(e){case"今日订单":this.filters[3].value=[_e["a"].today(),_e["a"].today()];break;case"近一周订单":this.filters[3].value=[_e["a"].getBeforeWeek(),_e["a"].today()];break;case"近一月订单":this.filters[3].value=[_e["a"].getPreOneMonthDay(),_e["a"].today()];break;case"近三月订单":this.filters[3].value=[_e["a"].getPreThreeMonthDay(),_e["a"].today()];break;default:this.filters[3].value=[];break}this.getList()},setting:function(){this.$refs.settingInfo.getList(),this.openSetting=!0},export:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,r,o,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],e.selections&&e.selections.length>0&&e.selections.forEach((function(e){a.push(e.id)})),i={ids:a,supplierIds:e.filters[0].value,dateType:"createTime",pageable:{pageSize:e.pagination.pageSize,pageNumber:e.pagination.currentPage,searchValue:e.filters[4].value},orderType:e.orderType,agentIds:e.filters[1].value,state:e.filters[2].value,beginTime:e.filters[3].value[0]?e.filters[3].value[0]+" 00:00:00":"",endTime:e.filters[3].value[1]?e.filters[3].value[1]+" 23:59:59":""},t.prev=3,t.next=6,ye.a.post("/admin/purchaseOrder/purchaser/order/export.jhtml",i,{responseType:"blob"});case 6:return r=t.sent,console.log("response => ",r),o=new Blob([r.data],{type:"application/vnd.ms-excel"}),n=decodeURI(r.headers["content-disposition"].split("filename=")[1]),s=document.createElement("a"),s.download=n.match(/"(\S*)"/)[1],s.style.display="none",s.href=URL.createObjectURL(o),document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s),t.abrupt("return");case 21:throw t.prev=21,t.t0=t["catch"](3),new Error(t.t0);case 24:case"end":return t.stop()}}),t,null,[[3,21]])})))()},rowClick:function(e,t,a){var i=this;this.tabName="info",this.orderState=e.state,this.itemId=e.id,this.open=!0,this.price=e.price,this.hasSyncOrder=e.hasSyncOrder,this.$nextTick((function(){i.$refs.info.getOrderInfo()})),this.isPend=!1,this.isRalateBill=!1},getSupplier:function(){var e=this;this.loading=!0;var t={pageSize:1e3,pageNumber:1,searchValue:this.filters[4].value,shopId:window.top.SHOP_ID||"",cooperationType:"0"};d["a"].get(u["g"].hypermarketMgmt.cooperationInfos,t).then((function(t){e.loading=!1,e.filters[0].options=[{label:"全部",value:""}].concat(t.dataList.map((function(e){return{label:e.name,value:e.id}})))})).catch((function(t){e.loading=!1,t.errorMessage&&console.log(t.errorMessage)}))},getList:function(){var e=this;this.loading=!0;var t={supplierIds:this.filters[0].value,dateType:"createTime",pageable:{pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage,searchValue:this.filters[4].value},orderType:this.orderType,agentIds:this.filters[1].value,state:this.filters[2].value,beginTime:this.filters[3].value[0]?this.filters[3].value[0]+" 00:00:00":"",endTime:this.filters[3].value[1]?this.filters[3].value[1]+" 23:59:59":""};d["a"].post(u["g"].hypermarketMgmt.purchaseOrderList,t).then((function(t){e.tableData=t.dataList,e.pagination.total=Number(t.total),e.loading=!1})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},queryKpi:function(){var e=this,t={shopId:window.top.SHOP_ID||""};d["a"].get("/admin/purchaseOrder/queryPurchaseOrderKpi.jhtml",t).then((function(t){e.$message({customClass:"motorists-club-activity__kpi",showClose:!0,message:"今日新增".concat(t.data.dayNewAdd,"条，待发货").concat(t.data.waitDeliver,"条"),duration:3e3})})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},service:function(e){this.orderState=e.state,this.tabName="info",this.itemId=e.id,this.activeNames=["2"],this.open=!0},paymentHandler:function(e){this.tabName="payinfo",this.itemId=e.id,this.openLogistics=!1,this.amountPaid=e.amountPaid,this.amount=e.amountPayable,this.amountPayable=e.amountPayable,this.openPay=!0},logisticsHandler:function(e){var t=this;this.tabName="loginfo",this.sn=e.shippings[0].sn,this.itemId=e.id,this.openPay=!1,this.openLogistics=!0,this.$nextTick((function(){t.$refs.logistics.getLogisticsInfo()}))},invoiceHandler:function(e){console.log("row"+e),this.tabName="invoiceinfo",this.invoiceAmount=Number(e.amount),this.updateOrderInfo(e),this.updateClickItemSelect(!0),this.openPay=!1,this.openLogistics=!1,this.openInvoice=!0},review:function(e){this.tabName="reviewinfo",this.orderId=e.id,this.openPay=!1,this.openLogistics=!1,this.openInvoice=!1,this.openReview=!0},confirmOrder:function(e){var t=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){window.dType=e.dType,c["a"].confirmOrder({orderId:e.id,shopId:window.top.SHOP_ID||""},(function(e){t.loading=!1,t.$message.success("操作成功"),t.getList()}),(function(e){t.loading=!1,t.$message.warning(e.errorMessage)}))}))},confirmOrderShipping:function(e){var t=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a={clientType:"2",methodName:"UpdateOrder",shopId:t.getUser().shop.id,userId:t.getUser().id,orderId:e.id,type:"1"};d["a"].put(u["g"].hypermarketMgmt.purchaseOrder,a).then((function(e){t.$message.success("操作成功"),t.getList()})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))}))},closeOrder:function(e){this.itemId=e.id,this.showCloseOrder=!0,this.curSelectCloseReason="",this.closeDeccription=""},cancelClose:function(){this.showCloseOrder=!1},confirmClose:function(){var e=this;if(this.curSelectCloseReason){this.showCloseOrder=!1,this.loading=!0;var t={clientType:"2",methodName:"UpdateOrder",shopId:this.getUser().shop.id,userId:this.getUser().id,orderId:this.itemId,type:0,content:this.curSelectCloseReason};d["a"].put(u["g"].hypermarketMgmt.purchaseOrder,t).then((function(t){e.$message.success("操作成功"),e.loading=!1,e.getList()})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){}))}else this.$message.warning("请选择关闭理由")},handleSelectionChange:function(e){this.selections=e,this.operations.map((function(e){"delete"===e.name&&(e.disabled=!0)})),e.length>0&&this.operations.map((function(e){"delete"===e.name&&(e.disabled=!1)}))},filterDataChange:function(e){this.pagination.currentPage=1,this.refresh()},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()},getOrderStatus:function(e){switch(e.state){case"13":return"部分发货";case"12":return"部分支付";case"11":return"已确认收货";case"10":return"退款退货完成";case"9":return"退款退货中";case"8":return"已过期";case"7":return"已评价";case"6":return"订单关闭";case"5":return"交易完成";case"4":return"订单已执行";case"3":return"买家已付款";case"2":return"商家已确认";case"1":return"待商家确认";default:return"无"}}})},ke=Te,De=(a("54889"),Object(_["a"])(ke,i,r,!1,null,null,null));t["default"]=De.exports},c466:function(e,t,a){"use strict";a("99af"),a("d3b7"),a("ac1f"),a("25f0"),a("5319");t["a"]={nowDate:function(){var e=new Date,t=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()+1<10?"0"+e.getDate():e.getDate();return e.getFullYear().toString()+"-"+t+"-"+a},getMonthDays:function(e){var t=new Date(Date.parse(e.replace(/-/g,"/"))),a=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,1),r=(i-a)/864e5;return r},halfYearAgo:function(e){var t="";return t=e?new Date(Date.parse(e.replace(/-/g,"/"))):new Date,console.log(t),t.setMonth(t.getMonth()-6),"".concat(t.getFullYear(),"-").concat(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,"-").concat(t.getDate()<10?"0"+t.getDate():t.getDate())},lastMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1<10?"0"+e.getMonth():e.getMonth(),i=e.getDate()+1<10?"0"+e.getDate():e.getDate();return"00"===a&&(a="12",t--),t.toString()+"-"+a+"-"+i},nextMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),r=parseInt(a)+1;13===r&&(t=parseInt(t)+1,r=1);var o=new Date(t,r,0);return o=o.getDate(),i>o&&(i=o),r<10&&(r="0"+r),t+"-"+r+"-"+i},lastYearDate:function(){var e=new Date,t=new Date(e.getFullYear()-1,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastTwoYearDate:function(){var e=new Date,t=new Date(e.getFullYear()+2,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastNYearDate:function(e,t){var a=new Date(e),i=new Date(a.getFullYear()+parseInt(t),a.getMonth(),a.getDate());return i.getFullYear()+"-"+this.convertToFullMode(i.getMonth()+1)+"-"+this.convertToFullMode(i.getDate())},dateConverter:function(e){return e instanceof Date?e.getFullYear()+"-"+this.convertToFullMode(e.getMonth()+1)+"-"+this.convertToFullMode(e.getDate()):e},timeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes())+":"+this.convertToFullMode(e.getSeconds()):e},shortTimeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes()):e},dateTimeConverter:function(e){return e instanceof Date?this.dateConverter(e)+" "+this.timeConverter(e):e},convertToFullMode:function(e){return e=e.toString(),1===e.length?"0"+e:e}}},d437:function(e,t,a){},d74a:function(e,t,a){"use strict";var i=a("21c5"),r=a.n(i);r.a},df22:function(e,t,a){},ec6b:function(e,t,a){"use strict";var i=a("b547"),r=a.n(i);r.a},f3ac:function(e,t,a){e.exports=a.p+"static/img/pic_default_none_100.6603f4ac.png"},f604:function(e,t,a){},f9a5:function(e,t,a){},fc46:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"my-evaluate"},[a("div",{staticClass:"evaluate-content"},[e.orderInfo&&e.reviews.length?a("div",e._l(e.orderInfo.orderItems,(function(t,i){return a("div",{key:i,staticClass:"my-evaluate-div"},[a("div",{staticClass:"order-info"},[a("div",{staticClass:"info"},[a("img",{attrs:{src:t.thumbnail?t.thumbnail:e.defaultImg},on:{error:e.errorHandle}}),a("div",{staticClass:"info-right"},[a("span",[e._v(e._s(t.name))]),a("span",[e._v("￥"+e._s(e.getAmount(t)))])])])]),e.editable&&t.product?a("div",{staticClass:"evaluate"},[a("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[a("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px",padding:"0px 30px"}}),a("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),a("el-radio-group",{staticStyle:{height:"10px"},attrs:{horizontal:!0},model:{value:e.reviews[i].score,callback:function(t){e.$set(e.reviews[i],"score",t)},expression:"reviews[index].score"}},e._l(e.options,(function(e,t){return a("el-radio",{key:t,attrs:{label:e}})})),1)],1),a("el-input",{attrs:{type:"textarea",size:"mini",placeholder:"来分享您的使用感受吧...",maxlength:e.maxlength},model:{value:e.reviews[i].content,callback:function(t){e.$set(e.reviews[i],"content",t)},expression:"reviews[index].content"}}),a("img-uploader",{model:{value:e.reviews[i].images,callback:function(t){e.$set(e.reviews[i],"images",t)},expression:"reviews[index].images"}})],1):e._e(),!e.editable&&t.product?a("div",{staticClass:"evaluate-dis"},[a("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[a("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px"}}),a("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),a("span",[e._v(e._s(e.reviews[i].score?e.已reviews[i].score:""))])]),a("div",{staticClass:"eva-content"},[a("p",{staticStyle:{"margin-bottom":"10px","margin-left":"20px"}},[e._v(e._s(e.reviews[i].content?e.reviews[i].content:"很遗憾，您没有留下任何评价。"))]),a("div",{staticClass:"img-group",staticStyle:{"margin-left":"20px"}},e._l(e.reviews[i].images,(function(t,r){return a("div",{key:r,staticClass:"img-eva"},[t?a("img",{attrs:{src:t},on:{click:function(t){return e.handleImagePreview(e.reviews[i].images,r)}}}):e._e()])})),0)])]):e._e()])})),0):e._e(),a("div",{staticClass:"shop-evaluate"},[a("div",{staticClass:"shop-title"},[a("img",{attrs:{src:e.iconShop}}),a("span",{staticStyle:{fontSize:"14px"}},[e._v("店铺评分")])]),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("服务态度")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.serValue,callback:function(t){e.serValue=t},expression:"serValue"}})],1),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("服务速度")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.speedValue,callback:function(t){e.speedValue=t},expression:"speedValue"}})],1),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("专业技能")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.proValue,callback:function(t){e.proValue=t},expression:"proValue"}})],1)])]),e.editable?a("div",{staticClass:"submit"},[a("span",{staticClass:"btn-submit",on:{click:e.submitEvaluate}},[e._v("提交评价")])]):e._e()])},r=[],o=(a("4160"),a("d81d"),a("a434"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("159b"),a("b85c")),n=a("5530"),s=a("2f62"),l=a("1ab1"),c=a("c596"),d=a("624d"),p=a.n(d),u=a("517a"),m=a.n(u),f=a("2119"),h=a("f606"),g=a.n(h),b={name:"my-evaluate",data:function(){return{iconShop:g.a,defaultImg:p.a,defaultFailImg:m.a,selected:"好评",options:["好评","中评","差评"],evaluateValue:"",maxlength:100,serValue:5,speedValue:5,proValue:5,reviews:[],info:null,initialIndex:0}},props:{orderId:{type:String,default:""},editable:{type:Boolean,default:function(){return!0}}},components:{ImgUploader:f["a"]},computed:Object(n["a"])(Object(n["a"])({},Object(s["c"])("Order",["orderInfo"])),Object(s["c"])(["getUser"])),watch:{orderId:function(e,t){this.getParams(),this.getOrderInfo()}},methods:Object(n["a"])(Object(n["a"])({},Object(s["d"])("Order",["updateOrderInfo"])),{},{showToast:function(e){this.$createToast({time:1e3,txt:e,type:"warn"}).show()},images:function(e){var t,a=[],i=Object(o["a"])(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;a.push(r)}}catch(n){i.e(n)}finally{i.f()}return a},handleImagePreview:function(e,t){var a=this;this.initialIndex=t;var i=[];e.map((function(e){i.push(e)}));var r={$props:{imgs:i,initialIndex:"initialIndex",loop:!1},$events:{change:function(e){a.initialIndex=e}}};this.$createImagePreview(Object(n["a"])({},r)).show()},getAmount:function(e){var t=Number(e.price)*Number(e.quantity);return t.toFixed(2)},submitEvaluate:function(){for(var e=this,t={serviceAttitude:this.serValue.toString(),serviceSpeed:this.speedValue.toString(),professional:this.proValue.toString(),methodName:"CreateProductReview",clientType:"2",shopId:this.getUser.shop.id,orderId:this.orderInfo.id,userId:this.getUser.id},a=this.orderInfo.orderItems,i=a.length,r=this.reviews,o=!1,n=0;n<i;n++){if(r[n]&&("好评"===r[n].score?(r[n].score="5",o=!0):"中评"===r[n].score?(r[n].score="3",o=!0):"差评"===r[n].score&&(r[n].score="1",o=!0)),!o&&a[n].product)return void this.$message.warning("请选择商品评分");a[n].product&&(r[n].images=this.images(r[n].images))}a.forEach((function(e,t){if(!e.product)return r.splice(t,1),!1})),o&&(t.reviews=this.reviews),l["a"].post(c["g"].hypermarketMgmt.review,t).then((function(t){e.$message.success("评价成功"),e.$emit("operationSuccess")})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){}))},errorHandle:function(e){e.currentTarget.src=this.defaultFailImg},getOrderInfo:function(e){var t=this;this.open=!1;var a="";a=e||this.orderId;var i={clientType:this.clientType,methodName:"QueryOrderDetail",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:a};l["a"].get(c["g"].hypermarketMgmt.queryOrder,i).then((function(e){console.log("订单信息",e);var i,r,o=e.order.orderItems,n=o.length;for(t.reviews=[],r=0;r<n;r++)i={score:"",content:"",reviewOrderId:e.order.id,images:[]},o[r].product&&(i.productId=o[r].product.id),t.reviews.push(i);t.editable?t.updateOrderInfo(e.order):(t.info=e.order,t.getEvaluationInfo(a))})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))},getParams:function(){this.editable=!0},getEvaluationInfo:function(e){var t=this,a={clientType:this.clientType,methodName:"QueryOrderReview",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:e};l["a"].get(c["g"].hypermarketMgmt.reviews,a).then((function(e){if(console.log(e),t.serValue=parseInt(e.serviceAttitude),t.speedValue=parseInt(e.serviceSpeed),t.proValue=parseInt(e.professional),e.reviews.length!==t.reviews.length){var a={score:"",content:"",images:[]};e.reviews.unshift(a)}t.reviews=e.reviews;for(var i=t.reviews,r=i.length,o=0;o<r;o++)"5"===i[o].score?i[o].score="好评":"3"===i[o].score?i[o].score="中评":"1"===i[o].score&&(i[o].score="差评");t.updateOrderInfo(t.info)})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))}}),created:function(){}},v=b,y=(a("9b2e"),a("2877")),C=Object(y["a"])(v,i,r,!1,null,null,null);t["a"]=C.exports}}]);