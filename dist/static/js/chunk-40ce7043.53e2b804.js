(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40ce7043"],{"0707":function(e,t,i){},"0943":function(e,t,i){"use strict";var a=i("1fac"),s=i.n(a);s.a},"0a05":function(e,t,i){},"1fac":function(e,t,i){},2086:function(e,t,i){"use strict";var a=i("2497"),s=i("bc3a"),n=i.n(s),o=i("c596");t["a"]={getList:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.getMemberCardList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getRightsList:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},listDistributeRights:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.listDistributeRights,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},listCardTemplate:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.listCardTemplate,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getlistVbean:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.getlistVbean,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getIntegralList:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.getIntegralList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},listProduct:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.listProduct,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},queryUserRights:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.queryUserRights,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},queryUserCoupons:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.queryUserCoupons,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},listByRights:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.listByRights,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getVipCardInfo:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.getVipCardInfo,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getVipCardTemplate:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.getVipCardTemplate,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},memberRankList:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.memberRankList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},setting:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.setting,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},settingUpdate:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.setting,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},queryPeople:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.queryPeople,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},delete:function(e,t,i){n.a.delete(o["g"].memberCardMgmt.memberCard.deleteManage,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},verification:function(e,t,i){n.a.post(o["g"].memberCardMgmt.vipRights.verification,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},updateTemplate:function(e,t,i){n.a.put(o["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},createTemplate:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},delTemplate:function(e,t,i){n.a.delete(o["g"].memberCardMgmt.memberCard.updateTemplate,{data:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},distributeRights:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.distributeRights,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},distributeAssignedRights:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.distributeAssignedRights,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},updateVipCardState:function(e,t,i){n.a.put(o["g"].memberCardMgmt.memberCard.updateVipCardState,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},createVipCard:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.createVipCard,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},createBean:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.createBean,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},createPoint:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.createPoint,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},addScore:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.addScore,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},reduceDeposit:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.reduceDeposit,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getlistUpgrade:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.getlistUpgrade,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getlistStore:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.getlistStore,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},updateGrade:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.updateGrade,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getVipCardGradeInfo:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.getVipCardGradeInfo,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},editVipCardGrade:function(e,t,i){n.a.put(o["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},addVipCardGrade:function(e,t,i){n.a.post(o["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},delVipCardGrade:function(e,t,i){n.a.delete(o["g"].memberCardMgmt.memberCard.VipCardGrade,{data:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},listAuthority:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.listAuthority,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},vipRightsList:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},queryrightsClass:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.get,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getFirstClassifies:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.getFirstClassifies,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},rightsCouponList:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.rightsCouponList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},queryRightsCoupon:function(e,t,i){n.a.get(o["g"].memberCardMgmt.vipRights.queryRightsCoupon,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},memberCardBox:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.memberCardBox,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},editRightsClass:function(e,t,i){n.a.put(o["g"].memberCardMgmt.vipRights.edit,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},createRightsClass:function(e,t,i){n.a.post(o["g"].memberCardMgmt.vipRights.add,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},rightsCouponUpdate:function(e,t,i){n.a.put(o["g"].memberCardMgmt.vipRights.rightsCouponUpdate,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},rightsCouponCreate:function(e,t,i){n.a.post(o["g"].memberCardMgmt.vipRights.rightsCouponCreate,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},deleteRightscoupon:function(e,t,i){n.a.delete(o["g"].memberCardMgmt.vipRights.deleteRightscoupon,{data:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},deleteRights:function(e,t,i){n.a.delete(o["g"].memberCardMgmt.vipRights.delete,{data:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},certificate:function(e,t,i){n.a.get(o["g"].memberCardMgmt.memberCard.certificate,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))}}},2119:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"biz-avatar-uploader-multi"},[i("div",{staticClass:"el-upload-list el-upload-list--picture-card"},[e._l(e.value,(function(t){return i("div",{key:t.index,staticClass:"el-upload-list__item is-success",attrs:{tabindex:"0"}},[i("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:t,alt:""}}),i("span",{staticClass:"el-upload-list__item-actions"},[i("span",{staticClass:"el-upload-list__item-preview",on:{click:function(i){return e.handlePictureCardPreview(t)}}},[i("i",{staticClass:"el-icon-zoom-in"})]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.isShowDelete,expression:"isShowDelete"}],staticClass:"el-upload-list__item-delete",on:{click:function(i){return e.handleRemove(t)}}},[i("i",{staticClass:"el-icon-delete"})])])])})),e.showUploader?i("el-upload",{ref:"upload",class:e.disabled?"avatar-uploader-disabled":"avatar-uploader",style:e.avatarStyle,attrs:{multiple:"","show-file-list":!1,accept:"image/*",limit:Number(e.limit),"file-list":e.fileList,data:e.fileData,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,name:"file",action:"/admin/file/uploads.jhtml",disabled:e.disabled}},[i("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:e.plusStyle})]):e._e()],2),i("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},s=[],n=(i("99af"),i("d81d"),i("a434"),i("ac1f"),i("1276"),{name:"ImgUploader",props:{value:{type:Array,default:function(){return[]}},imageForm:{type:Array,default:function(){return[]}},showUploader:{type:Boolean,default:function(){return!0}},size:{type:Object,default:function(){return{width:100,height:100}}},limit:{default:"9"},disabled:{type:Boolean,default:function(){return!1}},isShowDelete:{type:Boolean,default:function(){return!0}}},data:function(){return{fileData:{type:"0"},fileList:[],dialogVisible:!1,dialogImageUrl:""}},methods:{handleSuccess:function(e){var t=this.value.concat(e.fis[0].url);this.$emit("input",t)},handleExceed:function(e,t){this.$message.warning("只能上传".concat(this.limit,"张图片"))},handleRemove:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.removePic(e)}))},removePic:function(e){for(var t=this.value,i=0;i<t.length;i++)t[i]===e&&t.splice(i,1);this.$emit("input",t)},handlePictureCardPreview:function(e){this.dialogImageUrl=e,this.dialogVisible=!0}},computed:{plusStyle:function(){return{"line-height":this.size.height+"px"}},avatarStyle:function(){return{height:this.size.height+"px",width:this.size.width+"px"}}},watch:{value:function(e,t){console.log("value: ",this.value),this.fileList=e.map((function(e){return{name:e.split("/")[e.split("/").length-1],url:e}}))}},components:{}}),o=n,r=(i("d74a"),i("2877")),l=Object(r["a"])(o,a,s,!1,null,null,null);t["a"]=l.exports},"21c5":function(e,t,i){},3037:function(e,t,i){},3346:function(e,t,i){"use strict";var a=i("6f22"),s=i.n(a);s.a},"33b8":function(e,t,i){"use strict";var a=i("0707"),s=i.n(a);s.a},"3ef6":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"order-mgmt-list-agent"},[i("biz-flex-table",{ref:"table",staticClass:"order-mgmt-tabel",attrs:{operations:e.operations,filters:e.filters,tableData:e.tableData,loading:e.loading,pagination:e.pagination},on:{operate:e.operate,"filter-data-change":e.filterDataChange,"selection-change":e.handleSelectionChange,"row-click":e.rowClick,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[i("div",{staticClass:"operate-container",attrs:{slot:"operation"},slot:"operation"},[i("el-radio-group",{attrs:{size:"mini"},on:{change:e.onChangeDateType},model:{value:e.curSelectDateType,callback:function(t){e.curSelectDateType=t},expression:"curSelectDateType"}},e._l(e.dateTypeList,(function(t){return i("el-radio-button",{key:t,attrs:{label:t}},[e._v(e._s(t))])})),1)],1),i("el-table-column",{attrs:{label:"订单","min-width":"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{width:"100%"}},[i("div",{staticClass:"overflow"},[e._v(e._s(t.row.sn))]),i("div",{staticClass:"overflow"},[e._v("创建日期："+e._s(t.row.orderTime))]),i("div",{staticClass:"overflow"},[e._v("状态："+e._s(e.getOrderStatus(t.row)))])])]}}])}),i("el-table-column",{attrs:{label:"金额","min-width":"120px",prop:"amount"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{width:"100%"}},[i("div",{staticClass:"overflow"},[e._v(" 不含税： ")]),i("div",{staticClass:"overflow"},[e._v(" 税额： ")]),i("div",{staticClass:"overflow"},[e._v(" 含税："+e._s(t.row.amount)+" ")])])]}}])}),i("el-table-column",{attrs:{label:"商品信息","min-width":"220px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[i("div",{staticStyle:{width:"100%"}},e._l(t.row.orderItems.length>0?[t.row.orderItems[0]]:[],(function(a){return i("div",{key:a.sn,staticClass:"product-info-content"},[a.thumbnail&&" "!==a.thumbnail?i("img",{attrs:{src:a.thumbnail,onerror:e.errorImg}}):i("img",{attrs:{src:"/resources/admin/images/default/product-default-100.png"}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"titleClass",attrs:{title:a.name}},[e._v(e._s(a.name))]),i("div",{staticClass:"overflow"},[e._v(e._s(a.product?a.product.barCode:""))]),i("div",{staticClass:"overflow"},[e._v("单价(不含税)：")]),i("div",{staticClass:"overflow"},[e._v("单价(含税)："+e._s(a.price))])]),i("div",{staticClass:"amount"},[e._v(e._s(a.quantity)+e._s(t.row.orderItems.length>1?"...":""))])])})),0)])]}}])}),i("el-table-column",{attrs:{prop:"date",label:"操作","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("biz-column-operation",{attrs:{row:t.row}},["0"===t.row.hasSyncOrder&&"4"===t.row.state&&"0"===t.row.shippingWay||"3"===t.row.state&&"1"===t.row.shippingWay?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),e.confirmOrder(t.row)}}},[e._v("确认收货")]):e._e(),"0"===t.row.hasSyncOrder&&(t.row.shippings.length>0&&"5"!==t.row.state&&"6"!==t.row.state&&"7"!==t.row.state||t.row.shippings.length>0&&"13"===t.row.state)?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),e.logisticsHandler(t.row)}}},[e._v("物流跟踪")]):e._e(),"0"===t.row.hasSyncOrder&&("2"===t.row.state&&"0"===t.row.shippingWay||"12"===t.row.state&&"0"===t.row.shippingWay)?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),e.paymentHandler(t.row)}}},[e._v("付款")]):e._e(),"0"!==t.row.hasSyncOrder||"2"!==t.row.state&&"1"!==t.row.state?e._e():i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),e.closeOrder(t.row)}}},[e._v("取消")]),"0"===t.row.hasSyncOrder?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),e.certificate(t.row)}}},[e._v("凭证")]):e._e(),"0"!==t.row.hasSyncOrder||"6"===t.row.state||t.row.invoiceId?e._e():i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),e.invoiceHandler(t.row)}}},[e._v("申请发票")]),"0"===t.row.hasSyncOrder&&"5"===t.row.state?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),e.review(t.row)}}},[e._v("评价")]):e._e(),e.hasAuthCopy&&"0"===t.row.hasSyncOrder&&"0"===e.getUser().agent.grade?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),e.copy(t.row)}}},[e._v("商品复制")]):e._e()],1)]}}])})],1),i("biz-popup-tabs",{attrs:{open:e.openAdd},on:{close:function(t){e.openAdd=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[i("el-tab-pane",{attrs:{label:"添加订单",name:"addinfo"}},[e.step2?i("add-step-2",{ref:"step2",attrs:{step2Data:e.step2Data,step2SubTotal:e.step2SubTotal},on:{step2Confirm:e.step2Confirm}}):e._e(),e.step3?i("add-step-3",{on:{step3Confirm:e.step3Confirm,stepToTwo:e.stepToTwo,complate:e.complate}}):e._e()],1)],1),i("biz-popup-tabs",{attrs:{open:e.open},on:{close:function(t){e.open=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[i("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[i("order-info",{ref:"info",attrs:{orderId:e.itemId},on:{closeTabByLogistics:e.closeTabByLogistics,closeTabByEvaluate:e.closeTabByEvaluate}})],1),"1"===e.mergeState?i("el-tab-pane",{attrs:{label:"子订单信息",name:"orderChild"}},[i("order-child-info",{ref:"orderChild",attrs:{itemId:e.itemId}})],1):e._e()],1),i("biz-popup-tabs",{attrs:{open:e.openLogistics},on:{close:function(t){e.openLogistics=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[e.sn?i("el-tab-pane",{attrs:{label:"物流追踪",name:"loginfo"}},[i("logistics-following",{ref:"logistics",attrs:{orderId:e.orderId,sn:e.sn}})],1):e._e()],1),i("biz-popup-tabs",{attrs:{open:e.openPay},on:{close:function(t){e.openPay=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[i("el-tab-pane",{attrs:{label:"付款",name:"payinfo"}},[i("pay-info",{attrs:{orderId:e.orderId,amountPaid:e.amountPaid,amount:e.amount,amountPayable:e.amountPayable},on:{operateSuccess:e.operateSuccess}})],1)],1),i("biz-popup-tabs",{attrs:{open:e.openInvoice},on:{close:function(t){e.openInvoice=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[i("el-tab-pane",{attrs:{label:"发票",name:"invoiceinfo"}},[i("invoice-info",{attrs:{orderIds:e.orderIds,invoiceAmount:e.invoiceAmount},on:{close:e.close}})],1)],1),i("biz-popup-tabs",{attrs:{open:e.openReview},on:{close:function(t){e.openReview=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[i("el-tab-pane",{attrs:{label:"评价",name:"reviewinfo"}},[i("my-evaluate",{ref:"reviewinfo",attrs:{orderId:e.orderId,editable:e.editable},on:{operationSuccess:e.operationSuccess}})],1)],1),i("el-dialog",{attrs:{visible:e.dialogTableVisible,center:"",width:"1200px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:24}},[i("div",{staticClass:"grid-content bg-purple",attrs:{align:"left"}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.printExport}},[e._v("导出")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.print}},[e._v("打印")])],1)])],1),i("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[i("div",{staticClass:"d-p-wrap"},[i("el-row",{staticClass:"row",attrs:{gutter:10}},[i("div",{staticClass:"p-title"},[e._v(e._s(e.title))])]),i("el-row",{staticClass:"row",attrs:{gutter:10}},[i("el-col",{attrs:{span:24}},[i("div",{staticClass:"grid-content bg-purple",attrs:{align:"center"}},[e._v("打印日期："+e._s(e.formatDate((new Date).getTime())))])])],1),i("el-row",{staticClass:"row-top",attrs:{gutter:10}},[i("el-col",{attrs:{span:14}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("订单编号："+e._s(e.form.sn))])]),i("el-col",{attrs:{span:10}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("下单时间："+e._s(e.form.orderTime))])])],1),i("el-row",{staticClass:"row",attrs:{gutter:10}},[i("el-col",{attrs:{span:14}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("收件人："+e._s(e.form.consignee))])]),i("el-col",{attrs:{span:10}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("收件人电话："+e._s(e.form.phone))])])],1),i("el-row",{staticClass:"row",attrs:{gutter:10}},[i("el-col",{attrs:{span:24}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("收件人地址："+e._s(e.form.areaName?e.form.areaName+e.form.address:e.form.address))])])],1),i("el-table",{staticClass:"table-class",attrs:{data:e.gridData}},[i("el-table-column",{attrs:{property:"isTotal",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isTotal?i("div",[e._v("合计")]):i("div",[e._v(e._s(t.$index+1))])]}}])}),i("el-table-column",{attrs:{property:"fullName",label:"商品名称"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(e._s(t.row.fullName))]}}],null,!0)}),i("el-table-column",{attrs:{property:"product.barCode",label:"商品条码"}}),i("el-table-column",{attrs:{property:"price",label:"单价"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v("￥"+e._s(t.row.price))]}}],null,!0)}),i("el-table-column",{attrs:{property:"quantity",label:"数量"}}),i("el-table-column",{attrs:{property:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("￥"+e._s(t.row.subTotal))]}}])})],1),i("el-row",{staticClass:"row",attrs:{gutter:10}},[i("el-col",{attrs:{span:3}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("运费：￥"+e._s(e.form.freight))])]),i("el-col",{attrs:{span:5}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("优惠金额：￥"+e._s(e.form.couponDiscount))])]),i("el-col",{attrs:{span:5}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("调整金额：￥"+e._s(e.form.offsetAmount))])]),i("el-col",{attrs:{span:6}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("实收金额：￥"+e._s(e.form.amountPaid))])])],1),i("el-row",{staticClass:"row",attrs:{gutter:10}},[i("el-col",{attrs:{span:18}},[i("div",{staticClass:"grid18"})]),i("el-col",{attrs:{span:6}},[i("div",{staticClass:"grid-content bg-purple"},[e._v("客户签字：")])])],1)],1)])],1),i("el-dialog",{attrs:{visible:e.showCloseOrder,center:"","append-to-body":"","custom-class":"close-order-dialog"},on:{"update:visible":function(t){e.showCloseOrder=t}}},[i("div",[i("div",[e._v("取消订单后，本订单享有的优惠将一并取消，是否继续")]),i("div",{staticClass:"reson-container"},[i("span",{staticClass:"start"},[e._v("*")]),i("span",[e._v("请选择取消订单的理由：")]),i("el-select",{staticClass:"order-select",attrs:{placeholder:"请选择取消理由",size:"mini"},model:{value:e.curSelectCloseReason,callback:function(t){e.curSelectCloseReason=t},expression:"curSelectCloseReason"}},e._l(e.reasonList,(function(e){return i("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})})),1)],1)]),i("div",{staticClass:"close-button",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.cancelClose}},[e._v("取消")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.confirmClose}},[e._v("确定")])],1)]),i("el-dialog",{attrs:{visible:e.showConfirm,center:"","append-to-body":"","custom-class":"close-order-dialog"},on:{"update:visible":function(t){e.showConfirm=t}}},[i("div",[i("div",{staticStyle:{"font-size":"16px","font-weight":"bold"}},[i("i",{staticClass:"el-icon-warning",staticStyle:{padding:"10px",color:"#ff7300"}}),e._v("所选商品您店铺已存在，确认重复创建？ ")]),i("div",{staticStyle:{"margin-top":"10px","margin-left":"35px"}},[e._v("您所选的商品中有商品已在您店铺存在，商品名称一致。")])]),i("div",{staticClass:"close-button",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini",type:""},on:{click:function(t){e.showConfirm=!1}}},[e._v("取消")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.confirmCopy}},[e._v("确定")])],1)]),i("el-dialog",{attrs:{visible:e.showProductCopyOrder,center:"","append-to-body":"","custom-class":"close-order-dialog"},on:{"update:visible":function(t){e.showProductCopyOrder=t},close:e.colseDialog}},[i("div",[i("div",[e._v("是否需要将以下商品复制商品到您的门店？如有需要请选择需要复制的数据，并点击确认。")]),i("div",{staticClass:"reson-container"},[i("span",{staticClass:"start"},[e._v("*")]),i("span",[e._v("复制到门店：")]),i("el-select",{staticClass:"order-select",attrs:{size:"mini"},model:{value:e.shop,callback:function(t){e.shop=t},expression:"shop"}},e._l(e.shopList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),i("el-table",{attrs:{size:"small",data:e.productList.orderItems},on:{"selection-change":e.productSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),i("el-table-column",{attrs:{label:"商品信息","min-width":"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"product-info-p",staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[i("div",{staticStyle:{width:"100%","margin-right":"30px"}},[t.row.thumbnail&&" "!==t.row.thumbnail?i("img",{attrs:{src:t.row.thumbnail,onerror:e.errorImg}}):i("img",{attrs:{src:"/resources/admin/images/default/product-default-100.png"}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"titleClass",attrs:{title:t.row.fullName}},[e._v(e._s(t.row.fullName))])]),i("div",{staticClass:"info-bottom"},[i("div",{staticStyle:{"margin-left":"7px"}},[e._v(e._s(t.row.sn))]),i("div")])])])]}}])})],1)],1)]),i("div",{staticClass:"close-button",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.cancelClose}},[e._v("取消")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.confirm}},[e._v("确定")])],1)])],1)},s=[],n=(i("99af"),i("4160"),i("caad"),i("c975"),i("d81d"),i("b0c0"),i("a9e3"),i("d3b7"),i("ac1f"),i("2532"),i("3ca3"),i("466d"),i("1276"),i("159b"),i("ddb0"),i("2b3d"),i("96cf"),i("1da1")),o=i("5530"),r=i("7132"),l=i("04d3"),c=i("e42c"),d=i("1ab1"),u=i("2f62"),p=i("c596"),m=i("225d"),h=i("ce0c"),f=i("4382"),g=i("5eb4"),b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"payInfo"},[i("div",{staticClass:"price-label"},[i("span",{staticClass:"price-title"},[e._v("已付款金额")]),i("el-input",{attrs:{disabled:!0},model:{value:e.amountPaid,callback:function(t){e.amountPaid=t},expression:"amountPaid"}},[i("template",{slot:"append"},[e._v("元")])],2)],1),i("div",{staticClass:"price-label"},[i("span",{staticClass:"price-title"},[e._v("本次付款金额")]),i("el-input",{model:{value:e.amount,callback:function(t){e.amount=t},expression:"amount"}},[i("template",{slot:"append"},[e._v("元")])],2)],1),e._l(e.paymentTypes,(function(t){return i("div",{key:t.id,staticClass:"content-item"},[i("div",{staticClass:"radio-class"},[i("el-radio",{attrs:{size:"mini",label:t.type},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[i("span")])],1),i("div",{staticClass:"item"},[t.icon?i("img",{staticStyle:{margin:"10px"},attrs:{src:t.icon,width:"30",height:"30"}}):i("img",{attrs:{src:e.vfacLogo,width:"50",height:"50"}}),i("div",[e._v(e._s(t.name))]),"2"===t.type&&"2"===e.radio?i("div",[i("el-select",{attrs:{placeholder:"请选择会员卡",size:"mini"},model:{value:e.memberCardId,callback:function(t){e.memberCardId=t},expression:"memberCardId"}},e._l(t.memberCards,(function(e){return i("el-option",{key:e.id,attrs:{label:e.template.name+"  余额￥"+e.balance,value:e.id}})})),1)],1):e._e()])])})),i("el-form",{ref:"form",attrs:{"label-width":"140px",size:"small",model:e.form,rules:e.rules,"inline-message":!0}},["2"===e.radio?i("el-form-item",{attrs:{label:"会员卡支付密码",prop:"password"}},[i("div",{staticStyle:{display:"flex"}},[i("el-input",{attrs:{type:"password",maxlength:"6",minlength:"6",size:"mini"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}}),"0"===e.form.hasSetPayPassword&&"2"===e.radio?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.setPass}},[e._v("设置密码")]):e._e()],1)]):e._e(),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirm}},[e._v("确定")])],1),i("el-dialog",{attrs:{visible:e.dialogVisible,title:"设置支付密码",width:"40%","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",{staticClass:"valid-div"},[i("el-form",{ref:"formPass",attrs:{"label-width":"140px",size:"small",model:e.formPass,rules:e.rulesPass,"inline-message":!0}},[i("el-form-item",{attrs:{label:"请输入支付密码",prop:"pass"}},[i("el-input",{attrs:{type:"password",placeholder:"请输入支付密码",size:"mini",maxlength:"6"},model:{value:e.formPass.pass,callback:function(t){e.$set(e.formPass,"pass",t)},expression:"formPass.pass"}})],1),i("el-form-item",{attrs:{label:"请确认支付密码",prop:"checkpass"}},[i("el-input",{attrs:{type:"password",placeholder:"请确认支付密码",size:"mini",maxlength:"6"},model:{value:e.formPass.checkpass,callback:function(t){e.$set(e.formPass,"checkpass",t)},expression:"formPass.checkpass"}})],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirmByDialog}},[e._v("确 定")])],1)])],2)},v=[],y=i("f36f"),C=i("624d"),w=i.n(C),I={components:{BizGrid:y["a"]},data:function(){var e=this,t=function(t,i,a){""===i?a(new Error("请输入支付密码")):(""!==e.formPass.checkpass&&e.$refs.formPass.validateField("checkpass"),a())},i=function(t,i,a){""===i?a(new Error("请确认支付密码")):i!==e.formPass.pass?a(new Error("两次输入密码不一致!")):a()};return{vfacLogo:w.a,paymentType:"0",radio:"7",memberCardId:"",paymentTypes:[],nbzz:!0,hykye:!1,loading:!1,dialogVisible:!1,form:{hasSetPayPassword:"",password:""},formPass:{pass:"",checkpass:""},rules:{password:[{required:!0,message:"请输入密码",trigger:"blur"}]},rulesPass:{pass:[{validator:t,trigger:"blur"},{required:!0,min:6,max:6,message:"长度为6位数字",trigger:"blur"}],checkpass:[{required:!0,validator:i,trigger:"blur"}]}}},props:{orderId:{type:String,default:""},amountPaid:{type:String,default:""},amountPayable:{type:String,default:""},amount:{type:String,default:""}},computed:Object(o["a"])({},Object(u["c"])(["getUser"])),watch:{orderId:function(e,t){e&&(this.getPaymentType(),this.form.password="",this.radio="7")}},methods:{getPaymentType:function(){var e=this,t={shopId:this.getUser.shop.id,orderId:this.orderId,userId:this.getUser.id};d["a"].get("/admin/purchaseOrder/paymentTypes.jhtml",t).then((function(t){e.paymentTypes=t.paymentTypes,e.form.hasSetPayPassword=t.hasSetPayPassword})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},setPass:function(){this.formPass.pass="",this.formPass.checkpass="",this.dialogVisible=!0},confirmByDialog:function(){var e=this;this.$refs.formPass.validate((function(t,i){if(t){var a={type:"2",userNewPwd:e.formPass.pass,userPwd:e.formPass.checkpass,clientType:"2",methodName:"BalancePayment",shopId:e.getUser.shop.id,userId:e.getUser.id};e.loading=!0,d["a"].put("/rest/member/password.jhtml",a).then((function(t){e.$message.success("支付密码设置成功"),e.loading=!1,e.dialogVisible=!1})).catch((function(t){console.log(t),e.loading=!1,e.$message.warning(t.errorMessage)}))}}))},confirm:function(){var e=this;this.$refs.form.validate((function(t,i){if(t){if(Number(e.amount)<0)return e.$message.warning("本次付款金额不能为负数"),!1;if(!/^[0-9]+\.?[0-9]*$/.test(e.amount))return e.$message.warning("本次付款金额格式错误!"),!1;if(Number(e.amount)>e.amountPayable)return e.$message.warning("本次付款金额大于需付款金额!"),!1;if("2"===e.radio&&!e.memberCardId)return e.$message.warning("请选择会员卡"),!1;var a={orderId:e.orderId,amount:e.amount,memberCardId:e.memberCardId,password:e.form.password,methodName:"BalancePayment",clientType:"2",shopId:e.getUser.shop.id,userId:e.getUser.id};e.loading=!0,"2"===e.radio?d["a"].post(p["g"].hypermarketMgmt.balancePayment,a).then((function(t){e.$message.success("支付成功"),e.loading=!1,e.$emit("operateSuccess")})).catch((function(t){console.log(t),e.loading=!1,e.$message.warning(t.errorMessage)})):d["a"].post(p["g"].hypermarketMgmt.internalTransferPayment,a).then((function(t){e.$message.success("支付成功"),e.loading=!1,e.$emit("operateSuccess")})).catch((function(t){console.log(t),e.loading=!1,e.$message.warning(t.errorMessage)}))}}))}}},_=I,S=(i("78b9"),i("2877")),O=Object(S["a"])(_,b,v,!1,null,null,null),k=O.exports,x=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"invoice-info-agency"},[i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),e._l(e.invoiceList,(function(t){return i("el-card",{key:t.id},[i("div",{on:{click:function(i){return e.applyFor(t)}}},[i("div",[i("span",[e._v("发票抬头：")]),i("span",[e._v(e._s(t.invoiceTitle))])]),i("div",{staticStyle:{"padding-top":"10px"}},[i("span",[e._v("发票类型：")]),i("span",[e._v(e._s("0"===t.invoiceType?"个人":"1"===t.invoiceType?"增值税普通发票":"2"===t.invoiceType?"增值税专用发票":""))])]),i("div",{staticStyle:{padding:"10px 0px"}},[i("span",[e._v("联系人：")]),i("span",[e._v(e._s(t.contacts))])]),i("div",{staticClass:"top"},[i("div",[i("span",[e._v("联系电话：")]),i("span",[e._v(e._s(t.mobile))])]),i("div",[i("span",[i("el-checkbox",{attrs:{"true-label":"1","false-label":"0",size:"mini"},model:{value:t.isDefault,callback:function(i){e.$set(t,"isDefault",i)},expression:"invoice.isDefault"}})],1)])]),i("div",{staticClass:"content"},[i("span",[e._v("详细地址：")]),i("span",[e._v(e._s(t.areaName+t.address))])]),i("div",{staticClass:"bottom"},[i("span",{on:{click:function(i){return i.stopPropagation(),e.editForm(t)}}},[e._v("编辑")]),i("span",{on:{click:function(i){return i.stopPropagation(),e.deleteForm(t.id)}}},[e._v("删除")])])])])})),0===e.invoiceList.length?i("div",{style:e.styleObject}):e._e(),i("el-dialog",{attrs:{visible:e.showForm,"append-to-body":"",height:"40%",width:"30%",center:""},on:{"update:visible":function(t){e.showForm=t}}},[i("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small","inline-message":!0}},[i("el-form-item",{attrs:{label:"发票信息"}}),i("el-form-item",{attrs:{label:"发票类型",prop:"invoiceType"}},[i("el-select",{model:{value:e.form.invoiceType,callback:function(t){e.$set(e.form,"invoiceType",t)},expression:"form.invoiceType"}},[i("el-option",{attrs:{label:"个人",value:"0"}}),i("el-option",{attrs:{label:"增值税普通发票",value:"1"}}),i("el-option",{attrs:{label:"增值税专用发票",value:"2"}})],1)],1),i("el-form-item",{attrs:{label:"发票抬头",prop:"invoiceTitle"}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.invoiceTitle,callback:function(t){e.$set(e.form,"invoiceTitle",t)},expression:"form.invoiceTitle"}})],1),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"纳税人识别号",prop:"code"}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1):e._e(),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"注册地址",prop:"registerAddress"}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.registerAddress,callback:function(t){e.$set(e.form,"registerAddress",t)},expression:"form.registerAddress"}})],1):e._e(),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"注册电话",prop:"registerMobile"}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.registerMobile,callback:function(t){e.$set(e.form,"registerMobile",t)},expression:"form.registerMobile"}})],1):e._e(),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"开户银行",prop:"bank"}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.bank,callback:function(t){e.$set(e.form,"bank",t)},expression:"form.bank"}})],1):e._e(),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"银行账户",prop:"account"}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],1):e._e(),i("el-form-item",{attrs:{label:"邮寄地址"}}),i("el-form-item",{attrs:{label:"联系人",prop:"contacts"}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.contacts,callback:function(t){e.$set(e.form,"contacts",t)},expression:"form.contacts"}})],1),i("el-form-item",{attrs:{label:"联系电话",prop:"mobile"}},[i("el-input",{attrs:{type:"text"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1),i("el-form-item",{attrs:{label:"所在地区"}},[i("biz-area-select",{attrs:{areaId:e.form.area.id},on:{areaChanged:e.handleAreaChanged}})],1),i("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[i("el-input",{attrs:{type:"area",maxlength:"100"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),i("biz-save-button",{attrs:{operations:e.formOperations},on:{operate:e.operate}})],1)],1),i("el-dialog",{attrs:{visible:e.dialogVisiable,"append-to-body":"","custom-class":"bill-dialog"},on:{"update:visible":function(t){e.dialogVisiable=t}}},[i("my-invoice",{attrs:{invoiceInfoId:e.invoiceInfoId,orderIds:e.orderIds},on:{close:e.close,cancle:e.cancle}})],1)],2)},T=[],M=(i("b680"),i("8330")),P=i("ce2e"),$=i("ce09"),D=i("f260"),z=i.n(D),R={components:{BizGrid:y["a"],BizSaveButton:M["a"],BizAreaSelect:P["a"],MyInvoice:$["a"]},data:function(){return{invoiceList:[],invoiceInfoId:"",showForm:!1,dialogVisiable:!1,operations:[{label:"添加",name:"add",type:"primary"}],formOperations:[{label:"保存",name:"save",type:"primary"},{label:"取消",name:"cancel",type:"primary"}],rules:{invoiceType:[{required:!0,message:"请输入发票类型",trigger:"blur"}],invoiceTitle:[{required:!0,message:"请输入发票抬头",trigger:"blur"}],code:[{required:!0,message:"请输入纳税人识别号",trigger:"blur"}],registerAddress:[{required:!0,message:"请输入注册地址",trigger:"blur"}],registerMobile:[{required:!0,message:"请输入注册电话",trigger:"blur"}],bank:[{required:!0,message:"请输入开户银行",trigger:"blur"}],account:[{required:!0,message:"请输入银行账户",trigger:"blur"}],contacts:[{required:!0,message:"请输入联系人",trigger:"blur"}],address:[{required:!0,message:"请输入详细地址",trigger:"blur"}],mobile:[{required:!0,message:"请输入联系电话",trigger:"blur"},{len:11,message:"手机号位数错误",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"手机号格式错误",trigger:"blur"}]},form:this.getDetaultModel()}},props:{orderIds:{type:Array},invoiceAmount:{type:Number}},computed:Object(o["a"])(Object(o["a"])({},Object(u["c"])(["getUser"])),{},{styleObject:function(){return{position:"absolute",top:0,bottom:0,left:0,right:0,margin:"auto",width:"200px",background:"url("+z.a+") 50% 50% / 300px no-repeat"}}}),created:function(){this.query()},methods:Object(o["a"])(Object(o["a"])({},Object(u["d"])("Order",["updateCurInvoice"])),{},{operate:function(e){this[e]()},cancle:function(){this.dialogVisiable=!1},close:function(){this.dialogVisiable=!1,this.$emit("close")},applyFor:function(e){this.invoiceInfoId=e.id,this.$set(e,"invoiceAmount",this.invoiceAmount.toFixed(2)),this.updateCurInvoice(e),this.dialogVisiable=!0},getDetaultModel:function(){return{account:"",address:"",areaId:"",area:{id:"1568"},areaName:"",bank:"",code:"",contacts:"",invoiceTitle:"",invoiceType:"0",isDefault:"",mobile:"",registerAddress:"",registerMobile:""}},add:function(){this.showForm=!0,this.form=this.getDetaultModel()},cancel:function(){this.showForm=!1},editForm:function(e){this.form=Object.assign(this.getDetaultModel(),e),this.showForm=!0},deleteForm:function(e){var t=this,i={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,ids:[e]};this.$confirm("是否确认删除发票?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d["a"].delete(p["g"].hypermarketMgmt.invoiceInfo,i).then((function(e){t.$message.success("删除成功"),t.query(),t.showForm=!1})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(e){}))}))},save:function(){var e=this;this.$refs.form.validate((function(t,i){t&&(e.form.areaId=e.form.area.id,e.form.id?e.update():e.create())}))},create:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,invoice:this.form};d["a"].post(p["g"].hypermarketMgmt.invoiceInfo,t).then((function(t){e.$message.success("添加成功"),e.query(),e.showForm=!1,"1"===e.form.isDefault&&e.updateCurInvoice(e.form)})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},setDefault:function(e){e.isDefault="1",this.form=Object.assign(this.getDetaultModel(),e),this.update()},update:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,invoice:this.form};d["a"].put(p["g"].hypermarketMgmt.invoiceInfo,t).then((function(t){e.$message.success("更新成功"),e.query(),e.showForm=!1,"1"===e.form.isDefault&&e.updateCurInvoice(e.form)})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},handleAreaChanged:function(e){this.form.area.id=e},query:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id};d["a"].get(p["g"].hypermarketMgmt.invoiceInfos,t).then((function(t){e.invoiceList=t.invoices||[]})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))}})},j=R,N=(i("d91f"),Object(S["a"])(j,x,T,!1,null,null,null)),F=N.exports,A=i("fc46"),L=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"add-step-2"},[i("div",{attrs:{slot:"bottom"},slot:"bottom"},[i("div",{staticClass:"subTotal"},[i("div",[e._v(" 合计: "),i("span",{staticClass:"price"},[e._v("￥"+e._s(e.subTotal))])]),i("biz-save-button",{attrs:{operations:e.operations},on:{operate:e.operate}})],1)]),i("div",{attrs:{slot:"top"},slot:"top"},[i("div",{staticClass:"header-step"},[i("div",{staticClass:"step-2"},[i("span",[e._v("①")]),i("span",[e._v("选择商品")]),i("span",[e._v(">")])]),i("div",{staticClass:"step-3"},[i("span",[e._v("②")]),i("span",[e._v("确认订单")])])]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addProduct}},[e._v("添加商品")])],1),i("biz-list",{key:Math.random(),ref:"table",attrs:{tableData:e.tableData,loading:e.loading,height:"100%"}},[i("el-table-column",{attrs:{prop:"fullName",label:"商品名称","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[i("div",{staticStyle:{width:"100%","margin-right":"30px"}},[i("div",{staticClass:"product-info"},[t.row.image?i("img",{attrs:{src:t.row.image}}):i("img",{attrs:{src:"/resources/admin/images/default/product-default-100.png"}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"titleClass",attrs:{title:t.row.fullName}},[e._v(e._s(t.row.fullName))])]),i("div",{staticClass:"info-bottom"},[i("div",{staticStyle:{"margin-left":"7px",color:"red"}},[e._v("￥"+e._s(t.row.price))])])])])])]}}])}),i("el-table-column",{attrs:{prop:"barCode",label:"条码"}}),i("el-table-column",{attrs:{prop:"minimumPackQuantity",label:"最小包装数","min-width":"60"}}),i("el-table-column",{attrs:{prop:"quantity",label:"数量","min-width":"90"},scopedSlots:e._u([{key:"default",fn:function(t){return i("div",{},[i("div",{staticClass:"biz-customcol"},[i("el-input-number",{attrs:{size:"mini",min:1},on:{change:function(i){return e.quantityChange(t.row.quantity)}},model:{value:t.row.quantity,callback:function(i){e.$set(t.row,"quantity",i)},expression:"scope.row.quantity"}})],1)])}}])}),i("el-table-column",{attrs:{prop:"date",label:"操作",type:"index"},scopedSlots:e._u([{key:"default",fn:function(t){return i("div",{},[e.isEdit?i("div",{staticClass:"biz-customcol"},[i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return e.deleteHandeler(t)}}},[e._v("删除")])],1):e._e()])}}])})],1),i("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:e.showDialog,tableData:e.giftList,pagination:e.dialogPagination,filters:e.dialogFilters,selectionKeys:e.selectedGiftIds},on:{"update:visibility":function(t){e.showDialog=t},pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,confirmed:e.confirmedProduct,filterDataChange:e.dialogFilterDataChange,selectionChange:e.selectionChange,"active-item-change":e.activeItemChange,cascaderChange:e.cascaderChange}},[i("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"400px"},scopedSlots:e._u([{key:"default",fn:function(t){return i("div",{},[i("div",{staticClass:"dialog-column"},[i("img",{staticClass:"productImg",attrs:{src:t.row.image||e.DefaultImg,onerror:e.errorImg}}),i("div",{staticClass:"biz-two-row"},[i("div",{staticStyle:{"margin-left":"10px","font-size":"14px"}},[e._v(e._s(t.row.name))]),i("div",{staticStyle:{"margin-left":"10px"}},[e._v("编号："+e._s(t.row.sn))]),i("div",{staticStyle:{"margin-left":"10px"}},[e._v("规格："+e._s(t.row.fullName&&-1!==t.row.fullName.indexOf("[")?t.row.fullName.split("[")[1].split("]")[0]:""))])])])])}}])}),i("el-table-column",{attrs:{property:"barCode",label:"条码"}}),i("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),i("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),i("el-table-column",{attrs:{property:"price",label:"价格"}}),i("el-table-column",{attrs:{label:"在库库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.realStock))])]}}])})],1)],1)},q=[],B=(i("4de4"),i("a434"),i("25f0"),i("7558")),U=i("2086"),E=i("af3f"),V=i("f3ac"),G=i.n(V),H={name:"NewsMgmt",props:{itemId:{type:String},supplierId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},step2Data:{type:Array},step2SubTotal:{type:String}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},errorImg:'this.src="/resources/admin/images/default/product-default.png"',DefaultImg:G.a,selectedGiftList:[],selectedGiftIds:[],categoryDatas:[],showDialog:!1,dialogFilters:[{type:"cascader",label:"分类",name:"category",filterable:!1,value:[],options:[]},{type:"select",label:"品牌",value:"",options:[]},{type:"input",placeholder:"请输入编号/商品名/条码",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,subTotal:"",height:"585",productCategoryId:"",subTotalAll:"",tableData:[],restaurants:[],selections:[],orderItems:[],selectionList:[],dialogTableVisible:!1,gridData:[],formData:{},shippingData:{},title:"",form:{products:""},operations:[{label:"确定",name:"save",type:"primary"}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:B["a"],BizGrid:y["a"],BizSaveButton:M["a"],BizDialogSelector:E["a"]},computed:Object(o["a"])({},Object(u["c"])(["getUser"])),watch:{itemId:function(e){this.tableData=[],this.subTotal="",this.itemId&&this.getList()}},created:function(){this.queryFilters()},mounted:function(){},methods:Object(o["a"])(Object(o["a"])({},Object(u["d"])("Order",["updatedRouterFrom","updateProducts","updateFinalPayment","updateOperatingShop"])),{},{stepOne:function(){this.$emit("stepToOne")},queryFilters:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id};d["a"].get(p["g"].hypermarketMgmt.productCategories,t).then((function(t){e.categoryDatas=t.productCategorys,e.setCategoryFilters(),e.setBrandFilters()})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},cascaderChange:function(e){this.productCategoryId=e[e.length-1],e.length>1&&""===this.productCategoryId&&(this.productCategoryId=e[e.length-2]),this.getGiftList()},activeItemChange:function(e){var t=this,i={shopId:this.getUser.shop.id,parentId:e.toString()};d["a"].get("/admin/shopProduct/productCategorys.jhtml",i).then((function(i){var a;t.setCategoryFilters(),t.dialogFilters[0].options.forEach((function(t){t.value===e[0]&&(a=t.children)})),i.dateList.forEach((function(e){a.push({value:e.id,label:e.name})}))})).catch((function(){}))},setCategoryFilters:function(){var e=[{value:"",label:"全部"}];this.categoryDatas.forEach((function(t){e.push({value:t.id,label:t.name,children:[{label:"全部",value:""}]})})),this.dialogFilters[0].options=e},setBrandFilters:function(){var e=this,t={pageNumber:1,pageSize:1e3};d["a"].get("/admin/toB/product/brandSeries.jhtml",t).then((function(t){e.dialogFilters[1].options=t.Brand.map((function(e){return{value:e.id,label:e.name}})),e.dialogFilters[1].options.splice(0,0,{value:"",label:"全部"})})).catch((function(t){e.loading=!1,t.errorMessage&&e.$message.warning(t.errorMessage)}))},getSelectedBrandId:function(){return this.dialogFilters[1].value},addProduct:function(){this.dialogFilters[2].value="",this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getGiftList()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getGiftList()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.giftList=[],this.getGiftList()},getGiftList:function(){var e=this,t={shopBrands:this.getSelectedBrandId(),pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,categoryId:this.productCategoryId,searchValue:this.dialogFilters[2].value,shopId:window.top.SHOP_ID||this.getUser.shop.id,userId:this.getUser.id};d["a"].get("/admin/toB/product/list.jhtml",t).then((function(t){e.giftList=t.products,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},confirmedProduct:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(e.quantity="1",t.selectedGiftList.push(e))}));this.selectedGiftList.map((function(e){Number(e.quantity)*Number(e.price)})),this.selectedGiftList.forEach((function(e){t.handleSelect(e),t.listProduct(e)}))},formatDate:function(e){var t=new Date(e),i=t.getFullYear(),a=t.getMonth()+1,s=t.getDate(),n=i+"-"+(a<10?"0"+a:a)+"-"+(s<10?"0"+s:s);return n},resize:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},operate:function(e){this[e]()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},getList:function(){var e=this;this.loading=!0;var t={orderId:this.itemId,pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};c["a"].viewProducts(t,(function(t){e.loading=!1,e.tableData=t.orderItems,e.subTotal=t.order.price,e.pagination.total=Number(t.total),console.log("this.tableData",e.tableData)}),(function(e){console.log(e)}))},handleSelect:function(e){var t=!1;if(e.productId=e.id,e.id="",this.subTotal=(Number(this.subTotal)+Number(e.quantity)*Number(e.price)).toFixed(2),0!==this.tableData.length){for(var i=0;i<this.tableData.length;i++)if(this.tableData[i].productId===e.productId){this.tableData[i].quantity=(Number(this.tableData[i].quantity)+1).toString(),t=!0;break}t||this.tableData.push(e)}else this.tableData.push(e)},deleteHandeler:function(e){this.tableData.splice(e.$index,1),this.subTotal=(Number(this.subTotal)-Number(e.row.price)*Number(e.row.quantity)).toFixed(2)},quantityChange:function(e){var t=0;this.tableData.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.subTotal=t?t.toFixed(2):""},save:function(){var e=this;if(!this.tableData.length)return this.$message.warning("采购订单项目为空"),!1;var t=[];t=this.tableData.map((function(e){return{effectivePrice:e.price,product:{availableStock:e.availableStock,categoryType:e.categoryType,fullName:e.fullName,id:e.productId,image:e.image,productType:e.productType},shopName:e.shop.name,quantity:e.quantity}}));var i=!1;if(this.tableData.forEach((function(t){console.log(t.quantity),-1!==String(t.quantity).indexOf(".")&&(e.$message.warning("数量不能为小数"),i=!0),t.quantity%t.minimumPackQuantity!==0&&(e.$message.warning("数量为最小包装数的整数倍"),i=!0)})),i)return!1;this.updateProducts(t),this.$emit("step2Confirm",this.tableData,this.subTotal)},listProduct:function(e){var t=this;U["a"].listProduct({searchValue:e.name},(function(e){t.restaurants=e.content.map((function(e){return{fullName:e.fullName,sn:e.sn,price:e.price,quantity:"1",subTotal:e.price,productId:e.id,value:e.fullName}})),t.loading=!1}),(function(e){console.log(e),console.log("code错误")}))},querySearchAsync:function(e,t){var i=this.restaurants,a=e?i.filter(this.createStateFilter(e)):i;clearTimeout(this.timeout),this.timeout=setTimeout((function(){t(a)}),300*Math.random())},createStateFilter:function(e){return function(e){return!0}},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()},query:function(){this.tableData=this.step2Data,this.subTotal=this.step2SubTotal}})},K=H,Q=(i("5945"),Object(S["a"])(K,L,q,!1,null,null,null)),W=Q.exports,X=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"add-step-3"},[i("div",{attrs:{slot:"top"},slot:"top"},[i("div",{staticClass:"header-step"},[i("div",{staticClass:"step-2",on:{click:e.stepToTwo}},[i("span",[e._v("①")]),i("span",[e._v("选择商品")]),i("span",[e._v(">")])]),i("div",{staticClass:"step-3"},[i("span",[e._v("②")]),i("span",[e._v("确认订单")])])])]),i("div",{staticClass:"order-confirm"},[i("div",{staticClass:"order-confirm-content"},[e.showAddress?i("div",{staticClass:"order-address",on:{click:e.clickAdress}},[i("div",{staticClass:"left"},[i("div",{staticClass:"address"},[i("div",{staticClass:"receiver-address"},[i("span",[e._v(e._s(e.getAddress?e.getAddress.consignee:""))]),i("span",[e._v(e._s(e.getAddress?e.getAddress.phone:""))])]),i("div",{staticClass:"icon"},[i("span",[i("i",{staticClass:"el-icon-location-outline"}),e._v(" "+e._s(e.getAddress?e.getAddress.areaName+e.getAddress.address:"请设置收货地址")+" ")]),i("span",[i("i",{staticClass:"right-arrow iconfont biz-icon-i-web-zk1"})])])])]),i("div",[i("i",{staticClass:"right-arrow iconfont icon-i-sh-man-tz"})])]):e._e(),i("div",{staticClass:"order-goods"},[i("div",{staticClass:"shop-name"},[i("img",{attrs:{src:e.iconShop}}),i("span",{staticStyle:{fontSize:"14px"}},[e._v(e._s(e.orderConfim.products?e.orderConfim.products[0].shopName:""))])]),e._l(e.orderConfim.products,(function(t,a){return i("div",{key:a},[i("div",{staticClass:"order-goods-div"},[i("div",{staticClass:"img-div"},[i("img",{staticClass:"img",attrs:{src:t.product&&t.product.image?t.product.image:e.vfacLogo},on:{error:e.imgError}})]),i("div",{staticClass:"goods-info"},[i("span",{staticClass:"name"},[e._v(e._s(t.product.fullName))]),i("div",{staticClass:"money-info"},[i("span",{staticClass:"count-money"},[e._v("￥"+e._s(t.effectivePrice))]),i("span",{staticClass:"count-num"},[e._v("X"+e._s(t.quantity))])])])])])}))],2),i("div",{staticClass:"order-info"},["1"===e.orderConfim.products[0].product.productType||e.priceCoupon?e._e():i("div",{staticClass:"select-tyle"},[i("span",[e._v("支付方式")]),i("el-select",{attrs:{size:"mini"},on:{change:e.paymentChange},model:{value:e.payType,callback:function(t){e.payType=t},expression:"payType"}},e._l(e.payOptions,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),i("div",{staticClass:"select-tyle"},[i("span",[e._v("配送方式")]),i("el-select",{attrs:{size:"mini"},on:{change:e.inputChange},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.options,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),i("div",{staticClass:"buy-leave-mes"},[i("span",[e._v("买家留言")]),i("el-input",{attrs:{type:"textarea",size:"mini",placeholder:"选填：填写内容已和卖家协商确认"},model:{value:e.leaveMessage,callback:function(t){e.leaveMessage=t},expression:"leaveMessage"}})],1)]),i("div",{staticClass:"order-info"},["1"!==e.orderConfim.products[0].product.productType&&parseFloat(e.getRealAmount)&&e.showInvoince?i("div",{staticClass:"order-dispatch"},[i("span",{staticStyle:{display:"flex","align-items":"center"}},[i("el-checkbox",{on:{change:e.invoiceChange},model:{value:e.invoiceChecked,callback:function(t){e.invoiceChecked=t},expression:"invoiceChecked"}}),i("span",{staticClass:"label"},[e._v("发票信息")])],1),i("div",{staticClass:"invoice-info",on:{click:e.clickInvoiceInfo}},[e.invoiceChecked?i("span",{staticClass:"invoice-title",staticStyle:{"font-size":"14px"}},[e._v(e._s(e.curInvoice?e.curInvoice.invoiceTitle:"暂无发票"))]):e._e(),e.invoiceChecked?e._e():i("span",{staticClass:"invoice-title",staticStyle:{"font-size":"14px"}},[e._v(e._s("不开具发票"))]),i("i",{staticClass:"right-arrow iconfont biz-icon-i-web-zk1"})])]):e._e()]),i("div",{staticClass:"order-count-div"},[i("div",{staticClass:"order-count"},[i("span",{staticClass:"pro-count"},[e._v("产品总额")]),i("span",[e._v("￥"+e._s(e.getCountMouny))])]),i("div",{staticClass:"order-count"},[i("span",{staticClass:"pro-count"},[e._v("邮费")]),i("span",[e._v("+￥"+e._s(e.freight))])]),e.discount&&"1"!==e.orderConfim.products[0].product.productType?i("div",{staticClass:"order-count"},[i("span",{staticClass:"pro-count"},[e._v("优惠")]),i("span",[e._v("-￥"+e._s(e.discount.toFixed(2)))])]):e._e(),i("div",{staticClass:"order-count"},[i("span",{staticClass:"pro-count",staticStyle:{color:"#333"}},[e._v("合计")]),i("span",{staticClass:"count-money"},[e._v("￥"+e._s(e.getAmount?e.getAmount:e.getAmount.toFixed(2)))])])]),i("div",{staticClass:"foot",attrs:{slot:"bottom"},slot:"bottom"},[i("p",{staticClass:"pay-for"},[e._v(" 需付款 "),i("span",{staticClass:"count-money"},[e._v("￥"+e._s(e.getRealAmount?e.getRealAmount:e.getRealAmount.toFixed(2)))])]),i("span",{staticClass:"submit",on:{click:e.submit}},[e._v("提交订单")])])]),i("el-dialog",{attrs:{visible:e.dialogVisiable,"append-to-body":"","custom-class":"bill-dialog"},on:{"update:visible":function(t){e.dialogVisiable=t}}},[i("bill-info",{on:{selectedItem:e.selectedItem}})],1),i("el-dialog",{attrs:{visible:e.dialogVisiableInvoice,"append-to-body":"","custom-class":"bill-dialog"},on:{"update:visible":function(t){e.dialogVisiableInvoice=t}}},[i("invoice-info",{on:{selectedItem:e.selectedItem}})],1)],1)])},J=[],Y=(i("7db0"),i("7039"),i("5319"),i("f606")),Z=i.n(Y),ee=i("ea36"),te=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"invoice-info-order"},[i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),e._l(e.invoiceList,(function(t){return i("el-card",{key:t.id},[i("div",{on:{click:function(i){return e.selectItem(t)}}},[i("div",[i("span",[e._v("发票抬头：")]),i("span",[e._v(e._s(t.invoiceTitle))])]),i("div",[i("span",[e._v("联系人：")]),i("span",[e._v(e._s(t.contacts))])]),i("div",{staticClass:"top"},[i("div",[i("span",[e._v("联系电话：")]),i("span",[e._v(e._s(t.mobile))])]),i("div",[i("span",[i("el-checkbox",{attrs:{"true-label":"1","false-label":"0",size:"mini"},on:{change:function(i){return e.setDefault(t)}},model:{value:t.isDefault,callback:function(i){e.$set(t,"isDefault",i)},expression:"invoice.isDefault"}})],1)])]),i("div",{staticClass:"content"},[i("span",[e._v("详细地址：")]),i("span",[e._v(e._s(t.areaName+t.address))])]),i("div",{staticClass:"bottom"},[i("span",{on:{click:function(i){return e.editForm(t)}}},[e._v("编辑")]),i("span",{on:{click:function(i){return e.deleteForm(t.id)}}},[e._v("删除")])])])])})),0===e.invoiceList.length?i("div",{style:e.styleObject}):e._e(),i("el-dialog",{attrs:{visible:e.showForm,"append-to-body":"",height:"40%",center:""},on:{"update:visible":function(t){e.showForm=t}}},[i("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small","inline-message":!0}},[i("el-form-item",{attrs:{label:"发票信息"}}),i("el-form-item",{attrs:{label:"发票类型",prop:"consignee"}},[i("el-select",{staticStyle:{width:"220px"},model:{value:e.form.invoiceType,callback:function(t){e.$set(e.form,"invoiceType",t)},expression:"form.invoiceType"}},[i("el-option",{attrs:{label:"个人",value:"0"}}),i("el-option",{attrs:{label:"增值税普通发票",value:"1"}}),i("el-option",{attrs:{label:"增值税专用发票",value:"2"}})],1)],1),i("el-form-item",{attrs:{label:"发票抬头",prop:"invoiceTitle"}},[i("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.invoiceTitle,callback:function(t){e.$set(e.form,"invoiceTitle",t)},expression:"form.invoiceTitle"}})],1),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"纳税人识别号",prop:"code"}},[i("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1):e._e(),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"注册地址",prop:"registerAddress"}},[i("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.registerAddress,callback:function(t){e.$set(e.form,"registerAddress",t)},expression:"form.registerAddress"}})],1):e._e(),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"注册电话",prop:"registerMobile"}},[i("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.registerMobile,callback:function(t){e.$set(e.form,"registerMobile",t)},expression:"form.registerMobile"}})],1):e._e(),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"开户银行",prop:"bank"}},[i("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.bank,callback:function(t){e.$set(e.form,"bank",t)},expression:"form.bank"}})],1):e._e(),"0"!==e.form.invoiceType?i("el-form-item",{attrs:{label:"银行账户",prop:"account"}},[i("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],1):e._e(),i("el-form-item",{attrs:{label:"邮寄地址"}}),i("el-form-item",{attrs:{label:"联系人",prop:"contacts"}},[i("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.contacts,callback:function(t){e.$set(e.form,"contacts",t)},expression:"form.contacts"}})],1),i("el-form-item",{attrs:{label:"联系电话",prop:"mobile"}},[i("el-input",{staticStyle:{width:"220px"},attrs:{type:"text"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1),i("el-form-item",{attrs:{label:"所在地区"}},[i("biz-area-select",{staticStyle:{width:"220px"},attrs:{areaId:e.form.area.id},on:{areaChanged:e.handleAreaChanged}})],1),i("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[i("el-input",{staticStyle:{width:"220px"},attrs:{type:"area",maxlength:"100"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),i("biz-save-button",{attrs:{operations:e.formOperations},on:{operate:e.operate}})],1)],1)],2)},ie=[],ae={components:{BizGrid:y["a"],BizSaveButton:M["a"],BizAreaSelect:P["a"]},data:function(){return{invoiceList:[],showForm:!1,operations:[{label:"添加",name:"add",type:"primary"}],formOperations:[{label:"保存",name:"save",type:"primary"},{label:"取消",name:"cancel",type:"primary"}],rules:{invoiceType:[{required:!0,message:"请输入发票类型",trigger:"blur"}],invoiceTitle:[{required:!0,message:"请输入发票抬头",trigger:"blur"}],code:[{required:!0,message:"请输入纳税人识别号",trigger:"blur"}],registerAddress:[{required:!0,message:"请输入注册地址",trigger:"blur"}],registerMobile:[{required:!0,message:"请输入注册电话",trigger:"blur"}],bank:[{required:!0,message:"请输入开户银行",trigger:"blur"}],account:[{required:!0,message:"请输入银行账户",trigger:"blur"}],contacts:[{required:!0,message:"请输入联系人",trigger:"blur"}],address:[{required:!0,message:"请输入详细地址",trigger:"blur"}],mobile:[{required:!0,message:"请输入联系电话",trigger:"blur"},{len:11,message:"手机号位数错误",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"手机号格式错误",trigger:"blur"}]},form:this.getDetaultModel()}},computed:Object(o["a"])(Object(o["a"])({},Object(u["c"])(["getUser"])),{},{styleObject:function(){return{position:"absolute",top:0,bottom:0,left:0,right:0,margin:"auto",width:"200px",background:"url("+z.a+") 50% 50% / 300px no-repeat"}}}),created:function(){this.query()},methods:Object(o["a"])(Object(o["a"])({},Object(u["d"])("Order",["updateCurInvoice"])),{},{operate:function(e){this[e]()},getDetaultModel:function(){return{account:"",address:"",areaId:"",area:{id:"1568"},areaName:"",bank:"",code:"",contacts:"",invoiceTitle:"",invoiceType:"",isDefault:"",mobile:"",registerAddress:"",registerMobile:""}},add:function(){this.showForm=!0,this.form=this.getDetaultModel()},cancel:function(){this.showForm=!1},editForm:function(e){this.form=Object.assign(this.getDetaultModel(),e),this.showForm=!0},deleteForm:function(e){var t=this,i={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,ids:[e]};this.$confirm("是否确认删除收货地址?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d["a"].delete(p["g"].hypermarketMgmt.invoiceInfo,i).then((function(e){t.$message.success("删除成功"),t.query()})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(e){}))}))},save:function(){var e=this;this.$refs.form.validate((function(t,i){t&&(e.form.areaId=e.form.area.id,e.form.id?e.update():e.create())}))},create:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,invoice:this.form};d["a"].post(p["g"].hypermarketMgmt.invoiceInfo,t).then((function(t){e.$message.success("添加成功"),e.query(),e.showForm=!1,"1"===e.form.isDefault&&e.updateCurInvoice(e.form)})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},setDefault:function(e){e.isDefault="1",this.form=Object.assign(this.getDetaultModel(),e),this.update()},update:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id,invoice:this.form};d["a"].put(p["g"].hypermarketMgmt.invoiceInfo,t).then((function(t){e.$message.success("设置成功"),e.query(),e.$emit("selectedItem"),e.showForm=!1,"1"===e.form.isDefault&&e.updateCurInvoice(e.form)})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},selectItem:function(e){console.log(e),this.$emit("selectedItem"),this.updateCurInvoice(e)},handleAreaChanged:function(e){this.form.area.id=e},query:function(){var e=this,t={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id};d["a"].get(p["g"].hypermarketMgmt.invoiceInfos,t).then((function(t){e.invoiceList=t.invoices})).catch((function(t){e.$message({message:t.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))}})},se=ae,ne=(i("ab54"),Object(S["a"])(se,te,ie,!1,null,null,null)),oe=ne.exports,re={name:"order-confirm",data:function(){return{iconShop:Z.a,invoiceId:"",vfacLogo:w.a,leaveMessage:"",type:"",shippingMethodId:"",options:[],receiverId:"",open:!1,dialogVisiable:!1,dialogVisiableInvoice:!1,id:"0",payType:"",payOptions:[],openSelect:!1,selectDiscount:[],vdChecked:!1,invoiceChecked:!1,showVdDiscount:!1,option:{label:""},bean:0,vdiscount:0,discount:0,showVd:!1,disSelect:"",freight:0,computedBean:{},showAddress:!0}},props:{supplierId:{type:String}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(u["c"])(["getUser"])),Object(u["c"])("Order",["orderConfim","orderInfo","curInvoice","payment","defaultReceive","clickItemSelect"])),{},{getFinallyPayment:function(){return(this.orderConfim.products[0].effectivePrice*this.orderConfim.products[0].quantity-this.getSubscription).toFixed(2)},getIsSubscription:function(){return this.orderConfim.products[0].product.isSubscription},getSubscription:function(){return this.orderConfim.products[0].product.subscription},getRealAmount:function(){return this.orderConfim.finalPayment?this.orderConfim.finalPayment:this.getAmount},showInvoince:function(){return!(this.vdChecked&&this.getCountMouny-this.vdiscount-this.discount<=0)},getAmount:function(){var e=0;return this.vdChecked?e=Number(Number(this.getCountMouny)-Number(this.vdiscount)-Number(this.discount)+Number(this.freight)).toFixed(2):(console.log("amount: ",this.getCountMouny-this.discount+this.freight),e=Number(Number(this.getCountMouny)-Number(this.discount)+Number(this.freight)).toFixed(2)),e>=0?e:0},getCountMouny:function(){for(var e=this.orderConfim.products,t=e.length,i=0,a=0;a<t;a++)i+=e[a].effectivePrice*e[a].quantity;return parseFloat(i).toFixed(2)},getCountNum:function(){return"X "+this.orderConfim.quantity},getAddress:function(){return Object.getOwnPropertyNames(this.orderConfim.selAddress).length>1?this.orderConfim.selAddress:this.defaultReceive?this.defaultReceive:this.orderConfim.receivers&&this.orderConfim.receivers.length>0?this.orderConfim.receivers[0]:null},isActivityOrder:function(){return!1},priceCoupon:function(){return"7"===this.orderConfim.products[0].product.productType},orderType:function(){return this.priceCoupon?"5":"0"}}),components:{BillInfo:ee["a"],InvoiceInfo:oe,BizGrid:y["a"]},methods:Object(o["a"])(Object(o["a"])({},Object(u["d"])("Order",["updateOrderInfo","updateOrderConfim","updateOrderId","updatePayment","updateFreight","updateCouponSelect","updateClickItemSelect","updateCurInvoice"])),{},{goShop:function(){this.$router.push({path:"/shop-about/".concat(this.orderConfim.shop.id)})},stepToTwo:function(){this.$emit("stepToTwo")},selectedItem:function(){this.dialogVisiable=!1,this.dialogVisiableInvoice=!1,this.invoiceChecked=!0},calculateOrder:function(){for(var e,t,i=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0",s={cartItems:[],methodName:"CalculateOrder",clientType:"2",shopId:this.getUser.shop.id||"",userId:this.getUser.id||"",couponIds:this.selectDiscount,shippingMethodId:this.shippingMethodId||"",bean:a},n=this.orderConfim.products,o=n.length,r=0;r<o;r++)e={},e.quantity=n[r].quantity,e.amount=n[r].quantity*n[r].effectivePrice,t={},t.id=n[r].product.id,t.price=n[r].effectivePrice,e.product=t,s.cartItems.push(e);d["a"].post(p["g"].hypermarketMgmt.calculate,s).then((function(e){console.log("选择优惠券",e),i.discount=parseFloat(e.discount),i.freight=e.freight,i.beanComputed()})).catch((function(){})).finally((function(){}))},onSelect:function(e){this.disSelect=e.name,this.selectDiscount=e.id?[e.id]:[],this.calculateOrder()},imgError:function(e){},onCancel:function(){this.open=!1},clickAdress:function(){this.dialogVisiable=!0},submit:function(){this.getAddress&&this.getAddress.address||!("在线支付"===this.payment.name&&this.showAddress||"货到付款"===this.payment.name)||this.priceCoupon?this.createOrder():this.$message.warning("请设置收货地址")},clickInvoiceInfo:function(){this.updateClickItemSelect(!0),this.dialogVisiableInvoice=!0},getQueryHandle:function(){this.updateOrderInfo({amount:this.orderConfim.quantity*this.orderConfim.effectivePrice,count:this.orderConfim.quantity});var e,t=this.orderConfim.shippingMethods,i=t.length;for(e=0;e<i;e++)this.options.push(t[e].name);i>0&&(this.type=this.options[0],this.refreshFreight())},refreshFreight:function(){var e,t=this.orderConfim.shippingMethods,i=t.length;for(e=0;e<i;e++)this.type===t[e].name&&this.updateFreight({freight:t[e].freight,shippingMethodId:t[e].id});"顺丰速递"===this.type?this.freight=20:this.freight=0},inputChange:function(){var e=this;this.shippingMethodId=this.orderConfim.shippingMethods.find((function(t){return t.name===e.type})).id,this.calculateOrder();for(var t=this.orderConfim.shippingMethods,i=this.orderConfim.shippingMethods.length,a=0;a<i;a++)if(this.type===t[a].name)return"0"===t[a].isNeedReceiver?this.showAddress=!1:this.showAddress=!0,void this.refreshFreight()},orderConfirm:function(){var e=this,t="",i={cartItems:[],methodName:"",clientType:"2",shopId:this.getUser.shop.id,userId:this.getUser.id,orderType:this.orderType};i.methodName="FillInOrder",t=p["g"].hypermarketMgmt.fillIn;for(var a,s,n=this.orderConfim.products,o=n.length,r=0;r<o;r++)a={},a.id=n[r].id,a.quantity=n[r].quantity,a.amount=n[r].quantity*n[r].effectivePrice,s={},s.id=n[r].product.id,s.price=n[r].effectivePrice,a.product=s,i.cartItems.push(a);d["a"].post(t,i).then((function(t){!e.shippingMethodId&&t.shippingMethods.length&&(e.shippingMethodId=t.shippingMethods[0].id),console.log(111,t),e.updateOrderConfim({quantity:e.orderConfim.quantity,receivers:t.receivers,shippingMethods:t.shippingMethods,paymentMethods:t.paymentMethods,couponGroups:t.couponGroups}),e.setReceiveId(),e.payType=t.paymentMethods[0].name,e.updatePayment(t.paymentMethods[0]),e.getQueryHandle();for(var i=t.paymentMethods,a=i.length,s=0;s<a;s++)e.payOptions.push(i[s].name);e.computedBean={bean:t.bean,maxOffsetBean:t.maxOffsetBean,minOffsetBean:t.minOffsetBean,beanRate:t.beanRate},t.couponGroups&&t.couponGroups.length&&"1"!==e.orderConfim.products[0].product.productType&&!e.orderConfim.finalPayment&&(t.couponGroups[0].couponList[0].select=!0,e.disSelect=t.couponGroups[0].couponList[0].name,e.selectDiscount=[t.couponGroups[0].couponList[0].id],e.updateCouponSelect({couponGroups:t.couponGroups})),e.bean=t.bean,e.beanComputed(),t.shippingMethods&&t.shippingMethods.length&&("0"===t.shippingMethods[0].isNeedReceiver?e.showAddress=!1:e.showAddress=!0),e.isActivityOrder||(e.vdChecked?e.calculateOrder(e.bean):e.calculateOrder("0"))})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){}))},beanComputed:function(){if(console.log("computedBean",this.computedBean),parseFloat(this.computedBean.bean)>0){var e=parseFloat(this.computedBean.bean),t=parseFloat(this.computedBean.minOffsetBean),i=parseFloat(this.computedBean.maxOffsetBean);e>t&&e<=i?(this.bean=e,this.vdiscount=(this.bean*parseFloat(this.computedBean.beanRate)).toFixed(2)):e>i&&(console.log("discount",this.discount),i*parseFloat(this.computedBean.beanRate)>this.getCountMouny-this.discount?this.bean=(this.getCountMouny-this.discount)*(1/parseFloat(this.computedBean.beanRate)):this.bean=i,this.vdiscount=(this.bean*parseFloat(this.computedBean.beanRate)).toFixed(2)),console.log("bean",this.bean),console.log("vdiscount",this.vdiscount),this.bean&&(this.showVd=!0)}else this.showVd=!1;this.computedBean.beanRate||(this.showVd=!1)},createOrder:function(){var e=this;console.log("createOrder"),Object.getOwnPropertyNames(this.orderConfim.selAddress).length>1?this.receiverId=this.orderConfim.selAddress.id:this.defaultReceive?this.receiverId=this.defaultReceive.id:this.orderConfim.receivers&&this.orderConfim.receivers.length&&(this.receiverId=this.orderConfim.receivers[0].id);var t={cartItems:[],amount:this.orderConfim.quantity*this.orderConfim.price,freight:this.freight.toString(),receiverId:this.showAddress&&!this.priceCoupon?this.receiverId:"",paymentMethodId:this.priceCoupon?"":this.payment.id,shippingMethodId:this.shippingMethodId,methodName:"CreateOrder",clientType:"2",shopId:this.orderConfim.shop.id||this.getUser.shop.id,userId:this.getUser.id,orderType:this.orderType,invoiceId:this.invoiceChecked&&this.curInvoice?this.curInvoice.id:"",bean:"0",couponIds:this.selectDiscount,memo:this.leaveMessage,supplierId:this.supplierId};this.vdChecked&&(t.bean=this.bean.toString());for(var i,a,s=this.orderConfim.products,n=s.length,o=this.getAmount,r=0;r<n;r++)i={},i.id=s[r].id,i.quantity=s[r].quantity,i.amount=s[r].quantity*s[r].effectivePrice,i.isMatch=s[r].isMatch,i.packageId=s[r].packageId,a={},a.id=s[r].product.id,a.price=s[r].effectivePrice,i.product=a,t.cartItems.push(i);d["a"].post("/admin/purchaseOrder/agent/order.jhtml",t).then((function(t){console.log("订单id",t.id),e.updateOrderId(t.id),e.id=t.id,"在线支付"===e.payment.name&&0!==parseFloat(e.getRealAmount)?(console.log(e.getAmount),e.$emit("step3Confirm",t.id,o)):e.$emit("complate",t.id)})).catch((function(t){"1162"===t.resultCode&&e.$emit("complate"),e.$message.warning(t.errorMessage)})).finally((function(){}))},invoiceChange:function(e){var t=this;if(console.log(e),e){var i={clientType:"2",userId:this.getUser.id,shopId:this.getUser.shop.id};d["a"].get(p["g"].hypermarketMgmt.invoiceInfos,i).then((function(e){t.updateCurInvoice(e.invoices[0])})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(e){}))}},payNow:function(){var e=this,t={orderId:this.id,methodName:"BalancePayment",clientType:"2",shopId:this.getUser.shop.id,userId:this.getUser.id};d["a"].post(p["g"].hypermarketMgmt.balancePayment,t).then((function(t){e.$emit("complate",e.id)})).catch((function(t){"377"===t.resultCode?e.$message.warning("会员卡余额不足，请使用其他支付方式"):"378"===t.resultCode?e.$message.warning("用户支付密码未设定，请先设定支付密码"):"380"===t.resultCode?(e.$message.warning("支付密码输入错误，请重试"),e.passValue=""):e.$message.warning(t.errorMessage)})).finally((function(){}))},successHandle:function(e){console.log("支付成功回调函数",e),this.$router.replace({path:"/orderInfo/"+this.id})},failHandle:function(){this.$router.replace({path:"/orderInfo/"+this.id})},setReceiveId:function(){Object.getOwnPropertyNames(this.orderConfim.selAddress).length>1&&(this.receiverId=this.orderConfim.selAddress.id),this.defaultReceive&&(this.receiverId=this.defaultReceive.id),this.orderConfim.receivers&&this.orderConfim.receivers.length>0&&(this.receiverId=this.orderConfim.receivers[0].id)},paymentChange:function(){var e,t=this.orderConfim.paymentMethods,i=t.length;for(e=0;e<i;e++)this.payType===t[e].name&&this.updatePayment(t[e])},hideSelect:function(){this.openSelect=!1},onSelectDiscount:function(){this.openSelect=!0},deleteInvoice:function(){this.updateCurInvoice({})}}),created:function(){this.orderConfirm(),console.log("订单确认商品",this.orderConfim),"1"===this.orderConfim.products[0].product.productType&&(this.vdChecked=!0)}},le=re,ce=(i("33b8"),Object(S["a"])(le,X,J,!1,null,null,null)),de=ce.exports,ue=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"child-order-info"},[i("div",{staticClass:"order-info-div"},e._l(e.orderDatas,(function(t,a){return i("div",{key:a,staticClass:"order-info-content"},[i("div",{staticClass:"order-info-new"},[i("div",{staticClass:"order-sn"},[e._v(" 订单号： "),i("span",{staticStyle:{fontSize:"14px"}},[e._v(e._s(t.sn?t.sn:""))])]),e._l(t.orderItems,(function(t,a){return i("div",{key:a},[i("div",{staticClass:"good-info"},[i("div",{staticClass:"goods-img"},[i("img",{ref:"img",refInFor:!0,staticClass:"img",attrs:{src:t.thumbnail&&t.thumbnail.indexOf("/")>=0?t.thumbnail:e.defaultImg},on:{error:function(t){return e.imgError(a)}}})]),i("div",{staticClass:"good-right"},[i("div",{staticClass:"good-name"},[i("span",{staticStyle:{flex:"1"}},[e._v(e._s(t.fullName))])]),i("div",{staticClass:"good-price"},[i("span",[e._v("￥"+e._s(t.price))]),i("span",[e._v("X"+e._s(t.quantity))])])])])])})),i("div",{staticClass:"price-info-content"},[i("div",{staticClass:"total-price"},[i("span",{staticStyle:{"margin-right":"10px"}},[e._v("共"+e._s(t.count)+"件")]),i("span",[e._v("合计:￥"+e._s(t.amount))]),i("span",[e._v("(含运费"+e._s(t.freight)+"元)")])])])],2)])})),0)])},pe=[],me=i("e83a"),he=i.n(me),fe=i("517a"),ge=i.n(fe),be={name:"child-order-info",data:function(){return{defaultImg:he.a,defaultFailImg:ge.a,loading:!1,orderDatas:[]}},props:{itemId:{type:String}},watch:{itemId:function(e){this.itemId&&this.getOrderChildInfo()}},components:{BizGrid:y["a"]},computed:{},methods:{getOrderChildInfo:function(){var e=this,t={orderId:this.itemId};d["a"].get("/admin/purchaseOrderManage/storeSalesOrders/children.jhtml",t).then((function(t){e.orderDatas=t.dataList})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))}},created:function(){this.itemId&&this.getOrderChildInfo()}},ve=be,ye=(i("3346"),Object(S["a"])(ve,ue,pe,!1,null,null,null)),Ce=ye.exports,we=i("bc3a"),Ie=i.n(we),_e=i("443b"),Se={name:"OrderMgmtList",data:function(){return{sn:"",shop:"",amountPaid:"",amount:"",amountPayable:"",closeDeccription:"",curSelectCloseReason:"",editable:!0,step2:!0,step3:!1,showProductCopyOrder:!1,showConfirm:!1,productList:{orderItems:[]},shopList:[],mergeState:"",reasonList:[{label:"我不想买了",value:"我不想买了"},{label:"信息填写有误, 重新拍",value:"信息填写有误, 重新拍"},{label:"卖家缺货",value:"卖家缺货"},{label:"忘记使用优惠券",value:"忘记使用优惠券"},{label:"重复下单,误下单",value:"重复下单,误下单"},{label:"支付方式有误,无法支付",value:"支付方式有误,无法支付"}],errorImg:'this.src="'+i("b89e")+'"',showCloseOrder:!1,curSelectDateType:"全部",dateTypeList:["全部","今日订单","近一周订单","近一月订单","近三月订单"],tabName:"info",itemId:"",invoiceAmount:0,invoiceInfoId:"",invoiceId:"",orderId:"",orderIds:[],title:"",form:{},userCard:{},orderType:"",orderState:"",invoiceState:"",price:"",realName:"",defaultTab:"0",activeNames:["1"],loading:!1,open:!1,dialogTableVisible:!1,openPay:!1,openLogistics:!1,openInvoice:!1,openReview:!1,openAdd:!1,selections:[],isConfirm:"0",productSelections:[],step2Data:[],step2SubTotal:"",operations:[{label:"添加",name:"add",type:"primary",class:"show"},{label:"刷新",name:"refresh",type:""},{label:"导出",name:"export",type:""},{label:"合并发票",name:"mergerInvoice",type:"",disabled:!0}],filters:[{type:"select",label:"状态",name:"state",value:"",options:[{value:"",label:"全部"},{value:"2",label:"商家已确认"},{value:"3",label:"买家已付款"},{value:"4",label:"订单已执行"},{value:"5",label:"交易完成"},{value:"6",label:"订单关闭"},{value:"7",label:"已评价"},{value:"8",label:"已过期"},{value:"9",label:"退款退货中"},{value:"10",label:"退款退货完成"},{value:"12",label:"部分支付"},{value:"13",label:"部分发货"}]},{type:"daterange",label:"创建日期",name:"publishDate",value:[]},{type:"input",label:"",placeholder:"请输入订单编号/条码",name:"searchValue",value:""}],tableData:[],gridData:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizPopupTabs:r["a"],BizFlexTable:l["c"],vueEasyPrint:m["a"],LogisticsFollowing:f["a"],OrderInfo:g["a"],PayInfo:k,InvoiceInfo:F,MyEvaluate:A["a"],AddStep2:W,AddStep3:de,OrderChildInfo:Ce},created:function(){this.getList(),this.queryKpi(),this.getShopList()},mounted:function(){this.getIsEdit()},mixins:[_e["a"]],watch:{},computed:Object(o["a"])(Object(o["a"])({},Object(u["c"])("Authority",["currentAuth"])),{},{hasAuthCopy:function(){return this.currentAuth.includes("admin:PurchaseSaleStorage.product")},showInvoice:function(){var e=["service","product","car","general","rescue","couponOrder"];return-1!==e.indexOf(this.$route.params.orderType)}}),methods:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(u["c"])(["getUser"])),Object(u["d"])("Order",["updateOrderInfo","updateOrderId","updateApplySaleItem","updateClickItemSelect"])),{},{operate:function(e){this[e]()},getIsEdit:function(){var e=this;d["a"].get("/admin/invoicing/config/setting.jhtml",{shopId:this.getUser().shop.id}).then((function(t){"0"===t.saleOrder?e.operations[0].class="hidden":e.operations[0].class="show"})).catch((function(t){t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){}))},copy:function(e){this.productList=e,this.showProductCopyOrder=!0},colseDialog:function(){this.showProductCopyOrder=!1,this.$router.push({path:"/invoicing/agency/agency-purchase-order",query:{}})},add:function(){this.itemId="",this.tabName="addinfo",this.step2=!0,this.step3=!1,this.openAdd=!0},step2Confirm:function(e,t){this.step2=!1,this.step3=!0,this.step2Data=e,this.step2SubTotal=t},step3Confirm:function(e,t){this.tabName="payinfo",this.orderId=e,this.openAdd=!1,this.amountPaid="0.00",this.amount=t,this.amountPayable=t,this.openPay=!0},stepToTwo:function(){var e=this;this.step2=!0,this.step3=!1,this.$nextTick((function(){e.$refs.step2.query()}))},refresh:function(){this.flag=!0,this.getList()},close:function(){this.openInvoice=!1,this.getList()},operationSuccess:function(){this.openPay=!1,this.openReview=!1,this.getList()},operateSuccess:function(){var e=this;this.openPay=!1,this.openReview=!1;var t={orderId:this.$route.query.id||"",dateType:"createTime",searchValue:this.filters[2].value,orderType:this.orderType,state:this.filters[0].value,beginTime:this.filters[1].value[0]?this.filters[1].value[0]+" 00:00:00":"",endTime:this.filters[1].value[1]?this.filters[1].value[1]+" 23:59:59":"",pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};d["a"].get(p["g"].hypermarketMgmt.purchaseOrderListAgent,t).then((function(t){e.tableData=t.dataList,e.pagination.total=Number(t.total),e.loading=!1,e.productList=e.tableData[0]})).catch((function(t){e.$message.warning(t.errorMessage),e.loading=!1}))},onChangeDateType:function(e){switch(e){case"今日订单":this.filters[1].value=[h["a"].today(),h["a"].today()];break;case"近一周订单":this.filters[1].value=[h["a"].getBeforeWeek(),h["a"].today()];break;case"近一月订单":this.filters[1].value=[h["a"].getPreOneMonthDay(),h["a"].today()];break;case"近三月订单":this.filters[1].value=[h["a"].getPreThreeMonthDay(),h["a"].today()];break;default:this.filters[1].value=[];break}this.getList()},closeTabByLogistics:function(e){var t=this;this.open=!1,this.tabName="loginfo",this.sn=e,this.openPay=!1,this.openLogistics=!0,this.$nextTick((function(){t.$refs.logistics.getLogisticsInfo()}))},closeTabByEvaluate:function(e,t){var i=this;this.open=!1,this.tabName="reviewinfo",this.itemId="","5"!==t&&(this.editable=!1),this.openReview=!0,this.$nextTick((function(){i.$refs.reviewinfo.getOrderInfo(e)}))},formatDate:function(e){var t=new Date(e),i=t.getFullYear(),a=t.getMonth()+1,s=t.getDate(),n=i+"-"+(a<10?"0"+a:a)+"-"+(s<10?"0"+s:s);return n},complate:function(e){this.openAdd=!1,this.getList()},print:function(){this.$refs.easyPrint.print()},printExport:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,a,s,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i={orderId:e.orderId},t.prev=1,t.next=4,Ie.a.post("/admin/purchaseOrder/voucher/export/Purchase.jhtml",i,{responseType:"blob"});case 4:return a=t.sent,console.log("response => ",a),s=new Blob([a.data],{type:"application/vnd.ms-excel"}),n=decodeURI(a.headers["content-disposition"].split("filename=")[1]),o=document.createElement("a"),o.download=n.match(/"(\S*)"/)[1],o.style.display="none",o.href=URL.createObjectURL(s),document.body.appendChild(o),o.click(),URL.revokeObjectURL(o.href),document.body.removeChild(o),t.abrupt("return");case 19:throw t.prev=19,t.t0=t["catch"](1),new Error(t.t0);case 22:case"end":return t.stop()}}),t,null,[[1,19]])})))()},mergerInvoice:function(){var e=this;this.orderIds=[],this.invoiceAmount=0,this.selections.forEach((function(t){e.orderIds.push(t.id),e.invoiceAmount=Number(e.invoiceAmount)+Number(t.amount)})),this.tabName="invoiceinfo",this.openInvoice=!0},certificate:function(e){var t=this;window.dType="purchaseOrder",c["a"].certificate({orderId:e.id,shopId:window.top.SHOP_ID||""},(function(i){t.dialogTableVisible=!0,t.title=t.getUser().shop?t.getUser().shop.name+"采购单":"采购单",t.form=i.order,t.orderId=e.id,t.realName=i.adminCurrent?i.adminCurrent.realName:"",t.userCard=i.userCard,t.gridData=i.order.orderItems}),(function(e){t.loading=!1,t.$message.warning(e.errorMessage)}))},setting:function(){this.$refs.settingInfo.getList(),this.openSetting=!0},export:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,a,s,n,o,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=[],e.selections&&e.selections.length>0&&e.selections.forEach((function(e){i.push(e.id)})),a={ids:i,dateType:"createTime",searchValue:e.filters[2].value,orderType:e.orderType,state:e.filters[0].value,beginTime:e.filters[1].value[0]?e.filters[1].value[0]+" 00:00:00":"",endTime:e.filters[1].value[1]?e.filters[1].value[1]+" 23:59:59":"",pageNumber:e.pagination.currentPage,pageSize:e.pagination.pageSize},t.prev=3,t.next=6,Ie.a.post("/admin/purchaseOrder/agent/order/export.jhtml",a,{responseType:"blob"});case 6:return s=t.sent,console.log("response => ",s),n=new Blob([s.data],{type:"application/vnd.ms-excel"}),o=decodeURI(s.headers["content-disposition"].split("filename=")[1]),r=document.createElement("a"),r.download=o.match(/"(\S*)"/)[1],r.style.display="none",r.href=URL.createObjectURL(n),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r),t.abrupt("return");case 21:throw t.prev=21,t.t0=t["catch"](3),new Error(t.t0);case 24:case"end":return t.stop()}}),t,null,[[3,21]])})))()},rowClick:function(e,t,i){var a=this;this.tabName="info",this.orderState=e.state,this.mergeState=e.isMerged,this.itemId=e.id,this.open=!0,this.price=e.price,this.$nextTick((function(){a.$refs.info.getOrderInfo()}))},getShopList:function(){var e=this;this.loading=!0;var t={};d["a"].get("/admin/admin/manageShops.jhtml",t).then((function(t){e.shopList=t.dataList,e.shop=e.shopList[0].id,e.loading=!1})).catch((function(t){"店铺不存在"!==t.errorMessage&&e.$message.warning(t.errorMessage),e.loading=!1}))},getList:function(){var e=this;this.loading=!0;var t={orderId:this.$route.query.id||"",dateType:"createTime",searchValue:this.filters[2].value,orderType:this.orderType,state:this.filters[0].value,beginTime:this.filters[1].value[0]?this.filters[1].value[0]+" 00:00:00":"",endTime:this.filters[1].value[1]?this.filters[1].value[1]+" 23:59:59":"",pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};d["a"].get(p["g"].hypermarketMgmt.purchaseOrderListAgent,t).then((function(t){if(e.tableData=t.dataList,e.pagination.total=Number(t.total),e.$route.query.isShowDialog&&"0"===e.getUser().agent.grade&&e.hasAuthCopy){var i=e;setTimeout((function(){i.productList=e.tableData[0],i.showProductCopyOrder=!0}),500)}e.loading=!1})).catch((function(t){e.$message.warning(t.errorMessage),e.loading=!1}))},queryKpi:function(){var e=this,t={shopId:window.top.SHOP_ID||""};d["a"].get("/admin/purchaseOrder/agent/queryAgentPurchaseKpi.jhtml",t).then((function(t){e.$message({customClass:"motorists-club-activity__kpi",showClose:!0,message:"今日新增".concat(t.data.dayNewAdd,"条，待发货").concat(t.data.waitDeliver,"条"),duration:3e3})})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},paymentHandler:function(e){this.tabName="payinfo",this.orderId=e.id,this.openLogistics=!1,this.openReview=!1,this.openInvoice=!1,this.amountPaid=e.amountPaid,this.amount=e.amountPayable,this.amountPayable=e.amountPayable,this.openPay=!0},logisticsHandler:function(e){var t=this;this.tabName="loginfo",this.sn=e.shippings[0].sn,this.orderId=e.id,this.openPay=!1,this.openReview=!1,this.openInvoice=!1,this.openLogistics=!0,this.$nextTick((function(){t.$refs.logistics.getLogisticsInfo()}))},invoiceHandler:function(e){this.tabName="invoiceinfo",this.orderId=e.id,this.invoiceAmount=Number(e.amount),this.updateOrderInfo(e),this.updateClickItemSelect(!0),this.openPay=!1,this.openLogistics=!1,this.openReview=!1,this.openInvoice=!0},review:function(e){this.tabName="reviewinfo",this.orderId=e.id,this.openPay=!1,this.openLogistics=!1,this.openInvoice=!1,this.openReview=!0},confirmOrder:function(e){var t=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var i={clientType:"2",methodName:"UpdateOrder",shopId:t.getUser().shop.id,userId:t.getUser().id,orderId:e.id,type:"1"};d["a"].put(p["g"].hypermarketMgmt.purchaseOrder,i).then((function(e){t.$message.success("操作成功"),t.getList()})).catch((function(e){t.$message.warning(e.errorMessage),t.loading=!1})).finally((function(){}))}))},closeOrder:function(e){this.itemId=e.id,this.showCloseOrder=!0,this.curSelectCloseReason="",this.closeDeccription=""},cancelClose:function(){this.showCloseOrder=!1,this.showProductCopyOrder=!1,this.$router.push({path:"/invoicing/agency/agency-purchase-order",query:{}})},confirmCopy:function(){this.isConfirm="1",this.confirm(),this.showConfirm=!1},confirm:function(){var e=this;if(0!==this.productSelections.length)if(""!==this.shop){this.loading=!0;var t=[];this.productSelections.map((function(e){t.push(e.product.id)}));var i={shopIds:[this.shop],ids:t,isConfirmed:this.isConfirm};d["a"].post("/admin/shopProduct/purchse/clone.jhtml",i).then((function(t){e.$message.success("操作成功"),e.showProductCopyOrder=!1,e.$router.push({path:"/invoicing/agency/agency-purchase-order",query:{}}),e.loading=!1})).catch((function(t){e.showConfirm=!0,e.loading=!1})).finally((function(){}))}else this.$message.warning("请选择店铺");else this.$message.warning("请选择商品")},confirmClose:function(){var e=this;if(this.curSelectCloseReason){this.showCloseOrder=!1,this.loading=!0;var t={clientType:"2",methodName:"UpdateOrder",shopId:this.getUser().shop.id,userId:this.getUser().id,orderId:this.itemId,type:0,content:this.curSelectCloseReason};d["a"].put(p["g"].hypermarketMgmt.purchaseOrder,t).then((function(t){e.$message.success("操作成功"),e.loading=!1,e.getList()})).catch((function(t){e.$message.warning(t.errorMessage),e.loading=!1})).finally((function(){}))}else this.$message.warning("请选择关闭理由")},handleSelectionChange:function(e){this.operations[3].disabled=!0,this.selections=e,e.length>0&&(this.operations[3].disabled=!1)},productSelectionChange:function(e){this.productSelections=e},filterDataChange:function(e){this.pagination.currentPage=1,this.refresh()},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()},getOrderStatus:function(e){switch(e.state){case"13":return"部分发货";case"12":return"部分支付";case"11":return"卖家已发货";case"10":return"退款退货完成";case"9":return"退款退货中";case"8":return"已过期";case"7":return"已评价";case"6":return"订单关闭";case"5":return"交易完成";case"4":return"订单已执行";case"3":return"买家已付款";case"2":return"商家已确认";case"1":return"待商家确认";default:return"无"}}})},Oe=Se,ke=(i("7e21"),Object(S["a"])(Oe,a,s,!1,null,null,null));t["default"]=ke.exports},"443b":function(e,t,i){"use strict";i("4de4");var a=i("c596"),s=i("1ab1"),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{"append-to-body":"",visible:e.visible,title:"自定义列","custom-class":"biz-columns",width:"500px"},on:{close:e.onClose}},[i("div",{staticClass:"columns-wrap"},[i("biz-flex-table",{ref:"table",attrs:{checkable:!1,tableData:e.tableData},on:{"selection-change":e.selectionChangeHandler}},[i("el-table-column",{attrs:{type:"selection",width:"50",selectable:e.getSelectable}}),i("el-table-column",{attrs:{label:"信息",prop:"name"}}),i("el-table-column",{attrs:{prop:"tag",label:"排序"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[i("el-button",{attrs:{icon:"el-icon-sort-up",type:"text",disabled:0===a},on:{click:function(t){return e.onUp(a)}}}),i("el-button",{attrs:{icon:"el-icon-sort-down",type:"text",disabled:a===e.tableData.length-1},on:{click:function(t){return e.onBottom(a)}}})]}}])})],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.onClose}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确 定")])],1)])},o=[],r=(i("7db0"),i("a434"),i("b85c")),l=i("04d3"),c={name:"biz-columns",components:{BizFlexTable:l["c"]},props:{visible:Boolean,tableId:String},data:function(){return{id:"",tableName:"",selections:[],tableData:[]}},computed:{},watch:{visible:function(e){e?this.makeRowDisplayable():this.saveSelection()},tableId:function(){this.getTableColumns()}},mounted:function(){this.getTableColumns()},methods:{getTableColumns:function(){var e=this;s["a"].get(a["g"].user.columns,{tableId:this.tableId}).then((function(t){e.tableData=t.data.columnDatas,e.id=t.data.id,e.tableName=t.data.tableName}))},getSelectable:function(e){return e.isEditable},selectionChangeHandler:function(e){this.selections=e},saveSelection:function(){var e,t=this,i=Object(r["a"])(this.tableData);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.displayable=!1}}catch(l){i.e(l)}finally{i.f()}var s,n=Object(r["a"])(this.selections);try{var o=function(){var e=s.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(n.s();!(s=n.n()).done;)o()}catch(l){n.e(l)}finally{n.f()}},onUp:function(e){this.tableData[e]=this.tableData.splice(e-1,1,this.tableData[e])[0]},onBottom:function(e){this.tableData[e]=this.tableData.splice(e+1,1,this.tableData[e])[0]},onClose:function(){this.$emit("update:visible",!1)},update:function(){var e,t=this,i=Object(r["a"])(this.tableData);try{for(i.s();!(e=i.n()).done;){var n=e.value;n.displayable=!1}}catch(u){i.e(u)}finally{i.f()}var o,l=Object(r["a"])(this.selections);try{var c=function(){var e=o.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(l.s();!(o=l.n()).done;)c()}catch(u){l.e(u)}finally{l.f()}var d={columnDatas:this.tableData,id:this.id,tableId:this.tableId,tableName:this.tableName};console.log(d),s["a"].put(a["g"].user.columns,d).then((function(e){t.$emit("update"),t.$emit("update:visible",!1)}))},makeRowDisplayable:function(){var e=this;setTimeout((function(){var t,i=Object(r["a"])(e.tableData);try{for(i.s();!(t=i.n()).done;){var a=t.value;e.$refs.table.$refs.table.toggleRowSelection(a,a.displayable)}}catch(s){i.e(s)}finally{i.f()}}),20)}}},d=c,u=(i("ec6b"),i("2877")),p=Object(u["a"])(d,n,o,!1,null,null,null),m=p.exports,h=m;t["a"]={components:{BizColumnOperation:l["a"],BizColumns:h},data:function(){return{columnsSettingVisible:!1,columns:[]}},created:function(){this.getTableId(),this.getColumns()},methods:{onCustomColumns:function(){this.columnsSettingVisible=!0},getColumns:function(){var e=this;console.log(12),s["a"].get(a["A"].columns,{tableId:this.tableId}).then((function(t){e.columns=[],setTimeout((function(){e.columns=t.data.columnDatas.filter((function(e){return e.displayable})),e.$refs.table&&setTimeout((function(){e.$refs.table.doLayout()}),50)}),20)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getTableId:function(){}}}},"4d38":function(e,t,i){},5945:function(e,t,i){"use strict";var a=i("7ff6"),s=i.n(a);s.a},"697f":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:e.title,visible:e.dialogVisible,"append-to-body":e.appendToBody},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close,open:e.open}},[e._t("top"),i("biz-flex-table",{ref:"table",attrs:{showTable:e.showTable,operations:e.operations,filters:e.filters,tags:e.tags,rowKeys:e.rowKeys,pagination:e.pagination,tableData:e.tableData,rowClassName:e.rowClassName,loading:e.loading,memberIds:e.memberIds,checkable:e.checkable,isDepotOutNew:e.isDepotOutNew,checkedTable:e.checkedTable},on:{operate:e.operate,"row-click":e.rowClick,"filter-data-change":e.filterDataChange,"select-all":e.handleSelectAll,select:e.handleSelectionChange,"size-change":e.pageSizeChange,"current-change":e.currentPageChange,"cascader-change":e.cascaderChange,"active-item-change":e.activeItemChange,"sort-change":e.handleSortChange}},[e._t("default")],2),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isClear?i("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v("清除")]):e._e(),i("el-button",{attrs:{size:"small"},on:{click:e.close}},[e._v("取消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmed}},[e._v("确定")])],1)],2)},s=[],n=(i("99af"),i("4160"),i("c975"),i("a434"),i("a9e3"),i("159b"),i("04d3")),o={name:"BizDialogSelector",components:{BizFlexTable:n["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},max:{type:Number,default:0},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},isClear:{default:!0,type:Boolean},rowClassName:{type:Function,default:function(){return null}},selectionKeys:{type:Array,default:function(){return[]}},memberIds:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},isDepotOut:{type:Boolean,default:function(){return!1}},checkTable:{type:Array,default:function(){return[]}},showTable:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],isDepotOutNew:!1,checkedTable:[],innerSelection:[]}},methods:{rowKeys:function(e){return e.id},generateSelectionKeys:function(e,t){if(e.indexOf(t)>=0)this.innerSelectionKeys.push(t[this.keyField]),this.innerSelection.push(t);else{var i=this.innerSelectionKeys.indexOf(t[this.keyField]);this.innerSelectionKeys.splice(i,1),this.innerSelection.splice(i,1)}},open:function(e){this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(e){this.innerSelectionKeys=[],this.innerSelection=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){if(this.innerSelectionKeys.length>0||!this.showTable){if(!this.showTable&&!/(http|https):\/\/([\w.]+\/?)\S*/.test(this.filters[2].value))return void this.$message.warning("必须以http,https开头,且需符合URL规范,检查格式是否正确");this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1}else this.$message("请选择一项")},clear:function(){var e=this;this.tableData.forEach((function(t){e.$refs.table.toggleRowSelection(t,!1)})),this.innerSelectionKeys=[],this.innerSelection=[]},updateSelection:function(){var e=this;this.$refs&&this.$refs.table&&this.tableData.forEach((function(t){e.innerSelectionKeys.indexOf(t[e.keyField])>=0?(e.$refs.table.toggleRowSelection(t,!0),"single"===e.selectionMode&&(e.$refs.table.$refs.table.setCurrentRow(t),e.innerSelection=[t])):e.$refs.table.toggleRowSelection(t,!1)}))},operate:function(e){this.$emit("operate",e)},filterDataChange:function(e){this.$emit("filterDataChange",e)},handleSelectAll:function(e){var t=this;0===e.length?this.tableData.forEach((function(e){var i=t.innerSelectionKeys.indexOf(e[t.keyField]);i>=0&&t.innerSelectionKeys.splice(i,1)})):this.tableData.forEach((function(e){var i=t.innerSelectionKeys.indexOf(e[t.keyField]);i<0&&t.innerSelectionKeys.push(e[t.keyField])})),this.$emit("selectionChange",e)},handleSelectionChange:function(e,t){this.generateSelectionKeys(e,t),this.$emit("selectionChange",e)},pageSizeChange:function(e){this.$emit("pageSizeChange",e)},currentPageChange:function(e){this.$emit("currentPageChange",e)},cascaderChange:function(e){this.$emit("cascaderChange",e)},activeItemChange:function(e){this.$emit("active-item-change",e)},handleSortChange:function(e){this.$emit("sort-change",e)},rowClick:function(e,t,i){"single"===this.selectionMode&&(this.innerSelectionKeys=[e[this.keyField]],this.innerSelection=[e])}},watch:{visibility:function(e,t){this.dialogVisible=e,this.isDepotOutNew=this.isDepotOut,this.checkedTable=this.checkTable}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){},updated:function(){this.updateSelection()}},r=o,l=(i("0943"),i("2877")),c=Object(l["a"])(r,a,s,!1,null,null,null);t["a"]=c.exports},"6f22":function(e,t,i){},7039:function(e,t,i){var a=i("23e7"),s=i("d039"),n=i("057f").f,o=s((function(){return!Object.getOwnPropertyNames(1)}));a({target:"Object",stat:!0,forced:o},{getOwnPropertyNames:n})},"78b9":function(e,t,i){"use strict";var a=i("dabc"),s=i.n(a);s.a},"7e21":function(e,t,i){"use strict";var a=i("3037"),s=i.n(a);s.a},"7ff6":function(e,t,i){},"9b2e":function(e,t,i){"use strict";var a=i("0a05"),s=i.n(a);s.a},ab54:function(e,t,i){"use strict";var a=i("4d38"),s=i.n(a);s.a},af3f:function(e,t,i){"use strict";var a=i("697f");t["a"]=a["a"]},b547:function(e,t,i){},b89e:function(e,t,i){e.exports=i.p+"static/img/pic_default_fail.876971c2.png"},d74a:function(e,t,i){"use strict";var a=i("21c5"),s=i.n(a);s.a},d91f:function(e,t,i){"use strict";var a=i("dfba"),s=i.n(a);s.a},dabc:function(e,t,i){},dfba:function(e,t,i){},ec6b:function(e,t,i){"use strict";var a=i("b547"),s=i.n(a);s.a},f3ac:function(e,t,i){e.exports=i.p+"static/img/pic_default_none_100.6603f4ac.png"},fc46:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"my-evaluate"},[i("div",{staticClass:"evaluate-content"},[e.orderInfo&&e.reviews.length?i("div",e._l(e.orderInfo.orderItems,(function(t,a){return i("div",{key:a,staticClass:"my-evaluate-div"},[i("div",{staticClass:"order-info"},[i("div",{staticClass:"info"},[i("img",{attrs:{src:t.thumbnail?t.thumbnail:e.defaultImg},on:{error:e.errorHandle}}),i("div",{staticClass:"info-right"},[i("span",[e._v(e._s(t.name))]),i("span",[e._v("￥"+e._s(e.getAmount(t)))])])])]),e.editable&&t.product?i("div",{staticClass:"evaluate"},[i("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[i("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px",padding:"0px 30px"}}),i("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),i("el-radio-group",{staticStyle:{height:"10px"},attrs:{horizontal:!0},model:{value:e.reviews[a].score,callback:function(t){e.$set(e.reviews[a],"score",t)},expression:"reviews[index].score"}},e._l(e.options,(function(e,t){return i("el-radio",{key:t,attrs:{label:e}})})),1)],1),i("el-input",{attrs:{type:"textarea",size:"mini",placeholder:"来分享您的使用感受吧...",maxlength:e.maxlength},model:{value:e.reviews[a].content,callback:function(t){e.$set(e.reviews[a],"content",t)},expression:"reviews[index].content"}}),i("img-uploader",{model:{value:e.reviews[a].images,callback:function(t){e.$set(e.reviews[a],"images",t)},expression:"reviews[index].images"}})],1):e._e(),!e.editable&&t.product?i("div",{staticClass:"evaluate-dis"},[i("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[i("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px"}}),i("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),i("span",[e._v(e._s(e.reviews[a].score?e.已reviews[a].score:""))])]),i("div",{staticClass:"eva-content"},[i("p",{staticStyle:{"margin-bottom":"10px","margin-left":"20px"}},[e._v(e._s(e.reviews[a].content?e.reviews[a].content:"很遗憾，您没有留下任何评价。"))]),i("div",{staticClass:"img-group",staticStyle:{"margin-left":"20px"}},e._l(e.reviews[a].images,(function(t,s){return i("div",{key:s,staticClass:"img-eva"},[t?i("img",{attrs:{src:t},on:{click:function(t){return e.handleImagePreview(e.reviews[a].images,s)}}}):e._e()])})),0)])]):e._e()])})),0):e._e(),i("div",{staticClass:"shop-evaluate"},[i("div",{staticClass:"shop-title"},[i("img",{attrs:{src:e.iconShop}}),i("span",{staticStyle:{fontSize:"14px"}},[e._v("店铺评分")])]),i("div",{staticClass:"shop-item"},[i("span",{staticClass:"label"},[e._v("服务态度")]),i("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.serValue,callback:function(t){e.serValue=t},expression:"serValue"}})],1),i("div",{staticClass:"shop-item"},[i("span",{staticClass:"label"},[e._v("服务速度")]),i("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.speedValue,callback:function(t){e.speedValue=t},expression:"speedValue"}})],1),i("div",{staticClass:"shop-item"},[i("span",{staticClass:"label"},[e._v("专业技能")]),i("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.proValue,callback:function(t){e.proValue=t},expression:"proValue"}})],1)])]),e.editable?i("div",{staticClass:"submit"},[i("span",{staticClass:"btn-submit",on:{click:e.submitEvaluate}},[e._v("提交评价")])]):e._e()])},s=[],n=(i("4160"),i("d81d"),i("a434"),i("a9e3"),i("b680"),i("d3b7"),i("25f0"),i("159b"),i("b85c")),o=i("5530"),r=i("2f62"),l=i("1ab1"),c=i("c596"),d=i("624d"),u=i.n(d),p=i("517a"),m=i.n(p),h=i("2119"),f=i("f606"),g=i.n(f),b={name:"my-evaluate",data:function(){return{iconShop:g.a,defaultImg:u.a,defaultFailImg:m.a,selected:"好评",options:["好评","中评","差评"],evaluateValue:"",maxlength:100,serValue:5,speedValue:5,proValue:5,reviews:[],info:null,initialIndex:0}},props:{orderId:{type:String,default:""},editable:{type:Boolean,default:function(){return!0}}},components:{ImgUploader:h["a"]},computed:Object(o["a"])(Object(o["a"])({},Object(r["c"])("Order",["orderInfo"])),Object(r["c"])(["getUser"])),watch:{orderId:function(e,t){this.getParams(),this.getOrderInfo()}},methods:Object(o["a"])(Object(o["a"])({},Object(r["d"])("Order",["updateOrderInfo"])),{},{showToast:function(e){this.$createToast({time:1e3,txt:e,type:"warn"}).show()},images:function(e){var t,i=[],a=Object(n["a"])(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;i.push(s)}}catch(o){a.e(o)}finally{a.f()}return i},handleImagePreview:function(e,t){var i=this;this.initialIndex=t;var a=[];e.map((function(e){a.push(e)}));var s={$props:{imgs:a,initialIndex:"initialIndex",loop:!1},$events:{change:function(e){i.initialIndex=e}}};this.$createImagePreview(Object(o["a"])({},s)).show()},getAmount:function(e){var t=Number(e.price)*Number(e.quantity);return t.toFixed(2)},submitEvaluate:function(){for(var e=this,t={serviceAttitude:this.serValue.toString(),serviceSpeed:this.speedValue.toString(),professional:this.proValue.toString(),methodName:"CreateProductReview",clientType:"2",shopId:this.getUser.shop.id,orderId:this.orderInfo.id,userId:this.getUser.id},i=this.orderInfo.orderItems,a=i.length,s=this.reviews,n=!1,o=0;o<a;o++){if(s[o]&&("好评"===s[o].score?(s[o].score="5",n=!0):"中评"===s[o].score?(s[o].score="3",n=!0):"差评"===s[o].score&&(s[o].score="1",n=!0)),!n&&i[o].product)return void this.$message.warning("请选择商品评分");i[o].product&&(s[o].images=this.images(s[o].images))}i.forEach((function(e,t){if(!e.product)return s.splice(t,1),!1})),n&&(t.reviews=this.reviews),l["a"].post(c["g"].hypermarketMgmt.review,t).then((function(t){e.$message.success("评价成功"),e.$emit("operationSuccess")})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){}))},errorHandle:function(e){e.currentTarget.src=this.defaultFailImg},getOrderInfo:function(e){var t=this;this.open=!1;var i="";i=e||this.orderId;var a={clientType:this.clientType,methodName:"QueryOrderDetail",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:i};l["a"].get(c["g"].hypermarketMgmt.queryOrder,a).then((function(e){console.log("订单信息",e);var a,s,n=e.order.orderItems,o=n.length;for(t.reviews=[],s=0;s<o;s++)a={score:"",content:"",reviewOrderId:e.order.id,images:[]},n[s].product&&(a.productId=n[s].product.id),t.reviews.push(a);t.editable?t.updateOrderInfo(e.order):(t.info=e.order,t.getEvaluationInfo(i))})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))},getParams:function(){this.editable=!0},getEvaluationInfo:function(e){var t=this,i={clientType:this.clientType,methodName:"QueryOrderReview",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:e};l["a"].get(c["g"].hypermarketMgmt.reviews,i).then((function(e){if(console.log(e),t.serValue=parseInt(e.serviceAttitude),t.speedValue=parseInt(e.serviceSpeed),t.proValue=parseInt(e.professional),e.reviews.length!==t.reviews.length){var i={score:"",content:"",images:[]};e.reviews.unshift(i)}t.reviews=e.reviews;for(var a=t.reviews,s=a.length,n=0;n<s;n++)"5"===a[n].score?a[n].score="好评":"3"===a[n].score?a[n].score="中评":"1"===a[n].score&&(a[n].score="差评");t.updateOrderInfo(t.info)})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))}}),created:function(){}},v=b,y=(i("9b2e"),i("2877")),C=Object(y["a"])(v,a,s,!1,null,null,null);t["a"]=C.exports}}]);