(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73fd963f"],{"0f3f":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"mine__base-info"},[a("biz-header",{attrs:{operations:e.operations},on:{operate:e.handleOperate}}),a("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:20}},[a("el-col",{attrs:{xs:20,sm:18,md:18,lg:18,xl:18}},[a("el-card",[a("div",{staticClass:"title"},[e._v("账号信息")]),a("el-row",{attrs:{gutter:20}},[a("el-col",[a("el-form",{ref:"form",attrs:{size:"small","label-width":"110px",model:e.formModel,rules:e.rules}},[a("el-form-item",{attrs:{label:"用户头像"}},[a("BizAvatarUploaderNew",{on:{uploadSuccess:e.uploadSuccess},model:{value:e.formModel.head,callback:function(t){e.$set(e.formModel,"head",t)},expression:"formModel.head"}})],1),a("el-form-item",{attrs:{label:"用户名"}},[a("span",{staticStyle:{color:"#606266"}},[e._v(e._s(e.formModel.userName))])]),a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{model:{value:e.formModel.name,callback:function(t){e.$set(e.formModel,"name",t)},expression:"formModel.name"}})],1),a("el-form-item",{attrs:{label:"手机",prop:"mobile"}},[a("el-input",{model:{value:e.formModel.mobile,callback:function(t){e.$set(e.formModel,"mobile",t)},expression:"formModel.mobile"}})],1),e.formModel.shop&&e.formModel.shop.name?a("el-form-item",{attrs:{label:"默认店铺",prop:"defaultShop"}},[a("el-radio-group",{on:{change:e.shopChange},model:{value:e.formModel.shop.id,callback:function(t){e.$set(e.formModel.shop,"id",t)},expression:"formModel.shop.id"}},e._l(e.formModel.manageShops,(function(t,o){return a("el-radio-button",{key:o,attrs:{label:t.id}},[e._v(" "+e._s(t.name))])})),1)],1):e._e()],1)],1)],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{xs:20,sm:18,md:18,lg:18,xl:18}},[a("el-card",[a("div",{staticClass:"title"},[e._v("店内信息")]),a("el-row",{attrs:{gutter:20}},[a("el-col",[a("el-form",{attrs:{size:"small","label-width":"110px",model:e.formModel}},[a("el-form-item",{attrs:{label:"角色"}},e._l(e.formModel.roleDatas,(function(t){return a("span",{key:t.id,staticStyle:{"margin-right":"20px",color:"#606266"}},[e._v(e._s(t.name))])})),0),a("el-form-item",{attrs:{label:"状态"}},[a("span",[e._v(e._s("1"===e.formModel.isEnabled?"启用":"停用"))])]),a("el-form-item",{attrs:{label:"所属运营商"}},e._l(e.formModel.companyName,(function(t,o){return a("span",{key:o,staticStyle:{"margin-right":"20px",color:"#606266"}},[e._v(e._s(t))])})),0),e.formModel.shop&&e.formModel.shop.name?a("el-form-item",{attrs:{label:"所属店铺"}},[a("span",{staticStyle:{color:"#606266"}},[e._v(e._s(e.formModel.shop.name))])]):e._e(),a("el-form-item",{attrs:{label:"功能权限"}},[a("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},e._l(e.authorityList,(function(t,o){return a("el-tab-pane",{key:t.id,staticClass:"role-pane",attrs:{label:t.name,name:String(o)}},[a("el-tree",{ref:"tree",refInFor:!0,attrs:{"node-key":"id",props:e.treeProps,data:t.children}})],1)})),1)],1)],1)],1)],1)],1)],1)],1)],1)},r=[],n=(a("99af"),a("4160"),a("d81d"),a("d3b7"),a("159b"),a("5530")),l=a("b85c"),i=a("f36f"),s=a("04d3"),c=a("c17f"),d=a("c596"),f=a("1ab1"),u=a("2f62"),m={treeProps:{label:"name",children:"children"},activeTab:"0",authorityList:[],operations:[{label:"保存",name:"save",type:"primary"}]},h=function(){return{shop:{},head:"/resources/admin/images/Avatar.png"}},p={data:{defaultAvatar:"/resources/admin/images/Avatar.png",loading:!1,formModel:h()},events:{handleOperate:function(e){this[e]()}},methods:{query:function(){var e=this;f["a"].get(d["r"].baseInfo.profile,{}).then((function(t){e.loading=!0,e.formModel=t.content,e.formModel.head=t.content.head||e.defaultAvatar;for(var a=function(a){t.content.shop.id===t.content.manageShops[a].id&&(e.authorityList=e.formatAuthList(t.content.manageShops[a].authorityTree),e.authorityList.forEach((function(e,o){var r=[];e.children&&(e.children.forEach((function(e,o){var n,i=Object(l["a"])(t.content.manageShops[a].authorities);try{for(i.s();!(n=i.n()).done;){var s=n.value;e.id===s.id&&r.push(e)}}catch(d){i.e(d)}finally{i.f()}if(e.children){var c=[];e.children.forEach((function(e,o){var r,n=Object(l["a"])(t.content.manageShops[a].authorities);try{for(n.s();!(r=n.n()).done;){var i=r.value;e.id===i.id&&c.push(e)}}catch(d){n.e(d)}finally{n.f()}if(e.children){var s=[];e.children.forEach((function(e,o){var r,n=Object(l["a"])(t.content.manageShops[a].authorities);try{for(n.s();!(r=n.n()).done;){var i=r.value;e.id===i.id&&s.push(e)}}catch(d){n.e(d)}finally{n.f()}})),e.children=s}})),e.children=c}})),e.children=r)})))},o=0;o<t.content.manageShops.length;o++)a(o)})).catch((function(t){e.loading=!1,console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},formatAuthList:function(e){var t=e.concat(),a=function e(t){t.forEach((function(t){t.keyword;var a=[],o=["child","authorities","subAuthority"];for(var r in o)t[o[r]]&&(a=a.concat(t[o[r]]),delete t[o[r]]);a.length&&(t.children=a,e(t.children))}))};return a(e),console.log(e),t},getAuthList:function(e){},uploadSuccess:function(e){this.$set(this.formModel,"head",e)},shopChange:function(e){var t=this;this.formModel.manageShops.map((function(a){a.id===e&&(t.formModel.roleDatas=a.roles,t.activeTab="0",t.authorityList=t.formatAuthList(a.authorityTree),t.authorityList.forEach((function(e,t){if(e.children){var o=[];e.children.forEach((function(e,t){var r,n=Object(l["a"])(a.authorities);try{for(n.s();!(r=n.n()).done;){var i=r.value;e.id===i.id&&o.push(e)}}catch(c){n.e(c)}finally{n.f()}if(e.children){var s=[];e.children.forEach((function(e,t){var o,r=Object(l["a"])(a.authorities);try{for(r.s();!(o=r.n()).done;){var n=o.value;e.id===n.id&&s.push(e)}}catch(c){r.e(c)}finally{r.f()}if(e.children){var i=[];e.children.forEach((function(e,t){var o,r=Object(l["a"])(a.authorities);try{for(r.s();!(o=r.n()).done;){var n=o.value;e.id===n.id&&i.push(e)}}catch(c){r.e(c)}finally{r.f()}})),e.children=i}})),e.children=s}})),e.children=o}})))}))},resetModel:function(){this.formModel=this.getDefaultModel()},getDefaultModel:function(){return h()},getSaveParams:function(){var e=this.formModel;return e.roleIds=e.roleDatas.map((function(e){return e.id})),Object.assign({},e)},save:function(){var e=this;this.$refs.form.validate((function(t,a){if(!t)return!1;e.loading=!0,f["a"].put(d["r"].baseInfo.profile,e.getSaveParams()).then((function(t){e.$message.success("保存成功")})).catch((function(t){e.loading=!1,console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))}))}}},g={name:"MineBaseInfo",components:{BizGrid:i["a"],BizHeader:s["d"],BizAvatarUploaderNew:c["b"]},data:function(){var e=this;return Object(n["a"])(Object(n["a"])(Object(n["a"])({},m),p.data),{},{rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号码",trigger:"blur"},{len:11,message:"手机号位数错误",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"手机号格式错误",trigger:"blur"}],defaultShop:[{required:!0,validator:function(t,a,o){e.formModel.shop.id?o():o(new Error("请选择默认店铺"))}}]}})},methods:Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(u["c"])(["getUser"])),p.methods),p.events),created:function(){this.query()}},v=g,b=(a("ea76"),a("2877")),M=Object(b["a"])(v,o,r,!1,null,null,null);t["default"]=M.exports},dd82:function(e,t,a){},ea76:function(e,t,a){"use strict";var o=a("dd82"),r=a.n(o);r.a}}]);