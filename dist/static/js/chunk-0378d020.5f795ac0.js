(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0378d020"],{"2ebd":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"test-test"},[i("canvas",{attrs:{id:"canvas"}})])}],r=(i("96cf"),i("1da1")),o=i("1ab1"),h=(i("99af"),i("cb29"),i("4de4"),i("4160"),i("caad"),i("d81d"),i("b0c0"),i("ac1f"),i("2532"),i("5319"),i("159b"),i("2909")),s=i("d4ec"),c=i("bee2"),l=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"subAuthority";Object(s["a"])(this,t),this.tree=e.concat(),this.childKey=i,this.fontSize=14,this.width=1200,this.height=500,this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx.lineWidth=2,this.ctx.font="".concat(this.fontSize,"px 微软雅黑"),this.depth=this.getDepth(),this.leftNameList=["运营","店铺","客服","个人","系统"],this.rightNameList=["营销","会员","消息","销售","售后","订单"],this.leftTree=new Array(this.depth+1).fill([]),this.rightTree=new Array(this.depth+1).fill([]),this.columnPositionArr=[],this.expandTree(),this.createSideTree(),this.formatNodes()}return Object(c["a"])(t,[{key:"setCanvas",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.canvas,i=this.ctx,n=this.width,a=this.height,r=this.fontSize;e.width=t.width||n,e.height=t.height||a,i.lineWidth=t.lineWidth||2,i.font=t.font||"".concat(r,"px 微软雅黑")}},{key:"toCapitalize",value:function(t){return t.toLowerCase().replace(/( |^)[a-z]/g,(function(t){return t.toUpperCase()}))}},{key:"mapTree",value:function(t){var e=this.childKey,i=function i(n){n.forEach((function(a){t(a,n),a[e]&&i(a[e])}))};i(this.tree)}},{key:"getDepth",value:function(){var t=this.childKey,e=[],i=function i(n,a){n.forEach((function(n){n[t]&&n[t].length&&i(n[t],a+1),n.layer=a,e.push(a)}))};return i(this.tree,0),console.log("depth: ",Math.max.apply(Math,e)),Math.max.apply(Math,e)}},{key:"expandTree",value:function(){var t=this,e=this.childKey,i=this.leftNameList,n=this.rightNameList;this.tree.forEach((function(t){i.includes(t.name)?t.partOf="left":n.includes(t.name)?t.partOf="right":console.error("ERR_UNSORTED: ",t)}));var a=function i(n,a){n.forEach((function(n){n.partOf||(n.partOf=a.partOf||""),n.layer<t.depth&&(n[e]&&n[e].length||(n[e]=[{name:"",layer:n.layer+1,partOf:n.partOf}]),i(n[e],n))}))};a(this.tree),console.log("expanded: ",this.tree)}},{key:"createSideTree",value:function(){var t=this,e=this.fontSize,i=this.height,n=this.depth,a=function(e){"left"===e.partOf?t.leftTree[e.layer]=t.leftTree[e.layer].concat(e):"right"===e.partOf&&(t.rightTree[e.layer]=t.rightTree[e.layer].concat(e))};this.mapTree(a),this.leftTree[n].forEach((function(e,i){e.total=t.leftTree[n].length,e.index=i})),this.rightTree[n].forEach((function(e,i){e.total=t.rightTree[n].length,e.index=i}));var r=Math.max.apply(Math,[this.leftTree[n].length,this.rightTree[n].length])*(e+4);console.log("canvasHeight: ",r),i<r&&(this.setCanvas({height:r}),this.height=r),console.log("leftArr: ",this.leftTree),console.log("rightArr: ",this.rightTree)}},{key:"formatNodes",value:function(){for(var t=this,e=this.ctx,i=this.depth,n=this.height,a=this.childKey,r=function(t){var i=Math.ceil(e.measureText(t.name).width+6);0===t.layer?t.width=i+10:t.width=i},o=function(e,r){var o=t.columnPositionArr[r],h=0;if(e.layer===i)h=n/(e.total+1)*(e.index+1);else{var s=e[a];h=(s[s.length-1].position.y+s[0].position.y)/2}var c={};c.x=o,c.y=h,e.position=c},s=this.depth;s>-1;s--)this.leftTree[s].forEach((function(t){r(t)})),this.rightTree[s].forEach((function(t){r(t)}));var c=this.leftTree.map((function(t){return Math.max.apply(Math,Object(h["a"])(t.map((function(t){return t.width}))))+40})),l=this.rightTree.map((function(t){return Math.max.apply(Math,Object(h["a"])(t.map((function(t){return t.width}))))+40})),f=Math.ceil(e.measureText("V服").width+6+20)+40,u=[].concat(Object(h["a"])(c.reverse()),[f],Object(h["a"])(l)),d=0;u.forEach((function(t){d+=t})),this.setCanvas({width:d}),console.log("canvasWidth: ",d),this.columnPositionArr=u.map((function(t,e){for(var i=0,n=0;n<e;n++)i+=u[n];return i+=t/2,i})),console.log("widthArr: ",u),console.log("columnPositionArr: ",this.columnPositionArr);for(var p=this.depth;p>-1;p--)this.leftTree[p].forEach((function(t){o(t,i-t.layer)})),this.rightTree[p].forEach((function(e){o(e,e.layer+t.leftTree.length+1)}))}},{key:"drawLine",value:function(t,e,i){var n=this.ctx;e.name&&(n.strokeStyle="#000000",n.beginPath(),n.moveTo(Math.floor(t.x),Math.floor(t.y)),n.lineTo(Math.floor(i)||Math.floor((e.x+t.x)/2),Math.floor(t.y)),n.lineTo(Math.floor(i)||Math.floor((e.x+t.x)/2),Math.floor(e.y)),n.lineTo(Math.floor(e.x),Math.floor(e.y)),n.stroke())}},{key:"render",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=this.fontSize,n=this.ctx,a=this.depth,r=this.childKey,o=this.width,s=this.height;n.clearRect(0,0,o,s);var c=function(a){0===a.layer&&(n.strokeStyle="#000000",n.strokeRect(a.position.x-a.width/2,a.position.y-i/2-3-1,a.width,i+3+3)),1===a["is".concat(t.toCapitalize(e))]?n.fillStyle="#ff7300":n.fillStyle="#000000",n.fillText(a.name||"--",a.position.x,a.position.y)};n.textAlign="center",n.textBaseline="middle";for(var l=a;l>-1;l--)this.leftTree[l].forEach((function(e){c(e),e[r]&&e[r].forEach((function(i){var n=e[r].map((function(t){return t.width})),a=Math.max.apply(Math,Object(h["a"])(n));t.drawLine({name:e.name,x:e.position.x-e.width/2,y:e.position.y},{name:i.name,x:i.position.x+i.width/2,y:i.position.y},(i.position.x+a/2+e.position.x-e.width/2)/2)}))})),this.rightTree[l].forEach((function(e){c(e),e[r]&&e[r].forEach((function(i){var n=e[r].map((function(t){return t.width})),a=Math.max.apply(Math,Object(h["a"])(n));t.drawLine({name:e.name,x:e.position.x+e.width/2,y:e.position.y},{name:i.name,x:i.position.x-i.width/2,y:i.position.y},(i.position.x-a/2+e.position.x+e.width/2)/2)}))}));var f={name:"V服",position:{x:this.columnPositionArr[Math.floor(this.columnPositionArr.length/2)],y:this.height/2},layer:0,width:Math.ceil(n.measureText("V服").width+6+20),subAuthority:[].concat(Object(h["a"])(this.leftTree[0]),Object(h["a"])(this.rightTree[0]))},u=function(e){c(e);var i=Math.max.apply(Math,Object(h["a"])(e[r].filter((function(t){return"left"===t.partOf})).map((function(t){return t.width})))),n=Math.max.apply(Math,Object(h["a"])(e[r].filter((function(t){return"right"===t.partOf})).map((function(t){return t.width}))));e[r].forEach((function(a){"left"===a.partOf?t.drawLine({name:e.name,x:e.position.x-e.width/2,y:e.position.y},{name:a.name,x:a.position.x+a.width/2,y:a.position.y},(a.position.x+i/2+e.position.x-e.width/2)/2):t.drawLine({name:e.name,x:e.position.x+e.width/2,y:e.position.y},{name:a.name,x:a.position.x-a.width/2,y:a.position.y},(a.position.x-n/2+e.position.x+e.width/2)/2)}))};u(f)}}]),t}(),f=l,u={name:"",data:function(){return{loading:!1,tree:null,data:[]}},components:{},methods:{},mounted:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i={scope:""},e.next=3,o["a"].get("/admin/function/tree.jhtml",i);case 3:n=e.sent,t.data=n.authorityList,t.tree=new f(t.data),t.tree.render();case 7:case"end":return e.stop()}}),e)})))()},created:function(){}},d=u,p=(i("9868"),i("2877")),y=Object(p["a"])(d,n,a,!1,null,null,null);e["default"]=y.exports},"81d5":function(t,e,i){"use strict";var n=i("7b0b"),a=i("23cb"),r=i("50c4");t.exports=function(t){var e=n(this),i=r(e.length),o=arguments.length,h=a(o>1?arguments[1]:void 0,i),s=o>2?arguments[2]:void 0,c=void 0===s?i:a(s,i);while(c>h)e[h++]=t;return e}},9868:function(t,e,i){"use strict";var n=i("9fdb"),a=i.n(n);a.a},"9fdb":function(t,e,i){},bee2:function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}i.d(e,"a",(function(){return a}))},cb29:function(t,e,i){var n=i("23e7"),a=i("81d5"),r=i("44d2");n({target:"Array",proto:!0},{fill:a}),r("fill")},d4ec:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}i.d(e,"a",(function(){return n}))}}]);