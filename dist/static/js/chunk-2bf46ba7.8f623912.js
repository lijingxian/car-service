(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2bf46ba7"],{"01ce":function(t,e,n){},"0943":function(t,e,n){"use strict";var i=n("1fac"),a=n.n(i);a.a},"1fac":function(t,e,n){},"225d":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{directives:[{name:"show",rawName:"v-show",value:t.tableShow,expression:"tableShow"}],ref:"template"},[t._t("default",[n("span",[t._v("编写你自己的打印区域组件，然后slot插入到vue-easy-print")])],{getChineseNumber:t.getChineseNumber})],2),t.buttonShow?n("button",{class:t.buttonClass,attrs:{type:"button"},on:{click:t.print}},[n("span",[t._v("开始打印")])]):t._e()])},a=[],o=(n("a9e3"),n("d3b7"),n("ac1f"),n("25f0"),n("466d"),n("5319"),n("1276"),{name:"vue-easy-print",components:{},props:{spaceRow:{type:Boolean,default:!1},tableData:{type:Object,default:function(){}},tableShow:{type:Boolean,default:!1},buttonShow:{type:Boolean,default:!1},buttonClass:{type:String,default:"el-button el-button--default"},onePageRow:{type:Number,default:5},beforeCopy:Function,beforePrint:Function},data:function(){return{}},mounted:function(){this.init()},methods:{init:function(){var t=this,e=document.getElementById("easyPrintIframe");e?this.getStyle():(e=document.createElement("iframe"),e.id="easyPrintIframe",e.style.position="fixed",e.style.width="0",e.style.height="0",e.style.top="-100px",window.location.hostname!==document.domain&&navigator.userAgent.match(/msie/i)&&(e.src='javascript:document.write("<head><script>document.domain=\\"'+document.domain+'\\";<\/script></head><body></body>")'),e.onload=function(){t.getStyle()},document.body.appendChild(e))},print:function(){"function"===typeof this.beforeCopy&&this.beforeCopy();var t=document.getElementById("easyPrintIframe");t.contentDocument.body.innerHTML=this.$refs.template.innerHTML,"function"===typeof this.beforePrint&&this.beforePrint(),setTimeout((function(){t.contentWindow.print()}),100)},getStyle:function(){for(var t=document.getElementById("easyPrintIframe"),e="",n=document.querySelectorAll("style"),i=0;i<n.length;i++)e+=n[i].outerHTML;t.contentDocument.head.innerHTML=e;for(var a=document.querySelectorAll("link"),o=0;o<a.length;o++){var s=document.createElement("link");s.setAttribute("rel","stylesheet"),a[o].type?s.setAttribute("type",a[o].type):s.setAttribute("type","text/css"),s.setAttribute("href",a[o].href),s.setAttribute("media","all"),t.contentDocument.head.appendChild(s)}},getChineseNumber:function(t){var e,n,i,a,o,s,r,l,c,u,d,f,p,h,m=99999999999.99,g="零",b="壹",v="贰",y="叁",w="肆",S="伍",C="陆",I="柒",_="捌",D="玖",k="拾",$="佰",N="仟",x="万",z="亿",A="",T="元",E="角",P="分",O="整";if(void 0===t)return"";if(t=t.toString(),""==t)return"";if(null!=t.match(/[^,.\d]/))return"";if(null==t.match(/^((\d{1,3}(,\d{3})*(.((\d{3},)*\d{1,3}))?)|(\d+(.\d+)?))$/))return"";if(t=t.replace(/,/g,""),t=t.replace(/^0+/,""),Number(t)>m)return alert("您输入的金额太大，请重新输入!"),"";if(a=t.split("."),a.length>1?(e=a[0],n=a[1],n=n.substr(0,2)):(e=a[0],n=""),o=new Array(g,b,v,y,w,S,C,I,_,D),s=new Array("",k,$,N),r=new Array("",x,z),l=new Array(E,P),i="",Number(e)>0){for(c=0,u=0;u<e.length;u++)d=e.length-u-1,f=e.substr(u,1),p=d/4,h=d%4,"0"==f?c++:(c>0&&(i+=o[0]),c=0,i+=o[Number(f)]+s[h]),0==h&&c<4&&(i+=r[p]);i+=T}if(""!=n)for(u=0;u<n.length;u++)f=n.substr(u,1),"0"!=f&&(i+=o[Number(f)]+l[u]);return""==i&&(i=g+T),""==n&&(i+=O),i=A+i,i}}}),s=o,r=n("2877"),l=Object(r["a"])(s,i,a,!1,null,null,null),c=l.exports;e["a"]=c},"2b6e":function(t,e,n){"use strict";var i=n("5c34"),a=n.n(i);a.a},"31c4":function(t,e,n){},"3ed3":function(t,e,n){"use strict";var i=n("5467"),a=n.n(i);a.a},"443b":function(t,e,n){"use strict";n("4de4");var i=n("c596"),a=n("1ab1"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{"append-to-body":"",visible:t.visible,title:"自定义列","custom-class":"biz-columns",width:"500px"},on:{close:t.onClose}},[n("div",{staticClass:"columns-wrap"},[n("biz-flex-table",{ref:"table",attrs:{checkable:!1,tableData:t.tableData},on:{"selection-change":t.selectionChangeHandler}},[n("el-table-column",{attrs:{type:"selection",width:"50",selectable:t.getSelectable}}),n("el-table-column",{attrs:{label:"信息",prop:"name"}}),n("el-table-column",{attrs:{prop:"tag",label:"排序"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.$index;return[n("el-button",{attrs:{icon:"el-icon-sort-up",type:"text",disabled:0===i},on:{click:function(e){return t.onUp(i)}}}),n("el-button",{attrs:{icon:"el-icon-sort-down",type:"text",disabled:i===t.tableData.length-1},on:{click:function(e){return t.onBottom(i)}}})]}}])})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.onClose}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.update}},[t._v("确 定")])],1)])},s=[],r=(n("7db0"),n("a434"),n("b85c")),l=n("04d3"),c={name:"biz-columns",components:{BizFlexTable:l["c"]},props:{visible:Boolean,tableId:String},data:function(){return{id:"",tableName:"",selections:[],tableData:[]}},computed:{},watch:{visible:function(t){t?this.makeRowDisplayable():this.saveSelection()},tableId:function(){this.getTableColumns()}},mounted:function(){this.getTableColumns()},methods:{getTableColumns:function(){var t=this;a["a"].get(i["g"].user.columns,{tableId:this.tableId}).then((function(e){t.tableData=e.data.columnDatas,t.id=e.data.id,t.tableName=e.data.tableName}))},getSelectable:function(t){return t.isEditable},selectionChangeHandler:function(t){this.selections=t},saveSelection:function(){var t,e=this,n=Object(r["a"])(this.tableData);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.displayable=!1}}catch(l){n.e(l)}finally{n.f()}var a,o=Object(r["a"])(this.selections);try{var s=function(){var t=a.value;e.tableData.find((function(e){return e.id===t.id})).displayable=!0};for(o.s();!(a=o.n()).done;)s()}catch(l){o.e(l)}finally{o.f()}},onUp:function(t){this.tableData[t]=this.tableData.splice(t-1,1,this.tableData[t])[0]},onBottom:function(t){this.tableData[t]=this.tableData.splice(t+1,1,this.tableData[t])[0]},onClose:function(){this.$emit("update:visible",!1)},update:function(){var t,e=this,n=Object(r["a"])(this.tableData);try{for(n.s();!(t=n.n()).done;){var o=t.value;o.displayable=!1}}catch(d){n.e(d)}finally{n.f()}var s,l=Object(r["a"])(this.selections);try{var c=function(){var t=s.value;e.tableData.find((function(e){return e.id===t.id})).displayable=!0};for(l.s();!(s=l.n()).done;)c()}catch(d){l.e(d)}finally{l.f()}var u={columnDatas:this.tableData,id:this.id,tableId:this.tableId,tableName:this.tableName};console.log(u),a["a"].put(i["g"].user.columns,u).then((function(t){e.$emit("update"),e.$emit("update:visible",!1)}))},makeRowDisplayable:function(){var t=this;setTimeout((function(){var e,n=Object(r["a"])(t.tableData);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.$refs.table.$refs.table.toggleRowSelection(i,i.displayable)}}catch(a){n.e(a)}finally{n.f()}}),20)}}},u=c,d=(n("ec6b"),n("2877")),f=Object(d["a"])(u,o,s,!1,null,null,null),p=f.exports,h=p;e["a"]={components:{BizColumnOperation:l["a"],BizColumns:h},data:function(){return{columnsSettingVisible:!1,columns:[]}},created:function(){this.getTableId(),this.getColumns()},methods:{onCustomColumns:function(){this.columnsSettingVisible=!0},getColumns:function(){var t=this;console.log(12),a["a"].get(i["A"].columns,{tableId:this.tableId}).then((function(e){t.columns=[],setTimeout((function(){t.columns=e.data.columnDatas.filter((function(t){return t.displayable})),t.$refs.table&&setTimeout((function(){t.$refs.table.doLayout()}),50)}),20)})).catch((function(t){t.errorMessage&&console.log(t.errorMessage)}))},getTableId:function(){}}}},5467:function(t,e,n){},5742:function(t,e,n){"use strict";var i=n("01ce"),a=n.n(i);a.a},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,n){var i=n("1d80"),a=n("5899"),o="["+a+"]",s=RegExp("^"+o+o+"*"),r=RegExp(o+o+"*$"),l=function(t){return function(e){var n=String(i(e));return 1&t&&(n=n.replace(s,"")),2&t&&(n=n.replace(r,"")),n}};t.exports={start:l(1),end:l(2),trim:l(3)}},"5b8e":function(t,e,n){"use strict";var i=n("9678"),a=n.n(i);a.a},"5c34":function(t,e,n){},"697f":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:t.title,visible:t.dialogVisible,"append-to-body":t.appendToBody},on:{"update:visible":function(e){t.dialogVisible=e},close:t.close,open:t.open}},[t._t("top"),n("biz-flex-table",{ref:"table",attrs:{showTable:t.showTable,operations:t.operations,filters:t.filters,tags:t.tags,rowKeys:t.rowKeys,pagination:t.pagination,tableData:t.tableData,rowClassName:t.rowClassName,loading:t.loading,memberIds:t.memberIds,checkable:t.checkable,isDepotOutNew:t.isDepotOutNew,checkedTable:t.checkedTable},on:{operate:t.operate,"row-click":t.rowClick,"filter-data-change":t.filterDataChange,"select-all":t.handleSelectAll,select:t.handleSelectionChange,"size-change":t.pageSizeChange,"current-change":t.currentPageChange,"cascader-change":t.cascaderChange,"active-item-change":t.activeItemChange,"sort-change":t.handleSortChange}},[t._t("default")],2),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.isClear?n("el-button",{attrs:{size:"small"},on:{click:t.clear}},[t._v("清除")]):t._e(),n("el-button",{attrs:{size:"small"},on:{click:t.close}},[t._v("取消")]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.confirmed}},[t._v("确定")])],1)],2)},a=[],o=(n("99af"),n("4160"),n("c975"),n("a434"),n("a9e3"),n("159b"),n("04d3")),s={name:"BizDialogSelector",components:{BizFlexTable:o["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},max:{type:Number,default:0},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},isClear:{default:!0,type:Boolean},rowClassName:{type:Function,default:function(){return null}},selectionKeys:{type:Array,default:function(){return[]}},memberIds:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},isDepotOut:{type:Boolean,default:function(){return!1}},checkTable:{type:Array,default:function(){return[]}},showTable:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],isDepotOutNew:!1,checkedTable:[],innerSelection:[]}},methods:{rowKeys:function(t){return t.id},generateSelectionKeys:function(t,e){if(t.indexOf(e)>=0)this.innerSelectionKeys.push(e[this.keyField]),this.innerSelection.push(e);else{var n=this.innerSelectionKeys.indexOf(e[this.keyField]);this.innerSelectionKeys.splice(n,1),this.innerSelection.splice(n,1)}},open:function(t){this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(t){this.innerSelectionKeys=[],this.innerSelection=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){if(this.innerSelectionKeys.length>0||!this.showTable){if(!this.showTable&&!/(http|https):\/\/([\w.]+\/?)\S*/.test(this.filters[2].value))return void this.$message.warning("必须以http,https开头,且需符合URL规范,检查格式是否正确");this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1}else this.$message("请选择一项")},clear:function(){var t=this;this.tableData.forEach((function(e){t.$refs.table.toggleRowSelection(e,!1)})),this.innerSelectionKeys=[],this.innerSelection=[]},updateSelection:function(){var t=this;this.$refs&&this.$refs.table&&this.tableData.forEach((function(e){t.innerSelectionKeys.indexOf(e[t.keyField])>=0?(t.$refs.table.toggleRowSelection(e,!0),"single"===t.selectionMode&&(t.$refs.table.$refs.table.setCurrentRow(e),t.innerSelection=[e])):t.$refs.table.toggleRowSelection(e,!1)}))},operate:function(t){this.$emit("operate",t)},filterDataChange:function(t){this.$emit("filterDataChange",t)},handleSelectAll:function(t){var e=this;0===t.length?this.tableData.forEach((function(t){var n=e.innerSelectionKeys.indexOf(t[e.keyField]);n>=0&&e.innerSelectionKeys.splice(n,1)})):this.tableData.forEach((function(t){var n=e.innerSelectionKeys.indexOf(t[e.keyField]);n<0&&e.innerSelectionKeys.push(t[e.keyField])})),this.$emit("selectionChange",t)},handleSelectionChange:function(t,e){this.generateSelectionKeys(t,e),this.$emit("selectionChange",t)},pageSizeChange:function(t){this.$emit("pageSizeChange",t)},currentPageChange:function(t){this.$emit("currentPageChange",t)},cascaderChange:function(t){this.$emit("cascaderChange",t)},activeItemChange:function(t){this.$emit("active-item-change",t)},handleSortChange:function(t){this.$emit("sort-change",t)},rowClick:function(t,e,n){"single"===this.selectionMode&&(this.innerSelectionKeys=[t[this.keyField]],this.innerSelection=[t])}},watch:{visibility:function(t,e){this.dialogVisible=t,this.isDepotOutNew=this.isDepotOut,this.checkedTable=this.checkTable}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){},updated:function(){this.updateSelection()}},r=s,l=(n("0943"),n("2877")),c=Object(l["a"])(r,i,a,!1,null,null,null);e["a"]=c.exports},7132:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"biz-fade-t"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"biz-popup",on:{click:function(e){return e.target!==e.currentTarget?null:t.close(e)}}},[n("transition",{attrs:{name:"biz-fade-t-right"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"popup-content",style:t.contentStyle},[t._t("default")],2)])],1)])},a=[],o={name:"BizPopup",props:{open:{type:Boolean,default:function(){return!1}},contentStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{close:function(){this.$emit("close")}}},s=o,r=(n("5b8e"),n("2877")),l=Object(r["a"])(s,i,a,!1,null,null,null),c=l.exports,u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"biz-popup-tabs"},[n("biz-popup",{attrs:{open:t.open,contentStyle:t.contentStyle},on:{close:t.close}},[n("el-tabs",{attrs:{type:"border-card",value:t.value},on:{"tab-click":t.tabClick}},[t._t("default")],2)],1)],1)},d=[],f=(n("b0c0"),{name:"BizPopupTabs",data:function(){return{}},props:{open:{type:Boolean,default:!1},value:{type:String,required:!0},contentStyle:{type:Object,default:function(){return{}}}},components:{BizPopup:c},methods:{close:function(){var t=this;this.$confirm("是否保存当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("close")}))},tabClick:function(t){this.$emit("input",t.name)}}}),p=f,h=(n("d4c2"),Object(r["a"])(p,u,d,!1,null,null,null)),m=h.exports;n.d(e,"a",(function(){return m}))},"7ba2":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("biz-grid",{staticClass:"product-info"},[n("div",{attrs:{slot:"top"},slot:"top"},[t.isEdit?n("biz-save-button",{attrs:{operations:t.operations},on:{operate:t.operate}}):t._e(),n("el-form",{attrs:{inline:!0,disabled:!t.isEdit}},[n("el-form-item",{staticClass:"subTotal",attrs:{label:"商品总数:",prop:"productTotal"}},[t._v(t._s(t.productTotal?t.productTotal:"0"))]),n("el-form-item",{staticClass:"subTotal",attrs:{label:"盈亏总数:",prop:"profitTotal"}},[t._v(t._s(t.profitTotal?t.profitTotal:"0"))])],1)],1),n("biz-list",{key:Math.random(),ref:"table",attrs:{tableData:t.tableData,loading:t.loading},on:{handleSelectionChange:t.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"50"}}),n("el-table-column",{attrs:{prop:"fullName",label:"商品","min-width":"100"}}),n("el-table-column",{attrs:{prop:"barCode",label:"条码"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.product&&e.row.product.barCode?e.row.product.barCode:""))]}}])}),n("el-table-column",{attrs:{prop:"amount",label:"账目数量","min-width":"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.amount))]}}])}),n("el-table-column",{attrs:{prop:"inventoryAmount",label:"盘点数量","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return n("div",{},[n("div",{staticClass:"biz-customcol"},[n("el-input-number",{staticStyle:{width:"120px"},attrs:{size:"mini",min:0,disabled:!t.isEdit},on:{input:function(n){return t.amountChange(e.row)}},model:{value:e.row.inventoryAmount,callback:function(n){t.$set(e.row,"inventoryAmount",n)},expression:"scope.row.inventoryAmount"}})],1)])}}])}),n("el-table-column",{attrs:{label:"盈亏",prop:"profit","min-width":"60"}}),t.isEdit?n("el-table-column",{attrs:{prop:"date",label:"操作",type:"index","min-width":"60"},scopedSlots:t._u([{key:"default",fn:function(e){return n("div",{},[n("div",{staticClass:"biz-customcol"},[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return t.deleteHandeler(e.row)}}},[t._v("删除")])],1)])}}],null,!1,3776432633)}):t._e()],1),n("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:t.showDialog,tableData:t.giftList,pagination:t.dialogPagination,filters:t.dialogFilters,selectionKeys:t.selectedGiftIds},on:{"update:visibility":function(e){t.showDialog=e},pageSizeChange:t.dialogPageSizeChange,currentPageChange:t.dialogCurrentPageChange,confirmed:t.confirmedProduct,filterDataChange:t.dialogFilterDataChange,selectionChange:t.selectionChange,"active-item-change":t.activeItemChange,cascaderChange:t.cascaderChange}},[n("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"300px"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"dialog-column"},[n("img",{staticClass:"productImg",attrs:{src:e.row.image||t.DefaultImg,onerror:t.errorImg}}),n("div",{staticClass:"biz-two-row"},[n("div",{staticClass:"titleClass",staticStyle:{"margin-left":"10px"},attrs:{title:e.row.fullName}},[t._v(t._s(e.row.fullName))]),n("div",{staticStyle:{"margin-left":"10px"}},[t._v("编号："+t._s(e.row.sn))])])])]}}])}),n("el-table-column",{attrs:{property:"barCode",label:"条码"}}),n("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),n("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),n("el-table-column",{attrs:{property:"price",label:"价格"}}),n("el-table-column",{attrs:{label:"在库库存"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticStyle:{width:"120px"}},[t._v(t._s(e.row.realStock))])]}}])})],1)],1)},a=[],o=(n("99af"),n("4160"),n("c975"),n("d81d"),n("a434"),n("b0c0"),n("a9e3"),n("d3b7"),n("25f0"),n("159b"),n("b85c")),s=n("5530"),r=n("7558"),l=n("8330"),c=n("f36f"),u=n("2f62"),d=n("c596"),f=n("1ab1"),p=n("af3f"),h=n("f3ac"),m=n.n(h),g={name:"ProductInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},productCategoryId:"",categoryDatas:[],selectedGiftList:[],selectedGiftIds:[],showDialog:!1,DefaultImg:m.a,errorImg:'this.src="'+n("b89e")+'"',dialogFilters:[{type:"cascader",label:"分类",name:"category",filterable:!1,value:[],options:[]},{type:"select",label:"品牌",value:"",options:[]},{type:"input",placeholder:"请输入编号/商品名/条码",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,profitTotal:"",productTotal:"",height:"585",tableData:[],restaurants:[],selections:[],itemDatas:[],dialogTableVisible:!1,storeList:[],selectionList:[],multipleSelection:[],title:"",operations:[{label:"删除",name:"del",type:"",disabled:!0},{label:"新增商品",name:"addProduct",type:"primary"},{label:"保存",name:"save",type:"primary",auth:["admin:check.edit"]}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:r["a"],BizGrid:c["a"],BizSaveButton:l["a"],BizDialogSelector:p["a"]},watch:{itemId:function(t){this.tableData=[],this.productTotal="",this.profitTotal="",this.itemId&&this.getList()}},mounted:function(){var t=document.documentElement.clientHeight||window.innerHeight;this.height=String(t-175)},methods:Object(s["a"])(Object(s["a"])({},Object(u["c"])(["getUser"])),{},{addProduct:function(){this.queryFilters(),this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(t){this.dialogPagination.pageSize=t,this.getGiftList()},dialogCurrentPageChange:function(t){this.dialogPagination.currentPage=t,this.getGiftList()},dialogFilterDataChange:function(t){this.dialogFilters=t,this.dialogPagination.currentPage=1,this.getGiftList()},getGiftList:function(){var t=this,e={productCategoryId:this.productCategoryId,brandId:this.getSelectedBrandId(),pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[2].value,shopId:window.top.SHOP_ID||""};f["a"].get(d["g"].commodity.getCommodityList,e).then((function(e){t.giftList=e.content,t.dialogPagination.total=Number(e.total)})).catch((function(t){t.errorMessage&&console.log(t.errorMessage)}))},selectionChange:function(t){var e=this;t.forEach((function(t){-1===e.selectionList.indexOf(t)&&e.selectionList.push(t)}))},confirmedProduct:function(t){var e=this;this.selectedGiftIds=t.concat(),this.selectedGiftList=[],this.selectionList.map((function(t){-1!==e.selectedGiftIds.indexOf(t.id)&&(e.$set(t,"productName",t.fullName),e.$set(t,"profit","--"),e.$set(t,"amount",t.minimumPackQuantity),e.$set(t,"barCode",t.barCode),e.selectedGiftList.push(t))})),this.selectedGiftList.forEach((function(t){e.handleSelect(t)}))},operate:function(t){this[t]()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},getList:function(){var t=this;this.loading=!0;var e={id:this.itemId,shopId:window.top.SHOP_ID||""};f["a"].get(d["g"].invoicing.inventory.itemList,e).then((function(e){t.tableData=e.itemList,t.productTotal=e.data.totalAmount,t.profitTotal=e.data.profit})).catch((function(t){t.errorMessage&&console.log(t.errorMessage)}))},handleSelect:function(t){var e=!1;if(t.productId=t.id,t.id="",0!==this.tableData.length){for(var n=0;n<this.tableData.length;n++)if(this.tableData[n].productId===t.productId){this.tableData[n].amount=(Number(this.tableData[n].amount)+Number(t.availableStock)).toString(),this.tableData[n].inventoryAmount&&(this.tableData[n].profit=Number(this.tableData[n].inventoryAmount)-Number(this.tableData[n].amount)),e=!0;break}e||this.tableData.push(t)}else this.tableData.push(t)},handleSelectionChange:function(t){console.log(t),this.multipleSelection=t,this.operations[0].disabled=!0,this.multipleSelection.length>0&&(this.operations[0].disabled=!1)},del:function(){var t=this,e=[];this.multipleSelection.map((function(n){n.id?e.push(n.id):t.deleteHandeler(n)})),e.length>0&&(this.loading=!0,f["a"].delete(d["g"].invoicing.inventory.inventoryItem,{ids:e}).then((function(e){t.$message.success("删除成功"),t.$emit("operationSuccess"),t.getList()})).catch((function(e){e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1})))},deleteHandeler:function(t){var e=this;""===t.id?this.tableData.splice(this.tableData.indexOf(t),1):this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,f["a"].delete(d["g"].invoicing.inventory.inventoryItem,{ids:[t.id]}).then((function(t){e.$message.success("删除成功"),e.$emit("operationSuccess"),e.getList()})).catch((function(t){t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))})),this.productTotal=Number(this.productTotal)-Number(t.amount),"--"===t.profit?this.profitTotal=Number(this.profitTotal)-0:this.profitTotal=Number(this.profitTotal)-Number(t.profit)},save:function(){var t=this;this.itemDatas=this.tableData.map((function(e){return{id:e.id,billId:t.itemId,productId:e.productId?e.productId:e.id,amount:e.amount||"",price:e.price||"",depotId:e.depotId||"",depotName:e.depotName||"",productName:e.fullName,categoryId:"",categoryName:"",specId:e.specId||"",specValue:e.specValue||"",inventoryAmount:e.inventoryAmount||"",profit:e.profit||""}}));var e=!1;if(this.tableData.forEach((function(n){-1!==String(n.inventoryAmount).indexOf(".")&&(t.$message.warning("盘点商品数不能为小数"),e=!0)})),e)return!1;var n={id:this.itemId,itemDatas:this.itemDatas};f["a"].post(d["g"].invoicing.inventory.inventoryItem,n).then((function(e){t.$message.success("保存成功"),t.$emit("operationSuccess"),t.getList(),t.loading=!1})).catch((function(e){t.loading=!1,t.getList(),t.$message.warning(e.errorMessage)}))},amountChange:function(t){var e,n=0,i=Object(o["a"])(this.tableData);try{for(i.s();!(e=i.n()).done;){var a=e.value;""===a.inventoryAmount||"undefined"===a.inventoryAmount?(this.$set(a,"profit",""),n+=0):(a.id===t.id&&a.inventoryAmount&&this.$set(a,"profit",Number(a.inventoryAmount)-Number(a.amount)),n+=Number(a.profit))}}catch(s){i.e(s)}finally{i.f()}this.profitTotal=n||""},handleSizeChange:function(t){this.pagination.pageSize=t,this.refresh()},handleCurrentChange:function(t){this.pagination.currentPage=t,this.refresh()},queryFilters:function(){var t=this,e={shopId:window.top.SHOP_ID||""};f["a"].get("/admin/shopProduct/filter.jhtml",e).then((function(e){t.categoryDatas=e.categoryDatas,t.setCategoryFilters(),t.setBrandFilters(e.brandDatas)})).catch((function(){}))},setCategoryFilters:function(){var t=[{value:"",label:"全部"}];this.categoryDatas.forEach((function(e){t.push({value:e.id,label:e.name,children:[{label:"全部",value:""}]})})),this.dialogFilters[0].options=t},setBrandFilters:function(t){this.dialogFilters[1].options=t.map((function(t){return{value:t.id,label:t.name}})),this.dialogFilters[1].options.splice(0,0,{value:"",label:"全部"})},getSelectedBrandId:function(){return this.dialogFilters[1].value},activeItemChange:function(t){var e=this,n={shopId:this.getUser().shop.id,parentId:t.toString()};f["a"].get("/admin/shopProduct/productCategorys.jhtml",n).then((function(n){var i;e.setCategoryFilters(),e.dialogFilters[0].options.forEach((function(e){e.value===t[0]&&(i=e.children)})),n.dateList.forEach((function(t){i.push({value:t.id,label:t.name})}))})).catch((function(){}))},cascaderChange:function(t){this.productCategoryId=t[t.length-1],t.length>1&&""===this.productCategoryId&&(this.productCategoryId=t[t.length-2]),this.getGiftList()}})},b=g,v=(n("3ed3"),n("2877")),y=Object(v["a"])(b,i,a,!1,null,null,null);e["a"]=y.exports},9678:function(t,e,n){},a9e3:function(t,e,n){"use strict";var i=n("83ab"),a=n("da84"),o=n("94ca"),s=n("6eeb"),r=n("5135"),l=n("c6b6"),c=n("7156"),u=n("c04e"),d=n("d039"),f=n("7c73"),p=n("241c").f,h=n("06cf").f,m=n("9bf2").f,g=n("58a8").trim,b="Number",v=a[b],y=v.prototype,w=l(f(y))==b,S=function(t){var e,n,i,a,o,s,r,l,c=u(t,!1);if("string"==typeof c&&c.length>2)if(c=g(c),e=c.charCodeAt(0),43===e||45===e){if(n=c.charCodeAt(2),88===n||120===n)return NaN}else if(48===e){switch(c.charCodeAt(1)){case 66:case 98:i=2,a=49;break;case 79:case 111:i=8,a=55;break;default:return+c}for(o=c.slice(2),s=o.length,r=0;r<s;r++)if(l=o.charCodeAt(r),l<48||l>a)return NaN;return parseInt(o,i)}return+c};if(o(b,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var C,I=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof I&&(w?d((function(){y.valueOf.call(n)})):l(n)!=b)?c(new v(S(e)),n,I):S(e)},_=i?p(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),D=0;_.length>D;D++)r(v,C=_[D])&&!r(I,C)&&m(I,C,h(v,C));I.prototype=y,y.constructor=I,s(a,b,I)}},af3f:function(t,e,n){"use strict";var i=n("697f");e["a"]=i["a"]},b547:function(t,e,n){},b89e:function(t,e,n){t.exports=n.p+"static/img/pic_default_fail.876971c2.png"},becd:function(t,e,n){"use strict";var i=n("31c4"),a=n.n(i);a.a},d4c2:function(t,e,n){"use strict";var i=n("e725"),a=n.n(i);a.a},d6d1:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("biz-grid",{staticClass:"inventory-base-info"},[t.isEdit?n("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operate},slot:"top"}):t._e(),n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small",disabled:!t.isEdit,"inline-message":!0}},[t.itemId?n("el-form-item",{attrs:{label:"编号",prop:"sn"}},[n("el-input",{attrs:{disabled:!0},model:{value:t.form.sn,callback:function(e){t.$set(t.form,"sn",e)},expression:"form.sn"}})],1):t._e(),n("el-form-item",{attrs:{label:"盘点仓库",prop:"depotId"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择盘点仓库",disabled:!!t.itemId},model:{value:t.form.depotId,callback:function(e){t.$set(t.form,"depotId",e)},expression:"form.depotId"}},t._l(t.depotList,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),t.itemId?n("el-form-item",{attrs:{label:"创建者",prop:"creatorName"}},[n("el-input",{attrs:{disabled:!0},model:{value:t.form.creatorName,callback:function(e){t.$set(t.form,"creatorName",e)},expression:"form.creatorName"}})],1):t._e(),t.itemId?n("el-form-item",{attrs:{label:"状态",prop:"state"}},[n("el-input",{attrs:{value:t.stateFormatter,disabled:!0}})],1):t._e(),t.itemId?n("el-form-item",{attrs:{label:"创建时间",prop:"createDate"}},[n("el-input",{attrs:{disabled:!0},model:{value:t.form.createDate,callback:function(e){t.$set(t.form,"createDate",e)},expression:"form.createDate"}})],1):t._e(),n("el-form-item",{attrs:{label:"备注",prop:"remark"}},[n("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1)],1)},a=[],o=(n("d3b7"),n("b85c")),s=n("5530"),r=n("f36f"),l=n("8330"),c=n("2f62"),u=n("1ab1"),d=n("c596"),f=function(){return{depotId:"",remark:"",id:"",shopId:""}},p={name:"baseInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},components:{BizGrid:r["a"],BizSaveButton:l["a"]},data:function(){return{loading:!1,showDialog:!1,dialogVisible:!1,form:f(),depotList:[],itemDatas:[],operations:[{label:"保存",name:"save",type:"primary",auth:["admin:check.edit"]}],rules:{depotId:[{required:!0,message:"请选择盘点仓库",trigger:"blur"}]}}},computed:{stateFormatter:function(){switch(this.form.state){case"0":return"盘点中";case"1":return"盘点完成";case"2":return"已调整";default:return"--"}}},created:function(){this.queryDepotList()},watch:{itemId:function(t){""!==t?this.queryInventory(t):this.form=this.getDefaultModel()}},methods:Object(s["a"])(Object(s["a"])({},Object(c["c"])(["getUser"])),{},{operate:function(t){this[t]()},initModel:function(t){t?this.form=Object.assign(this.getDefaultModel(),t):this.resetModel(),this.$refs.form.resetFields()},resetModel:function(){this.form=this.getDefaultModel()},queryInventory:function(t){var e=this;this.loading=!0,u["a"].get(d["g"].invoicing.inventory.inventory,{shopId:window.top.SHOP_ID||"",id:t}).then((function(t){e.loading=!1,e.initModel(t.data)})).catch((function(t){e.loading=!1,console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},getDefaultModel:function(){return f()},queryDepotList:function(){var t=this;this.loading=!0;var e={shopId:window.top.SHOP_ID||""};u["a"].get(d["g"].invoicing.storeHouseMgmt.shopDepotList,e).then((function(e){var n,i=Object(o["a"])(e.dataList);try{for(i.s();!(n=i.n()).done;){var a=n.value;"1"===a.enabled&&t.depotList.push(a)}}catch(s){i.e(s)}finally{i.f()}})).catch((function(e){console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))},getSaveParams:function(){return{id:this.form.id,depotId:this.form.depotId,remark:this.form.remark,shopId:window.top.SHOP_ID||""}},save:function(){var t=this;this.$refs.form.validate((function(e,n){if(!e)return!1;t.loading=!0,t.form.id?u["a"].put(d["g"].invoicing.inventory.inventory,t.getSaveParams()).then((function(e){t.$message.success("保存成功"),t.$emit("operationSuccess"),t.loading=!1})).catch((function(e){t.loading=!1,t.$message.warning(e.errorMessage)})).finally((function(e){t.loading=!1})):u["a"].post(d["g"].invoicing.inventory.inventory,t.getSaveParams()).then((function(e){t.$message.success("保存成功"),t.$emit("operationSuccess",e.id),t.queryInventory(e.id),t.loading=!1})).catch((function(e){t.loading=!1,t.$message.warning(e.errorMessage)})).finally((function(e){t.loading=!1}))}))}})},h=p,m=(n("5742"),n("2877")),g=Object(m["a"])(h,i,a,!1,null,null,null);e["a"]=g.exports},de82:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"inventory-mgmt"},[n("biz-flex-table",{ref:"table",staticClass:"inventory-mgmt-tabel",attrs:{operations:t.operations,filters:t.filters,tableData:t.tableData,loading:t.loading,pagination:t.pagination},on:{operate:t.operate,"filter-data-change":t.filterDataChange,"selection-change":t.handleSelectionChange,"row-click":t.rowClick,"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}},[n("el-table-column",{attrs:{label:"单据","min-width":"180px"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticStyle:{width:"100%"}},[n("div",{staticClass:"overflow"},[t._v(t._s(e.row.sn))]),n("div",{staticClass:"overflow"},[t._v("创建日期："+t._s(e.row.createDate))]),n("div",{staticClass:"overflow"},[t._v("状态："+t._s(t.getStatus(e.row)))])])]}}])}),n("el-table-column",{attrs:{label:"仓库","min-width":"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticStyle:{width:"100%"}},[n("div",{staticClass:"overflow"},[t._v(t._s(e.row.depotName))])])]}}])}),n("el-table-column",{attrs:{label:"盘点人","min-width":"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticStyle:{width:"100%"}},[n("div",{staticClass:"overflow"},[t._v(t._s(e.row.creatorName))])])]}}])}),n("el-table-column",{attrs:{label:"盘点","min-width":"180px"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticStyle:{width:"100%"}},[n("div",{staticClass:"overflow"},[t._v("盘点商品种类："+t._s(e.row.productAmount))]),n("div",{staticClass:"overflow"},[t._v("已盘点商品种类："+t._s(e.row.inventoryProductAmount))]),n("div",{staticClass:"overflow"},[t._v("盈亏数量："+t._s(e.row.profit?e.row.profit:"--"))])])]}}])}),n("el-table-column",{attrs:{prop:"date",label:"操作","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("biz-column-operation",{attrs:{row:e.row}},["1"===e.row.state&&t.hasAuthAdjust?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return n.stopPropagation(),t.dataChange(e.row)}}},[t._v("调整 ")]):t._e(),"0"===e.row.state&&t.hasAuthComfirm?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return n.stopPropagation(),t.statusChange(e.row,"0")}}},[t._v("完成")]):t._e(),"0"===e.row.state&&t.hasAuthDel?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return n.stopPropagation(),t.deleteApply(n,e.row)}}},[t._v("删除")]):t._e(),n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return n.stopPropagation(),t.printApply(e.row)}}},[t._v("凭证")])],1)]}}])})],1),n("biz-popup-tabs",{attrs:{open:t.open},on:{close:function(e){t.open=!1}},model:{value:t.tabName,callback:function(e){t.tabName=e},expression:"tabName"}},[n("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[n("base-info",{ref:"baseInfo",attrs:{itemId:t.itemId,isEdit:t.isEdit},on:{operationSuccess:t.createdSuccess}})],1),t.isCreate?n("el-tab-pane",{attrs:{label:"商品信息",name:"productinfo"}},[n("product-info",{ref:"productinfo",attrs:{itemId:t.itemId,isEdit:t.isEdit},on:{operationSuccess:t.refresh}})],1):t._e()],1),n("biz-popup-tabs",{attrs:{open:t.openModify},on:{close:function(e){t.openModify=!1}},model:{value:t.isButtonClick,callback:function(e){t.isButtonClick=e},expression:"isButtonClick"}},[n("el-tab-pane",{attrs:{label:"调整信息",name:"modifyinfo"}},[n("modify-info",{ref:"modifyinfo",attrs:{itemId:t.itemId,isEdit:t.isEdit},on:{operationSuccess:t.operationSuccess}})],1)],1),n("el-dialog",{attrs:{visible:t.dialogTableVisible,center:"",width:"800px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[n("el-row",{attrs:{gutter:10}},[n("el-col",{attrs:{span:24}},[n("div",{staticClass:"grid-content bg-purple",attrs:{align:"left"}},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.print}},[t._v("打印")]),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.exportInvoice}},[t._v("导出")])],1)])],1),n("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[n("div",{staticClass:"d-p-wrap"},[n("el-row",{staticClass:"row",attrs:{gutter:10}},[n("div",{staticClass:"p-title"},[t._v(t._s(t.title))])]),n("el-row",{staticClass:"row",attrs:{gutter:10}},[n("el-col",{attrs:{span:24}},[n("div",{staticClass:"grid-content bg-purple",attrs:{align:"center"}},[t._v("打印日期："+t._s(t.formatDate((new Date).getTime())))])])],1),n("el-row",{staticClass:"row-top",attrs:{gutter:10}},[n("el-col",{attrs:{span:14}},[n("div",{staticClass:"grid-content bg-purple"},[t._v("编号："+t._s(t.form.sn))])]),n("el-col",{attrs:{span:10}},[n("div",{staticClass:"grid-content bg-purple"},[t._v("创建时间："+t._s(t.form.createDate))])])],1),n("el-row",{staticClass:"row",attrs:{gutter:10}},[n("el-col",{attrs:{span:14}},[n("div",{staticClass:"grid-content bg-purple"},[t._v("仓库："+t._s(t.form.depotName))])]),n("el-col",{attrs:{span:10}},[n("div",{staticClass:"grid-content bg-purple"},[t._v("创建人："+t._s(t.form.creatorName))])])],1),n("el-row",{staticClass:"row",attrs:{gutter:10}},[n("el-col",{attrs:{span:14}},[n("div",{staticClass:"grid-content bg-purple"},[t._v("状态："+t._s(t.form.state))])]),n("el-col",{attrs:{span:10}},[n("div",{staticClass:"grid-content bg-purple"},[t._v("备注："+t._s(t.form.remark))])])],1),n("el-row",{staticClass:"row",attrs:{gutter:10}},[n("el-col",{attrs:{span:14}},[n("div",{staticClass:"grid-content bg-purple"},[t._v("盘点商品总数："+t._s(t.form.inventoryProductAmount))])]),n("el-col",{attrs:{span:10}},[n("div",{staticClass:"grid-content bg-purple"},[t._v("盈亏总数："+t._s(t.form.profit))])])],1),n("el-table",{staticClass:"table-class",attrs:{data:t.gridData,"show-summary":""}},[n("el-table-column",{attrs:{type:"index",label:"序号"}}),n("el-table-column",{attrs:{property:"productName",label:"商品"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.productName))]}}])}),n("el-table-column",{attrs:{property:"product.barCode",label:"商品条码"}}),n("el-table-column",{attrs:{property:"amount",label:"在库数量"}}),n("el-table-column",{attrs:{property:"inventoryAmount",label:"盘点数量"}}),n("el-table-column",{attrs:{property:"profit",label:"盈亏"}})],1)],1)])],1)],1)},a=[],o=(n("99af"),n("4160"),n("caad"),n("d81d"),n("b0c0"),n("a9e3"),n("d3b7"),n("ac1f"),n("2532"),n("3ca3"),n("466d"),n("1276"),n("159b"),n("ddb0"),n("2b3d"),n("96cf"),n("1da1")),s=n("5530"),r=n("7132"),l=n("04d3"),c=n("d6d1"),u=n("7ba2"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("biz-grid",{staticClass:"modify-info"},[n("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operate},slot:"top"}),n("biz-list",{ref:"table",attrs:{tableData:t.tableData,loading:t.loading}},[n("el-table-column",{attrs:{label:"商品",prop:"productName"}}),n("el-table-column",{attrs:{label:"盈亏",prop:"profit"}}),n("el-table-column",{attrs:{label:"调整数量",prop:"adjustAmount"},scopedSlots:t._u([{key:"default",fn:function(e){return n("div",{},[n("div",{staticClass:"biz-customcol"},[n("el-input-number",{staticStyle:{width:"150px"},attrs:{size:"mini"},model:{value:e.row.adjustAmount,callback:function(n){t.$set(e.row,"adjustAmount",n)},expression:"scope.row.adjustAmount"}})],1)])}}])})],1)],1)},f=[],p=n("b85c"),h=n("7558"),m=n("8330"),g=n("f36f"),b=n("2f62"),v=n("c596"),y=n("1ab1"),w={name:"ModifyInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{loading:!1,tableData:[],operations:[{label:"确认调整",name:"modifiy",type:"primary",auth:["admin:check.edit"]}]}},components:{BizList:h["a"],BizGrid:g["a"],BizSaveButton:m["a"]},methods:Object(s["a"])(Object(s["a"])({},Object(b["c"])(["getUser"])),{},{operate:function(t){this[t]()},refresh:function(t){var e=this;this.loading=!0;var n={id:t,shopId:window.top.SHOP_ID||""};y["a"].get(v["g"].invoicing.inventory.itemList,n).then((function(t){var n,i=Object(p["a"])(t.itemList);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.$set(a,"adjustAmount",a.profit),e.tableData.push(a)}}catch(o){i.e(o)}finally{i.f()}})).catch((function(t){t.errorMessage&&console.log(t.errorMessage)}))},modifiy:function(){var t=this;console.log(this.tableData),this.itemDatas=this.tableData.map((function(e){return{id:e.id||"",billId:t.itemId,productId:e.productId?e.productId:e.id,amount:e.amount||"",productName:e.productName,depotId:e.depotId,depotName:e.depotName,inventoryAmount:e.inventoryAmount||"",profit:e.profit||"",adjustAmount:e.adjustAmount}}));var e=!1;if(this.tableData.forEach((function(n){""===n.adjustAmount&&(t.$message.warning("请填写调整数量！"),e=!0)})),e)return!1;var n={itemDatas:this.itemDatas};y["a"].put(v["g"].invoicing.inventory.adjustInventory,n).then((function(e){t.$message.success("保存成功"),t.$emit("operationSuccess",t.itemId),t.loading=!1})).catch((function(e){t.loading=!1,t.$message.warning(e.errorMessage)}))},updateHeight:function(){var t=this;setTimeout((function(){t.$refs.table.doHeight()}),100)},showMessage:function(t,e){this.$notify({message:t,type:e,showClose:!0})}}),mounted:function(){},watch:{}},S=w,C=(n("becd"),n("2877")),I=Object(C["a"])(S,d,f,!1,null,null,null),_=I.exports,D=n("225d"),k=n("bc3a"),$=n.n(k),N=n("443b"),x={name:"InventoryMgmtList",data:function(){return{tabName:"info",itemId:"",title:"",handler:"",isEdit:!0,isCreate:!1,isButtonClick:"modifyinfo",openModify:!1,form:{},loading:!1,visiable:!1,open:!1,dialogTableVisible:!1,selections:[],operations:[{label:"添加",name:"add",type:"primary",auth:["admin:check.add"]},{label:"删除",name:"delete",type:"",disabled:!0,auth:["admin:check.delete"]},{label:"刷新",name:"refresh",type:""}],filters:[{type:"select",label:"仓库",name:"depot",value:"",options:[]},{type:"select",label:"状态",name:"state",value:"",options:[]},{type:"select",label:"盈亏状态",name:"depotState",value:"",options:[{value:"",label:"全部"},{value:"0",label:"平库"},{value:"1",label:"盘盈"},{value:"2",label:"盘亏"}]},{type:"select",label:"盘点人",name:"people",value:"",options:[]},{type:"input",label:"",placeholder:"请输入盘点单号",name:"searchValue",value:""}],tableData:[],gridData:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:9}}},components:{BizPopupTabs:r["a"],BizFlexTable:l["c"],BaseInfo:c["a"],vueEasyPrint:D["a"],ProductInfo:u["a"],ModifyInfo:_},created:function(){this.getList(),this.queryKpi(),this.queryFilters()},watch:{},mixins:[N["a"]],computed:Object(s["a"])(Object(s["a"])({},Object(b["c"])("Authority",["currentAuth"])),{},{hasAuthComfirm:function(){return this.currentAuth.includes("admin:check.comfirm")},hasAuthDel:function(){return this.currentAuth.includes("admin:check.delete")},hasAuthAdjust:function(){return this.currentAuth.includes("admin:check.adjust")}}),mounted:function(){},methods:Object(s["a"])(Object(s["a"])({},Object(b["c"])(["getUser"])),{},{operate:function(t){this[t]()},operationSuccess:function(t){this.refresh(),this.itemId=""},createdSuccess:function(t){t?(this.itemId=String(t),this.tabName="productinfo",this.isCreate=!0):this.refresh()},refresh:function(){this.getList()},formatDate:function(t){var e=new Date(t),n=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),o=n+"-"+(i<10?"0"+i:i)+"-"+(a<10?"0"+a:a);return o},statusChange:function(t,e){var n=this,i=!1;t.itemDatas.map((function(t){"0"!==t.inventoryAmount&&t.inventoryAmount||(n.$message.warning("请完成盘点后再点击完成"),i=!0)})),i||this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var i={shopId:window.top.SHOP_ID||"",id:t.id,actionType:e};y["a"].get(v["g"].invoicing.inventory.state,i).then((function(t){n.$message.success("操作成功！"),n.refresh()})).catch((function(t){t.errorMessage&&n.$message.warning(t.errorMessage)})).finally((function(){}))}))},deleteApply:function(t,e){t.stopPropagation(),this.deleteItem([e.id])},deleteItem:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,y["a"].delete(v["g"].invoicing.inventory.inventory,{ids:t}).then((function(t){e.$message.success("删除成功"),e.refresh()})).catch((function(t){console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))}))},delete:function(){if(this.selections&&this.selections.length>0){var t=[];this.selections.forEach((function(e){t.push(e.id)})),this.deleteItem(t)}else this.$message("请选择一条数据")},printApply:function(t){var e=this,n={id:t.id};y["a"].get(v["g"].invoicing.inventory.print,n).then((function(t){e.dialogTableVisible=!0,e.title=e.getUser().shop.name+"盘点单",e.form=t.data,"0"===e.form.state?e.form.state="盘点中":"1"===e.form.state?e.form.state="盘点完成":"2"===e.form.state&&(e.form.state="已调整"),e.gridData=t.data.itemDatas,e.loading=!1})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},print:function(){this.$refs.easyPrint.print()},exportInvoice:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n,i,a,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={id:t.form.id},e.prev=1,e.next=4,$.a.post("/admin/invoicing/stock/voucher/depotInventory/export.jhtml",n,{responseType:"blob"});case 4:return i=e.sent,console.log("response => ",i),a=new Blob([i.data],{type:"application/vnd.ms-excel"}),console.log(decodeURI(i.headers["content-disposition"])),o=decodeURI(i.headers["content-disposition"].split("filename=")[1]),s=document.createElement("a"),s.download=o.match(/"(\S*)"/)[1],s.style.display="none",s.href=URL.createObjectURL(a),document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s),e.abrupt("return");case 20:throw e.prev=20,e.t0=e["catch"](1),new Error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[1,20]])})))()},add:function(){this.tabName="info",this.open=!0,this.isCreate=!1,this.itemId="",this.isEdit=!0,this.$refs.baseInfo.resetModel()},rowClick:function(t,e,n){var i=this;this.tabName="info",this.open=!0,this.isCreate=!0,this.$nextTick((function(){i.itemId=t.id})),"0"===t.state?this.isEdit=!0:this.isEdit=!1},dataChange:function(t){var e=this;this.itemId=t.id,this.isButtonClick="modifyinfo",this.openModify=!0,this.$nextTick((function(){e.$refs.modifyinfo.refresh(t.id)}))},getList:function(){var t=this,e={pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage,shopId:window.top.SHOP_ID||"",depotId:this.filters[0].value,userId:this.filters[3].value,state:this.filters[1].value,depotState:this.filters[2].value,searchValue:this.filters[4].value};this.loading=!0,y["a"].get(v["g"].invoicing.inventory.list,e).then((function(e){console.log(e),t.tableData=e.dataList,t.pagination.total=Number(e.total),t.loading=!1})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))},queryKpi:function(){var t=this,e={shopId:window.top.SHOP_ID||""};y["a"].get("/admin/invoicing/stock/queryShopDepotInventoriesKpi.jhtml",e).then((function(e){t.$message({customClass:"motorists-club-activity__kpi",showClose:!0,message:"今日新增".concat(e.data.dayNewAdd,"条，待完成").concat(e.data.processing,"条"),duration:3e3})})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))},queryFilters:function(){var t=this,e={shopId:window.top.SHOP_ID||""};y["a"].get(v["g"].invoicing.inventory.queryFilters,e).then((function(e){t.filters[0].options=[{label:"全部",value:""}].concat(e.depotList.map((function(t){return{label:t.name,value:t.id}}))),t.filters[3].options=[{label:"全部",value:""}].concat(e.creatorList.map((function(t){return{label:t.name,value:t.id}}))),t.filters[1].options=[{label:"全部",value:""}].concat(e.stateList.map((function(t){return{label:t.name,value:t.id}})))})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)})).finally((function(t){}))},getStatus:function(t){switch(t.state){case"0":return"盘点中";case"1":return"盘点完成";case"2":return"已调整";default:return"--"}},handleSelectionChange:function(t){this.selections=t,this.operations.map((function(t){"delete"===t.name&&(t.disabled=!0)})),t.length>0&&this.operations.map((function(t){"delete"===t.name&&(t.disabled=!1)}))},filterDataChange:function(t){this.filters=t,this.pagination.currentPage=1,this.refresh()},handleSizeChange:function(t){this.pagination.pageSize=t,this.refresh()},handleCurrentChange:function(t){this.pagination.currentPage=t,this.refresh()}})},z=x,A=(n("2b6e"),Object(C["a"])(z,i,a,!1,null,null,null));e["default"]=A.exports},e725:function(t,e,n){},ec6b:function(t,e,n){"use strict";var i=n("b547"),a=n.n(i);a.a},f3ac:function(t,e,n){t.exports=n.p+"static/img/pic_default_none_100.6603f4ac.png"}}]);