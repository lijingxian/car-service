(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-63e795dd"],{5369:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"distributor-mgmt"},[n("biz-flex-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{operations:e.operations,tableData:e.tableData,checkable:!1},on:{operate:e.operate,"row-click":e.rowClick}},[n("el-table-column",{attrs:{prop:"name",label:"关怀卡分类名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return n("div",{},[n("div",{staticClass:"biz-customcol"},[e._v(e._s(t.row.name))])])}}])}),n("el-table-column",{attrs:{prop:"description",label:"关怀卡分类描述"}}),n("el-table-column",{attrs:{width:"200",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"biz-customcol"},[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){n.stopPropagation(),0!==t.$index&&e.moveUp(t.$index)}}},[e._v("上移")]),n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){n.stopPropagation(),t.$index!==e.tableData.length-1&&e.moveDown(t.$index)}}},[e._v("下移 ")]),e.hasAuthDel?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return n.stopPropagation(),e.deleteHandler(t.row.id)}}},[e._v("删除")]):e._e()],1)]}}])})],1),n("biz-popup-tabs",{attrs:{open:e.open},on:{close:function(t){e.open=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[n("el-tab-pane",{attrs:{label:"基本信息",name:"baseinfo"}},[n("base-info",{ref:"baseInfo",attrs:{itemId:e.itemId},on:{refresh:e.refresh}})],1)],1)],1)},r=[],i=(n("caad"),n("d3b7"),n("2532"),n("96cf"),n("1da1")),o=n("5530"),s=n("04d3"),c=n("7132"),u=n("2f62"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("biz-grid",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"base-info"},[n("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),n("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"150px",size:"small","inline-message":!0}},[n("el-form-item",{attrs:{label:"关怀卡分类名称：",prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入分类名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"分类描述："}},[n("el-input",{attrs:{placeholder:"请输入分类描述",type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)},d=[],m=(n("a4d3"),n("e01a"),n("b0c0"),n("8330")),f=n("f36f"),p=n("1ab1"),b=n("c596"),h=function(){return{id:"",name:"",description:""}},g={name:"BaseInfo",components:{BizSaveButton:m["a"],BizGrid:f["a"]},props:{itemId:{type:Object,default:function(){return{id:""}}}},data:function(){return{loading:!1,operations:[{label:"保存",name:"save",type:"primary",auth:["admin:member.memberCare.category.edit"]}],form:h(),rules:{name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5A-z0-9]+$/,message:"分类名称只能由中文/英文/数字组成",trigger:"blur"}]}}},computed:{},watch:{itemId:function(e){this.$refs.form.clearValidate(),this.form=h(),""!==e.id&&this.refresh()}},created:function(){},methods:{operate:function(e){this[e]()},refresh:function(){var e=this,t={id:this.itemId.id};this.loading=!0,p["a"].get(b["g"].memberCareMgmt.categoryCard,t).then((function(t){e.form=Object.assign({},h(),t.data)})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},create:function(){var e=this;this.loading=!0;var t={name:this.form.name,description:this.form.description};p["a"].post(b["g"].memberCareMgmt.categoryCard,t).then((function(t){e.$message.success("操作成功"),e.$emit("refresh",t.data.id)})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},update:function(){var e=this;this.loading=!0;var t={id:this.itemId.id,name:this.form.name,description:this.form.description};p["a"].put(b["g"].memberCareMgmt.categoryCard,t).then((function(t){e.$message.success("操作成功"),e.$emit("refresh")})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},save:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;e.itemId.id?e.update():e.create()}))}}},v=g,w=(n("f7b0"),n("2877")),y=Object(w["a"])(v,l,d,!1,null,null,null),x=y.exports,$={name:"CategoryMgmt",components:{BizFlexTable:s["c"],BizPopupTabs:c["a"],BaseInfo:x},props:{},data:function(){return{itemId:{id:""},loading:!1,tableData:[],dataList:[],open:!1,tabName:"baseinfo",operations:[{label:"添加",name:"add",type:"primary",auth:["admin:member.memberCare.category.add"]}]}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(u["c"])(["getUser"])),Object(u["c"])("Authority",["currentAuth"])),{},{hasAuthDel:function(){return this.currentAuth.includes("admin:member.memberCare.category.delete")},hasAuthEdit:function(){return this.currentAuth.includes("admin:member.memberCare.category.edit")}}),watch:{},created:function(){this.getList()},methods:{operate:function(e){this[e]()},refresh:function(e){e&&(this.itemId={id:e}),this.getList()},add:function(){this.tabName="baseinfo",this.open=!0,this.itemId={id:""}},rowClick:function(e){this.itemId={id:e.id},this.open=!0},moveUp:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.loading=!0,n.next=3,t.switchRow(e-1,e);case 3:t.loading=!1;case 4:case"end":return n.stop()}}),n)})))()},moveDown:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.loading=!0,n.next=3,t.switchRow(e,e+1);case 3:t.loading=!1;case 4:case"end":return n.stop()}}),n)})))()},switchRow:function(e,t){var n=this,a=this.tableData[e],r=this.tableData[t],i=[{id:a.id,order:r.order},{id:r.id,order:a.order}];return new Promise((function(s,c){p["a"].put(b["g"].memberCareMgmt.changeOrder,i).then((function(i){n.$set(n.tableData,e,Object(o["a"])(Object(o["a"])({},r),{},{order:a.order})),n.$set(n.tableData,t,Object(o["a"])(Object(o["a"])({},a),{},{order:r.order})),console.log("tableData: ",n.tableData),s()})).catch((function(e){c(e)}))}))},deleteHandler:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.$confirm("确认删除?","提示",{type:"warning"});case 3:a={ids:[e]},p["a"].delete(b["g"].memberCareMgmt.categoryCard,a).then((function(e){t.$message.success("删除成功"),t.refresh()})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_DELETE: ",e)})),n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](0),console.log("取消删除");case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()},getList:function(){var e=this,t=this.getUser.shop&&this.getUser.shop.id||window.top.SHOP_ID||"",n={shopId:t,pageNumber:1,pageSize:1e3};p["a"].get(b["g"].memberCareMgmt.categoryList,n).then((function(t){e.tableData=t.dataList})).catch()}}},C=$,z=(n("a3ab"),Object(w["a"])(C,a,r,!1,null,null,null));t["default"]=z.exports},"5b8e":function(e,t,n){"use strict";var a=n("9678"),r=n.n(a);r.a},7132:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"biz-fade-t"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.open,expression:"open"}],staticClass:"biz-popup",on:{click:function(t){return t.target!==t.currentTarget?null:e.close(t)}}},[n("transition",{attrs:{name:"biz-fade-t-right"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.open,expression:"open"}],staticClass:"popup-content",style:e.contentStyle},[e._t("default")],2)])],1)])},r=[],i={name:"BizPopup",props:{open:{type:Boolean,default:function(){return!1}},contentStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{close:function(){this.$emit("close")}}},o=i,s=(n("5b8e"),n("2877")),c=Object(s["a"])(o,a,r,!1,null,null,null),u=c.exports,l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"biz-popup-tabs"},[n("biz-popup",{attrs:{open:e.open,contentStyle:e.contentStyle},on:{close:e.close}},[n("el-tabs",{attrs:{type:"border-card",value:e.value},on:{"tab-click":e.tabClick}},[e._t("default")],2)],1)],1)},d=[],m=(n("b0c0"),{name:"BizPopupTabs",data:function(){return{}},props:{open:{type:Boolean,default:!1},value:{type:String,required:!0},contentStyle:{type:Object,default:function(){return{}}}},components:{BizPopup:u},methods:{close:function(){var e=this;this.$confirm("是否保存当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$emit("close")}))},tabClick:function(e){this.$emit("input",e.name)}}}),f=m,p=(n("d4c2"),Object(s["a"])(f,l,d,!1,null,null,null)),b=p.exports;n.d(t,"a",(function(){return b}))},"84e9":function(e,t,n){},9678:function(e,t,n){},a3ab:function(e,t,n){"use strict";var a=n("84e9"),r=n.n(a);r.a},ae99:function(e,t,n){},d4c2:function(e,t,n){"use strict";var a=n("e725"),r=n.n(a);r.a},e725:function(e,t,n){},f7b0:function(e,t,n){"use strict";var a=n("ae99"),r=n.n(a);r.a}}]);