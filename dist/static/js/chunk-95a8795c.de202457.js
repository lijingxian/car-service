(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-95a8795c"],{"07ac":function(e,t,i){var a=i("23e7"),o=i("6f53").values;a({target:"Object",stat:!0},{values:function(e){return o(e)}})},2497:function(e,t,i){"use strict";var a=i("4360"),o=i("a18c");t["a"]=function(e,t){return function(i){var s=i.data;"100"===s.resultCode?e(s):"709"===s.resultCode?(a["a"].commit("updateUser",{shop:{}}),console.log("未登录: ",a["a"].getters.currentUser),o["a"].push("/login")):t(s)}}},"4b44":function(e,t,i){"use strict";var a=i("c7d0"),o=i.n(a);o.a},"4caf":function(e,t,i){"use strict";var a=i("2497"),o=i("bc3a"),s=i.n(o),n=i("c596");t["a"]={add:function(e,t,i){s.a.get(n["g"].staffMgmt.adminAdd,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},get:function(e,t,i){s.a.get(n["g"].staffMgmt.adminSelect,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},create:function(e,t,i){s.a.post(n["g"].staffMgmt.adminCreate,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},save:function(e,t,i){s.a.put(n["g"].staffMgmt.adminEdit,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getCompanies:function(e,t,i){s.a.get(n["g"].staffMgmt.getCompanyList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getShops:function(e,t,i){s.a.get(n["g"].staffMgmt.getShopList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getChildShops:function(e,t,i){s.a.get(n["g"].staffMgmt.getChildShopList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getAllRoles:function(e,t,i){s.a.get(n["g"].staffMgmt.getAllRoles,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},editPass:function(e,t,i){s.a.put(n["g"].staffMgmt.editPass,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))}}},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,i){var a=i("1d80"),o=i("5899"),s="["+o+"]",n=RegExp("^"+s+s+"*"),r=RegExp(s+s+"*$"),l=function(e){return function(t){var i=String(a(t));return 1&e&&(i=i.replace(n,"")),2&e&&(i=i.replace(r,"")),i}};e.exports={start:l(1),end:l(2),trim:l(3)}},"5b8e":function(e,t,i){"use strict";var a=i("9678"),o=i.n(a);o.a},"6f53":function(e,t,i){var a=i("83ab"),o=i("df75"),s=i("fc6a"),n=i("d1e7").f,r=function(e){return function(t){var i,r=s(t),l=o(r),c=l.length,d=0,m=[];while(c>d)i=l[d++],a&&!n.call(r,i)||m.push(e?[i,r[i]]:r[i]);return m}};e.exports={entries:r(!0),values:r(!1)}},7132:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"biz-fade-t"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.open,expression:"open"}],staticClass:"biz-popup",on:{click:function(t){return t.target!==t.currentTarget?null:e.close(t)}}},[i("transition",{attrs:{name:"biz-fade-t-right"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.open,expression:"open"}],staticClass:"popup-content",style:e.contentStyle},[e._t("default")],2)])],1)])},o=[],s={name:"BizPopup",props:{open:{type:Boolean,default:function(){return!1}},contentStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{close:function(){this.$emit("close")}}},n=s,r=(i("5b8e"),i("2877")),l=Object(r["a"])(n,a,o,!1,null,null,null),c=l.exports,d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"biz-popup-tabs"},[i("biz-popup",{attrs:{open:e.open,contentStyle:e.contentStyle},on:{close:e.close}},[i("el-tabs",{attrs:{type:"border-card",value:e.value},on:{"tab-click":e.tabClick}},[e._t("default")],2)],1)],1)},m=[],h=(i("b0c0"),{name:"BizPopupTabs",data:function(){return{}},props:{open:{type:Boolean,default:!1},value:{type:String,required:!0},contentStyle:{type:Object,default:function(){return{}}}},components:{BizPopup:c},methods:{close:function(){var e=this;this.$confirm("是否保存当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$emit("close")}))},tabClick:function(e){this.$emit("input",e.name)}}}),p=h,u=(i("d4c2"),Object(r["a"])(p,d,m,!1,null,null,null)),f=u.exports;i.d(t,"a",(function(){return f}))},7652:function(e,t,i){"use strict";var a=i("cf1c"),o=i.n(a);o.a},9386:function(e,t,i){"use strict";var a=i("e81b"),o=i.n(a);o.a},9678:function(e,t,i){},a37c:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"staff-mgmt-admin-mgmt"},[i("biz-flex-table",{attrs:{operations:e.operations,filters:e.filters,tableData:e.tableData,pagination:e.pagination},on:{operate:e.operate,"filter-data-change":e.filterDataChange,"selection-change":e.handleSelectionChange,"row-click":e.rowClick,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"sort-change":e.handleSortChange}},[i("el-table-column",{attrs:{"min-width":"160",prop:"info",label:"用户信息"},scopedSlots:e._u([{key:"default",fn:function(t){return i("div",{},[i("div",{staticClass:"customer-info"},[i("img",{attrs:{src:t.row.head?t.row.head:e.Img,alt:""}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"title"},[e._v(e._s(t.row.name))]),i("div",{staticClass:"gender"},["0"===t.row.gender?i("i",{staticClass:"male iconfont biz-icon-i-web-m"}):e._e(),"1"===t.row.gender?i("i",{staticClass:"female iconfont biz-icon-i-web-f"}):e._e(),"2"===t.row.gender?i("i",{staticClass:"none iconfont biz-icon-i-web-bm"}):e._e(),i("span",[e._v(e._s(t.row.mobile))])])])])])}}])}),i("el-table-column",{attrs:{"min-width":"80",prop:"roleDatas",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{width:"100%"}},[i("div",{staticClass:"overflow"},[e._v(" "+e._s(e.roleFormatter(t.row))+" ")])])]}}])}),i("el-table-column",{attrs:{prop:"isEnabled",label:"状态","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{style:{color:e.stateColor(t.row)}},[e._v(e._s("1"===t.row.isEnabled?"启用":"停用"))])]}}])}),i("el-table-column",{attrs:{prop:"isEnabled",label:"关联门店","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{width:"100%"}},[i("div",{staticClass:"overflow"},[e._v(e._s(t.row.supplier?t.row.supplier.name:""))]),i("div",{staticClass:"overflow"},[e._v(e._s(t.row.agent?t.row.agent.name:""))])])]}}])}),i("el-table-column",{attrs:{prop:"shop.name",label:"所属店铺","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{width:"100%"}},[i("div",{staticClass:"overflow"},[e._v(" "+e._s(t.row.shop.name)+" ")])])]}}])}),i("el-table-column",{attrs:{prop:"shop.name",label:"登录信息","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{width:"100%"}},[i("div",{staticClass:"overflow"},[e._v(" 最后登录地址："+e._s("null"===t.row.loginAddress?"":t.row.loginAddress)+" ")]),i("div",{staticClass:"overflow"},[e._v(" 最后登录时间："+e._s(t.row.loginDate)+" ")])])]}}])}),i("el-table-column",{attrs:{prop:"option",label:"操作","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return"1"===t.row.unionConfig.editable||"shop"!==e.getUser.roleLevel?[e.hasAuthDel?i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){return i.stopPropagation(),e.del(t.row.masterId)}}},[e._v("删除")]):e._e()]:void 0}}],null,!0)})],1),i("biz-popup-tabs",{attrs:{open:e.open},on:{close:e.close},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[i("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[i("base-info",{ref:"baseInfo",attrs:{isEdit:e.isEdit,itemId:e.currentRowId,shopId:e.shopId?e.shopId:"",type:e.type},on:{created:e.refresh}})],1),""!==e.currentRowId?i("el-tab-pane",{attrs:{label:"修改密码",name:"second"}},[i("pass-modify",{attrs:{id:e.currentRowId,isEdit:e.isEdit,masterId:e.masterId},on:{created:e.refresh}})],1):e._e()],1),i("biz-popup-tabs",{staticClass:"add-member-popup",attrs:{open:e.openAdd},on:{close:function(t){e.openAdd=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[i("el-tab-pane",{attrs:{label:"注册新用户",name:"first"}},[i("base-info",{ref:"addBaseInfo",attrs:{isEdit:e.isEdit,id:e.currentRowId,shopId:e.shopId?e.shopId:"",type:e.type},on:{created:e.refresh}})],1),i("el-tab-pane",{attrs:{label:"选择已注册用户",name:"second"}},[i("select-member",{ref:"selectMember",attrs:{isEdit:e.isEdit,id:e.currentRowId,shopId:e.shopId?e.shopId:"",type:e.type},on:{created:e.refresh}})],1)],1)],1)},o=[],s=(i("99af"),i("caad"),i("a15b"),i("d81d"),i("b0c0"),i("a9e3"),i("2532"),i("5530")),n=i("7132"),r=i("04d3"),l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"staff-mgmt-admin-mgmt-base-info"},[e.isEdit?i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small",disabled:!e.isEdit,"inline-message":!0}},[i("el-form-item",{attrs:{label:"用户名",prop:"userName",error:e.errUserName}},[i("el-input",{attrs:{placeholder:"请输入用户名",disabled:""!==e.id},model:{value:e.form.userName,callback:function(t){e.$set(e.form,"userName",t)},expression:"form.userName"}})],1),i("el-form-item",{attrs:{label:"姓名",prop:"name",error:e.errName}},[i("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"性别",prop:"gender"}},[i("el-radio-group",{model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[i("el-radio",{attrs:{label:"0"}},[e._v("男")]),i("el-radio",{attrs:{label:"1"}},[e._v("女")]),i("el-radio",{attrs:{label:"2"}},[e._v("保密")])],1)],1),i("el-form-item",{attrs:{label:"手机",prop:"mobile",error:e.errorMobile}},[i("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1),""===e.id?i("el-form-item",{attrs:{label:"密码",prop:"pass"}},[i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{type:"password",name:"pwd"}}),i("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"请输入6-16位密码"},model:{value:e.form.pass,callback:function(t){e.$set(e.form,"pass",t)},expression:"form.pass"}})],1):e._e(),""===e.id?i("el-form-item",{attrs:{label:"确认密码",prop:"checkpass"}},[i("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"再次确认密码"},model:{value:e.form.checkpass,callback:function(t){e.$set(e.form,"checkpass",t)},expression:"form.checkpass"}})],1):e._e(),i("el-form-item",{attrs:{label:"用户头像",prop:"head"}},[e.isEdit?i("biz-avatar-uploader-new",{model:{value:e.form.head,callback:function(t){e.$set(e.form,"head",t)},expression:"form.head"}}):e._e(),e.isEdit?e._e():i("img",{attrs:{src:e.form.head,width:"80px",height:"80px"}})],1),i("el-form-item",{staticClass:"isRequired",attrs:{label:"所属运营商",prop:"company"}},[i("el-select",{attrs:{placeholder:"请选择运营商",disabled:""!==this.id&&""!==this.form.companyId||"1"!==this.isOperatorAdminFlg||"operator"!==this.type&&""!==this.type,clearable:""},on:{change:e.listChange1},model:{value:e.list[0],callback:function(t){e.$set(e.list,0,t)},expression:"list[0]"}},e._l(e.companyList1,(function(e){return i("el-option",{key:e.index,attrs:{label:e.name,value:e.id}})})),1),0!==e.companyList2.length?i("el-select",{attrs:{placeholder:"请选择运营商",disabled:"0"===e.isOperatorAdminFlg||"store"===this.type||""!==this.id,clearable:""},on:{change:e.listChange2},model:{value:e.list[1],callback:function(t){e.$set(e.list,1,t)},expression:"list[1]"}},e._l(e.companyList2,(function(e){return i("el-option",{key:e.index,attrs:{label:e.name,value:e.id}})})),1):e._e(),0!==e.companyList3.length?i("el-select",{attrs:{placeholder:"请选择运营商",disabled:"0"===e.isOperatorAdminFlg||"store"===this.type||""!==this.id,clearable:""},on:{change:e.listChange3},model:{value:e.list[2],callback:function(t){e.$set(e.list,2,t)},expression:"list[2]"}},e._l(e.companyList3,(function(e){return i("el-option",{key:e.index,attrs:{label:e.name,value:e.id}})})),1):e._e()],1),i("el-form-item",{staticClass:"isRequired",attrs:{label:"所属店铺",prop:"shop"}},[i("el-select",{attrs:{placeholder:"请选择所属店铺",disabled:"0"===e.isOperatorAdminFlg||"store"===this.type||""!==e.id,clearable:""},on:{change:e.shopListChange},model:{value:e.shop,callback:function(t){e.shop=t},expression:"shop"}},e._l(e.allShops,(function(e){return i("el-option",{key:e.index,attrs:{label:e.name,value:e.id}})})),1),0!==e.childShopList.length?i("el-select",{attrs:{placeholder:"请选择所属店铺",disabled:""!==e.id,clearable:""},on:{change:e.childShopListChange},model:{value:e.childShop,callback:function(t){e.childShop=t},expression:"childShop"}},e._l(e.childShopList,(function(e){return i("el-option",{key:e.index,attrs:{label:e.name,value:e.id}})})),1):e._e()],1),i("el-form-item",{attrs:{label:"角色",prop:"role",error:e.errorRole}},[i("div",{staticClass:"line"},[e._v("默认")]),i("el-checkbox-group",{model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}},[e._l(e.allRoles,(function(t){return"0"===t.hierarchy?i("el-checkbox",{key:t.index,attrs:{label:t.id,name:"role"}},[e._v(" "+e._s(t.name))]):e._e()}))],2),i("div",{staticClass:"line"},[e._v("自定义")]),i("el-checkbox-group",{model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}},[e._l(e.allRoles,(function(t){return"1"===t.hierarchy?i("el-checkbox",{key:t.index,attrs:{label:t.id,name:"role"}},[e._v(" "+e._s(t.name))]):e._e()}))],2)],1),i("el-form-item",{attrs:{label:"状态",prop:"isEnabled"}},[i("el-switch",{attrs:{"active-value":"1","active-color":"#87d068","inactive-value":"0","inactive-color":"#d9d9d9"},model:{value:e.form.isEnabled,callback:function(t){e.$set(e.form,"isEnabled",t)},expression:"form.isEnabled"}})],1)],1),i("el-dialog",{attrs:{title:"",visible:e.dialogVisible,width:"30%","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("span",[e._v(e._s(e.form.mobile)+"手机号已注册，确定添加此手机号为管理员请点击获取验证码，验证成功后自动添加")]),i("div",{staticClass:"valid-div"},[i("el-input",{attrs:{placeholder:"请输入验证码",size:"mini",maxlength:"4"},model:{value:e.validImg,callback:function(t){e.validImg=t},expression:"validImg"}}),i("img",{attrs:{src:e.imgSrc,alt:""},on:{click:e.getVerificationImg}})],1),i("div",{staticClass:"code-div"},[i("el-input",{attrs:{placeholder:"请输入手机验证码",size:"mini",maxlength:"6"},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],attrs:{type:"primary",size:"mini"},on:{click:e.getVerification}},[e._v("获取验证码")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.show,expression:"!show"}],attrs:{type:"primary",disabled:"",size:"mini"}},[e._v(e._s(e.count)+"秒后重新获取")])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirm}},[e._v("确 定")])],1)]),i("el-dialog",{attrs:{title:"",visible:e.dialogAdminVisible,width:"30%","append-to-body":""},on:{"update:visible":function(t){e.dialogAdminVisible=t}}},[i("span",[e._v("该用户是其他店铺管理员，确认成为本店铺管理员")]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogAdminVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.create}},[e._v("确 定")])],1)])],1)},c=[],d=(i("4160"),i("b64b"),i("d3b7"),i("07ac"),i("159b"),i("f36f")),m=i("8330"),h=i("4caf"),p=i("c17f"),u=i("4e29"),f=i("1ab1"),g=i("bc3a"),b=i.n(g),v={name:"BaseInfo",props:{shopId:{type:String,default:""},type:{type:String,default:""},isEdit:{type:Boolean},itemId:{type:String,default:""}},data:function(){var e=this,t=function(t,i,a){""===i?a(new Error("请输入密码")):(""!==e.form.checkpass&&e.$refs.form.validateField("checkpass"),a())},i=function(t,i,a){""===i?a(new Error("请再次输入密码")):i!==e.form.pass?a(new Error("两次输入密码不一致!")):a()};return{defaultAvatar:"/resources/admin/images/Avatar.png",id:"",masterId:"",rules:{userName:[{required:!0,message:"用户名不能为空",trigger:"blur"},{pattern:/^[0-9a-zA-Z]+$/,message:"用户名只能为数字或字母",trigger:"blur"},{min:4,max:20,message:"长度在4-20位",trigger:"blur"}],name:[{required:!0,message:"姓名不能为空",trigger:"blur"},{max:20,message:"长度不能大于20位",trigger:"blur"}],gender:[{required:!0,message:"请选择性别"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{len:11,message:"手机号位数错误",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"手机号格式错误",trigger:"blur"}],pass:[{validator:t,trigger:"blur"},{required:!0,min:6,max:16,message:"长度在6-16个字符",trigger:"blur"}],checkpass:[{required:!0,validator:i,trigger:"blur"}],role:[{required:!0,message:"您还未选择角色",trigger:"change"}]},allRoles:[],parentCompany:[],companyList1:[],companyList2:[],companyList3:[],list:["","",""],allShops:[],shop:"",childShopList:[],childShop:"",isOperatorAdminFlg:"",form:{userName:"",name:"",gender:"",mobile:"",pass:"",checkpass:"",head:"/resources/admin/images/Avatar.png",role:[],companyId:"",shopId:"",isEnabled:"1",isMemberConvert:"",isManageThisStore:""},operations:[{label:"保存",name:"save",type:"primary",auth:["admin:admin.edit"]}],count:"",code:"",imgSrc:"",validImg:"",validCode:"",timer:null,loading:!1,dialogVisible:!1,dialogAdminVisible:!1,isCreate:!0,show:!0,userId:"",errorMobile:"",errorRole:"",errUserName:"",errName:"",currentCompany:{}}},components:{BizGrid:d["a"],BizSaveButton:m["a"],BizAvatarUploaderNew:p["b"]},methods:{operate:function(e){this[e]()},getCode:function(){var e=this,t=60;this.timer||(this.count=t,this.show=!1,this.timer=setInterval((function(){e.count>0&&e.count<=t?e.count--:(e.show=!0,clearInterval(e.timer),e.timer=null)}),1e3))},getVerificationImg:function(){var e=this;this.uid=u["a"].getUuid("xxxxxxxxxxxxxxxx");var t={uid:this.uid,clientType:"2",methodName:"QueryCaptcha"},i="/rest/member/captcha.jhtml?req="+encodeURIComponent(JSON.stringify(t));f["a"].get(i).then((function(t){e.imgSrc="data:image/png;base64,"+t.captchaImage,e.uid=t.uid})).catch((function(e){}))},getVerification:function(){var e=this,t={uid:this.uid,captcha:this.validImg,clientType:"2",methodName:"SendValidateCode",phoneNumber:this.form.mobile,type:"9"},i="/rest/member/sendValidateCode.jhtml";b.a.post(i,t).then((function(t){"100"===t.data.resultCode?(e.validCode=t.data.validateCode,e.show=!0,e.getCode()):e.$message({message:t.data.errorMessage,type:"warning"})})).catch((function(e){console.log(e)}))},showNotify:function(e,t){this.$notify({showClose:!0,message:e,type:t})},listChange1:function(e){console.log("一级运营商",e),this.companyList2=[],this.companyList3=[],this.list[1]="",this.shop="",e&&(this.getShops(e),this.getCompanies(e,1))},listChange2:function(e){this.companyList3=[],this.list[2]="",this.shop="",(e||this.list[0])&&(this.getShops(e||this.list[0]),e&&this.getCompanies(e,2))},listChange3:function(e){this.shop="",(e||this.list[1])&&this.getShops(e||this.list[1])},shopListChange:function(e){this.form.role=[],this.getChildShops(e),this.getAllRoles(e)},childShopListChange:function(e){this.form.role=[],this.getAllRoles(e)},save:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;e.checkMobile(e.form.mobile)}))},checkMobile:function(e){var t=this;f["a"].post("/admin/admin/checkMobile.jhtml",{mobile:e}).then((function(e){""!==e.userId?(t.userId=e.userId,t.id=e.userId,t.form.userName=e.memberData.userName,t.form.nickname=e.memberData.nickname,t.form.name=e.memberData.name||t.form.name,t.form.gender=e.memberData.gender,t.form.mobile=e.memberData.mobile,t.form.head=e.memberData.head,t.form.isEnabled=e.memberData.enableState,t.form.isMemberConvert="1",t.dialogVisible=!0):(t.userId="",t.form.isMemberConvert="",t.form.isManageThisStore="",t.submit())})).catch((function(e){t.loading=!1,e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(e){t.loading=!1}))},confirm:function(){return""===this.validImg?(this.$message.warning("请输入验证码"),!1):""===this.code?(this.$message.warning("请输入手机验证码"),!1):this.code!==this.validCode?(this.$message.warning("请输入正确的验证码"),!1):void this.submit()},submit:function(){this.validCode="",this.code="",this.dialogVisible=!1,this.form.companyId=""===this.list[2]?""===this.list[1]?""===this.list[0]?this.form.companyId:this.list[0]:this.list[1]:this.list[2],this.form.shopId=""===this.childShop?this.shop:this.childShop,console.log("shopId: ",this.form.shopId),this.isCreate?this.create():this.update()},create:function(){var e=this,t={id:this.userId,head:this.form.head,userName:this.form.userName,password:this.form.pass,mobile:this.form.mobile,gender:this.form.gender,name:this.form.name,nickname:this.form.mobile,isEnabled:this.form.isEnabled,roleIds:this.form.role,compy:{id:this.form.companyId},shop:{id:this.form.shopId},isMemberConvert:this.form.isMemberConvert,isManageThisStore:this.form.isManageThisStore};this.loading=!0,this.dialogAdminVisible=!1,h["a"].create(t,(function(t){e.loading=!1,e.$emit("created"),e.refresh(t.AdminData.id,t.AdminData.masterId),e.$message.success("管理员创建成功")}),(function(t){e.loading=!1,"1070"===t.resultCode?(e.form.gender=t.AdminData.gender,e.form.head=t.AdminData.head,e.form.id=t.AdminData.id,e.form.isEnabled=t.AdminData.isEnabled,e.form.loginAddress=t.AdminData.loginAddress,e.form.loginDate=t.AdminData.loginDate,e.form.mobile=t.AdminData.mobile,e.form.name=t.AdminData.name,e.form.nickname=t.AdminData.nickname,e.form.userName=t.AdminData.userName,e.form.isManageThisStore="1",e.dialogAdminVisible=!0):(e.$message.warning({message:t.errorMessage}),console.log("ERR_CREATE:",t))}))},update:function(){var e=this,t={id:this.id,masterId:this.masterId,userName:this.form.userName,mobile:this.form.mobile,gender:this.form.gender,name:this.form.name,nickname:this.form.nickname,head:this.form.head,isEnabled:this.form.isEnabled,roleIds:this.form.role,compy:{id:this.form.companyId},shop:{id:this.form.shopId},isMemberConvert:this.form.isMemberConvert};this.loading=!0,h["a"].save(t,(function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("created"),e.refresh(t.AdminData.id,t.AdminData.masterId)}),(function(t){e.loading=!1,e.$message.warning({message:t.errorMessage}),console.log("ERR_UPDATE: ",t)}))},getCompanies:function(e,t){var i=this,a={parentId:e};h["a"].getCompanies(a,(function(a){void 0===e?i.companyList1=i.formatList(a.content):1===t?i.companyList2=i.formatList(a.content):2===t&&(i.companyList3=i.formatList(a.content))}),(function(e){console.log("ERR_GET_COMPANY_LIST: ",e)}))},getShops:function(e){var t=this,i={companyId:e};h["a"].getShops(i,(function(e){t.loading=!1,t.allShops=e.shopDatas,""===t.shop&&void 0!==t.allShops[0]&&(!t.itemId&&window.Company_ID?t.shop="":(t.shop=t.allShops[0].id,t.getChildShops(t.shop))),t.getAllRoles(t.shop)}),(function(e){t.loading=!1,console.log("ERR_GET_SHOPS: ",e)}))},getChildShops:function(e){var t=this;this.childShop="",this.childShopList=[];var i={shopId:e};e&&h["a"].getChildShops(i,(function(e){t.loading=!1,t.childShopList=e.dataList}),(function(e){t.loading=!1,console.log("ERR_GET_CHILD_SHOP_LIST: ",e.errorMessage)}))},getAllRoles:function(e){var t=this,i={companyId:""===this.list[2]?""===this.list[1]?""===this.list[0]?this.form.companyId:this.list[0]:this.list[1]:this.list[2],shopId:""===this.childShop?this.shop:this.childShop};h["a"].getAllRoles(i,(function(e){t.allRoles=e.allRoles,t.id||(t.form.role=[],t.allRoles.map((function(e){"15"!==e.type&&"16"!==e.type||t.form.role.push(e.id)})))}),(function(e){console.log("ERR_GET_ROLES: ",e)}))},refresh:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.id=t,this.masterId=i;var a={id:t,masterId:i};this.loading=!0,""===t?(this.isCreate=!0,this.shopId&&this.queryParent(this.shopId),h["a"].add(a,(function(t){e.loading=!1,e.$refs.form.resetFields(),e.list=["","",""],e.shop="",e.companyList1=[],e.companyList2=[],e.companyList3=[],e.childShopList=[],e.isOperatorAdminFlg=t.isOperatorAdminFlg,e.allShops=t.allShops?t.allShops:[],e.form.shopId=e.shop=""===e.shopId||"operator"===e.type?void 0===t.shop?"":t.shop.id:e.shopId,console.log("this.shop: ",e.shop),e.shop&&e.getChildShops(e.shop),e.form.companyId="1"===e.isOperatorAdminFlg?e.form.companyId:void 0===t.company?"":t.company.id,console.log(e.companyList1),console.log(e.form.companyId),t.company?e.companyList1.push(t.company):e.currentCompany.id?e.companyList1.push(e.currentCompany):e.getCompanies(),e.getAllRoles(),e.companyList1.forEach((function(t){console.log(t.id),e.form.companyId===t.id&&e.$set(e.list,0,e.form.companyId)})),"0"===e.isOperatorAdminFlg&&e.$set(e.list,0,e.form.companyId)}),(function(t){e.loading=!1,console.log("ERR_ADD_NEW_ADMIN: ",t)}))):(this.shop="",h["a"].get(a,(function(t){e.loading=!1,e.form.userName=t.admin.userName,e.form.name=t.admin.name,e.form.mobile=t.admin.mobile,e.form.nickname=t.admin.nickname,e.form.gender=t.admin.gender,e.form.head=t.admin.head||e.defaultAvatar,e.form.pass="",e.form.checkpass="",e.form.isEnabled=t.admin.isEnabled,e.form.companyId=t.admin.compy?t.admin.compy.id:"",e.isCreate=!1,e.list=["","",""];for(var i=0;i<t.companyTrees.length;i++)e.list[i]=t.companyTrees[i].id;e.getCompanies(),e.companyList2=[],e.companyList3=[],e.childShopList=[];for(var a=0;a<e.list.length;a++)""!==e.list[a]&&e.getCompanies(e.list[a],a+1);console.log(e.form.companyId),e.getShops(e.form.companyId),e.form.shopId=e.shop=t.admin.shop?t.admin.shop.id:"",e.childShop="",e.getChildShops(e.shop),e.form.role=[],t.admin.roleDatas.map((function(t){e.form.role.push(t.id)})),e.getAllRoles()}),(function(t){e.loading=!1,console.log("ERR_GET_INFO : ",t)})))},formatList:function(e){for(var t=[],i=Object.keys(e),a=Object.values(e),o=0;o<i.length;o++)t.push({id:i[o],name:a[o]});return t},queryParent:function(e){var t=this;if(e){var i={type:this.type,id:this.shopId},a="admin/store/affiliatedOperator.jhtml";f["a"].get(a,i).then((function(i){i.data.id?(t.form.companyId=i.data.id,t.$set(t.list,0,i.data.id),t.currentCompany=i.data):(t.form.companyId=e,t.$set(t.list,0,e)),t.listChange1(i.data.id)})).catch((function(e){console.log("ERR_GET_PARENT: ",e.errorMessage)}))}}},watch:{itemId:function(e,t){this.$refs.form.$el.scrollTop=0},shop:function(e,t){t&&this.shopListChange(e)}},computed:{},mounted:function(){this.refresh(),this.getVerificationImg()}},y=v,w=(i("4b44"),i("2877")),I=Object(w["a"])(y,l,c,!1,null,null,null),C=I.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"select-member"},[a("biz-flex-table",{ref:"table",attrs:{loading:e.loading,operations:e.operations,filters:e.filters,tableData:e.tableData,pagination:e.pagination,checkable:!1},on:{operate:e.operate,"filter-data-change":e.filterDataChange,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{label:"用户"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"customer-info"},[t.row.head?a("img",{attrs:{src:t.row.head}}):a("img",{attrs:{src:i("624d")}}),a("div",{staticClass:"wrapper"},[a("div",{staticClass:"title",attrs:{title:t.row.name}},[e._v(e._s(t.row.name))]),a("div",{staticClass:"gender"},["0"===t.row.gender?a("i",{staticClass:"male iconfont biz-icon-i-web-m"}):e._e(),"1"===t.row.gender?a("i",{staticClass:"female iconfont biz-icon-i-web-f"}):e._e(),"2"===t.row.gender?a("i",{staticClass:"none iconfont biz-icon-i-web-bm"}):e._e(),a("span",[e._v(e._s(t.row.mobile))])])])])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"===t.row.opeateState?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return e.setting(t.row)}}},[e._v("添加为管理员")]):e._e(),"1"===t.row.opeateState?a("span",[e._v("已添加")]):e._e()]}}])})],1),a("el-dialog",{attrs:{title:"设置用户信息","append-to-body":"",visible:e.dlgVisible},on:{"update:visible":function(t){e.dlgVisible=t},close:function(t){e.dlgVisible=!1}}},[a("el-form",{ref:"form",staticClass:"dialog-form",attrs:{size:"small","label-width":"110px",model:e.formModel,rules:e.rules}},[a("el-form-item",{attrs:{label:""}},[a("div",{staticClass:"customer-info"},[e.formModel.head?a("img",{attrs:{src:e.formModel.head}}):a("img",{attrs:{src:i("624d")}}),a("div",{staticClass:"wrapper"},[a("div",{staticClass:"title",attrs:{title:e.formModel.name}},[e._v(e._s(e.formModel.name))]),a("div",{staticClass:"gender"},["0"===e.formModel.gender?a("i",{staticClass:"male iconfont biz-icon-i-web-m"}):e._e(),"1"===e.formModel.gender?a("i",{staticClass:"female iconfont biz-icon-i-web-f"}):e._e(),"2"===e.formModel.gender?a("i",{staticClass:"none iconfont biz-icon-i-web-bm"}):e._e(),a("span",[e._v(e._s(e.formModel.mobile))])])])])]),a("el-form-item",{attrs:{label:"角色",prop:"role",error:e.errorRole}},[a("el-checkbox-group",{model:{value:e.formModel.role,callback:function(t){e.$set(e.formModel,"role",t)},expression:"formModel.role"}},[e._l(e.allRoles,(function(t){return a("el-checkbox",{key:t.index,attrs:{label:t.id,name:"role"}},[e._v(e._s(t.name))])}))],2)],1)],1),a("biz-save-button",{staticStyle:{"margin-right":"0"},attrs:{operations:e.formOperations},on:{operate:e.operate}})],1),a("el-dialog",{attrs:{title:"",visible:e.dialogVisibleMobile,width:"30%","append-to-body":""},on:{"update:visible":function(t){e.dialogVisibleMobile=t}}},[a("span",[e._v(e._s(e.form.mobile)+"手机号已注册，确定添加此手机号为管理员请点击获取验证码，验证成功后自动添加")]),a("div",{staticClass:"valid-div"},[a("el-input",{attrs:{placeholder:"请输入验证码",size:"mini",maxlength:"4"},model:{value:e.validImg,callback:function(t){e.validImg=t},expression:"validImg"}}),a("img",{attrs:{src:e.imgSrc,alt:""},on:{click:e.getVerificationImg}})],1),a("div",{staticClass:"code-div"},[a("el-input",{attrs:{placeholder:"请输入手机验证码",size:"mini",maxlength:"6"},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],attrs:{type:"primary",size:"mini"},on:{click:e.getVerification}},[e._v("获取验证码")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.show,expression:"!show"}],attrs:{type:"primary",disabled:"",size:"mini"}},[e._v(e._s(e.count)+"秒后重新获取")])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisibleMobile=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirm}},[e._v("确 定")])],1)])],1)},_=[],x=i("2f62"),E={name:"SelectMember",data:function(){return{checkable:!1,bargainAttendId:"",dlgTitle:"帮砍记录",dlgVisible:!1,dialogVisibleMobile:!1,dlgLoading:!1,loading:!1,show:!0,height:"",errorRole:"",formModel:{role:[],roleLevel:""},rules:{role:[{required:!0,message:"您还未选择角色",trigger:"change"}]},pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},tableData:[],allRoles:[],operations:[],count:"",code:"",imgSrc:"",validImg:"",validCode:"",userId:"",form:{userName:"",name:"",gender:"",mobile:"",pass:"",checkpass:"",head:"/resources/admin/images/Avatar.png",role:[],companyId:"",shopId:"",isEnabled:"1",isMemberConvert:"",isManageThisStore:""},formOperations:[{label:"取消",name:"cancelForm"},{label:"确定",name:"save",type:"primary",auth:["admin:admin.edit"]}],filters:[{type:"input",label:"",placeholder:"请输入手机号",name:"searchValue",value:""}]}},props:{isEdit:{type:Boolean,default:function(){return!0}},id:{type:String}},components:{BizFlexTable:r["c"],BizSaveButton:m["a"]},created:function(){this.getList()},computed:{},watch:{id:function(e,t){}},methods:Object(s["a"])(Object(s["a"])({},Object(x["c"])(["getUser"])),{},{operate:function(e){this[e]()},getCode:function(){var e=this,t=60;this.timer||(this.count=t,this.show=!1,this.timer=setInterval((function(){e.count>0&&e.count<=t?e.count--:(e.show=!0,clearInterval(e.timer),e.timer=null)}),1e3))},getVerificationImg:function(){var e=this;this.uid=u["a"].getUuid("xxxxxxxxxxxxxxxx");var t={uid:this.uid,clientType:"2",methodName:"QueryCaptcha"},i="/rest/member/captcha.jhtml?req="+encodeURIComponent(JSON.stringify(t));f["a"].get(i).then((function(t){e.imgSrc="data:image/png;base64,"+t.captchaImage,e.uid=t.uid})).catch((function(e){}))},clearSearchValue:function(){this.filters[0].value="",this.pagination={pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}},getAllRoles:function(){var e=this,t={shopId:window.top.SHOP_ID||this.getUser().shop.id,companyId:window.top.Company_ID||""};h["a"].getAllRoles(t,(function(t){e.allRoles=t.allRoles,e.formModel.role=[],e.allRoles.map((function(t){"15"!==t.type&&"16"!==t.type||e.formModel.role.push(t.id)}))}),(function(e){console.log("ERR_GET_ROLES: ",e)}))},cancelForm:function(){this.dlgVisible=!1},confirm:function(){return""===this.validImg?(this.$message.warning("请输入验证码"),!1):""===this.code?(this.$message.warning("请输入手机验证码"),!1):this.code!==this.validCode?(this.$message.warning("请输入正确的验证码"),!1):void(this.dlgVisible=!0)},getVerification:function(){var e=this,t={uid:this.uid,captcha:this.validImg,clientType:"2",methodName:"SendValidateCode",phoneNumber:this.form.mobile,type:"9"},i="/rest/member/sendValidateCode.jhtml";b.a.post(i,t).then((function(t){"100"===t.data.resultCode?(e.validCode=t.data.validateCode,e.show=!0,e.getCode()):e.$message({message:t.data.errorMessage,type:"warning"})})).catch((function(e){console.log(e)}))},save:function(){this.formModel.roleLevel?this.submitAdmin():this.submitMember()},submitAdmin:function(){var e=this;this.$refs.form.validate((function(t){if(t){var i={id:e.formModel.id,roleIds:e.formModel.role||"",shop:{id:window.top.SHOP_ID||""},compy:{id:window.top.Company_ID||""}};f["a"].post("/admin/admin/mgmt/admin/transfer.jhtml",i).then((function(t){e.$message.success("添加成功"),e.getList(),e.$emit("created"),e.dlgVisible=!1})).catch((function(t){e.$message.warning(t.errorMessage)}))}}))},checkMobile:function(e){var t=this;f["a"].post("/admin/admin/checkMobile.jhtml",{mobile:e}).then((function(e){t.getVerificationImg(),""!==e.userId?(t.userId=e.userId,t.id=e.userId,t.form.userName=e.memberData.userName,t.form.nickname=e.memberData.nickname,t.form.name=e.memberData.name||t.form.name,t.form.gender=e.memberData.gender,t.form.mobile=e.memberData.mobile,t.form.head=e.memberData.head,t.form.isEnabled=e.memberData.enableState,t.form.isMemberConvert="1",t.dialogVisibleMobile=!0,t.validImg=""):(t.userId="",t.form.isMemberConvert="",t.form.isManageThisStore="",t.form.userName=t.formModel.userName,t.form.nickname=t.formModel.nickname,t.form.name=t.formModel.name,t.form.gender=t.formModel.gender,t.form.mobile=t.formModel.mobile,t.form.head=t.formModel.head,t.dlgVisible=!0)})).catch((function(e){t.loading=!1,e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(e){t.loading=!1}))},submitMember:function(){var e=this,t={id:this.userId,head:this.form.head,userName:this.form.userName,password:this.form.pass,mobile:this.form.mobile,gender:this.form.gender,name:this.form.name,nickname:this.form.mobile,isEnabled:this.form.isEnabled,roleIds:this.formModel.role,compy:{id:this.form.companyId},shop:{id:this.form.shopId},isMemberConvert:this.form.isMemberConvert,isManageThisStore:this.form.isManageThisStore};this.loading=!0,this.dialogVisibleMobile=!1,h["a"].create(t,(function(t){e.loading=!1,e.$message.success("添加成功"),e.getList(),e.$emit("created"),e.dialogVisibleMobile=!1}),(function(t){e.loading=!1,e.$message.warning({message:t.errorMessage}),console.log("ERR_CREATE:",t)}))},setting:function(e){e.roleLevel&&e.roleLevel!==this.getUser().roleLevel?this.$message.warning("管理员不可以跨层级添加"):(this.formModel=Object.assign(this.formModel,e),this.getAllRoles(),e.roleLevel?this.dlgVisible=!0:this.checkMobile(e.mobile))},getList:function(){var e=this,t={companyId:window.top.Company_ID||"",shopId:window.top.SHOP_ID||"",searchValue:this.filters[0].value,pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};f["a"].get("/admin/admin/membersByKeyword.jhtml",t).then((function(t){e.tableData=t.dataList,e.pagination.total=Number(t.total)})).catch((function(e){}))},filterDataChange:function(e){this.pagination.currentPage=1,this.getList()},refresh:function(){},handleSizeChange:function(e){this.pagination.pageSize=e,this.getList()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.getList()}})},M=E,k=(i("7652"),Object(w["a"])(M,S,_,!1,null,null,null)),A=k.exports,$=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"staff-mgmt-admin-mgmt-pass-modify"},[e.isEdit?i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px",size:"small",disabled:!e.isEdit,"inline-message":!0}},[i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{type:"password",name:"pwd"}}),i("el-form-item",{attrs:{label:"新密码",prop:"pass"}},[i("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"请输入6-16位密码"},model:{value:e.form.pass,callback:function(t){e.$set(e.form,"pass",t)},expression:"form.pass"}})],1),i("el-form-item",{attrs:{label:"确认密码",prop:"checkpass"}},[i("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"再次确认密码"},model:{value:e.form.checkpass,callback:function(t){e.$set(e.form,"checkpass",t)},expression:"form.checkpass"}})],1)],1)],1)},N=[],L={name:"PassModify",components:{BizGrid:d["a"],BizSaveButton:m["a"]},props:{id:{type:String,default:""},masterId:{type:String,default:""},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){var e=this,t=function(t,i,a){""===i?a(new Error("请输入密码")):(""!==e.form.checkpass&&e.$refs.form.validateField("checkpass"),a())},i=function(t,i,a){""===i?a(new Error("请再次输入密码")):i!==e.form.pass?a(new Error("两次输入密码不一致!")):a()};return{operations:[{label:"保存",name:"save",type:"primary",auth:["admin:admin.edit"]}],form:{pass:"",checkpass:""},rules:{pass:[{validator:t,trigger:"blur"},{required:!0,min:6,max:16,message:"长度在6-16个字符",trigger:"blur"}],checkpass:[{required:!0,validator:i,trigger:"blur"}]},loading:!1}},create:function(){this.refresh()},watch:{id:function(e,t){this.$refs.form.clearValidate()}},methods:{operate:function(e){this[e]()},showMessage:function(e,t){this.$notify({showClose:!0,message:e,type:t})},refresh:function(){var e=this,t={id:this.id};this.loading=!0,h["a"].get(t,(function(t){e.loading=!1}),(function(t){e.loading=!1}))},save:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;e.update()}))},update:function(){var e=this,t={id:this.id,password:this.form.pass,masterId:this.masterId};this.loading=!0,h["a"].editPass(t,(function(t){e.loading=!1,e.$message.success("操作成功"),e.form.pass="",e.form.checkpass=""}),(function(t){e.loading=!1,console.log("PASS_MODIFY_ERR: ",t)}))}}},R=L,z=(i("9386"),Object(w["a"])(R,$,N,!1,null,null,null)),D=z.exports,O=i("624d"),V=i.n(O),T=i("aa3e"),j=i("c596"),P={name:"AdminMgmt",components:{BizPopupTabs:n["a"],BizFlexTable:r["c"],BaseInfo:C,PassModify:D,SelectMember:A},data:function(){return{editShopIds:[],isEdit:!0,isInit:!0,orderProperty:"",orderDirection:"",Img:V.a,open:!1,openAdd:!1,tabName:"first",message:"",currentRowId:"",masterId:"",shopId:"",type:"",operations:[{label:"添加",name:"add",type:"primary",auth:["admin:admin.add"]},{label:"删除",name:"del",type:"",disabled:!0,auth:["admin:admin.delete"]},{label:"刷新",name:"refresh",type:""}],filters:[{type:"select",placeholder:"请选择状态",label:"状态",value:"",options:[{label:"全部",value:""},{label:"启用",value:"1"},{label:"停用",value:"0"}]},{type:"select",placeholder:"请选择所属店铺",label:"所属店铺",value:"",options:[],filterable:!0},{type:"select",placeholder:"请选择角色",label:"角色",filterable:!0,multiple:!0,collapseTags:!0,value:"",options:[]},{type:"input",placeholder:"请输入姓名/手机号",name:"searchbar",value:""}],isEnabled:"",pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},tableData:[],multiSelected:[]}},computed:Object(s["a"])(Object(s["a"])(Object(s["a"])({},Object(x["c"])(["getUser"])),Object(x["c"])("Authority",["currentAuth"])),{},{hasAuthDel:function(){return this.currentAuth.includes("admin:admin.delete")}}),created:function(){this.refresh(),this.getRoleList(),this.getEditableStores()},methods:{operate:function(e){this[e]()},selectAble:function(e){return"shop"!==this.getUser.roleLevel||"1"===e.unionConfig.editable},getEditableStores:function(){var e=this;f["a"].get(j["j"].editableStores,{resourceType:"0"}).then((function(t){e.editShopIds=[],t.dataList.map((function(t){e.editShopIds.push(t.id)}))})).catch((function(e){console.log(e),console.log("code错误")}))},getRoleList:function(){var e=this;f["a"].get("/admin/role/roleList.jhtml",{shopId:window.top.SHOP_ID||""}).then((function(t){e.filters[2].options=[{label:"全部",value:""}].concat(t.roleList.map((function(e){return{label:e.name,value:e.id}})))})).catch((function(t){console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)}))},add:function(){this.currentRowId="",this.shopId=this.$route.query.parentId||"",this.type=this.$route.query.type||"",console.log("parentId: ",this.shopId),this.tabName="first",this.$refs.addBaseInfo.refresh(""),this.isEdit=!0,this.open=!1,this.openAdd=!0,this.$refs.selectMember.clearSearchValue(),this.$refs.selectMember.tableData=[]},del:function(e){var t=this,i=e?Array(e):this.multiSelected;0!==i.length?this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={masterIds:i};f["a"].delete("/admin/admin/mgmt/admin.jhtml",e).then((function(e){t.$message.success("操作成功"),t.refresh()})).catch((function(e){console.log(e),console.log("code错误"),t.$message.warning(e.errorMessage)}))})):this.$message.warning("未选择删除条目")},filterDataChange:function(e){this.pagination={pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},this.refresh()},getShopList:function(){var e=this,t={shopId:this.shopId,sourceType:"0"};T["a"].getShopList(t,(function(t){var i=[{label:"全部",value:""}].concat(t.shops.map((function(e){return{label:e.name,value:e.id}})));e.filters[1].options=i}),(function(e){}))},handleSelectionChange:function(e){var t=this;this.multiSelected=[],this.operations[1].disabled=!0,e.length>0&&(this.operations[1].disabled=!1),e.map((function(e){t.multiSelected=t.multiSelected.concat(e.masterId)}))},rowClick:function(e){"shop"===this.getUser.roleLevel&&"0"===e.unionConfig.editable?this.isEdit=!1:this.isEdit=!0,this.currentRowId=e.id,this.masterId=e.masterId,this.shopId=e.shopId,this.tabName="first",this.$refs.baseInfo.$refs.form.resetFields(),this.$refs.baseInfo.refresh(e.id,e.masterId),this.openAdd=!1,this.open=!0},close:function(){this.open=!1},changeState:function(e){"0"===e.isEnabled?e.isEnabled="1":e.isEnabled="0",this.updated(e)},stateColor:function(e){return"1"===e.isEnabled?"#67c23a":"#f56c6c"},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()},handleSortChange:function(e){var t={ascending:"asc",descending:"desc"};this.orderProperty=e.column?e.column.property:"",this.orderDirection=e.order?t[e.order]:"",this.refresh()},updated:function(e){var t=this,i={id:e.id,isEnabled:e.isEnabled,masterId:e.masterId};T["a"].update(i,(function(e){t.$message.success("操作成功"),t.refresh()}),(function(e){t.$message.warning(e.errorMessage),console.log("ERR_UPDATE: ",e)}))},refresh:function(){var e=this,t={pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize,searchValue:this.filters[3].value,roleId:this.filters[2].value,shopId:"shop"===this.$route.query.type?this.$route.query.parentId:"",searchShopId:this.filters[1].value||"",isEnabled:this.filters[0].value,parentId:this.$route.query.parentId,type:this.$route.query.type||"",orderProperty:this.orderProperty,orderDirection:this.orderDirection};T["a"].getList(t,(function(t){e.pagination.total=Number(t.total),e.tableData=t.content,e.isInit&&(e.showMessage("管理员累计 ".concat(e.pagination.total," 名"),"info"),e.isInit=!1)}),(function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)}))},showMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},roleFormatter:function(e,t){var i=[];return e.roleDatas.map((function(e){i=i.concat(e.name)})),i.join(",")}},watch:{},mounted:function(){this.shopId=this.$route.query.parentId||"",this.type=this.$route.query.type||"",this.getShopList(),this.type&&(document.querySelectorAll(".filter-wrap")[1].style.display="none")}},B=P,F=(i("b8ad"),Object(w["a"])(B,a,o,!1,null,null,null));t["default"]=F.exports},a9e3:function(e,t,i){"use strict";var a=i("83ab"),o=i("da84"),s=i("94ca"),n=i("6eeb"),r=i("5135"),l=i("c6b6"),c=i("7156"),d=i("c04e"),m=i("d039"),h=i("7c73"),p=i("241c").f,u=i("06cf").f,f=i("9bf2").f,g=i("58a8").trim,b="Number",v=o[b],y=v.prototype,w=l(h(y))==b,I=function(e){var t,i,a,o,s,n,r,l,c=d(e,!1);if("string"==typeof c&&c.length>2)if(c=g(c),t=c.charCodeAt(0),43===t||45===t){if(i=c.charCodeAt(2),88===i||120===i)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:a=2,o=49;break;case 79:case 111:a=8,o=55;break;default:return+c}for(s=c.slice(2),n=s.length,r=0;r<n;r++)if(l=s.charCodeAt(r),l<48||l>o)return NaN;return parseInt(s,a)}return+c};if(s(b,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var C,S=function(e){var t=arguments.length<1?0:e,i=this;return i instanceof S&&(w?m((function(){y.valueOf.call(i)})):l(i)!=b)?c(new v(I(t)),i,S):I(t)},_=a?p(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;_.length>x;x++)r(v,C=_[x])&&!r(S,C)&&f(S,C,u(v,C));S.prototype=y,y.constructor=S,n(o,b,S)}},aa3e:function(e,t,i){"use strict";var a=i("2497"),o=i("bc3a"),s=i.n(o),n=i("c596");t["a"]={getShopList:function(e,t,i){s.a.get(n["g"].staffMgmt.queryAllShops,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},getList:function(e,t,i){s.a.get(n["g"].staffMgmt.getAdminList,{params:e}).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},delete:function(e,t,i){s.a.delete(n["g"].staffMgmt.adminDelete,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},update:function(e,t,i){s.a.put(n["g"].staffMgmt.adminUpdate,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))},save:function(e,t,i){s.a.put(n["g"].staffMgmt.adminEdit,e).then(Object(a["a"])(t,i)).catch((function(e){console.error(e)}))}}},b8ad:function(e,t,i){"use strict";var a=i("d12c"),o=i.n(a);o.a},c7d0:function(e,t,i){},cf1c:function(e,t,i){},d12c:function(e,t,i){},d4c2:function(e,t,i){"use strict";var a=i("e725"),o=i.n(a);o.a},e725:function(e,t,i){},e81b:function(e,t,i){}}]);