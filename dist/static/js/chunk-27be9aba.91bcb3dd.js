(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27be9aba","chunk-488cebb3"],{1598:function(e,t,a){"use strict";var n=a("af33"),r=a.n(n);r.a},2497:function(e,t,a){"use strict";var n=a("4360"),r=a("a18c");t["a"]=function(e,t){return function(a){var o=a.data;"100"===o.resultCode?e(o):"709"===o.resultCode?(n["a"].commit("updateUser",{shop:{}}),console.log("未登录: ",n["a"].getters.currentUser),r["a"].push("/login")):t(o)}}},"2eb4":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cs-knowledge-mgmt"},[a("biz-flex-table",{attrs:{operations:e.operations,filters:e.filters,tableData:e.tableData,pagination:e.pagination},on:{operate:e.operate,"filter-data-change":e.filterDataChange,"row-click":e.rowClick,"selection-change":e.handleSelectionChange,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[e.hasAuthImport?a("template",{slot:"operation"},[a("import-file",{ref:"importFile",staticStyle:{"margin-left":"10px"},attrs:{tableData:e.importResult,importLoading:e.importLoading,total:e.total,disabled:e.disabled,count:e.count,percentage:e.percentage,stepkey:e.stepkey,action:"/admin/cs/importKnowledge.jhtml",name:"uFile"},on:{clearTimeOut:e.clearTimeOut,restProcess:e.restProcess,"handle-import":e.handleImport}},[a("el-table-column",{attrs:{label:"编号",prop:"line",width:"50"}}),a("el-table-column",{attrs:{label:"消息",prop:"result"}})],1)],1):e._e(),a("el-table-column",{attrs:{prop:"parentCategory.name",label:"类别"}}),a("el-table-column",{attrs:{prop:"childCategory.name",label:"子类别"}}),a("el-table-column",{attrs:{prop:"question",label:"关键字"}}),a("el-table-column",{attrs:{prop:"answer",label:"客服答案"}})],2),a("biz-popup-tabs",{attrs:{open:e.open},on:{close:function(t){e.open=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[a("item",{attrs:{activatedObj:e.activedK,KFatherTypeList:e.KFatherTypeList},on:{created:e.getKList}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openSetting},on:{close:function(t){e.openSetting=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"回复设置",name:"setting"}},[a("reply-setting")],1)],1)],1)},r=[],o=(a("caad"),a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("ac1f"),a("2532"),a("3ca3"),a("466d"),a("1276"),a("ddb0"),a("2b3d"),a("b85c")),i=(a("96cf"),a("1da1")),s=a("5530"),l=a("04d3"),c=a("7132"),u=a("ccf0"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"cs-knowledge-item"},[a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.form,"inline-message":!0,"label-width":"100px",size:"small"}},[a("el-form-item",{attrs:{label:"类别",prop:"firstType"}},[a("el-select",{on:{change:e.firstTypeChange},model:{value:e.form.firstType,callback:function(t){e.$set(e.form,"firstType",t)},expression:"form.firstType"}},e._l(e.FList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"子类别",prop:"secondType"}},[a("el-select",{model:{value:e.form.secondType,callback:function(t){e.$set(e.form,"secondType",t)},expression:"form.secondType"}},e._l(e.SList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"关键字",prop:"question"}},[a("el-input",{attrs:{placeholder:"请输入关键字",type:"textarea",rows:2},model:{value:e.form.question,callback:function(t){e.$set(e.form,"question",t)},expression:"form.question"}})],1),a("el-form-item",{attrs:{label:"客服答案",prop:"answer"}},[a("el-input",{attrs:{placeholder:"请输入客服答案",type:"textarea",rows:2},model:{value:e.form.answer,callback:function(t){e.$set(e.form,"answer",t)},expression:"form.answer"}})],1)],1)],1)},f=[],d=a("f36f"),m=a("8330"),g=a("e1ee"),h={name:"KnowledgeItem",data:function(){return{loading:!1,operations:[{label:"保存",name:"save",type:"primary",auth:["admin:knowledgeBase.edit"]}],form:{firstType:"",secondType:"",question:"",answer:""},rules:{firstType:[{required:!0,message:"请选择类别",trigger:"change"}],secondType:[{required:!0,message:"请选择子类别",trigger:"change"}],question:[{required:!0,message:"请输入关键字",trigger:"blur"}],answer:[{required:!0,message:"请输入客服答案",trigger:"blur"},{min:0,max:100,message:"长度在 100个字符之内",trigger:"blur"}]}}},props:{KFatherTypeList:Array,activatedObj:Object},components:{BizSaveButton:m["a"],BizGrid:d["a"]},created:function(){},mounted:function(){},computed:{FList:function(){var e,t=[],a=Object(o["a"])(this.KFatherTypeList);try{for(a.s();!(e=a.n()).done;){var n=e.value;t.push({value:n.id,label:n.name})}}catch(r){a.e(r)}finally{a.f()}return t},SList:function(){var e,t=[],a=Object(o["a"])(this.KFatherTypeList);try{for(a.s();!(e=a.n()).done;){var n=e.value;if(n.id===this.form.firstType){var r,i=Object(o["a"])(n.list);try{for(i.s();!(r=i.n()).done;){var s=r.value;t.push({value:s.id,label:s.name})}}catch(l){i.e(l)}finally{i.f()}break}}}catch(l){a.e(l)}finally{a.f()}return t}},watch:{activatedObj:function(e){console.log(e),this.$refs.form.resetFields(),""===e.id?this.clear():this.refresh()}},methods:{operate:function(e){this[e]()},firstTypeChange:function(){this.form.secondType=""},clear:function(){this.form.firstType="",this.form.secondType="",this.form.question="",this.form.answer=""},save:function(){this.isCreated()?this.create():this.update()},create:function(){var e=this;this.$refs.form.validate((function(t){if(t){var a={question:e.form.question,answer:e.form.answer,parentCategory:{id:e.form.firstType},childCategory:{id:e.form.secondType}};e.loading=!0,g["a"].createK(a,(function(t){e.$message.success("操作成功"),e.loading=!1,e.$emit("created")}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))}}))},update:function(){var e=this;this.$refs.form.validate((function(t){if(t){var a={id:e.activatedObj.id,question:e.form.question,answer:e.form.answer,parentCategory:{id:e.form.firstType},childCategory:{id:e.form.secondType}};e.loading=!0,g["a"].updateK(a,(function(t){e.$message.success("操作成功"),e.loading=!1,e.$emit("created")}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))}}))},refresh:function(){var e=this,t={id:this.activatedObj.id};g["a"].getK(t,(function(t){e.form.firstType=t.data.parentCategory.id,e.form.secondType=t.data.childCategory.id,e.form.question=t.data.question,e.form.answer=t.data.answer}),(function(e){console.log(e)}))},isCreated:function(){return""===this.activatedObj.id}}},b=h,y=(a("a9b4"),a("2877")),v=Object(y["a"])(b,p,f,!1,null,null,null),w=v.exports,S=a("2f62"),T=a("c384"),x=a("1ab1"),k=a("bc3a"),O=a.n(k),I={name:"KnowledgeMgmt",data:function(){return{importResult:[],importLoading:!1,total:0,count:0,t:"",percentage:0,stepkey:"",loading:!1,disabled:!1,tabName:"first",open:!1,openSetting:!1,tableData:[],KFatherTypeList:[],activedK:{},selectedList:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:9},operations:[{label:"添加",name:"createItem",type:"primary",auth:["admin:knowledgeBase.add"]},{label:"删除",name:"delete",type:"",disabled:!0,auth:["admin:knowledgeBase.delete"]},{label:"导出",name:"export",type:"",auth:["admin:knowledgeBase.export"]},{label:"模版下载",name:"download",type:""},{label:"回复设置",name:"replySetting",type:"",auth:["admin:knowledgeBase.set"]}],filters:[{type:"input",label:"",placeholder:"请输入关键字搜索",name:"add",value:""}]}},components:{BizFlexTable:l["c"],BizPopupTabs:c["a"],Item:w,ImportFile:u["b"],ReplySetting:T["default"]},created:function(){this.refresh()},computed:Object(s["a"])(Object(s["a"])({},Object(S["c"])("Authority",["currentAuth"])),{},{hasAuthImport:function(){return this.currentAuth.includes("admin:knowledgeBase.import")}}),mounted:function(){},beforeDestroy:function(){this.t&&window.clearTimeout(this.t)},methods:{clearTimeOut:function(){window.clearTimeout(this.t)},download:function(){window.open("/upload/mode/V服爱车_知识库导入模板.xlsx")},restProcess:function(){this.total=0,this.count=0,this.stepkey="",this.percentage=0},replySetting:function(){this.tabName="setting",this.openSetting=!0},handleImport:function(){var e=this,t="/admin/cs/importProgress.jhtml";x["a"].get(t,{}).then((function(t){t.data.total&&(e.total=Number(t.data.total||0),e.count=Number(t.data.count||0),e.stepkey=t.data.remark,e.percentage=Number(t.data.rate),e.$refs.importFile.title=t.data.title),t.data&&t.data.rate&&"100"===t.data.rate?(e.clearTimeOut(),e.$refs.importFile.showCurrentInfo=!1,e.$refs.importFile.title="导入完成",e.disabled=!1,t.data&&t.data.results&&t.data.results.length>0&&(e.importResult=t.data.results,e.$refs.importFile.uploadingVisible=!1,e.$refs.importFile.importingVisible=!0),e.getKList()):t.data&&t.data.rate&&"100"!==t.data.rate&&(e.t&&e.clearTimeOut(),e.t=setTimeout(e.handleImport,2e3),e.$refs.importFile.uploadingVisible=!0,e.$refs.importFile.showCurrentInfo=!0,e.disabled=!0)})).catch((function(e){console.log(e),console.log("code错误")}))},export:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={keyWord:e.filters[0].value,shopId:window.top.SHOP_ID||"",pageSize:e.pagination.pageSize,pageNumber:e.pagination.currentPage},t.prev=1,t.next=4,O.a.post("/admin/cs/exportAll.jhtml",a,{responseType:"blob"});case 4:return n=t.sent,console.log("response => ",n),r=new Blob([n.data],{type:"application/vnd.ms-excel"}),console.log(decodeURI(n.headers["content-disposition"])),o=decodeURI(n.headers["content-disposition"].split("filename=")[1]),i=document.createElement("a"),i.download=o.match(/"(\S*)"/)[1],i.style.display="none",i.href=URL.createObjectURL(r),document.body.appendChild(i),i.click(),URL.revokeObjectURL(i.href),document.body.removeChild(i),t.abrupt("return");case 20:throw t.prev=20,t.t0=t["catch"](1),new Error(t.t0);case 23:case"end":return t.stop()}}),t,null,[[1,20]])})))()},operate:function(e){this[e]()},refresh:function(){this.getKFatherType()},getKFatherType:function(){var e=this,t={};g["a"].getKFatherType(t,function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var n,r,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=Object(o["a"])(a.list),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=11;break}return i=r.value,t.next=7,g["a"].getKSonType({parentId:i.id});case 7:s=t.sent,i.list=s.data.list;case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](1),n.e(t.t0);case 16:return t.prev=16,n.f(),t.finish(16);case 19:e.KFatherTypeList=a.list,e.getKList();case 21:case"end":return t.stop()}}),t,null,[[1,13,16,19]])})));return function(e){return t.apply(this,arguments)}}(),(function(e){console.log(e)}))},getKList:function(){var e=this,t={keyWord:this.filters[0].value,shopId:window.top.SHOP_ID||"",pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage};g["a"].getKList(t,(function(t){e.tableData=t.content,e.pagination.total=Number(t.total)}),(function(e){console.log(e)}))},delete:function(){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t,a=[],n=Object(o["a"])(e.selectedList);try{for(n.s();!(t=n.n()).done;){var r=t.value;a.push(r.id)}}catch(s){n.e(s)}finally{n.f()}var i={ids:a};g["a"].deleteK(i,(function(t){e.$message({type:"success",message:"删除成功!"}),e.refresh()}),(function(e){console.log(e)}))})).catch((function(){}))},createItem:function(){this.tabName="first",this.open=!0,this.activedK={id:""}},filterDataChange:function(){this.pagination.currentPage=1,this.getKFatherType()},rowClick:function(e){this.activedK={id:e.id},this.open=!0},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()},handleSelectionChange:function(e){this.selectedList=e,this.operations.map((function(t){"delete"===t.name&&(t.disabled=!0),e.length>0&&"delete"===t.name&&(t.disabled=!1)}))}}},C=I,K=(a("8f46"),Object(y["a"])(C,n,r,!1,null,null,null));t["default"]=K.exports},4314:function(e,t,a){},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,a){var n=a("1d80"),r=a("5899"),o="["+r+"]",i=RegExp("^"+o+o+"*"),s=RegExp(o+o+"*$"),l=function(e){return function(t){var a=String(n(t));return 1&e&&(a=a.replace(i,"")),2&e&&(a=a.replace(s,"")),a}};e.exports={start:l(1),end:l(2),trim:l(3)}},"8f46":function(e,t,a){"use strict";var n=a("fba1"),r=a.n(n);r.a},a9b4:function(e,t,a){"use strict";var n=a("4314"),r=a.n(n);r.a},a9e3:function(e,t,a){"use strict";var n=a("83ab"),r=a("da84"),o=a("94ca"),i=a("6eeb"),s=a("5135"),l=a("c6b6"),c=a("7156"),u=a("c04e"),p=a("d039"),f=a("7c73"),d=a("241c").f,m=a("06cf").f,g=a("9bf2").f,h=a("58a8").trim,b="Number",y=r[b],v=y.prototype,w=l(f(v))==b,S=function(e){var t,a,n,r,o,i,s,l,c=u(e,!1);if("string"==typeof c&&c.length>2)if(c=h(c),t=c.charCodeAt(0),43===t||45===t){if(a=c.charCodeAt(2),88===a||120===a)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+c}for(o=c.slice(2),i=o.length,s=0;s<i;s++)if(l=o.charCodeAt(s),l<48||l>r)return NaN;return parseInt(o,n)}return+c};if(o(b,!y(" 0o1")||!y("0b1")||y("+0x1"))){for(var T,x=function(e){var t=arguments.length<1?0:e,a=this;return a instanceof x&&(w?p((function(){v.valueOf.call(a)})):l(a)!=b)?c(new y(S(t)),a,x):S(t)},k=n?d(y):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),O=0;k.length>O;O++)s(y,T=k[O])&&!s(x,T)&&g(x,T,m(y,T));x.prototype=v,v.constructor=x,i(r,b,x)}},af33:function(e,t,a){},baa5:function(e,t,a){var n=a("23e7"),r=a("e58c");n({target:"Array",proto:!0,forced:r!==[].lastIndexOf},{lastIndexOf:r})},c384:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"cs-reply-setting"},[a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),a("el-form",{ref:"form",attrs:{rules:e.rules,size:"small",model:e.form,"label-position":"left","label-width":"110px","inline-message":!0}},[a("el-form-item",{attrs:{label:"欢迎语",prop:"welcom"}},[a("el-input",{attrs:{placeholder:"请输入欢迎语",type:"textarea",rows:2},model:{value:e.form.welcom,callback:function(t){e.$set(e.form,"welcom",t)},expression:"form.welcom"}})],1),a("el-form-item",{attrs:{label:"默认回复",prop:"hello"}},[a("el-input",{attrs:{placeholder:"请输入默认回复",type:"textarea",rows:2},model:{value:e.form.hello,callback:function(t){e.$set(e.form,"hello",t)},expression:"form.hello"}})],1),a("el-form-item",{attrs:{label:"重复回复",prop:"replying"}},[a("el-input",{attrs:{placeholder:"请输入重复回复",type:"textarea",rows:2},model:{value:e.form.replying,callback:function(t){e.$set(e.form,"replying",t)},expression:"form.replying"}})],1)],1)],1)},r=[],o=a("8330"),i=a("f36f"),s=a("e1ee"),l={name:"ReplySetting",data:function(){return{operations:[{label:"保存",name:"save",type:"primary",auth:["admin:knowledgeBase.edit"]}],form:{hello:"",replying:"",welcom:""},rules:{welcom:[{required:!0,message:"请输入欢迎语",trigger:"blur"},{min:0,max:100,message:"长度在 100个字符之内",trigger:"blur"}],hello:[{required:!0,message:"请输入默认回复",trigger:"blur"},{min:0,max:100,message:"长度在 100个字符之内",trigger:"blur"}],replying:[{required:!0,message:"请输入重复回复",trigger:"blur"},{min:0,max:100,message:"长度在 100个字符之内",trigger:"blur"}]}}},components:{BizGrid:i["a"],BizSaveButton:o["a"]},created:function(){this.getReplySetting()},mounted:function(){this.$message({showClose:!0,message:"对接入的机器人进行欢迎语、默认回复、重复回复的语句设置",type:"info"})},methods:{operate:function(e){this[e]()},save:function(){var e=this;this.$refs.form.validate((function(t){if(t){var a={hello:e.form.hello,replying:e.form.replying,welcom:e.form.welcom};s["a"].saveReplySetting(a,(function(t){e.$message({type:"success",message:"保存成功!"}),e.getReplySetting()}),(function(t){console.log(t),e.$message.warning(t.errorMessage)}))}}))},getReplySetting:function(){var e=this,t={shopId:window.top.SHOP_ID||""};s["a"].getReplySetting(t,(function(t){e.form.hello=t.data.hello,e.form.replying=t.data.replying,e.form.welcom=t.data.welcom}),(function(e){console.log(e)}))}}},c=l,u=(a("1598"),a("2877")),p=Object(u["a"])(c,n,r,!1,null,null,null);t["default"]=p.exports},e1ee:function(e,t,a){"use strict";var n=a("2497"),r=a("bc3a"),o=a.n(r),i=a("c596");t["a"]={getReplySetting:function(e,t,a){o.a.get(i["g"].customerService.replySetting,{params:e}).then(Object(n["a"])(t,a)).catch((function(e){console.error(e)}))},saveReplySetting:function(e,t,a){o.a.post(i["g"].customerService.replySetting,e).then(Object(n["a"])(t,a)).catch((function(e){console.error(e)}))},getKFatherType:function(e,t,a){o.a.get(i["g"].customerService.knowledgeType,{params:e}).then(Object(n["a"])(t,a)).catch((function(e){console.error(e)}))},getKSonType:function(e){return o.a.get(i["g"].customerService.knowledgeType,{params:e})},getKList:function(e,t,a){o.a.get(i["g"].customerService.knowledgeList,{params:e}).then(Object(n["a"])(t,a)).catch((function(e){console.error(e)}))},createK:function(e,t,a){o.a.post(i["g"].customerService.knowledge,e).then(Object(n["a"])(t,a)).catch((function(e){console.error(e)}))},getK:function(e,t,a){o.a.get(i["g"].customerService.knowledge,{params:e}).then(Object(n["a"])(t,a)).catch((function(e){console.error(e)}))},updateK:function(e,t,a){o.a.put(i["g"].customerService.knowledge,e).then(Object(n["a"])(t,a)).catch((function(e){console.error(e)}))},deleteK:function(e,t,a){o.a.delete(i["g"].customerService.knowledge,{data:e}).then(Object(n["a"])(t,a)).catch((function(e){console.error(e)}))},import:function(e,t,a){o.a.post(i["g"].customerService.ImportKnowledge,e).then(Object(n["a"])(t,a)).catch((function(e){console.error(e)}))},export:function(e){window.open(i["g"].customerService.ExportKnowledge+"?shopId="+e.shopId)}}},e58c:function(e,t,a){"use strict";var n=a("fc6a"),r=a("a691"),o=a("50c4"),i=a("a640"),s=a("ae40"),l=Math.min,c=[].lastIndexOf,u=!!c&&1/[1].lastIndexOf(1,-0)<0,p=i("lastIndexOf"),f=s("indexOf",{ACCESSORS:!0,1:0}),d=u||!p||!f;e.exports=d?function(e){if(u)return c.apply(this,arguments)||0;var t=n(this),a=o(t.length),i=a-1;for(arguments.length>1&&(i=l(i,r(arguments[1]))),i<0&&(i=a+i);i>=0;i--)if(i in t&&t[i]===e)return i||0;return-1}:c},fba1:function(e,t,a){}}]);