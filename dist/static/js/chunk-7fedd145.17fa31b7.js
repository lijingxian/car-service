(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7fedd145"],{"0643":function(e,t,a){"use strict";var i=a("2366"),n=a.n(i);n.a},"0b13f":function(e,t,a){"use strict";var i=a("c0d7"),n=a.n(i);n.a},"0f3b":function(e,t,a){},"10e4":function(e,t,a){"use strict";var i=a("8cdd"),n=a.n(i);n.a},"15d8":function(e,t,a){},2366:function(e,t,a){},2724:function(e,t,a){"use strict";var i=a("2497"),n=a("bc3a"),r=a.n(n),s=a("c596");t["a"]={query:function(e,t,a){r.a.get(s["g"].motoristsClubActivity.ActivityNotification_query,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},update:function(e,t,a){r.a.post(s["g"].motoristsClubActivity.ActivityNotification_update,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},publish:function(e,t,a){r.a.post(s["g"].motoristsClubActivity.ActivityNotification_publish,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryVIPList:function(e,t,a){r.a.get(s["g"].motoristsClubActivity.ActivityNotification_queryVIPList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryPeople:function(e,t,a){r.a.get(s["g"].motoristsClubActivity.ActivityNotification_queryPeople,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))}}},"4f76":function(e,t,a){},"4fa4":function(e,t,a){"use strict";var i=a("0f3b"),n=a.n(i);n.a},"5b90":function(e,t,a){e.exports=a.p+"static/img/common_blank.41e5808e.png"},"5ca4":function(e,t,a){"use strict";var i=a("6c42"),n=a.n(i);n.a},"6c42":function(e,t,a){},"7f51":function(e,t,a){"use strict";var i=a("4f76"),n=a.n(i);n.a},8314:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"member-care-mgmt"},[a("div",{attrs:{slot:"top"},slot:"top"},[a("div",{staticClass:"member-mgmt-top"},[a("biz-header",{attrs:{operations:e.operations,filters:e.filters},on:{operate:e.operate,filterDataChange:e.filterDataChange}})],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"content"},[a("member-care-card-view",{attrs:{memberCareList:e.memberCareList},on:{refresh:e.refresh,click:e.rowClick,delete:e.cardDelete}})],1),a("div",{attrs:{slot:"float"},slot:"float"},[a("biz-popup-tabs",{attrs:{open:e.openPopup},on:{close:function(t){e.openPopup=!1}},model:{value:e.popupTabName,callback:function(t){e.popupTabName=t},expression:"popupTabName"}},[a("el-tab-pane",{attrs:{label:"关怀卡信息",name:"baseinfo"}},[a("member-base-info",{ref:"baseInfo",attrs:{memberRankList:e.initInfo.memberRankList,itemId:e.itemId},on:{refresh:e.refresh}})],1),e.itemId.id?a("el-tab-pane",{attrs:{label:"发放人群",name:"dispath"}},[a("rank-item",{ref:"rank",attrs:{rankData:e.rankData}})],1):e._e(),e.itemId.id?a("el-tab-pane",{attrs:{label:"会员通知",name:"notice"}},[a("member-notice",{ref:"notice",attrs:{itemId:e.itemId}})],1):e._e(),e.itemId.id?a("el-tab-pane",{attrs:{label:"发放记录",name:"record"}},[a("refueling-record",{ref:"record",attrs:{itemId:e.itemId}})],1):e._e()],1)],1)])},n=[],r=(a("a4d3"),a("e01a"),a("ac1f"),a("5319"),a("b85c")),s=a("5530"),o=a("04d3"),l=a("1ab1"),c=a("c596"),d=a("2f62"),u=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"rank-item"},[i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),i("el-form",{attrs:{size:"small"}},[i("el-form-item",[i("el-radio-group",{on:{change:e.onTypeChange},model:{value:e.rankData.target,callback:function(t){e.$set(e.rankData,"target",t)},expression:"rankData.target"}},[i("el-radio",{attrs:{label:"0"}},[e._v("所有会员")]),i("el-radio",{attrs:{label:"1"}},[e._v("指定等级会员")]),i("el-radio",{attrs:{label:"2"}},[e._v("指定会员")])],1)],1)],1),"0"===e.rankData.target?i("div",[i("span",[e._v("已选中会员"+e._s(e.total)+"人")])]):"1"===e.rankData.target?i("div",[i("el-button",{staticClass:"btn-style",attrs:{type:"primary",size:"mini"},on:{click:e.selectRank}},[e._v("选择")]),i("span",[e._v("已选中会员"+e._s(e.rankTotal)+"人")]),e._l(e.selVips,(function(t){return i("div",{key:t.name},[e._v(e._s(t.name+" ("+t.curSel+")"))])}))],2):i("div",[i("el-button",{staticClass:"btn-style",attrs:{type:"primary",size:"mini"},on:{click:e.showPeoplePicker}},[e._v("选择")]),i("span",[e._v("已选中会员"+e._s(e.rankData.members.length)+"人")]),i("div",{class:e.isShow?"nick-name-container-show":"nick-name-container"},e._l(e.rankData.members,(function(t){return i("div",{key:t.id,staticClass:"nick-name-title"},[e._v(e._s(t.name||t.nickname))])})),0),e.rankData.members.length>6?i("div",{staticClass:"color",on:{click:e.view}},[e._v("查看全部")]):e._e()],1),i("biz-dialog-selector",{staticClass:"rank-dialog-selector",attrs:{title:"选择会员",visibility:e.showDialog,appendToBody:!0,keyField:"id",selectionKeys:e.selectionKeys,loading:e.dialogLoading,tableData:e.dialogTableDataHandle,pagination:e.dialogPagination,filters:e.dialogFilters},on:{"update:visibility":function(t){e.showDialog=t},confirmed:e.handleConfirmed,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,selectionChange:e.selectionChange,cascaderChange:e.cascaderChange}},[i("el-table-column",{attrs:{prop:"name",label:"会员信息",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"customer-info"},[t.row.head?i("img",{attrs:{src:t.row.head}}):i("img",{attrs:{src:a("624d")}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"title"},[e._v(e._s(t.row.name))]),i("div",{staticClass:"gender"},["0"===t.row.gender?i("i",{staticClass:"male iconfont biz-icon-i-web-m"}):e._e(),"1"===t.row.gender?i("i",{staticClass:"female iconfont biz-icon-i-web-f"}):e._e(),"2"===t.row.gender?i("i",{staticClass:"none iconfont biz-icon-i-web-bm"}):e._e(),i("span",[e._v(e._s(t.row.mobile))])])])])]}}])}),i("el-table-column",{attrs:{prop:"enableState",label:"状态",formatter:e.getStatus}}),i("el-table-column",{attrs:{prop:"shop.name",label:"所属店铺"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",e._l(t.row.shops,(function(t,a){return i("div",{key:a,staticClass:"customer-info"},[e._v(e._s(t.name))])})),0)]}}])}),i("el-table-column",{attrs:{prop:"shopTags",label:"会员标签",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",e._l(t.row.shopTags,(function(t,a){return i("div",{key:a,staticClass:"platform-tags"},[e._v(e._s(t.name))])})),0)]}}])})],1),i("el-dialog",{attrs:{title:"选择等级",visible:e.showRankDialog,appendToBody:!0,center:"","custom-class":"rank-dialog"},on:{"update:visible":function(t){e.showRankDialog=t}}},[i("div",{staticClass:"content"},e._l(e.vipRankList,(function(t){return i("div",{key:t.id,staticClass:"memberRank"},[i("div",{staticClass:"vip-name"},[e._v(e._s(t.name))]),i("div",{staticClass:"vip-container"},e._l(t.ranks,(function(t){return i("div",{key:t.id,staticClass:"vip"},[i("el-checkbox",{attrs:{value:t.checked},on:{change:function(a){return e.vipChange(t)}}},[e._v(e._s(t.name))])],1)})),0)])})),0),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.showRankDialog=!1}}},[e._v("取 消")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.handleRankConfirmed}},[e._v("确认选择")])],1)])],1)},m=[],h=(a("99af"),a("4de4"),a("4160"),a("c975"),a("a15b"),a("d81d"),a("a434"),a("b0c0"),a("a9e3"),a("d3b7"),a("25f0"),a("159b"),a("af3f")),g=a("2724"),p=a("f36f"),f=a("8330"),b=function e(t){var a,i=[],n=Object(r["a"])(t);try{for(n.s();!(a=n.n()).done;){var s=a.value,o={value:{name:s.name,id:s.id},label:s.name};if(s.children.length>0&&(o.children=e(s.children)),s.tags&&s.tags.length>0){o.hasOwnProperty("children")||(o.children=[]),o.children=o.children.concat([{label:"全部",value:""}]);var l,c=v(s.tags),d=Object(r["a"])(c);try{for(d.s();!(l=d.n()).done;){var u=l.value;o.children.push(u)}}catch(m){d.e(m)}finally{d.f()}}0!==s.children.length||s.tags||(o.disabled=!0),i.push(o)}}catch(m){n.e(m)}finally{n.f()}return i},v=function(e){var t,a=[],i=Object(r["a"])(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;a.push({label:n.name,value:{name:n.name,id:n.id}})}}catch(s){i.e(s)}finally{i.f()}return a},k={name:"rank-item",data:function(){return{selectedRankList:[],memberRankList:[],total:0,rankTotal:0,selVips:[],selectionList:[],showDialog:!1,showRankDialog:!1,dialogLoading:!0,isShow:!1,dialogTableData:[],dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},dialogFilters:[{type:"cascader",label:"会员标签",name:"memberTag",changeOnSelect:!1,filterable:!1,value:[""],options:[]},{type:"input",label:"",placeholder:"请输入姓名/手机号",name:"searchValue",value:""}],operations:[{label:"保存",name:"save",type:"primary",auth:["admin:member.memberCare.care.edit"]}],curTagName:""}},props:{rankData:{type:Object,default:function(){return{target:"0",members:[],memberRanks:[]}}},itemId:{type:Object,default:function(){return{id:""}}}},watch:{showRankDialog:function(e){e&&(this.selectedRankList=this.rankData.memberRanks.concat())}},components:{BizDialogSelector:h["a"],BizSaveButton:f["a"],BizGrid:p["a"]},computed:Object(s["a"])(Object(s["a"])({},Object(d["c"])(["getUser"])),{},{dialogTableDataHandle:function(){var e=this.dialogTableData;return e.forEach((function(e){e.shopTags&&(e.shopTagsNew=[],e.shopTags.forEach((function(t,a){a<3&&(e.shopTags.length>1?e.shopTagsNew.push(t+"、"):e.shopTagsNew.push(t))})))})),e},selectionKeys:function(){var e,t=[],a=Object(r["a"])(this.rankData.members);try{for(a.s();!(e=a.n()).done;){var i=e.value;t.push(i.id)}}catch(n){a.e(n)}finally{a.f()}return t},vipRankList:function(){var e=[];this.memberRankList.forEach((function(t){var a={};a.id=t.id,a.name=t.name,a.ranks=[],t.ranks&&t.ranks.length&&t.ranks.forEach((function(e){var t={};t.id=e.id,t.name=e.name,t.checked=e.checked,a.ranks.push(t)})),e.push(a)}));for(var t=e,a=0,i=t;a<i.length;a++){var n,s=i[a],o=Object(r["a"])(s.ranks);try{for(o.s();!(n=o.n()).done;){var l=n.value;l.checked=!1}}catch(v){o.e(v)}finally{o.f()}}for(var c=0,d=t;c<d.length;c++){var u,m=d[c],h=Object(r["a"])(m.ranks);try{for(h.s();!(u=h.n()).done;){var g,p=u.value,f=Object(r["a"])(this.selectedRankList);try{for(f.s();!(g=f.n()).done;){var b=g.value;b.id===p.id&&(p.checked=!0)}}catch(v){f.e(v)}finally{f.f()}}}catch(v){h.e(v)}finally{h.f()}}return t}}),methods:{view:function(){this.isShow=!0},clearData:function(){var e;switch(this.rankData.target){case"0":e=this.memberRankList;var t,a=Object(r["a"])(e);try{for(a.s();!(t=a.n()).done;){var i,n=t.value,s=Object(r["a"])(n.ranks);try{for(s.s();!(i=s.n()).done;){var o=i.value;o.checked=!1}}catch(g){s.e(g)}finally{s.f()}}}catch(g){a.e(g)}finally{a.f()}this.rankTotal=0,this.selVips=[],this.rankData.members=[],this.rankData.memberRanks=[];break;case"1":this.total=0,this.rankData.members=[];break;case"2":e=this.memberRankList;var l,c=Object(r["a"])(e);try{for(c.s();!(l=c.n()).done;){var d,u=l.value,m=Object(r["a"])(u.ranks);try{for(m.s();!(d=m.n()).done;){var h=d.value;h.checked=!1}}catch(g){m.e(g)}finally{m.f()}}}catch(g){c.e(g)}finally{c.f()}this.total=0,this.rankTotal=0,this.selVips=[],this.rankData.memberRanks=[];break;default:break}},operate:function(e){this[e]()},save:function(){var e=this;l["a"].put("/admin/memberCare/manage/memberCareObject.jhtml",this.rankData).then((function(t){e.$message.success("操作成功")})).catch((function(t){t.errorMessage&&(e.$message.warning(t.errorMessage),console.log(t.errorMessage))}))},onTypeChange:function(e){"0"===e&&this.getVipCount()},getMemberRankList:function(){var e=this,t={shopId:this.getUser.shop&&this.getUser.shop.id||window.top.SHOP_ID||""};l["a"].get("/admin/memberRank/templateAndRanks.jhtml",t).then((function(t){e.memberRankList=t.templates})).catch()},getVipCount:function(e){var t=this,a={shopId:"",memberRankIds:null};if("0"===this.rankData.target)a.shopId=this.getUser.shop.id;else if("1"===this.rankData.target){if(!e||!e.length)return;a.memberRankIds=e.toString()}l["a"].get("admin/member/count.jhtml",a).then((function(e){"0"===t.rankData.target?t.total=e.total:"1"===t.rankData.target&&(t.rankTotal=e.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},showPeoplePicker:function(){this.selectionList=[],this.dialogFilters[1].value="",this.showDialog=!0,this.queryPeople()},selectRank:function(){this.showRankDialog=!0},cascaderChange:function(e){var t=this;if(this.curTagName=e[e.length-1].id,e.length>1&&!this.curTagName){var a=e[e.length-2].id;l["a"].get("/admin/tag/storeTags.jhtml",{tagCategoryId:a}).then((function(e){var a=[];e.content.map((function(e){a.push(e.id)})),t.curTagName=a.join(","),t.queryPeople()})).catch((function(e){"店铺不存在"!==e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){}))}else this.queryPeople()},queryPeople:function(){var e=this;this.dialogLoading=!0;var t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[1].value,tag:this.curTagName};g["a"].queryPeople(t,(function(t){e.dialogTableData=t.content,e.dialogPagination.total=Number(t.total),e.dialogLoading=!1}),(function(e){console.log(e)}))},getStatus:function(e){switch(e.enableState){case"0":return"停用";case"1":return"启用"}return""},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},handleConfirmed:function(e,t){var a,i=this,n=[],s=Object(r["a"])(e);try{var o=function(){var e=a.value;i.selectionList.forEach((function(t){t.id===e&&n.push({id:e,name:t.name,nickName:t.nickName})}))};for(s.s();!(a=s.n()).done;)o()}catch(l){s.e(l)}finally{s.f()}this.rankData.members&&this.rankData.members.length?n.forEach((function(e){i.containsItem(i.rankData.members,e.id)||i.rankData.members.push(e)})):this.rankData.members=this.rankData.members.concat(n),this.rankData.members=this.rankData.members.filter((function(t){return i.containsItem(e,t.id)}))},containsItem:function(e,t){var a=!1;return e.forEach((function(e){if(e.id){if(e.id===t)return a=!0,!1}else if(e===t)return a=!0,!1})),a},dialogFilterDataChange:function(){this.dialogPagination.currentPage=1,this.queryPeople()},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.queryPeople()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.queryPeople()},handleRankConfirmed:function(e,t){this.selectedRankList.length?(this.showRankDialog=!1,this.memberRankHandle()):this.$message({showClose:!0,message:"请选择等级",type:"warning"})},memberRankHandle:function(){var e;this.selVipList(),this.rankData.memberRanks=this.selectedRankList.concat(),e=this.selectedRankList.map((function(e){return parseInt(e.id)})),e&&e.length&&this.getVipCount(e)},selVipList:function(){var e,t=this;this.selVips=[],this.vipRankList.forEach((function(a){e=[],a.ranks.forEach((function(t){t.checked&&e.push(t.name)})),e.length&&t.selVips.push({name:a.name,curSel:e.join("、")})}))},vipChange:function(e){var t=this;e.checked?this.selectedRankList.forEach((function(a,i){a.id===e.id&&t.selectedRankList.splice(i,1)})):this.selectedRankList.push({id:e.id})},getTagClassList:function(){var e=this,t={categoryType:"会员标签",shopId:window.top.SHOP_ID||"",isIncludeTag:"1"};l["a"].get(c["x"].storeTagcategories,t).then((function(t){var a=t.content,i=[{label:"全部",value:""}];i=i.concat(b(a)),e.dialogFilters[0].options=i,e.dialogFilters[0].value=[""]})).catch((function(t){"店铺不存在"!==t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){}))}},created:function(){this.getMemberRankList(),this.getVipCount(),this.getTagClassList()}},y=k,C=(a("7f51"),a("2877")),w=Object(C["a"])(y,u,m,!1,null,null,null),M=w.exports,_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"member-mgmt-card-view"},[0===e.memberCareList.length?a("div",{staticClass:"no-content",style:e.styleObject}):e._e(),e._l(e.categoryList,(function(t){return a("div",{key:t,staticClass:"category-list"},[a("div",{staticClass:"category-name"},[e._v(e._s(t))]),e._l(e.filteredList(t),(function(t){return a("item",{key:t.id,attrs:{item:t},on:{click:e.cardClick,delete:e.cardDelete,refresh:e.refresh}})}))],2)}))],2)},D=[],L=(a("6062"),a("3ca3"),a("ddb0"),a("2909")),R=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"member-care-mgmt-card-item",nativeOn:{click:function(t){return e.cardClick(t)}}},[a("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[e.hasAuthDel?a("i",{staticClass:"del-btn el-icon-error",on:{click:function(t){return t.stopPropagation(),e.handleDelete(t)}}}):e._e(),a("div",{staticClass:"title"},[a("span",[e._v(e._s(e.filteredTitle))]),a("span",{staticClass:"state",class:{"is-active":"1"===e.item.state}},[e._v(e._s(e.itemState))])]),a("div",{staticClass:"desc"},[e._v(e._s(e.item.description))])]),a("div",{staticClass:"content"},[a("div",{staticClass:"upper"},[e._v("内含福利:")]),a("div",{staticClass:"lower"},[e._v(" "+e._s(e.computedWelfare)+" ")])])])},x=[],N=(a("caad"),a("fb6a"),a("2532"),{name:"MemberCareMgmtCardItem",data:function(){return{}},props:{item:{type:Object,default:function(){return{name:"",rightsList:[]}}}},created:function(){},computed:Object(s["a"])(Object(s["a"])({},Object(d["c"])("Authority",["currentAuth"])),{},{hasAuthDel:function(){return this.currentAuth.includes("admin:member.memberCare.care.delete")},hasAuthEdit:function(){return this.currentAuth.includes("admin:member.memberCare.care.edit")},filteredTitle:function(){return this.item.name.length>15?this.item.name.slice(0,15)+"...":this.item.name},itemState:function(){var e=this.item.state;return"0"===e?"已停用":"已启用"},rights:function(){if(!this.item.rightsList.length)return"";var e=this.item.rightsList.map((function(e){return e.name})).splice(0,2).join("、");return this.item.rightsList.length>2&&(e+="..."),e},computedWelfare:function(){var e=[],t=this.item;return t.point>0&&e.push("".concat(t.point," 积分")),t.bean>0&&e.push("".concat(t.bean," V豆")),t.rightsList.length&&e.push("".concat(this.rights)),e.join("、")}}),methods:{handleDelete:function(){this.$emit("delete",this.item.id)},cardClick:function(){this.$emit("click",this.item.id)}}}),S=N,O=(a("10e4"),Object(C["a"])(S,R,x,!1,null,null,null)),j=O.exports,I=a("f260"),V=a.n(I),T={name:"MemberCareMgmtCardView",data:function(){return{}},props:{memberCareList:{type:Array,default:function(){return[]}}},components:{Item:j},created:function(){},computed:{styleObject:function(){return{position:"absolute",top:0,bottom:0,left:0,right:0,margin:"auto",background:"url("+V.a+") 50% 50% / auto 200px no-repeat"}},categoryList:function(){return Object(L["a"])(new Set(this.memberCareList.map((function(e){return e.category.name}))))}},methods:{filteredList:function(e){return this.memberCareList.filter((function(t){return t.category.name===e}))},cardClick:function(e){this.$emit("click",e)},cardDelete:function(e){this.$emit("delete",e)},refresh:function(){this.$emit("refresh")}}},z=T,$=(a("4fa4"),Object(C["a"])(z,_,D,!1,null,null,null)),P=$.exports,A=a("7132"),B=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"care-card-base-info"},[a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.formModel,"label-width":"110px",size:"small"}},[a("el-form-item",{attrs:{label:"关怀卡分类",prop:"category"}},[a("el-select",{model:{value:e.formModel.category,callback:function(t){e.$set(e.formModel,"category",t)},expression:"formModel.category"}},e._l(e.categoryList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"关怀卡名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入关怀卡名称",maxlength:"15"},model:{value:e.formModel.name,callback:function(t){e.$set(e.formModel,"name",t)},expression:"formModel.name"}})],1),a("el-form-item",{staticClass:"isRequired",attrs:{label:"发放条件",prop:"type"}},[a("el-cascader",{attrs:{options:e.options},model:{value:e.bindValue,callback:function(t){e.bindValue=t},expression:"bindValue"}})],1),"2"!==e.bindValue[1]?a("el-form-item",{attrs:{label:"发放规则",prop:"5"===e.bindValue[1]?"triggerDate":""}},["0"===e.bindValue[1]||"3"===e.bindValue[1]||"4"===e.bindValue[1]?a("div",[a("el-input-number",{attrs:{min:0},model:{value:e.formModel.triggerBoundary,callback:function(t){e.$set(e.formModel,"triggerBoundary",t)},expression:"formModel.triggerBoundary"}}),e._v("天前发放 ")],1):e._e(),"3"===e.bindValue[1]?a("div",[a("el-input-number",{attrs:{min:0},model:{value:e.formModel.triggerKilometres,callback:function(t){e.$set(e.formModel,"triggerKilometres",t)},expression:"formModel.triggerKilometres"}}),e._v("或公里前发放 ")],1):e._e(),"1"===e.bindValue[1]||"6"===e.bindValue[1]?a("div",[a("el-input-number",{attrs:{min:0},model:{value:e.formModel.triggerBoundary,callback:function(t){e.$set(e.formModel,"triggerBoundary",t)},expression:"formModel.triggerBoundary"}}),e._v("元发放 ")],1):e._e(),"5"===e.bindValue[1]?a("div",[a("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.formModel.triggerDate,callback:function(t){e.$set(e.formModel,"triggerDate",t)},expression:"formModel.triggerDate"}}),e._v("发放 ")],1):e._e(),"7"===e.bindValue[1]?a("div",[a("el-radio-group",{model:{value:e.formModel.triggerActivityChange,callback:function(t){e.$set(e.formModel,"triggerActivityChange",t)},expression:"formModel.triggerActivityChange"}},[a("el-radio",{attrs:{label:"0"}},[e._v("活跃度上升")]),a("el-radio",{attrs:{label:"1"}},[e._v("活跃度下降")])],1)],1):e._e()]):e._e(),"0"===e.bindValue[1]||"3"===e.bindValue[1]||"4"===e.bindValue[1]||"5"===e.bindValue[1]?a("el-form-item",{attrs:{label:"发放时间",prop:"publishTime"}},[a("el-select",{model:{value:e.formModel.publishTime,callback:function(t){e.$set(e.formModel,"publishTime",t)},expression:"formModel.publishTime"}},[a("el-option",{attrs:{label:"01:00",value:"01:00"}}),a("el-option",{attrs:{label:"02:00",value:"02:00"}}),a("el-option",{attrs:{label:"03:00",value:"03:00"}}),a("el-option",{attrs:{label:"04:00",value:"04:00"}}),a("el-option",{attrs:{label:"05:00",value:"05:00"}}),a("el-option",{attrs:{label:"06:00",value:"06:00"}}),a("el-option",{attrs:{label:"07:00",value:"07:00"}}),a("el-option",{attrs:{label:"08:00",value:"08:00"}}),a("el-option",{attrs:{label:"09:00",value:"09:00"}}),a("el-option",{attrs:{label:"10:00",value:"10:00"}}),a("el-option",{attrs:{label:"11:00",value:"11:00"}}),a("el-option",{attrs:{label:"12:00",value:"12:00"}}),a("el-option",{attrs:{label:"13:00",value:"13:00"}}),a("el-option",{attrs:{label:"14:00",value:"14:00"}}),a("el-option",{attrs:{label:"15:00",value:"15:00"}}),a("el-option",{attrs:{label:"16:00",value:"16:00"}}),a("el-option",{attrs:{label:"17:00",value:"17:00"}}),a("el-option",{attrs:{label:"18:00",value:"18:00"}}),a("el-option",{attrs:{label:"19:00",value:"19:00"}}),a("el-option",{attrs:{label:"20:00",value:"20:00"}}),a("el-option",{attrs:{label:"21:00",value:"21:00"}}),a("el-option",{attrs:{label:"22:00",value:"22:00"}}),a("el-option",{attrs:{label:"23:00",value:"23:00"}}),a("el-option",{attrs:{label:"24:00",value:"24:00"}})],1)],1):e._e(),a("el-form-item",{attrs:{label:"关怀卡样式",prop:"style"}},[a("el-select",{model:{value:e.formModel.style,callback:function(t){e.$set(e.formModel,"style",t)},expression:"formModel.style"}},[a("el-option",{attrs:{label:"样式1",value:"0"}}),a("el-option",{attrs:{label:"样式2",value:"1"}}),a("el-option",{attrs:{label:"样式3",value:"2"}})],1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:function(t){e.templateDialogVisible=!0}}},[e._v("全部样式")]),a("el-button",{directives:[{name:"popover",rawName:"v-popover:tips",arg:"tips"}],attrs:{type:"text",size:"small"}},[a("i",{staticClass:"iconfont el-icon-question"})]),a("el-popover",{ref:"tips",attrs:{placement:"bottom-start",width:"300",trigger:"hover",content:"点击此处查看全部样式"}})],1),a("el-form-item",{staticClass:"is-required",attrs:{label:"关怀卡福利",prop:"welfare"}},[a("el-checkbox-group",{model:{value:e.welfareChecks,callback:function(t){e.welfareChecks=t},expression:"welfareChecks"}},[a("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.validateForm,expression:"validateForm"}],staticClass:"welfare-item"},[a("el-checkbox",{staticStyle:{width:"55px"},attrs:{label:"point"}},[e._v("积分")]),a("el-input-number",{directives:[{name:"show",rawName:"v-show",value:e.welfareChecks.includes("point"),expression:"welfareChecks.includes('point')"}],attrs:{min:1},model:{value:e.formModel.point,callback:function(t){e.$set(e.formModel,"point",t)},expression:"formModel.point"}})],1),a("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.validateForm,expression:"validateForm"}],staticClass:"welfare-item"},[e._v(" . "),a("el-checkbox",{staticStyle:{width:"55px"},attrs:{label:"bean"}},[e._v("V豆")]),a("el-input-number",{directives:[{name:"show",rawName:"v-show",value:e.welfareChecks.includes("bean"),expression:"welfareChecks.includes('bean')"}],attrs:{min:1},model:{value:e.formModel.bean,callback:function(t){e.$set(e.formModel,"bean",t)},expression:"formModel.bean"}})],1),a("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.validateForm,expression:"validateForm"}],staticClass:"welfare-item"},[a("el-checkbox",{staticStyle:{width:"55px"},attrs:{label:"right"}},[e._v("权益")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.welfareChecks.includes("right"),expression:"welfareChecks.includes('right')"}],staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(t){e.rightSelectDialogVisible=!0}}},[e._v("+添加")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.welfareChecks.includes("right"),expression:"welfareChecks.includes('right')"},{name:"popover",rawName:"v-popover:rights",arg:"rights"}],attrs:{type:"text",size:"small"}},[a("i",{staticClass:"iconfont el-icon-question"})]),a("el-popover",{ref:"rights",attrs:{placement:"bottom-start",width:"300",trigger:"hover",content:"请前往【权益管理】进行权益的管理和维护"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.welfareChecks.includes("right"),expression:"welfareChecks.includes('right')"}],staticClass:"selected-right-list"},e._l(e.selectedRightList,(function(t){return a("div",{key:t.id,staticClass:"right-item"},[a("img",{attrs:{src:t.logo||e.defaultImg,alt:""}}),a("span",{staticClass:"right-name"},[e._v(e._s(t.name))])])})),0)])],1),a("el-form-item",{attrs:{label:"关怀介绍",prop:"description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.formModel.description,callback:function(t){e.$set(e.formModel,"description",t)},expression:"formModel.description"}})],1),a("el-form-item",{attrs:{label:"启用关怀",prop:"state"}},[a("el-switch",{attrs:{"active-value":"1","active-color":"#87d068","inactive-value":"0","inactive-color":"#d9d9d9"},model:{value:e.formModel.state,callback:function(t){e.$set(e.formModel,"state",t)},expression:"formModel.state"}})],1)],1),a("el-dialog",{attrs:{title:"权益选择",center:"",visible:e.rightSelectDialogVisible,width:"80%","append-to-body":"","custom-class":"rights-select","close-on-click-modal":!1},on:{"update:visible":function(t){e.rightSelectDialogVisible=t},close:function(t){e.rightSelectDialogVisible=!1}}},[a("el-form",{ref:"formDialog",attrs:{"label-width":"120px",size:"small"}},e._l(e.rightList,(function(t){return t.rights?a("el-form-item",{key:t.id,attrs:{label:t.name+":",prop:"rights"}},[a("el-checkbox-group",{model:{value:e.checkedRights,callback:function(t){e.checkedRights=t},expression:"checkedRights"}},e._l(t.rights,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.id,disabled:"0"===t.valid}},[a("img",{attrs:{src:t.logo||e.defaultImg,width:"50px",height:"50px"}}),a("div",{staticClass:"right_name",attrs:{title:t.name}},[e._v(e._s(t.name))])])})),1)],1):e._e()})),1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer",align:"right"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.cancel}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirm}},[e._v("确认选择")])],1)],1),a("el-dialog",{staticClass:"template-preview",attrs:{"append-to-body":"",visible:e.templateDialogVisible,open:e.templateDialogVisible,width:"1000px"},on:{close:function(t){e.templateDialogVisible=!1}}},e._l(e.templateGroup,(function(t,i){return a("div",{key:i,staticClass:"template-item"},[a("div",{staticClass:"template-name"},[e._v(e._s(t.name))]),a("div",{staticClass:"template-img"},[a("img",{attrs:{src:t.src,alt:""}})]),a("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.templateSelect(t.id)}}},[e._v("使用此模板")])],1)})),0),a("el-dialog",{staticClass:"care-card-preview",attrs:{"append-to-body":"",title:"预览",visible:e.previewDialogOpen,open:e.previewDialogOpen,width:"450px"},on:{close:function(t){e.previewDialogOpen=!1}}},[a("div",{staticClass:"card-preview",class:"card-style-"+e.formModel.style},[a("img",{attrs:{src:e.previewCardBgImg,alt:""}}),a("div",{staticClass:"preview-content"},[a("div",{staticClass:"content-detail"},[a("ol",[e.welfareChecks.includes("bean")&&e.formModel.bean>0?a("li",[a("span",[e._v("V豆: "+e._s(e.formModel.bean))])]):e._e(),e.welfareChecks.includes("point")&&e.formModel.point>0?a("li",[a("span",[e._v("积分: "+e._s(e.formModel.point))])]):e._e(),e.welfareChecks.includes("right")&&e.selectedRightList.length>0?a("li",[a("span",[e._v("权益: "+e._s(e.previewRights))])]):e._e()])]),a("div",{staticClass:"content-btn"},[e._v("前往[我的]查看")])])])])],1)},E=[],q=a("9ee9"),F=a.n(q),U=a("aa74"),W=a.n(U),H=a("5b90"),G=a.n(H),K=a("d8ac"),J=a.n(K),Z=a("c834"),Q=a.n(Z),X=a("c0b3"),Y=a.n(X),ee=a("9169"),te=function(){return{name:"",description:"",category:"",type:"0",style:"0",state:"0",publishTime:"09:00",triggerBoundary:"",triggerDate:"",triggerActivityChange:"0",triggerKilometres:"0",point:"0",bean:"0"}},ae={name:"MemberBaseInfo",directives:{Clickoutside:ee["a"]},data:function(){return{bindValue:["riqi","0"],options:[{value:"riqi",label:"日期",children:[{value:"0",label:"生日"},{value:"5",label:"指定日期"}]},{value:"huiyuan",label:"会员",children:[{value:"2",label:"新会员"},{value:"7",label:"活跃度变化"}]},{value:"dingdan",label:"订单",children:[{value:"1",label:"累计消费"},{value:"6",label:"单次消费"}]},{value:"shouhou",label:"售后",children:[{value:"3",label:"保养到期"},{value:"4",label:"保险到期"}]}],defaultImg:"/resources/admin/images/default/icon_vip.png",categoryList:[],templateDialogVisible:!1,flg:!0,templateGroup:[{id:"0",name:"样式1",src:J.a},{id:"1",name:"样式2",src:Q.a},{id:"2",name:"样式3",src:Y.a}],previewDialogOpen:!1,rightSelectDialogVisible:!1,loading:!1,welfareChecks:[],welfareList:[{name:"积分",value:"point"},{name:"V豆",value:"bean"},{name:"权益",value:"rightList"}],rightList:[],checkedRights:[],selectedRights:[],formModel:te(),operations:[{label:"预览",name:"preview",type:""},{label:"保存",name:"save",type:"primary",auth:["admin:member.memberCare.care.edit"]}],rules:{category:[{required:!0,message:"请选择关怀卡分类",trigger:"blur"}],name:[{required:!0,message:"请输入关怀卡名称",trigger:"blur"}],welfare:[{validator:this.validateWelfare,trigger:"blur"}],triggerDate:[{required:!0,message:"请输入发放规则",trigger:"blur"}],publishTime:[{required:!0,message:"请选择发放时间",trigger:"blur"}]}}},props:{memberRankList:Array,defaultShop:{type:Object,default:function(){return{id:"",name:"",address:""}}},isEdit:{type:Boolean,default:function(){return!0}},itemId:{type:Object,default:function(){return{id:""}}}},components:{BizSaveButton:f["a"],BizGrid:p["a"]},created:function(){this.getCategoryList(),this.getRightList()},mounted:function(){},computed:Object(s["a"])(Object(s["a"])({},Object(d["c"])(["getUser"])),{},{id:function(){return this.itemId.id},shopId:function(){return this.getUser.shop&&this.getUser.shop.id||window.top.SHOP_ID||""},selectedRightList:function(){var e=this,t=[];return this.rightList.forEach((function(a){a.rights&&a.rights.forEach((function(a){e.selectedRights.includes(a.id)&&t.push(a)}))})),t},previewCardBgImg:function(){switch(this.formModel.style){case"0":return F.a;case"1":return W.a;case"2":return G.a;default:return""}},previewRights:function(){return this.selectedRightList.length?this.selectedRightList.map((function(e){return e.name})).splice(0,2).join(" ")+"".concat(this.selectedRightList.length>2?"...":""):""}}),watch:{id:function(e,t){e!==t&&(this.$refs.form.$el.scrollTop=0,this.$refs.form.clearValidate(),this.clear(),e&&this.refresh())}},methods:{validateForm:function(){this.$refs.form.validateField("welfare")},validateWelfare:function(e,t,a){var i=this.welfareChecks,n=this.formModel,r=this.selectedRights,s=i.length&&(i.includes("point")&&n.point>0||i.includes("bean")&&n.bean>0||i.includes("right")&&!!r.length);if(!s)return a(new Error("请选择关怀卡福利"));a()},templateSelect:function(e){this.formModel.style=e,this.templateDialogVisible=!1},getCategoryList:function(){var e=this,t=this.shopId,a={shopId:t,pageNumber:1,pageSize:1e3};l["a"].get(c["g"].memberCareMgmt.categoryList,a).then((function(t){e.categoryList=t.dataList,e.formModel.category=e.categoryList[0].id})).catch()},getRightList:function(){var e=this,t={shopId:this.shopId};l["a"].get(c["g"].memberCareMgmt.rightList,t).then((function(t){e.rightList=t.content})).catch()},cancel:function(){this.checkedRights=Object(L["a"])(this.selectedRights),this.rightSelectDialogVisible=!1},confirm:function(){0===this.checkedRights.length?this.$message("请选择权益"):(this.selectedRights=Object(L["a"])(this.checkedRights),this.rightSelectDialogVisible=!1)},operate:function(e){this[e]()},clear:function(){this.$refs.form.clearValidate(),this.formModel=te(),this.categoryList[0]&&(this.formModel.category=this.categoryList[0].id),this.selectedRights=[],this.checkedRights=[],this.welfareChecks=[]},save:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.itemId.id?e.update():e.create())}))},create:function(){var e=this;this.flg=!0;var t=this.shopId;["bean","point","right"].forEach((function(t,a){e.welfareChecks.includes(t)||(a<2?e.formModel[t]="0":(e.selectedRights=[],e.checkedRights=[]))}));var a=this.selectedRights.map((function(e){return{id:e}}));if(this.welfareChecks.includes("right")&&0===a.length&&(this.$message.warning("请选择权益"),this.flg=!1),!this.flg)return!1;this.formModel.type=this.bindValue[1];var i=Object.assign({},this.formModel,{category:{id:this.formModel.category}},{rightsList:a},{shopId:t});l["a"].post(c["g"].memberCareMgmt.memberCare,i).then((function(t){e.$message.success("操作成功"),e.$emit("refresh",t.data.id)})).catch((function(t){e.$notify({message:t.errorMessage,type:"warning"})}))},update:function(){var e=this;this.flg=!0;var t=this.shopId;["bean","point","right"].forEach((function(t,a){e.welfareChecks.includes(t)||(a<2?e.formModel[t]="0":(e.selectedRights=[],e.checkedRights=[]))})),this.formModel.type=this.bindValue[1];var a=this.selectedRights.map((function(e){return{id:e}}));if(this.welfareChecks.includes("right")&&0===a.length&&(this.$message.warning("请选择权益"),this.flg=!1),!this.flg)return!1;var i=Object.assign({},this.formModel,{category:{id:this.formModel.category}},{rightsList:a},{shopId:t},{id:this.itemId.id});l["a"].put(c["g"].memberCareMgmt.memberCare,i).then((function(t){e.$message.success("更新成功"),e.$emit("refresh",t.data.id)})).catch((function(t){e.$notify({message:t.errorMessage,type:"warning"})}))},preview:function(){this.previewDialogOpen=!0},refresh:function(){var e=this,t=this.itemId.id,a={id:t};l["a"].get(c["g"].memberCareMgmt.memberCare,a).then((function(t){e.formModel=Object.assign({},te(),t.data),e.formModel.category=t.data.category.id,"0"===e.formModel.type||"5"===e.formModel.type?e.bindValue=["riqi",e.formModel.type]:"2"===e.formModel.type||"7"===e.formModel.type?e.bindValue=["huiyuan",e.formModel.type]:"1"===e.formModel.type||"6"===e.formModel.type?e.bindValue=["dingdan",e.formModel.type]:"3"!==e.formModel.type&&"4"!==e.formModel.type||(e.bindValue=["shouhou",e.formModel.type]),e.selectedRights=t.data.rightsList.map((function(e){return e.id})),e.checkedRights=Object(L["a"])(e.selectedRights),"0"!==t.data.bean&&e.welfareChecks.push("bean"),"0"!==t.data.point&&e.welfareChecks.push("point"),t.data.rightsList.length>0&&e.welfareChecks.push("right")})).catch()}}},ie=ae,ne=(a("0b13f"),Object(C["a"])(ie,B,E,!1,null,null,null)),re=ne.exports,se=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"market-activity-activity-notice"},[a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.formModel,rules:e.rules,size:"small","label-width":"110px"}},[a("el-form-item",{staticClass:"is-required",attrs:{label:"通知方式",prop:"noticeMethod"}},[a("div",{staticClass:"notify-type"},[a("div",{staticClass:"item"},[a("el-checkbox",{attrs:{"true-label":"1","false-label":"0"},model:{value:e.formModel.isAppNotice,callback:function(t){e.$set(e.formModel,"isAppNotice",t)},expression:"formModel.isAppNotice"}},[e._v("App消息")]),a("div",{directives:[{name:"show",rawName:"v-show",value:"1"===e.formModel.isAppNotice,expression:"formModel.isAppNotice === '1'"}],staticClass:"preview-content"},[a("el-input",{attrs:{placeholder:"请输入通知内容，不超过100字符",type:"textarea",rows:3,maxlength:100},model:{value:e.formModel.appMsgContent,callback:function(t){e.$set(e.formModel,"appMsgContent",t)},expression:"formModel.appMsgContent"}})],1)],1),a("div",{staticClass:"item"},[a("el-checkbox",{attrs:{"true-label":"1","false-label":"0"},model:{value:e.formModel.isWechatNotice,callback:function(t){e.$set(e.formModel,"isWechatNotice",t)},expression:"formModel.isWechatNotice"}},[e._v("微信消息")]),a("div",{directives:[{name:"show",rawName:"v-show",value:"1"===e.formModel.isWechatNotice,expression:"formModel.isWechatNotice === '1'"}],staticClass:"preview-content"},[a("el-input",{attrs:{type:"textarea",rows:3,maxlength:100,placeholder:"请输入通知内容，不超过100字符"},model:{value:e.formModel.wechatMsgTitle,callback:function(t){e.$set(e.formModel,"wechatMsgTitle",t)},expression:"formModel.wechatMsgTitle"}}),a("div",[e._v("活动主题： "),a("span",{staticClass:"custom-c"},[e._v(e._s(e.formModel.wechatMsgSubject))])]),a("div",[e._v("通知时间： "),a("span",{staticClass:"custom-c"},[e._v(e._s(e.formModel.wechatMsgTime))])]),a("el-input",{attrs:{type:"textarea",placeholder:"请输入通知内容，不超过100字符",rows:3,maxlength:100},model:{value:e.formModel.wechatMsgContent,callback:function(t){e.$set(e.formModel,"wechatMsgContent",t)},expression:"formModel.wechatMsgContent"}})],1)],1),a("div",{staticClass:"item"},[a("el-checkbox",{attrs:{"true-label":"1","false-label":"0"},model:{value:e.formModel.isSmsNotice,callback:function(t){e.$set(e.formModel,"isSmsNotice",t)},expression:"formModel.isSmsNotice"}},[e._v("短信消息")]),a("div",{directives:[{name:"show",rawName:"v-show",value:"1"===e.formModel.isSmsNotice,expression:"formModel.isSmsNotice === '1'"}],staticClass:"preview-content"},[e._v(" "+e._s(e.formModel.smsMsgContent)+" ")])],1)])])],1)],1)},oe=[],le=function(){return{isAppNotice:"0",isWechatNotice:"0",isSmsNotice:"0",appMsgContent:"",wechatMsgContent:"",wechatMsgSubject:"",wechatMsgTime:"",wechatMsgTitle:"",smsMsgContent:""}},ce={name:"CareCardNotice",components:{BizSaveButton:f["a"],BizGrid:p["a"]},data:function(){return{loading:!1,activity:{},formModel:le(),originForm:{},operations:[{label:"保存",name:"save",type:"primary",auth:["admin:member.memberCare.care.edit"]}],rules:{noticeMethod:[{required:!0,trigger:"blur",validator:this.validateMethod}]}}},props:{itemId:{type:Object,default:function(){return{id:""}}}},computed:Object(s["a"])({},Object(d["c"])(["getUser"])),watch:{itemId:function(e,t){e.id&&this.refresh()}},created:function(){this.refresh()},methods:{operate:function(e){this[e]()},validateMethod:function(e,t,a){var i=this.formModel,n=i.isAppNotice,r=i.appMsgContent,s=i.isWechatNotice,o=i.wechatMsgTitle,l=i.wechatMsgContent,c=i.isSmsNotice;return Number(s+n+c)?Number(n)&&!r?a(new Error("请填写APP消息内容")):!Number(s)||o&&l?void a():a(new Error("请填写微信消息内容")):a(new Error("请选择通知方式"))},save:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.loading=!0;var a=e.formModel,i=a.isAppNotice,n=a.appMsgContent,r=a.isWechatNotice,s=a.wechatMsgTitle,o=a.wechatMsgContent,d=a.isSmsNotice,u={memberCareId:e.itemId.id,isAppNotice:i,isWechatNotice:r,isSmsNotice:d,appMsgContent:n,wechatMsgTitle:s,wechatMsgContent:o};"0"===i&&Object.assign(u,{appMsgContent:e.originForm.appMsgContent}),"0"===r&&Object.assign(u,{wechatMsgTitle:e.originForm.wechatMsgTitle,wechatMsgContent:e.originForm.wechatMsgContent}),l["a"].put(c["g"].memberCareMgmt.careNotice,u).then((function(t){e.$message.success("更新成功")})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))}}))},refresh:function(){var e=this;if(this.itemId.id){var t={memberCareId:this.itemId.id};this.loading=!0,l["a"].get(c["g"].memberCareMgmt.careNotice,t).then((function(t){e.formModel=Object.assign({},t.data),e.originForm=Object.assign({},t.data)})).catch().finally((function(){e.loading=!1}))}}}},de=ce,ue=(a("980a"),Object(C["a"])(de,se,oe,!1,null,null,null)),me=ue.exports,he=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"refueling-record"},[i("div",{attrs:{slot:"top"},slot:"top"},[i("biz-filter",{attrs:{filters:e.filters},on:{filterDataChange:e.filterDataChange}})],1),i("biz-list",{key:Math.random(),ref:"table",attrs:{tableData:e.tableData,height:"100%"},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}},[i("el-table-column",{attrs:{prop:"name",label:"会员",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"customer-info"},[t.row.member.head?i("img",{attrs:{src:t.row.member.head}}):i("img",{attrs:{src:a("624d")}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"title",attrs:{title:t.row.member.name}},[e._v(e._s(t.row.member.name))]),i("div",{staticClass:"gender"},[i("span",[e._v(e._s(t.row.member.mobile))])])])])]}}])}),i("el-table-column",{attrs:{prop:"createDate",label:"发放时间",width:"90px"}}),i("el-table-column",{attrs:{prop:"type",label:"关怀类型",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getType(t.row.type))+" ")]}}])}),i("el-table-column",{attrs:{label:"发放福利"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"cell-content"},[i("div",{staticClass:"slot-top"},[0!==Number(t.row.bean)?i("p",[e._v("V豆: "+e._s(t.row.bean))]):e._e(),0!==Number(t.row.point)?i("p",[e._v("积分: "+e._s(t.row.point))]):e._e()]),t.row.rightsList.length?i("div",{staticClass:"slot-bottom"},[e._v(" 权益: "+e._s(e.getRights(t.row.rightsList))+" ")]):e._e()])]}}])})],1),i("div",{attrs:{slot:"bottom"},slot:"bottom"},[i("biz-pagination",{attrs:{pagination:e.pagination},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1)],1)},ge=[],pe=a("7558"),fe=a("5c40"),be=a("8c35"),ve={name:"RefuelingRecord",components:{BizGrid:p["a"],BizList:pe["a"],BizPagination:fe["a"],BizFilter:be["a"]},data:function(){return{loading:!1,tableData:[],filters:[{type:"input",placeholder:"请输入姓名/手机号",name:"searchbar",value:""}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0,pagerCount:2}}},props:{itemId:{type:Object,default:function(){return{id:""}}}},methods:Object(s["a"])(Object(s["a"])({},Object(d["c"])(["getUser"])),{},{getType:function(e){switch(e){case"0":return"会员生日";case"1":return"会员消费";case"2":return"新会员注册";case"3":return"保养到期";case"4":return"保险到期";case"5":return"指定日期";case"6":return"单次消费";case"7":return"活跃度变化";default:return""}},getWelfare:function(e){return"V豆: ".concat(e.bean,", 积分: ").concat(e.point)},getRights:function(e){return e.length?e.map((function(e){return e.name})).splice(0,2).join("、"):""},filterDataChange:function(e){this.filters=e,this.getList()},clearSearchValue:function(){this.filters[0].value=""},getList:function(){var e=this;this.loading=!0;var t={memberCareId:this.itemId.id,shopId:this.getUser.shop&&this.getUser.shop.id||window.top.SHOP_ID||"",pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize,searchValue:this.filters[0].value,beginTime:"",endTime:""};l["a"].get(c["g"].memberCareMgmt.careRecord,t).then((function(t){e.loading=!1,e.tableData=t.dataList,e.pagination.total=Number(t.total)})).catch((function(t){e.loading=!1,t.errorMessage&&console.log(t.errorMessage)}))},handleSizeChange:function(e){this.pagination.pageSize=e,this.pagination.currentPage=1,this.getList()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.getList()}}),watch:{itemId:function(e,t){this.clearSearchValue(),e.id&&this.getList()}},created:function(){this.getList()}},ke=ve,ye=(a("0643"),Object(C["a"])(ke,he,ge,!1,null,null,null)),Ce=ye.exports,we={name:"MemberCareMgmt",data:function(){return{itemId:{id:""},loading:!1,activeActivity:{},initInfo:{memberRankList:[]},orderProperty:"",orderDirection:"",height:"100%",isCreated:!1,popupTabName:"baseinfo",openPopup:!1,editShopIds:[],isEdit:!0,shopList:[],memberCareList:[],multipleSelection:[],rankData:{id:"",target:"0",members:[],memberRanks:[]},operations:[{label:"添加",name:"create",type:"primary",auth:["admin:member.memberCare.care.add"]},{label:"刷新",name:"refresh",type:""}],filters:[{type:"input",label:"",placeholder:"请输入关怀卡名称",select:[],name:"searchValue",value:""}]}},components:{BizGrid:p["a"],BizHeader:o["d"],BizPopupTabs:A["a"],MemberBaseInfo:re,MemberCareCardView:P,MemberNotice:me,RefuelingRecord:Ce,RankItem:M},created:function(){this.refresh()},mounted:function(){this.popupTabName="baseinfo"},watch:{},computed:{},methods:Object(s["a"])(Object(s["a"])({},Object(d["c"])(["getUser"])),{},{create:function(){this.popupTabName="baseinfo",this.itemId={id:""},this.$set(this.rankData,"target","0"),this.$set(this.rankData,"members",[]),this.$set(this.rankData,"memberRanks",[]),this.openPopup=!0},refresh:function(e){e&&(this.itemId={id:e}),this.getList()},operate:function(e){this[e]()},filterDataChange:function(){this.getList()},rowClick:function(e){var t=this;this.popupTabName="baseinfo",this.itemId={id:e},l["a"].get(c["g"].memberCareMgmt.memberCare,{id:e}).then((function(a){var i=a.data,n=i.target,r=i.members,s=i.memberRanks;t.rankData.target=n,t.rankData.members=r,t.rankData.memberRanks=s,t.rankData.id=e,"0"===t.rankData.target?t.$refs.rank.getVipCount():t.rankData.memberRanks.length&&t.$refs.rank.memberRankHandle(),t.openPopup=!0})).catch()},cardDelete:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a={ids:[e]};l["a"].delete(c["g"].memberCareMgmt.memberCare,a).then((function(e){t.$message({type:"success",message:"删除成功!"}),t.refresh()})).catch((function(e){t.$message({type:"warning",message:e.errorMessage})}))}))},formatContent:function(e){var t=e.replace(/<script[^>]*?>.*<\/script>/g,"");return t=t.replace(/<style[^>]*?>.*<\/style>/g,""),t=t.replace(/<[^>]+>/g,""),t=t.replace(/\\&[a-zA-Z]{1,10};/g,""),t},getList:function(){var e=this;this.loading=!0;var t=this.filters[0].value,a=this.getUser.shop&&this.getUser.shop.id||window.top.SHOP_ID||"",i={shopId:a,pageNumber:1,pageSize:1e3,searchValue:t};l["a"].get(c["g"].memberCareMgmt.careCardList,i).then((function(t){e.loading=!1,e.memberCareList=t.dataList;var a,i=Object(r["a"])(t.dataList);try{for(i.s();!(a=i.n()).done;){var n=a.value;"0"===n.type&&""===n.description?n.description="此关怀卡是对会员生日的关怀，在会员生日前将卡内的福利发放给会员。":"1"===n.type&&""===n.description?n.description="此关怀卡是对老会员累计消费的回馈关怀，在会员累计消费满一定金额时将该卡内的福利发放给会员。":"2"===n.type&&""===n.description?n.description="此关怀卡是对新注册会员的关怀，在会员注册并登陆时将该卡内的福利发放给会员。":"3"===n.type&&""===n.description?n.description="此关怀卡是对会员车辆保养提醒的关怀，在保养快到期时将该卡内的福利发放给会员。":"4"===n.type&&""===n.description?n.description="此关怀卡是对会员车辆续保提醒的关怀，在保险快到期时将该卡内的福利发放给会员。":"5"===n.type&&""===n.description&&(n.description="次关怀卡是该指定日期对会员的关怀，在该日期时将卡内的福利发放给会员。")}}catch(s){i.e(s)}finally{i.f()}})).catch((function(t){e.$message.warning(t.errorMessage),e.loading=!1}))}})},Me=we,_e=(a("5ca4"),Object(C["a"])(Me,i,n,!1,null,null,null));t["default"]=_e.exports},"8cdd":function(e,t,a){},"980a":function(e,t,a){"use strict";var i=a("15d8"),n=a.n(i);n.a},"9ee9":function(e,t,a){e.exports=a.p+"static/img/birthday_blank.1af1afb9.png"},aa74:function(e,t,a){e.exports=a.p+"static/img/festival_blank.6d40cda5.png"},c0b3:function(e,t,a){e.exports=a.p+"static/img/common.733a19d7.png"},c0d7:function(e,t,a){},c834:function(e,t,a){e.exports=a.p+"static/img/festival.fd638d2e.png"},d8ac:function(e,t,a){e.exports=a.p+"static/img/birthday.f89d9117.png"}}]);