(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e6e7a08"],{"0f68":function(t,e,a){},2497:function(t,e,a){"use strict";var i=a("4360"),o=a("a18c");e["a"]=function(t,e){return function(a){var r=a.data;"100"===r.resultCode?t(r):"709"===r.resultCode?(i["a"].commit("updateUser",{shop:{}}),console.log("未登录: ",i["a"].getters.currentUser),o["a"].push("/login")):e(r)}}},"2c8a":function(t,e,a){},"498a":function(t,e,a){"use strict";var i=a("23e7"),o=a("58a8").trim,r=a("c8d2");i({target:"String",proto:!0,forced:r("trim")},{trim:function(){return o(this)}})},"4ba1":function(t,e,a){},"4f84":function(t,e,a){},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,a){var i=a("1d80"),o=a("5899"),r="["+o+"]",n=RegExp("^"+r+r+"*"),s=RegExp(r+r+"*$"),c=function(t){return function(e){var a=String(i(e));return 1&t&&(a=a.replace(n,"")),2&t&&(a=a.replace(s,"")),a}};t.exports={start:c(1),end:c(2),trim:c(3)}},"59aa":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-grid",{staticClass:"invoicing-category-mgmt"},[a("div",{staticClass:"invoicing-category-mgmt-header",attrs:{slot:"top"},slot:"top"},[a("biz-header",{attrs:{operations:t.operations},on:{operate:t.operate}})],1),a("expand-table",{ref:"expandTable",attrs:{data:t.tableData,loading:t.loading,isSearch:t.isSearch},on:{"expand-change":t.expandChange,delete:t.handleDelete,"row-click":t.rowClick,"selection-change":t.handleSelectionChange,moveUp:t.moveUp,moveDown:t.moveDown}}),a("biz-pagination",{attrs:{slot:"bottom",pagination:t.pagination},slot:"bottom"}),a("category-mgmt-popup",{attrs:{slot:"float",open:t.open,isEdit:t.isEdit,itemId:t.itemId,tabName:t.tabName},on:{close:function(e){t.open=!1,t.itemId=""},operationSuccess:t.operationSuccess,createdCategorySuccess:t.createdCategorySuccess},slot:"float"}),a("category-mgmt-input-popup",{attrs:{slot:"float",open:t.inputPopupOpen},on:{close:function(e){t.inputPopupOpen=!1},operationSuccess:t.operationSuccess},slot:"float"})],1)},o=[],r=(a("c975"),a("d81d"),a("b0c0"),a("a9e3"),a("b85c")),n=a("04d3"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"expandTable",staticClass:"expand-table",staticStyle:{width:"100%","min-height":"100%"},attrs:{size:"small","tooltip-effect":"dark","row-key":"id",height:t.height,border:t.showBorder,data:t.data,"show-header":t.showHeader,"expand-row-keys":t.expandedRowKeys,rowClassName:t.setClassName,"cell-class-name":t.cellClassName},on:{"expand-change":t.expandChangeHandler,"row-click":t.rowClickHandler,"selection-change":t.handleSelectionChange,moveUp:t.moveUp,moveDown:t.moveDown}},[t.isSearch?a("el-table-column",{attrs:{type:"expand",label:t.maxLevel,width:"100","class-name":"1"===t.hasChild?"cell"+t.layer:"cell0"+t.layer},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.childrenProductCategoryDataList.length>0?a("expand-table",{staticClass:"expand-table-child",attrs:{height:"auto",layer:t.layer+1,hasChild:e.row.hasChild,data:e.row.childrenProductCategoryDataList,"show-header":!1,"show-border":!1,"expand-row-keys":t.expandedRowKeys},on:{delete:t.deleteFunction,"expand-change":t.expandChangeHandler,"row-click":t.rowClickHandler,"selection-change":t.handleSelectionChange,moveUp:t.moveUp,moveDown:t.moveDown}}):t._e()]}}],null,!1,2207010269)}):t._e(),a("el-table-column",{attrs:{prop:"name",label:"分类","class-name":"first-category-name"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("div",{staticClass:"biz-two-column"},[a("img",{attrs:{src:e.row.logo||t.DefaultImg,width:"32px",height:"32px"}}),a("div",{staticClass:"biz-two-row"},[a("div",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(e.row.name))])])])])}}])}),a("el-table-column",{attrs:{prop:"specificationDataList",label:"规格","class-name":"first-category-name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._l(e.row.specificationDataList,(function(a,i){return[t._v(" "+t._s(a.name)+" "),i<e.row.specificationDataList.length-1?[t._v(t._s(t.separator))]:t._e()]}))]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){a.stopPropagation(),0!==e.$index&&t.moveUp(e.row)}}},[t._v("上移")]),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){a.stopPropagation(),e.$index!==t.data.length-1&&t.moveDown(e.row)}}},[t._v("下移")]),t.hasAuthDel?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.deleteFunction(e.row)}}},[t._v("删除")]):t._e()]}}])})],1)},c=[],l=(a("cb29"),a("4160"),a("caad"),a("a15b"),a("ac1f"),a("2532"),a("1276"),a("159b"),a("5530")),u=a("f3ac"),p=a.n(u),d=a("2f62"),f={name:"ExpandTable",props:{showHeader:{type:Boolean,default:!0},isSearch:{type:Boolean,default:!0},hasChild:{type:String,default:"1"},data:{type:Array,default:function(){return[]}},height:{type:String,default:"100%"},loading:{type:Boolean,default:!1},showBorder:{type:Boolean,default:!0},layer:{type:Number,default:0},expandedRowKeys:{type:Array,default:function(){return[]}}},data:function(){return{maxLevel:"1",currentLevel:1,className:"",selections:[],selectionsChild:[],DefaultImg:p.a,separator:"、"}},components:{},computed:Object(l["a"])(Object(l["a"])({},Object(d["c"])("Authority",["currentAuth"])),{},{hasAuthDel:function(){return this.currentAuth.includes("admin:PurchaseSaleStorage.productCategory.delete")}}),watch:{},mounted:function(){var t=document.documentElement.clientHeight||window.innerHeight,e=String(t-205);document.querySelectorAll(".el-table__body-wrapper")[0].style.height=e+"px",document.querySelectorAll(".el-table__body-wrapper")[0].style.overflowX="hidden",document.querySelectorAll(".el-table__body-wrapper")[0].style.overflowY="auto"},updated:function(){this.doLayout()},methods:{setClassName:function(t){var e=t.row;t.index;return e.hasChild>0?"expand":"noexpand"},cellClassName:function(t){var e=t.row;t.column,t.rowIndex,t.columnIndex;return"row"+e.id},doLayout:function(){document.querySelectorAll(".expand-table-child .el-table__body-wrapper").forEach((function(t){t.style.height="auto"})),document.querySelectorAll(".el-table__expand-icon").forEach((function(t){t.children[0].className="iconfont biz-icon-i-web-zk1"}))},formatTreeLayer:function(t,e){var a=[];return e&&(a.push(new Array(e).fill("|").join(" ")),a.push("--")),a.push(t),a.join("")},expandChangeHandler:function(t,e){this.doLayout(),this.className&&this.className.split(".")[1]!=="row"+t.id&&(document.querySelector(this.className).children[0].children[0].style.color="#666666"),this.className=".row"+t.id,document.querySelector(this.className).children[0].children[0].style.color="#ff7300";var a=[];console.log("this.currentLevel"+this.currentLevel),console.log("row.treeLevel"+this.currentLevel),e&&e.length>0?this.currentLevel=t.treeLevel:this.currentLevel=t.treeLevel-1;for(var i=0;i<=this.currentLevel;i++)a.push(i+1);this.maxLevel=a.join(" "),console.log(this.$refs.expandTable),this.$emit("expand-change",t,e)},rowClickHandler:function(t){this.$emit("row-click",t)},deleteFunction:function(t){this.$emit("delete",t)},handleSelectionChange:function(t){this.selections=t,this.$emit("selection-change",t)},moveUp:function(t){this.$emit("moveUp",t)},moveDown:function(t){this.$emit("moveDown",t)}}},m=f,h=(a("856c"),a("2877")),g=Object(h["a"])(m,s,c,!1,null,null,null),y=g.exports,D=a("f36f"),v=a("cc55"),b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-popup-tabs",{attrs:{open:t.open,value:t.tabName},on:{close:t.close}},[a("el-tab-pane",{attrs:{label:"分类信息",name:"Category"}},[a("category-setting",{attrs:{open:t.open,isEdit:t.isEdit,itemId:t.itemId},on:{operationSuccess:t.operationSuccess,createdCategorySuccess:t.createdCategorySuccess}})],1),t.itemId?a("el-tab-pane",{attrs:{label:"规格信息",name:"Specification"}},[a("specification-setting",{attrs:{itemId:t.itemId,isEdit:t.isEdit},on:{operationSuccess:t.operationSuccess}})],1):t._e(),t.itemId?a("el-tab-pane",{attrs:{label:"参数",name:"Parameter"}},[a("parameter-setting",{attrs:{itemId:t.itemId,isEdit:t.isEdit},on:{operationSuccess:t.operationSuccess}})],1):t._e()],1)},C=[],S=a("7132"),I=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-grid",{staticClass:"category-mgmt__category-setting"},[t.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operateHandler},slot:"top"}):t._e(),a("el-form",{ref:"form",attrs:{size:"small","label-width":"110px",model:t.productCategory,rules:t.rules,disabled:!t.isEdit,"inline-message":!0}},[a("el-form-item",{attrs:{label:"分类名称:",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入1-20字分类名称"},model:{value:t.productCategory.name,callback:function(e){t.$set(t.productCategory,"name",e)},expression:"productCategory.name"}})],1),a("el-form-item",{attrs:{label:"上级分类:",prop:"parentId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择上级分类",disabled:t.hasChild()},on:{change:t.changeParentId},model:{value:t.productCategory.parentId,callback:function(e){t.$set(t.productCategory,"parentId",e)},expression:"productCategory.parentId"}},t._l(t.productCategoryList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}},[a("span",{staticStyle:{float:"left"}},[t._v(t._s(!0===e.topCategory?e.name:""))]),a("span",{staticStyle:{float:"right"}},[t._v(t._s(!1===e.topCategory?e.name:""))])])})),1)],1),a("el-form-item",{attrs:{label:"类型:",prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择类型",disabled:t.hasParent()},model:{value:t.productCategory.type,callback:function(e){t.$set(t.productCategory,"type",e)},expression:"productCategory.type"}},t._l(t.typeList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"logo：",prop:"logo"}},[a("BizAvatarUploaderNew",{model:{value:t.productCategory.logo,callback:function(e){t.$set(t.productCategory,"logo",e)},expression:"productCategory.logo"}})],1),a("el-form-item",{attrs:{label:"品牌:",prop:"shopBrands"}},[a("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),a("el-checkbox-group",{on:{change:t.handleCheckedBrandsChange},model:{value:t.productCategory.shopBrandIds,callback:function(e){t.$set(t.productCategory,"shopBrandIds",e)},expression:"productCategory.shopBrandIds"}},[a("div",{staticClass:"checkbox-group"},t._l(t.brands,(function(e){return a("el-checkbox",{key:e.id,attrs:{label:e.id}},[a("div",{staticClass:"checkbox-group-item"},[t._v(" "+t._s(e.name)+" ")])])})),1)])],1)],1)],1)},w=[],P=(a("c740"),a("8330")),L=a("c17f"),x=a("8c42"),E={name:"CategorySetting",components:{BizAvatarUploaderNew:L["b"],BizSaveButton:P["a"],BizGrid:D["a"]},data:function(){return{defaultImg:"/resources/admin/images/default/product-default.png",operations:[{label:"保存",name:"save",type:"primary",auth:["admin:PurchaseSaleStorage.productCategory.edit"]}],rules:{name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],parentId:[{required:!0,message:"请选择上级分类",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:["blur","change"]}]},checkAll:!1,isIndeterminate:!1,productCategory:this.getDefaultProductCategory(),brands:[],productCategoryList:[],allCategoryList:[],typeList:[]}},props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},open:{type:Boolean}},created:function(){},methods:{query:function(){console.log("CategorySetting::query() itemId:",this.itemId),this.itemId?this.queryWidthId(Number(this.itemId)):this.queryWidthOutId()},queryWidthId:function(t){var e=this,a={id:t,shopId:window.top.SHOP_ID||""};x["a"].getProductCategory(a,(function(t){e.allCategoryList=t.productCategoryTree,e.productCategoryList=e.getTopCategoryList(t.productCategoryTree),e.brands=t.brands||[],e.typeList=t.productCategoryType;var a=Object.assign(e.getDefaultProductCategory(),t.productCategory);a.parentId=""===t.productCategory.parentId?"-1":t.productCategory.parentId,a.sort="null"===t.productCategory.sort?"":t.productCategory.sort,a.logo=""===t.productCategory.logo?e.defaultImg:t.productCategory.logo,e.productCategory=a,console.log(e.productCategory.shopBrandIds),e.checkAll=e.productCategory.shopBrandIds&&e.productCategory.shopBrandIds.length>0&&e.productCategory.shopBrandIds.length===e.brands.length,e.isIndeterminate=e.productCategory.shopBrandIds&&e.productCategory.shopBrandIds.length>0&&e.productCategory.shopBrandIds.length<e.brands.length}),(function(a){console.log("queryWidthId",t),console.log(a),e.$message.warning(a.errorMessage)}))},queryWidthOutId:function(){var t=this,e={id:"",shopId:window.top.SHOP_ID||""};x["a"].getProductCategory(e,(function(e){t.allCategoryList=e.productCategoryTree,t.productCategoryList=t.getTopCategoryList(e.productCategoryTree),t.brands=e.brands||[],t.typeList=e.productCategoryType,t.productCategory=t.getDefaultProductCategory()}),(function(e){console.log("queryWidthOutId"),console.log(e),t.$message.warning(e.errorMessage)}))},getDefaultProductCategory:function(){return{id:"",name:"",type:"",sort:"",parentId:"-1",shopBrandIds:[],topCategory:"",logo:this.defaultImg}},getDefaultTopCategory:function(){return{id:"-1",name:"顶级分类",type:"",sort:"",parentId:"-1",shopBrandIds:[],topCategory:!0}},getTopCategoryList:function(t){var e=[];e.push(this.getDefaultTopCategory());var a,i=Object(r["a"])(t);try{for(i.s();!(a=i.n()).done;){var o=a.value;!0===o.topCategory&&e.push(o)}}catch(n){i.e(n)}finally{i.f()}return e},operateHandler:function(t){this[t]()},save:function(){var t=this;console.log("save:",this.productCategory),this.$refs.form.validate((function(e){if(!e)return!1;var a=t.getSaveParams();if(t.hasSameNameProductCategory(a))return t.$message.warning("分类名称已存在"),!1;t.productCategory.id?x["a"].updateProductCategory(a,(function(e){t.$message.success("更新分类成功"),t.$emit("operationSuccess"),t.query()}),(function(e){console.log("更新分类失败 id:",t.productCategory.id),t.$message.warning(e.errorMessage)})):x["a"].saveProductCategory(a,(function(e){t.$message.success("添加分类成功"),t.$emit("operationSuccess"),t.$emit("createdCategorySuccess",e.id)}),(function(e){console.log("添加分类失败"),t.$message.warning(e.errorMessage)}))}))},getSaveParams:function(){return{id:"-1"===this.productCategory.id?"":this.productCategory.id,name:this.productCategory.name,type:this.productCategory.type,sort:this.productCategory.sort,logo:this.productCategory.logo?this.productCategory.logo:this.defaultImg,parentId:"-1"===this.productCategory.parentId?"":this.productCategory.parentId,shopBrandIds:this.productCategory.shopBrandIds,topCategory:this.productCategory.topCategory}},hasSameNameProductCategory:function(t){var e=this.allCategoryList.findIndex((function(e){return e.name===t.name}));return-1!==e&&this.allCategoryList[e].id!==t.id},handleCheckAllChange:function(t){this.productCategory.shopBrandIds=t?this.getAllShopBrandIds():[],this.isIndeterminate=!1},handleCheckedBrandsChange:function(t){console.log(this.productCategory.shopBrandIds);var e=t.length;this.checkAll=e>0&&e===this.brands.length,this.isIndeterminate=e>0&&e<this.brands.length},getAllShopBrandIds:function(){var t=[];return this.brands.forEach((function(e){t.push(e.id)})),t},changeParentId:function(t){var e=this;this.allCategoryList.forEach((function(a){a.id===t&&(e.productCategory.type=a.type)}))},hasChild:function(){var t=this;if(""===this.productCategory.id||"-1"===this.productCategory.id)return!1;var e=this.allCategoryList.findIndex((function(e){return e.parentId===t.productCategory.id}));return-1!==e},hasParent:function(){return"-1"!==this.productCategory.parentId&&""!==this.productCategory.parentId}},computed:{},watch:{itemId:function(t){!0===this.open&&this.query()},open:function(t){t?""===this.itemId&&this.query():(this.productCategory=this.getDefaultProductCategory(),this.brands=[],this.productCategoryList=[],this.typeList=[],this.allCategoryList=[],this.checkAll=!1,this.isIndeterminate=!1)}}},_=E,$=(a("6877"),Object(h["a"])(_,I,w,!1,null,null,null)),k=$.exports,V=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-grid",{staticClass:"category-mgmt__specification-setting"},[t.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operateHandler},slot:"top"}):t._e(),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.specificationDataList,size:"small"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{label:"规格名称",prop:"specificationData.name","min-width":"80"}}),a("el-table-column",{attrs:{label:"类型",prop:"specificationData.type","min-width":"80"}}),a("el-table-column",{attrs:{label:"排序",prop:"specificationData.sort","min-width":"80"}}),a("el-table-column",{attrs:{label:"规格值",prop:"specificationData.valueList","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._l(e.row.specificationData.valueList,(function(a,i){return[t._v(" "+t._s(a.name)+" "),i<e.row.specificationData.valueList.length-1?[t._v(t._s(t.separator))]:t._e()]}))]}}])}),a("el-table-column",{attrs:{prop:"title",label:"操作","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return t.rowDeleteClickHandler(e.row)}}},[t._v("删除")]),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return t.rowEditClickHandler(e.row)}}},[t._v("编辑")])]}}])})],1),a("el-form",{directives:[{name:"show",rawName:"v-show",value:t.showSpecificationDataEditor,expression:"showSpecificationDataEditor"}],ref:"specificationDataForm",attrs:{size:"small","label-width":"110px",model:t.specificationData,rules:t.rules,"inline-message":!0}},[a("el-form-item",{attrs:{label:"规格名称: ",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入规格名称"},model:{value:t.specificationData.name,callback:function(e){t.$set(t.specificationData,"name",e)},expression:"specificationData.name"}})],1),a("el-form-item",{attrs:{label:"规格类型: ",prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:t.specificationChange},model:{value:t.specificationData.type,callback:function(e){t.$set(t.specificationData,"type",e)},expression:"specificationData.type"}},t._l(t.typeList,(function(t){return a("el-option",{key:t.id,attrs:{label:t,value:t}})})),1)],1),a("el-form-item",{attrs:{label:"排序: ",prop:"sort"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入排序"},model:{value:t.specificationData.sort,callback:function(e){t.$set(t.specificationData,"sort",e)},expression:"specificationData.sort"}})],1),a("el-form-item",{attrs:{label:"规格值: ",prop:"valueList"}},[t._l(t.specificationData.valueList,(function(e){return a("el-tag",{key:e.id,staticStyle:{"margin-right":"5px"},attrs:{size:"small",closable:"","disable-transitions":!0,type:"warning"},on:{close:function(a){return t.handleTagClose(e)}},nativeOn:{click:function(a){return t.handleTagClick(e)}}},[t._v(t._s(e.name))])})),a("el-button",{attrs:{icon:"el-icon-plus",size:"small"},on:{click:function(e){return e.stopPropagation(),t.handleAddSpecificationValue(e)}}})],2)],1),a("el-form",{directives:[{name:"show",rawName:"v-show",value:t.showSpecificationValueEditor,expression:"showSpecificationValueEditor"}],ref:"specificationValueForm",attrs:{size:"small","label-width":"110px",model:t.specificationValueData,rules:t.rules,"inline-message":!0}},[a("el-form-item",{attrs:{label:"规格值名称:",prop:"valueName"}},[a("el-input",{attrs:{placeholder:"请输入规格值名称"},model:{value:t.specificationValueData.valueName,callback:function(e){t.$set(t.specificationValueData,"valueName",e)},expression:"specificationValueData.valueName"}})],1)],1),a("el-form",{directives:[{name:"show",rawName:"v-show",value:t.showSpecificationValueImageEditor,expression:"showSpecificationValueImageEditor"}],ref:"specificationValueImageForm",attrs:{size:"small","label-width":"110px",model:t.specificationValueData,rules:t.rules}},[a("el-form-item",{attrs:{label:"规格值图片:",prop:"attrValueImag"}},[a("BizAvatarUploaderNew",{attrs:{title:"建议尺寸1:1"},model:{value:t.specificationValueData.valueImage,callback:function(e){t.$set(t.specificationValueData,"valueImage",e)},expression:"specificationValueData.valueImage"}})],1)],1)],1)},O=[],N=(a("a434"),a("498a"),a("dd58")),B={name:"SpecificationSetting",components:{BizSaveButton:P["a"],BizGrid:D["a"],BizAvatarUploaderNew:L["b"]},data:function(){return{operations:[{label:"添加",name:"addSpecificationOperate",type:"primary",auth:["admin:PurchaseSaleStorage.productCategory.edit"]},{label:"保存",name:"saveSpecificationOperate",type:"primary",auth:["admin:PurchaseSaleStorage.productCategory.edit"]}],rules:{name:[{required:!0,message:"请输入规格名称",trigger:"blur"}],type:[{required:!0,message:"请输入规格类型",trigger:"blur"}],valueName:[{required:!0,min:1,message:"请输入规格值名称",trigger:"blur"}],attrValueImag:[{required:!0,min:1,message:"请输入规格值图片",trigger:"blur"}]},showSpecificationDataEditor:!1,showSpecificationValueEditor:!1,showSpecificationValueImageEditor:!1,specificationDataList:[],specificationData:this.getDefaultSpecificationData(),specificationValueData:this.getDefaultSpecificationValueData(),typeList:[],separator:"、"}},computed:{},props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},created:function(){this.query()},methods:{specificationChange:function(){this.$refs.specificationDataForm.clearValidate("type")},query:function(){this.specificationDataList=this.getSpecificationDataList()},update:function(){var t=this;N["a"].updateProductSpecification(this.getSpecificationUpdateParams(),(function(e){t.$message.success("更新规格成功"),t.query(),t.$emit("operationSuccess")}),(function(e){t.$message.warning(e.errorMessage)}))},save:function(){var t=this;N["a"].saveProductSpecification(this.getSpecificationSaveParams(),(function(e){t.$message.success("添加规格成功"),t.query(),t.$emit("operationSuccess")}),(function(e){t.$message.warning(e.errorMessage)}))},handleSelectionChange:function(t){this.operations[1].disabled=!0,t.length>0&&(this.operations[1].disabled=!1)},getSpecificationDataList:function(){var t=this,e=[],a={shopId:window.top.SHOP_ID||"",id:this.itemId};return N["a"].getProductSpecificationList(a,(function(a){a.specification.forEach((function(t,a){e.push({specificationData:{id:t.id,name:t.name,sort:t.sort,valueList:t.specificationValueData,type:t.type}})})),t.typeList=a.types,t.specificationData=t.getSpecificationData(e)}),(function(e){t.$message.warning(e.errorMessage)})),e},getSpecificationData:function(t){var e=this,a=t.findIndex((function(t){return t.specificationData.id===e.specificationData.id}));return-1!==a?{id:t[a].specificationData.id,name:t[a].specificationData.name,sort:t[a].specificationData.sort,valueList:t[a].specificationData.valueList,type:t[a].specificationData.type}:this.getDefaultSpecificationData()},operateHandler:function(t){this[t]()},rowEditClickHandler:function(t){this.specificationData=Object.assign({},t.specificationData),this.showSpecificationDataEditor=!0,this.showSpecificationValueEditor=!1,this.showSpecificationValueImageEditor=!1},rowDeleteClickHandler:function(t){this.deleteSpecification([t.specificationData.id])},saveSpecificationOperate:function(){this.showSpecificationValueImageEditor?this.saveBySpecificationValueImageForm():this.showSpecificationValueEditor?this.saveBySpecificationValueForm():this.showSpecificationDataEditor&&this.saveBySpecificationDataForm()},saveBySpecificationValueImageForm:function(){var t=this;this.$refs.specificationDataForm.validate((function(e,a){e&&t.$refs.specificationValueForm.validate((function(e,a){if(!e)return!1;t.specificationValueData.valueImage.trim()?t.saveBySpecificationValueForm():t.$refs.specificationValueImageForm.validate((function(t,e){if(!t)return!1}))}))}))},saveBySpecificationValueForm:function(){var t=this;this.$refs.specificationDataForm.validate((function(e,a){if(!e)return!1;t.$refs.specificationValueForm.validate((function(e,a){if(!e)return!1;if(t.specificationValueData.valueName.trim()){if(t.hasSameNameSpecificationData(t.specificationData))return t.$message.warning("规格名称已存在"),!1;if(t.hasSameNameSpecificationValue(t.specificationValueData,t.specificationData))return t.$message.warning("规格值名称已存在"),!1;var i=t.specificationData.valueList.findIndex((function(e){return e.id===t.specificationValueData.valueID}));-1===i?t.specificationData.valueList.push({id:t.specificationValueData.valueID,image:t.specificationValueData.valueImage,name:t.specificationValueData.valueName}):t.specificationData.valueList[i]={id:t.specificationValueData.valueID,image:t.specificationValueData.valueImage,name:t.specificationValueData.valueName},t.saveBySpecificationDataForm()}t.showSpecificationValueEditor=!1,t.showSpecificationValueImageEditor=!1}))}))},saveBySpecificationDataForm:function(){var t=this;this.$refs.specificationDataForm.validate((function(e,a){return!!e&&(t.hasSameNameSpecificationData(t.specificationData)?(t.$message.warning("规格名称已存在"),!1):void(t.specificationData.id?(t.update(),t.resetSpecificationValueData()):(t.save(),t.resetSpecificationValueData())))}))},deleteSpecification:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){N["a"].deleteProductSpecification(e.getSpecificationDeleteParams(t),(function(t){e.$message.success("删除成功"),e.$emit("operationSuccess"),e.query()}),(function(t){e.$message.warning(t.errorMessage)})),t.indexOf(e.specificationData.id)>=0&&e.resetSpecificationData(),e.resetSpecificationValueData(),e.showSpecificationValueEditor=!1,e.showSpecificationValueImageEditor=!1}))},addSpecificationOperate:function(){this.resetSpecificationData(),this.resetSpecificationValueData(),this.showSpecificationDataEditor=!0,this.showSpecificationValueEditor=!1,this.showSpecificationValueImageEditor=!1},handleAddSpecificationValue:function(){this.resetSpecificationValueData(),this.showSpecificationValueEditor=!0,"图片"===this.specificationData.type?this.showSpecificationValueImageEditor=!0:this.showSpecificationValueImageEditor=!1},handleTagClose:function(t){this.deleteSpecificationValue([t.name])},handleTagClick:function(t){this.specificationValueData={valueID:t.id,valueName:t.name,valueImage:t.image},this.showSpecificationValueEditor=!0,"图片"===this.specificationData.type?this.showSpecificationValueImageEditor=!0:this.showSpecificationValueImageEditor=!1},resetSpecificationData:function(){this.specificationData=this.getDefaultSpecificationData()},resetSpecificationValueData:function(){this.specificationValueData=this.getDefaultSpecificationValueData()},hideSpecificationDataEditor:function(){!0===this.showSpecificationDataEditor&&(this.showSpecificationDataEditor=!1,this.specificationData=this.getDefaultSpecificationData(),this.hideSpecificationValueEditor())},hideSpecificationValueEditor:function(){!0===this.showSpecificationValueEditor&&(this.showSpecificationValueEditor=!1,this.specificationValueData=this.getDefaultSpecificationValueData(),this.hideSpecificationValueImageEditor())},hideSpecificationValueImageEditor:function(){!0===this.showSpecificationValueImageEditor&&(this.showSpecificationValueImageEditor=!1,this.specificationValueData=this.getDefaultSpecificationValueData())},handleUploadSuccess:function(t){this.specificationValueData.valueImage=t},deleteSpecificationValue:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a=e.specificationDataList.findIndex((function(t){return t.specificationData.id===e.specificationData.id}));if(-1!==a){var i={id:e.specificationDataList[a].specificationData.id,name:e.specificationDataList[a].specificationData.name,sort:e.specificationDataList[a].specificationData.sort,valueList:e.specificationDataList[a].specificationData.valueList,type:e.specificationDataList[a].specificationData.type},o=[];i.valueList.forEach((function(e,a){t.indexOf(e.name)>=0&&o.push(a)})),o.reverse().forEach((function(t,e){i.valueList.splice(t,1)})),e.specificationData=i,e.hideSpecificationValueEditor(),e.update()}else console.log("关闭Tag所属的属性在属性列中不存在")}))},getSpecificationUpdateParams:function(){return{productCategoryId:this.itemId,id:this.specificationData.id,name:this.specificationData.name,sort:this.specificationData.sort,specificationValueData:this.specificationData.valueList,type:this.specificationData.type}},getSpecificationSaveParams:function(){return{productCategoryId:this.itemId,name:this.specificationData.name,sort:this.specificationData.sort,specificationValueData:this.specificationData.valueList,type:this.specificationData.type}},getSpecificationDeleteParams:function(t){return{productCategoryId:this.itemId,ids:t}},getDefaultSpecificationValueData:function(){return{valueID:"",valueImage:"",valueName:""}},getDefaultSpecificationData:function(){return{id:"",name:"",sort:"",valueList:[],type:""}},hasSameNameSpecificationData:function(t){var e=this.specificationDataList.findIndex((function(e){return e.specificationData.name===t.name}));return-1!==e&&this.specificationDataList[e].specificationData.id!==t.id},hasSameNameSpecificationValue:function(t,e){var a=e.valueList.findIndex((function(e){return e.name===t.valueName}));return-1!==a&&e.valueList[a].id!==t.valueID}},watch:{itemId:function(t){this.hideSpecificationDataEditor(),this.specificationData={},this.specificationValueData={},this.query()}}},z=B,T=(a("ab7b"),Object(h["a"])(z,V,O,!1,null,null,null)),A=T.exports,q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-grid",{staticClass:"category-mgmt__parameter-setting"},[t.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operateHandler},slot:"top"}):t._e(),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.parameterDataList,size:"small"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"name",label:"参数分类","min-width":"100"}}),a("el-table-column",{attrs:{prop:"parameters",label:"参数"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._l(e.row.parameters,(function(a,i){return[t._v(" "+t._s(a.name)+" "),i<e.row.parameters.length-1?[t._v(t._s(t.separator))]:t._e()]}))]}}])}),a("el-table-column",{attrs:{prop:"title",label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){a.stopPropagation(),e.row.id!==t.parameterDataList[0].id&&t.moveUp(e.row)}}},[t._v("上移")]),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){a.stopPropagation(),e.row.id!==t.parameterDataList[t.parameterDataList.length-1].id&&t.moveDown(e.row)}}},[t._v("下移")]),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return t.rowDeleteClickHandler(e.row)}}},[t._v(" 删除 ")]),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return t.rowEditClickHandler(e.row)}}},[t._v(" 编辑 ")])],1)]}}])})],1),a("el-form",{directives:[{name:"show",rawName:"v-show",value:t.showParameterDataEditor,expression:"showParameterDataEditor"}],ref:"parameterDataForm",attrs:{size:"small","label-width":"110px",model:t.parameterData,rules:t.parameterDataFormRules,"inline-message":!0}},[a("el-form-item",{attrs:{prop:"name",label:"名称:"}},[a("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.parameterData.name,callback:function(e){t.$set(t.parameterData,"name",e)},expression:"parameterData.name"}})],1),a("el-form-item",{attrs:{prop:"parameters",label:"参数"}},[t._l(t.parameterData.parameters,(function(e){return a("el-tag",{key:e.id,staticStyle:{"margin-right":"5px"},attrs:{size:"small",closable:"","disable-transitions":!0,type:"warning"},on:{close:function(a){return t.handleTagClose(e)}},nativeOn:{click:function(a){return t.handleTagClick(e)}}},[t._v(" "+t._s(e.name)+" ")])})),a("el-button",{attrs:{icon:"el-icon-plus",size:"mini"},on:{click:function(e){return e.stopPropagation(),t.handleAddParameterInfo(e)}}})],2)],1),a("el-form",{directives:[{name:"show",rawName:"v-show",value:t.showParameterInfoEditor,expression:"showParameterInfoEditor"}],ref:"parameterInfoForm",attrs:{size:"small","label-width":"110px",model:t.parameterInfo,rules:t.parameterInfoFormRules,"inline-message":!0}},[a("el-form-item",{attrs:{prop:"name",label:"参数名称: "}},[a("el-input",{attrs:{placeholder:"请输入参数名称"},model:{value:t.parameterInfo.name,callback:function(e){t.$set(t.parameterInfo,"name",e)},expression:"parameterInfo.name "}})],1),a("el-form-item",{attrs:{prop:"type",label:"类型: "}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择型"},model:{value:t.parameterInfo.type,callback:function(e){t.$set(t.parameterInfo,"type",e)},expression:"parameterInfo.type "}},t._l(t.parameterInfoTypeList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1)],1)],1)},F=[],j=(a("4de4"),a("8316")),H=a("1ab1"),M={name:"ParameterSetting",components:{BizSaveButton:P["a"],BizGrid:D["a"]},data:function(){return{operations:[{label:"添加",name:"add",type:"primary",auth:["admin:PurchaseSaleStorage.productCategory.edit"]},{label:"保存",name:"save",type:"primary",auth:["admin:PurchaseSaleStorage.productCategory.edit"]}],parameterDataFormRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}]},parameterInfoFormRules:{name:[{required:!0,message:"请输入参数名称",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:["blur","change"]}]},showParameterDataEditor:!1,showParameterInfoEditor:!1,parameterInfoTypeList:[],parameterDataList:[],dataList:[],parameterData:this.getDefaultParameterData(),parameterInfo:this.getDefaultParameterInfo(),separator:"、"}},computed:{},props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},created:function(){this.query()},methods:{handleSelectionChange:function(t){this.operations[1].disabled=!0,t.length>0&&(this.operations[1].disabled=!1)},showUp:function(t){return!this.parameterDataList[0]||t.id!==this.parameterDataList[0].id},showDown:function(t){return!this.parameterDataList[0]||t.id!==this.parameterDataList[this.parameterDataList.length-1].id},moveUp:function(t){var e=this;this.loading=!0;var a=t.sort;this.parameterDataList.map((function(i){i.id===t.id&&(e.parameterDataList[e.parameterDataList.indexOf(t)].sort=e.parameterDataList[e.parameterDataList.indexOf(t)-1].sort,e.parameterDataList[e.parameterDataList.indexOf(t)-1].sort=a,e.dataList=[e.parameterDataList[e.parameterDataList.indexOf(t)],e.parameterDataList[e.parameterDataList.indexOf(t)-1]],e.sort())}))},moveDown:function(t){var e=this;this.loading=!0;var a=t.sort;this.dataList=[],this.parameterDataList.map((function(i){i.id===t.id&&(e.parameterDataList[e.parameterDataList.indexOf(t)].sort=e.parameterDataList[e.parameterDataList.indexOf(t)+1].sort,e.parameterDataList[e.parameterDataList.indexOf(t)+1].sort=a,e.dataList=[e.parameterDataList[e.parameterDataList.indexOf(t)],e.parameterDataList[e.parameterDataList.indexOf(t)+1]],e.sort())}))},sort:function(){var t=this;H["a"].put("/admin/parameter_group/parameterGroupSort.jhtml",this.dataList).then((function(e){t.query(),t.loading=!1})).catch((function(e){t.loading=!1,t.$message.warning(e.errorMessage||"操作出现错误")}))},getDefaultParameterData:function(){return{id:"",name:"",sort:"",parameters:[],productCategoryId:""}},getDefaultParameterInfo:function(){return{id:"",name:"",type:""}},operateHandler:function(t){this[t]()},rowEditClickHandler:function(t){var e=this;this.$refs.parameterDataForm.clearValidate(),!1===this.showParameterDataEditor&&(this.showParameterDataEditor=!0),this.parameterData.id!==t.id&&(this.parameterData=this.changeParameterData(t),this.hideParameterInfoEditor()),this.$nextTick((function(){e.$refs.parameterDataForm.$el["0"].focus()}))},changeParameterData:function(t){return{id:t.id,name:t.name,sort:t.sort,parameters:t.parameters,productCategoryId:t.productCategoryId}},add:function(){var t=this;!1===this.showParameterDataEditor&&(this.showParameterDataEditor=!0),this.hideParameterInfoEditor(),this.parameterData=this.getDefaultParameterData(),this.$nextTick((function(){t.$refs.parameterDataForm.$el["0"].focus()}))},hideParameterDataEditor:function(){!0===this.showParameterDataEditor&&(this.showParameterDataEditor=!1,this.parameterData=this.getDefaultParameterData(),this.hideParameterInfoEditor())},hideParameterInfoEditor:function(){!0===this.showParameterInfoEditor&&(this.showParameterInfoEditor=!1,this.parameterInfo=this.getDefaultParameterInfo())},save:function(){!0===this.showParameterInfoEditor?this.handlerParameterInfo():!0===this.showParameterDataEditor&&this.handlerParameterData()},handlerParameterData:function(){var t=this;this.$refs.parameterDataForm.validate((function(e){if(!e)return!1;var a=t.getParameterData();if(t.hasSameNameParameterData(a))return t.$message.warning("参数分类名称已存在"),!1;a.id?(console.log("parameterData变更"),t.updateParameterData(a)):(console.log("parameterData添加"),t.saveParameterData(a))}))},handlerParameterInfo:function(){var t=this;this.$refs.parameterDataForm.validate((function(e){if(!e)return!1;t.$refs.parameterInfoForm.validate((function(e){if(!e)return!1;var a=t.getParameterInfo(),i=t.getParameterData(),o=i.parameters.findIndex((function(t){return t.id===a.id}));return t.hasSameNameParameterData(i)?(t.$message.warning("参数分类名称已存在"),!1):t.hasSameNameParameterInfo(a,i.parameters)?(t.$message.warning("参数名称已存在"),!1):(-1===o?(console.log("ParameterInfo添加"),i.parameters.push(a)):(console.log("ParameterInfo变更"),i.parameters[o]=a),void(i.id?t.updateParameterData(i):t.saveParameterData(i)))}))}))},handleTagClose:function(t){var e=this,a=this.parameterDataList.findIndex((function(t){return t.id===e.parameterData.id}));if(-1!==a){var i={id:this.parameterDataList[a].id,name:this.parameterDataList[a].name,sort:this.parameterDataList[a].sort,parameters:this.parameterDataList[a].parameters,productCategoryId:this.parameterDataList[a].productCategoryId};i.parameters=i.parameters.filter((function(e){return e.id!==t.id})),this.hideParameterInfoEditor(),this.updateParameterData(i)}else console.log("关闭Tag所属的参数在参数列中不存在")},handleTagClick:function(t){!1===this.showParameterInfoEditor&&(this.showParameterInfoEditor=!0),this.parameterInfo.id=t.id,this.parameterInfo.name=t.name,this.parameterInfo.type=t.type},handleAddParameterInfo:function(){!1===this.showParameterInfoEditor&&(this.showParameterInfoEditor=!0),this.parameterInfo=this.getDefaultParameterInfo()},updateParameterData:function(t){var e=this;console.log("变更前parameterData",this.parameterData),console.log("参数parameterData",t),j["a"].updateCategoryParameter(t,(function(t){console.log("更新参数分类成功",t.id),e.$message.success("更新参数分类成功"),e.$emit("operationSuccess"),e.hideParameterInfoEditor(),e.query()}),(function(t){console.log("更新参数分类失败"),e.$message.warning(t.errorMessage)}))},saveParameterData:function(t){var e=this;console.log("保存前parameterData",this.parameterData),console.log("参数parameterData",t),""===t.productCategoryId&&(t.productCategoryId=this.itemId),j["a"].saveCategoryParameter(t,(function(t){console.log("添加参数分类成功",t.id),e.$message.success("添加参数分类成功"),e.parameterData=e.getDefaultParameterData(),e.$emit("operationSuccess"),e.parameterData.id=t.id,e.query(),e.$nextTick((function(){this.hideParameterDataEditor()}))}),(function(t){console.log("添加参数分类失败"),e.$message.warning(t.errorMessage)}))},query:function(){var t=this;console.log("查询分类的参数",this.itemId);var e={id:Number(this.itemId),shopId:window.top.SHOP_ID||""};j["a"].getCategoryParameter(e,(function(e){console.log("查询分类的参数成功",e),t.parameterDataList=e.parameterGroups,t.parameterInfoTypeList=e.allParameterType,!0===t.showParameterDataEditor&&(t.parameterData=t.getParameterDataFromList(t.parameterData.id))}),(function(e){console.log("查询分类的参数失败",t.itemId),console.log(e),t.$message.warning(e.errorMessage)}))},getParameterDataFromList:function(t){var e=this.parameterDataList.findIndex((function(e){return e.id===t}));return-1!==e?{id:this.parameterDataList[e].id,name:this.parameterDataList[e].name,sort:this.parameterDataList[e].sort,parameters:this.parameterDataList[e].parameters,productCategoryId:this.parameterDataList[e].productCategoryId}:(console.log("新添加的参数在分类中没有找到",this.parameterData.id),this.getDefaultParameterData())},rowDeleteClickHandler:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a=[];a.push(t.id);var i={ids:a};j["a"].deleteCategoryParameter(i,(function(t){e.$message({type:"success",message:"删除成功!"}),e.$emit("operationSuccess"),e.hideParameterDataEditor(),e.query()}),(function(t){console.log("删除失败",t),e.$message.warning(t.errorMessage)}))})).catch((function(){}))},getParameterData:function(){return{id:this.parameterData.id,name:this.parameterData.name,sort:this.parameterData.sort,parameters:this.parameterData.parameters,productCategoryId:this.parameterData.productCategoryId}},getParameterInfo:function(){return{id:this.parameterInfo.id,name:this.parameterInfo.name,type:this.parameterInfo.type}},hasSameNameParameterData:function(t){var e=this.parameterDataList.findIndex((function(e){return e.name===t.name}));return-1!==e&&this.parameterDataList[e].id!==t.id},hasSameNameParameterInfo:function(t,e){var a=e.findIndex((function(e){return e.name===t.name}));return-1!==a&&e[a].id!==t.id}},watch:{itemId:function(t){console.log("ParameterSetting::watch() Val:",t),this.hideParameterDataEditor(),this.parameterInfoTypeList=[],this.parameterDataList=[],this.query()}}},U=M,R=(a("cad0"),Object(h["a"])(U,q,F,!1,null,null,null)),G=R.exports,K={name:"CategoryMgmtPopup",components:{BizPopupTabs:S["a"],CategorySetting:k,SpecificationSetting:A,ParameterSetting:G},props:{open:{type:Boolean},isEdit:{type:Boolean,default:function(){return!0}},itemId:{type:String},tabName:{type:String}},data:function(){return{}},methods:{close:function(t){this.$emit("close",t)},operationSuccess:function(t){this.$emit("operationSuccess",t)},createdCategorySuccess:function(t){this.$emit("createdCategorySuccess",t)}},watch:{itemId:function(t){console.log("CategoryMgmtPopup::watch() Val:",t)}}},W=K,X=Object(h["a"])(W,b,C,!1,null,null,null),Y=X.exports,J=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-popup-tabs",{attrs:{open:t.open},on:{close:t.close},model:{value:t.clickTabName,callback:function(e){t.clickTabName=e},expression:"clickTabName"}},[a("el-tab-pane",{attrs:{label:"导入",name:"InputCategory"}},[a("input-category-setting",{attrs:{open:t.open},on:{operationSuccess:t.operationSuccess}})],1)],1)},Q=[],Z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-grid",{staticClass:"category-mgmt__input-category-setting"},[a("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operateHandler},slot:"top"}),a("el-tree",{ref:"tree",attrs:{data:t.inputCategoryData,"show-checkbox":"","node-key":"id",props:t.defaultProps},on:{"check-change":t.handleCheckChange}})],1)},tt=[],et={name:"InputCategorySetting",components:{BizSaveButton:P["a"],BizGrid:D["a"]},data:function(){return{operations:[{label:"确定导入",name:"save",type:"primary",disabled:!0,auth:["admin:PurchaseSaleStorage.productCategory.edit"]}],inputCategoryData:[],defaultProps:{label:"name",children:"children"}}},computed:{},props:{open:{type:Boolean}},created:function(){},methods:{operateHandler:function(t){this[t]()},query:function(){this.inputCategoryData=this.getInputCategoryDataList()},getInputCategoryDataList:function(){var t=[],e={shopId:window.top.SHOP_ID||""};return v["a"].getInputProductCategoryList(e,(function(e){e.rootCategoryDatas.forEach((function(e,a){t.push({id:e.id,name:e.name,children:e.childrenProductCategoryDataList,parentId:e.parentId})}))}),(function(t){console.log(t),console.log("code错误")})),t},save:function(){var t=this;v["a"].saveInputProductCategoryList(this.getSaveParams(),(function(e){t.$message.success("导入成功"),t.$emit("operationSuccess")}),(function(e){t.$message.warning(e.errorMessage)}))},getSaveParams:function(){return{shopId:window.top.SHOP_ID||"",productCategoryIds:this.getCheckedIds()}},getCheckedIds:function(){return this.$refs.tree.getCheckedKeys()},handleCheckChange:function(){this.operations[0].disabled=!this.getCheckedIds().length}},watch:{open:function(t){t&&this.query()}}},at=et,it=(a("d63e"),Object(h["a"])(at,Z,tt,!1,null,null,null)),ot=it.exports,rt={name:"CategoryMgmtPopup",components:{BizPopupTabs:S["a"],InputCategorySetting:ot},props:{open:{type:Boolean}},data:function(){return{clickTabName:"InputCategory"}},computed:{},methods:{close:function(t){this.$emit("close",t)},operationSuccess:function(t){this.$emit("operationSuccess",t)}},watch:{}},nt=rt,st=Object(h["a"])(nt,J,Q,!1,null,null,null),ct=st.exports,lt=a("c596"),ut={name:"InvoicingCategoryMgmt",data:function(){return{loading:!1,categoryId:"",refreshSign:!0,open:!1,isEdit:!0,itemId:"",tabName:"Category",isSearch:!0,currentRow:{},multipleSelection:[],editShopIds:[],inputPopupOpen:!1,operations:[{label:"添加",name:"add",type:"primary",auth:["admin:PurchaseSaleStorage.productCategory.add"]},{label:"刷新",name:"refresh",type:""},{label:"从平台导入",name:"importFromPlatForm",type:"",auth:["admin:PurchaseSaleStorage.productCategory.import"]}],tableData:[],dataList:[],pagination:{pageSize:1e3,currentPage:1,pageSizes:[1e3],total:9}}},computed:{},components:{ExpandTable:y,BizGrid:D["a"],BizHeader:n["d"],CategoryMgmtPopup:Y,CategoryMgmtInputPopup:ct,BizPagination:n["f"]},created:function(){this.refresh(),this.getKpi(),this.getEditableStores()},mounted:function(){},methods:{operate:function(t){this[t]()},expandChange:function(t){this.currentRow=t,this.getList(t)},getChildren:function(t,e,a){var i=this,o=e.sort;t.map((function(r){r.id===e.id?("up"===a?(t[t.indexOf(e)].sort=t[t.indexOf(e)-1].sort,t[t.indexOf(e)-1].sort=o,i.dataList=[t[t.indexOf(e)],t[t.indexOf(e)-1]]):(t[t.indexOf(e)].sort=t[t.indexOf(e)+1].sort,t[t.indexOf(e)+1].sort=o,i.dataList=[t[t.indexOf(e)],t[t.indexOf(e)+1]]),i.sort()):r.childrenProductCategoryDataList&&i.getChildren(r.childrenProductCategoryDataList,e,a)}))},moveUp:function(t){var e=this;this.loading=!0;var a=t.sort;this.tableData.map((function(i){i.id===t.id?(e.tableData[e.tableData.indexOf(t)].sort=e.tableData[e.tableData.indexOf(t)-1].sort,e.tableData[e.tableData.indexOf(t)-1].sort=a,e.dataList=[e.tableData[e.tableData.indexOf(t)],e.tableData[e.tableData.indexOf(t)-1]],e.sort()):i.childrenProductCategoryDataList&&e.getChildren(i.childrenProductCategoryDataList,t,"up")}))},moveDown:function(t){var e=this;this.loading=!0;var a=t.sort;this.dataList=[],this.tableData.map((function(i){i.id===t.id?(e.tableData[e.tableData.indexOf(t)].sort=e.tableData[e.tableData.indexOf(t)+1].sort,e.tableData[e.tableData.indexOf(t)+1].sort=a,e.dataList=[e.tableData[e.tableData.indexOf(t)],e.tableData[e.tableData.indexOf(t)+1]],e.sort()):e.getChildren(i.childrenProductCategoryDataList,t,"down")}))},sort:function(){var t=this;H["a"].put("/admin/product_category/categorySort.jhtml",this.dataList).then((function(e){t.getList(),t.loading=!1})).catch((function(e){t.loading=!1,t.$message.warning(e.errorMessage||"操作出现错误")}))},refresh:function(){this.getList()},getKpi:function(){var t=this;H["a"].get("/admin/product/queryNavigationKpi.jhtml",{}).then((function(e){var a="维护店铺商品分类。已维护分类"+e.data.productCategoryCount+"个";t.$message({customClass:"motorists-club-activity__kpi",showClose:!0,message:a,duration:3e3})})).catch((function(e){t.$message.warning(e.errorMessage||"操作出现错误")}))},getEditableStores:function(){var t=this;H["a"].get(lt["j"].editableStores,{resourceType:"2"}).then((function(e){t.editShopIds=[],e.dataList.map((function(e){t.editShopIds.push(e.id)}))})).catch((function(t){console.log(t),console.log("code错误")}))},getList:function(t){var e=this,a={shopId:window.top.SHOP_ID||"",pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};!0!==this.open&&!0!==this.inputPopupOpen&&(this.loading=!0),v["a"].getProductCategoryList(a,(function(t){e.tableData=t.ProductCategoryManage;var a,i=Object(r["a"])(e.tableData);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(o.childrenProductCategoryDataList.length>0){o.hasChild="1";var n,s=[],c=Object(r["a"])(o.childrenProductCategoryDataList);try{for(c.s();!(n=c.n()).done;){var l=n.value;s.push({id:l.id?l.id:"",name:l.name,sort:"null"===l.sort?"":l.sort,specificationDataList:l.specificationDataList,parentId:l.parentId,hasChild:"0"})}}catch(u){c.e(u)}finally{c.f()}}}}catch(u){i.e(u)}finally{i.f()}e.pagination.total=Number(t.dataSum),e.loading=!1}),(function(t){console.log(t),e.$message.warning(t.errorMessage),e.loading=!1}))},filterDataChange:function(t){},deleteList:function(){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e,a=[],i=Object(r["a"])(t.multipleSelection);try{for(i.s();!(e=i.n()).done;){var o=e.value;a.push(o.id)}}catch(s){i.e(s)}finally{i.f()}var n={ids:a};v["a"].deleteProductCategory(n,(function(e){t.$message({type:"success",message:"删除成功!"}),t.refresh()}),(function(e){console.log(e),t.$message.warning(e.errorMessage)}))})).catch((function(){}))},handleDelete:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a=[];a.push(t.id);var i={ids:a};v["a"].deleteProductCategory(i,(function(t){e.$message({type:"success",message:"删除成功!"}),e.refresh()}),(function(t){console.log(t),e.$message.warning(t.errorMessage)}))})).catch((function(){}))},add:function(){this.open=!0,this.itemId="",this.tabName="Category"},handleSelectionChange:function(t){this.operations[1].disabled=!0,t.length>0&&(this.operations[1].disabled=!1),this.multipleSelection=t},rowClick:function(t){this.open=!0,this.itemId=t.id},handleSizeChange:function(t){this.pagination.pageSize=t,this.refresh()},handleCurrentChange:function(t){this.pagination.currentPage=t,this.refresh()},operationSuccess:function(){this.refresh()},createdCategorySuccess:function(t){this.itemId=t},importFromPlatForm:function(){this.inputPopupOpen=!0}}},pt=ut,dt=(a("9e27"),Object(h["a"])(pt,i,o,!1,null,null,null));e["default"]=dt.exports},"5b8e":function(t,e,a){"use strict";var i=a("9678"),o=a.n(i);o.a},6877:function(t,e,a){"use strict";var i=a("f0d5"),o=a.n(i);o.a},7132:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"biz-fade-t"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"biz-popup",on:{click:function(e){return e.target!==e.currentTarget?null:t.close(e)}}},[a("transition",{attrs:{name:"biz-fade-t-right"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"popup-content",style:t.contentStyle},[t._t("default")],2)])],1)])},o=[],r={name:"BizPopup",props:{open:{type:Boolean,default:function(){return!1}},contentStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{close:function(){this.$emit("close")}}},n=r,s=(a("5b8e"),a("2877")),c=Object(s["a"])(n,i,o,!1,null,null,null),l=c.exports,u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"biz-popup-tabs"},[a("biz-popup",{attrs:{open:t.open,contentStyle:t.contentStyle},on:{close:t.close}},[a("el-tabs",{attrs:{type:"border-card",value:t.value},on:{"tab-click":t.tabClick}},[t._t("default")],2)],1)],1)},p=[],d=(a("b0c0"),{name:"BizPopupTabs",data:function(){return{}},props:{open:{type:Boolean,default:!1},value:{type:String,required:!0},contentStyle:{type:Object,default:function(){return{}}}},components:{BizPopup:l},methods:{close:function(){var t=this;this.$confirm("是否保存当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("close")}))},tabClick:function(t){this.$emit("input",t.name)}}}),f=d,m=(a("d4c2"),Object(s["a"])(f,u,p,!1,null,null,null)),h=m.exports;a.d(e,"a",(function(){return h}))},"81d5":function(t,e,a){"use strict";var i=a("7b0b"),o=a("23cb"),r=a("50c4");t.exports=function(t){var e=i(this),a=r(e.length),n=arguments.length,s=o(n>1?arguments[1]:void 0,a),c=n>2?arguments[2]:void 0,l=void 0===c?a:o(c,a);while(l>s)e[s++]=t;return e}},8316:function(t,e,a){"use strict";var i=a("2497"),o=a("bc3a"),r=a.n(o),n=a("c596");e["a"]={getCategoryParameter:function(t,e,a){r.a.get(n["g"].commodity.getCategoryParameter,{params:t}).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},deleteCategoryParameter:function(t,e,a){r.a.delete(n["g"].commodity.deleteCategoryParameter,{data:t}).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},saveCategoryParameter:function(t,e,a){r.a.post(n["g"].commodity.saveCategoryParameter,t).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},updateCategoryParameter:function(t,e,a){r.a.put(n["g"].commodity.updateCategoryParameter,t).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))}}},8424:function(t,e,a){},"856c":function(t,e,a){"use strict";var i=a("8424"),o=a.n(i);o.a},"8c42":function(t,e,a){"use strict";var i=a("2497"),o=a("bc3a"),r=a.n(o),n=a("c596");e["a"]={getProductCategory:function(t,e,a){r.a.get(n["g"].commodity.getProductCategory,{params:t}).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},saveProductCategory:function(t,e,a){r.a.post(n["g"].commodity.saveProductCategory,t).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},updateProductCategory:function(t,e,a){r.a.put(n["g"].commodity.updateProductCategory,t).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))}}},9678:function(t,e,a){},"9e27":function(t,e,a){"use strict";var i=a("0f68"),o=a.n(i);o.a},a9e3:function(t,e,a){"use strict";var i=a("83ab"),o=a("da84"),r=a("94ca"),n=a("6eeb"),s=a("5135"),c=a("c6b6"),l=a("7156"),u=a("c04e"),p=a("d039"),d=a("7c73"),f=a("241c").f,m=a("06cf").f,h=a("9bf2").f,g=a("58a8").trim,y="Number",D=o[y],v=D.prototype,b=c(d(v))==y,C=function(t){var e,a,i,o,r,n,s,c,l=u(t,!1);if("string"==typeof l&&l.length>2)if(l=g(l),e=l.charCodeAt(0),43===e||45===e){if(a=l.charCodeAt(2),88===a||120===a)return NaN}else if(48===e){switch(l.charCodeAt(1)){case 66:case 98:i=2,o=49;break;case 79:case 111:i=8,o=55;break;default:return+l}for(r=l.slice(2),n=r.length,s=0;s<n;s++)if(c=r.charCodeAt(s),c<48||c>o)return NaN;return parseInt(r,i)}return+l};if(r(y,!D(" 0o1")||!D("0b1")||D("+0x1"))){for(var S,I=function(t){var e=arguments.length<1?0:t,a=this;return a instanceof I&&(b?p((function(){v.valueOf.call(a)})):c(a)!=y)?l(new D(C(e)),a,I):C(e)},w=i?f(D):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),P=0;w.length>P;P++)s(D,S=w[P])&&!s(I,S)&&h(I,S,m(D,S));I.prototype=v,v.constructor=I,n(o,y,I)}},ab7b:function(t,e,a){"use strict";var i=a("4ba1"),o=a.n(i);o.a},c8d2:function(t,e,a){var i=a("d039"),o=a("5899"),r="​᠎";t.exports=function(t){return i((function(){return!!o[t]()||r[t]()!=r||o[t].name!==t}))}},cad0:function(t,e,a){"use strict";var i=a("2c8a"),o=a.n(i);o.a},cb29:function(t,e,a){var i=a("23e7"),o=a("81d5"),r=a("44d2");i({target:"Array",proto:!0},{fill:o}),r("fill")},cc55:function(t,e,a){"use strict";var i=a("2497"),o=a("bc3a"),r=a.n(o),n=a("c596");e["a"]={getProductCategoryList:function(t,e,a){r.a.get(n["g"].commodity.getProductCategoryList,{params:t}).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},deleteProductCategory:function(t,e,a){r.a.delete(n["g"].commodity.deleteProductCategory,{data:t}).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},getInputProductCategoryList:function(t,e,a){console.log("[---- dachao ----] [API-从平台导入-get] getInputProductCategoryList() params=",t),r.a.get(n["g"].commodity.getInputProductCategoryList,{params:t}).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},saveInputProductCategoryList:function(t,e,a){console.log("[---- dachao ----] [API-从平台导入-post] saveInputProductCategoryList() params=",t),r.a.post(n["g"].commodity.saveInputProductCategoryList,t).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))}}},d4c2:function(t,e,a){"use strict";var i=a("e725"),o=a.n(i);o.a},d63e:function(t,e,a){"use strict";var i=a("4f84"),o=a.n(i);o.a},dd58:function(t,e,a){"use strict";var i=a("2497"),o=a("bc3a"),r=a.n(o),n=a("c596");e["a"]={getProductSpecificationList:function(t,e,a){console.log("[---- dachao ----] [API-规格编辑-get] getProductSpecificationList() params=",t),r.a.get(n["g"].commodity.getProductSpecificationList,{params:t}).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},saveProductSpecification:function(t,e,a){console.log("[---- dachao ----] [API-规格编辑-post] saveProductSpecification() params=",t),r.a.post(n["g"].commodity.saveProductSpecification,t).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},updateProductSpecification:function(t,e,a){console.log("[---- dachao ----] [API-规格编辑-put] updateProductSpecification() params=",t),r.a.put(n["g"].commodity.updateProductSpecification,t).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))},deleteProductSpecification:function(t,e,a){console.log("[---- dachao ----] [API-规格编辑-delete] updateProductSpecification() params=",t),r.a.delete(n["g"].commodity.deleteProductSpecification,{data:t}).then(Object(i["a"])(e,a)).catch((function(t){console.error(t)}))}}},e725:function(t,e,a){},f0d5:function(t,e,a){},f3ac:function(t,e,a){t.exports=a.p+"static/img/pic_default_none_100.6603f4ac.png"}}]);