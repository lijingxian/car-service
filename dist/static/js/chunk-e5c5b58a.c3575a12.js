(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e5c5b58a"],{"1b2b":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"service-handbook"},[i("biz-flex-table",{attrs:{loading:e.loading,operations:e.operations,tableData:e.tableData,pagination:e.pagination,filters:e.filters},on:{operate:e.operate,"selection-change":e.handleSelectionChange,"row-click":e.rowClick,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"filter-data-change":e.filterDataChange}},["shop"!==e.getUser().roleLevel&&e.isPlateForm?i("template",{slot:"operation"},[i("import-file",{ref:"importFile",staticStyle:{"margin-left":"10px"},attrs:{tableData:e.importResult,importLoading:e.importLoading,total:e.total,disabled:e.disabled,count:e.count,percentage:e.percentage,stepkey:e.stepkey,showProcess:e.showProcess,action:"/admin/baseData/importBooklet.jhtml",name:"uFile"},on:{clearTimeOut:e.clearTimeOut,restProcess:e.restProcess,"handle-import":e.handleImport}},[i("el-table-column",{attrs:{label:"编号",width:"50",prop:"row"}}),i("el-table-column",{attrs:{label:"状态",width:"150",prop:"result"}}),i("el-table-column",{attrs:{label:"信息",prop:"message"}})],1)],1):e._e(),i("el-table-column",{attrs:{label:"品牌",prop:"brand",width:"150px"}}),i("el-table-column",{attrs:{label:"系列",prop:"series",width:"150px"}}),i("el-table-column",{attrs:{label:"车型",prop:"carType"},scopedSlots:e._u([{key:"default",fn:function(t){return i("div",{staticClass:"line-break"},[e._v(" "+e._s(t.row.carType)+" ")])}}])})],2),i("biz-popup-tabs",{attrs:{open:e.open},on:{close:function(t){e.open=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[i("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[i("service-handbook-item",{ref:"item",attrs:{itemId:e.itemId},on:{created:e.refresh}})],1)],1),i("biz-popup-tabs",{attrs:{open:e.openImport},on:{close:function(t){e.openImport=!1}},model:{value:e.tabImport,callback:function(t){e.tabImport=t},expression:"tabImport"}},[i("el-tab-pane",{attrs:{label:"导入保养手册",name:"import"}},[i("service-import",{ref:"item",on:{created:e.importSuccess}})],1)],1)],1)},o=[],n=(i("99af"),i("caad"),i("d81d"),i("b0c0"),i("a9e3"),i("2532"),i("b85c")),s=i("5530"),l=i("ff65"),r=i("7132"),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"service-handbook-item"},[i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}),i("biz-list",{ref:"table",attrs:{height:e.heightList,tableData:e.modeList}},[i("el-table-column",{attrs:{type:"selection",width:"50",selectable:e.selectAble}}),i("el-table-column",{attrs:{prop:"name",label:"车型"}})],1),e.tableData.length>0?i("biz-list",{ref:"list",attrs:{height:e.height,tableData:e.tableData},on:{handleSelectionChange:e.handleSelectionChange}},[i("el-table-column",{attrs:{prop:"mileage",label:"保养里程(km)",width:"130px"},scopedSlots:e._u([{key:"default",fn:function(t){return i("div",{},[i("el-input-number",{attrs:{placeholder:"",size:"mini","controls-position":"right",min:0},model:{value:t.row.mileage,callback:function(i){e.$set(t.row,"mileage",i)},expression:"scope.row.mileage"}})],1)}}],null,!1,1714030071)}),i("el-table-column",{attrs:{prop:"cost",label:"推荐价格",width:"130px"},scopedSlots:e._u([{key:"default",fn:function(t){return i("div",{},[i("el-input-number",{attrs:{placeholder:"",size:"mini","controls-position":"right",min:0},model:{value:t.row.cost,callback:function(i){e.$set(t.row,"cost",i)},expression:"scope.row.cost"}})],1)}}],null,!1,4100546866)}),e._l(e.tableData[0].item,(function(t,a){return e.tableData[0].item?i("el-table-column",{key:a,attrs:{prop:"name",label:t.name,"min-width":"50px"},scopedSlots:e._u([{key:"default",fn:function(a){return i("div",{},[i("div",{staticClass:"biz-customcol"},e._l(a.row.item,(function(a,o){return t.id===a.id?i("div",{key:o},[i("el-checkbox",{attrs:{"true-label":"1","false-label":"0"},model:{value:a.ischecked,callback:function(t){e.$set(a,"ischecked",t)},expression:"booklets.ischecked"}})],1):e._e()})),0)])}}],null,!0)}):e._e()})),e._l(e.tableData[0].productList,(function(t,a){return e.tableData[0]&&e.tableData[0].productList?i("el-table-column",{key:a,attrs:{prop:"name",label:t.name,"min-width":"50px"},scopedSlots:e._u([{key:"default",fn:function(a){return i("div",{},[i("div",{staticClass:"biz-customcol"},e._l(a.row.productList,(function(a,o){return t.id===a.id?i("div",{key:o},[i("el-checkbox",{attrs:{"true-label":"1","false-label":"0"},model:{value:a.ischecked,callback:function(t){e.$set(a,"ischecked",t)},expression:"booklets.ischecked"}})],1):e._e()})),0)])}}],null,!0)}):e._e()}))],2):e._e()],1)},u=[],d=(i("4160"),i("ac1f"),i("1276"),i("159b"),i("f36f")),p=i("8330"),h=i("04d3"),f=i("2f62"),m={name:"ServiceHandbookItem",props:{itemId:{type:String}},data:function(){return{isCreated:!0,height:"500",heightList:"300",mode:100,loading:!1,carTypes:[],serviceList:[],multipleSelection:[],brandList:[],seriesList:[],modeList:[],itemList:[],tableData:[],formModel:{},operations:[{label:"保存",name:"save",type:"primary",auth:["admin:aftersale.booklet.edit"]}]}},watch:{itemId:function(e,t){this.itemId&&("shop"===this.getUser().roleLevel?this.query():this.querySys())}},components:{BizGrid:d["a"],BizSaveButton:p["a"],BizList:h["e"]},created:function(){this.queryBrandList()},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-282)},updated:function(){this.updateSelection()},methods:Object(s["a"])(Object(s["a"])({},Object(f["c"])(["getUser"])),{},{operate:function(e){this[e]()},selectAble:function(e){return!1},updateSelection:function(){var e=this;this.modeList.forEach((function(t){e.carTypes.includes(parseInt(t.id))?e.$refs.table.toggleRowSelection(t,!0):e.$refs.table.toggleRowSelection(t,!1)}))},save:function(){"shop"===this.getUser().roleLevel?this.shopUpdate():this.sysUpdate()},shopUpdate:function(){var e=this;this.loading=!0,l["a"].updateServiceHandbook(this.formModel,(function(t){e.$message.success("保存成功"),e.loading=!1,e.$emit("created")}),(function(t){console.log(t),e.loading=!1,e.$message.error(t.errorMessage),console.log("code错误")}))},sysUpdate:function(){var e=this;this.loading=!0,l["a"].maintainBookletUpdate(this.formModel,(function(t){e.$message.success("保存成功"),e.loading=!1,e.$emit("created")}),(function(t){console.log(t),e.loading=!1,e.$message.error(t.errorMessage),console.log("code错误")}))},queryBrandList:function(){var e=this;l["a"].queryBrandList({},(function(t){e.brandList=t.dataList}),(function(e){console.log(e),console.log("code错误")}))},querySeriesList:function(e){var t=this;l["a"].querySeriesList({brand:e},(function(e){t.seriesList=e.dataList?e.dataList:[]}),(function(e){console.log(e),console.log("code错误")}))},queryTypeList:function(e){var t=this;l["a"].baseData({type:"2",seriesId:e,brandId:this.formModel.brandId},(function(e){t.modeList=e.dataList?e.dataList:[]}),(function(e){console.log(e),console.log("code错误")}))},query:function(){var e=this;this.loading=!0,l["a"].getServiceHandbook({id:this.itemId},(function(t){e.loading=!1,e.formModel=t.result,e.tableData=t.result.booklets,e.carTypes=t.result.carTypeId,1===e.carTypes.length?e.modeList=[{id:e.carTypes[0],name:t.result.carType}]:2===e.carTypes.length?e.modeList=[{id:e.carTypes[0],name:t.result.carType.split(",")[0]},{id:e.carTypes[1],name:t.result.carType.split(",")[1]}]:e.queryTypeList(t.result.seriesId)}),(function(t){console.log(t),e.loading=!1,console.log("code错误")}))},querySys:function(){var e=this;this.loading=!0,l["a"].maintainBookletQuery({id:this.itemId},(function(t){e.formModel=t.result,e.loading=!1,e.tableData=t.result.booklets}),(function(t){console.log(t),e.loading=!1,console.log("code错误")}))},handleBrandChange:function(e){this.querySeriesList(e),this.$set(this.formModel,"series",""),this.$set(this.formModel,"type","")},handleSeriesChange:function(e){this.queryTypeList(e),this.$set(this.formModel,"type","")},handleSelectionChange:function(e){this.multipleSelection=e}})},b=m,g=(i("e815"),i("2877")),v=Object(g["a"])(b,c,u,!1,null,null,null),y=v.exports,S=i("84a1"),w=i("ccf0"),k=i("c596"),I={name:"ServiceHandbook",data:function(){return{total:0,count:0,percentage:0,stepkey:"",loading:!1,disabled:!1,importLoading:!1,showProcess:!1,isShop:!0,urls:k["g"],importResult:[],tableData:[],itemId:"",t:"",type:"",tabName:"first",tabImport:"import",tags:[],open:!1,openImport:!1,dialogVisible:!1,multipleSelection:[],brandId:"",seriesId:"",modeList:"",serviceList:[],serviceHandbookList:[],operations:[{disabled:!0,label:"删除",name:"delete",type:"",auth:["admin:aftersale.booklet.delete"]}],filters:[{type:"select",label:"品牌",name:"brand",value:"",options:[]},{type:"select",label:"系列",name:"series",value:"",options:[]},{type:"select",label:"车型",name:"carType",value:"",options:[]}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizPopupTabs:r["a"],ServiceHandbookItem:y,BizFlexTable:h["c"],ImportFile:w["b"],ServiceImport:S["a"]},created:function(){this.handleImport(),"shop"===this.getUser().roleLevel&&"平台导入"!==this.operations[0].label&&this.hasAuthImport||window.top.SHOP_ID?(this.isShop=!0,this.getServiceHandbookList(),this.baseShopData("0"),this.operations.unshift({label:"平台导入",name:"sysImport",type:"primary"})):(this.isShop=!1,this.listMaintainBooklet(),this.baseData("0"))},beforeDestroy:function(){this.t&&window.clearTimeout(this.t)},watch:{$route:function(e,t){this.refresh(),this.handleImport()},filters0:function(e,t){this.filters[1].value="",this.filters[1].options=[{label:"全部",value:""}],this.filters[2].options=[{label:"全部",value:""}]},filters1:function(e,t){this.filters[2].value="",this.filters[2].options=[{label:"全部",value:""}]}},computed:Object(s["a"])(Object(s["a"])({},Object(f["c"])("Authority",["currentAuth"])),{},{hasAuthImport:function(){return this.currentAuth.includes("admin:aftersale.booklet.import")},toggleRecommendTxt:function(){return this.showRecommend?"收起明细":"查看明细"},filters0:function(){return this.filters[0].value},filters1:function(){return this.filters[1].value},isPlateForm:function(){return!window.top.SHOP_ID}}),methods:Object(s["a"])(Object(s["a"])({},Object(f["c"])(["getUser"])),{},{operate:function(e){this[e]()},add:function(){this.open=!0},importSuccess:function(){"shop"===this.getUser().roleLevel||window.top.SHOP_ID?this.baseShopData("0"):this.baseData("0"),this.openImport=!1,this.refresh()},baseData:function(e,t,i){var a=this;l["a"].bookletbaseData({type:e,brandId:t,seriesId:i},(function(t){"0"===e&&(a.filters[0].options=[{label:"全部",value:""}].concat(t.dataList.map((function(e){return{label:e.name,value:e.id}}))),a.filters[1].value="",a.filters[2].value=""),"1"===e&&(a.filters[1].options=[{label:"全部",value:""}].concat(t.dataList.map((function(e){return{label:e.name,value:e.id}})))),"2"===e&&(a.filters[2].options=[{label:"全部",value:""}].concat(t.dataList.map((function(e){return{label:e.name,value:e.id}}))))}),(function(e){console.log(e),console.log("code错误")}))},baseShopData:function(e,t,i){var a=this;l["a"].bookletShopData({type:e,brandId:t,seriesId:i,shopId:window.top.SHOP_ID||""},(function(t){"0"===e&&(a.filters[0].options=[{label:"全部",value:""}].concat(t.dataList.map((function(e){return{label:e.name,value:e.id}}))),a.filters[1].value="",a.filters[2].value=""),"1"===e&&(a.filters[1].options=[{label:"全部",value:""}].concat(t.dataList.map((function(e){return{label:e.name,value:e.id}})))),"2"===e&&(a.filters[2].options=[{label:"全部",value:""}].concat(t.dataList.map((function(e){return{label:e.name,value:e.id}}))))}),(function(e){console.log(e),console.log("code错误")}))},queryBrandList:function(){var e=this;l["a"].queryBrandList({},(function(t){e.filters[0].options=t.dataList.map((function(e){return{label:e.name,value:e.id}}))}),(function(e){console.log(e),console.log("code错误")}))},querySeriesList:function(e){var t=this;l["a"].querySeriesList({brandId:e},(function(e){t.filters[1].options=e.dataList.map((function(e){return{label:e.name,value:e.id}}))}),(function(e){console.log(e),console.log("code错误")}))},queryModeList:function(e){var t=this;l["a"].listCarType({seriesId:e,brandId:this.filters[0].value},(function(e){t.filters[2].options=e.dataList.map((function(e){return{label:e.name,value:e.id}}))}),(function(e){console.log(e),console.log("code错误")}))},sysImport:function(){var e=this;l["a"].queryImportProgress({shopId:window.top.SHOP_ID},(function(t){t.data&&t.data.rate&&"100"!==t.data.rate?(e.$refs.item.handleImport(),e.$refs.item.uploadingVisible=!0,e.$refs.item.showCurrentInfo=!0):e.openImport=!0}),(function(e){console.log(e),console.log("code错误")}))},delete:function(){if(0===this.multipleSelection.length)return this.$message.warning("请选择一条数据"),!1;"shop"===this.getUser().roleLevel||window.top.SHOP_ID?this.deleteOperate():this.deleteSys()},deleteSys:function(){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t,i=[],a=Object(n["a"])(e.multipleSelection);try{for(a.s();!(t=a.n()).done;){var o=t.value;i.push(o.id)}}catch(r){a.e(r)}finally{a.f()}var s={ids:i};e.loading=!0,l["a"].maintainBookletDelete(s,(function(t){e.$message({type:"success",message:"删除成功!"}),e.loading=!1,e.refresh()}),(function(t){console.log(t),e.loading=!1}))})).catch((function(){}))},deleteOperate:function(){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t,i=[],a=Object(n["a"])(e.multipleSelection);try{for(a.s();!(t=a.n()).done;){var o=t.value;i.push(o.id)}}catch(r){a.e(r)}finally{a.f()}var s={ids:i};e.loading=!0,l["a"].deleteServiceHandbook(s,(function(t){e.$message({type:"success",message:"删除成功!"}),e.loading=!1,e.refresh()}),(function(t){console.log(t),e.loading=!1}))})).catch((function(){}))},refresh:function(){"shop"===this.getUser().roleLevel||window.top.SHOP_ID?this.getServiceHandbookList():this.listMaintainBooklet()},clearTimeOut:function(){window.clearTimeout(this.t)},restProcess:function(){this.total=0,this.count=0,this.stepkey="",this.percentage=0},handleImport:function(){var e=this;l["a"].queryImportBaseProgress({},(function(t){t.data.total||(e.total=0,e.count=0,e.stepkey="",e.percentage=0),t.data.total&&(e.total=Number(t.data.total||0),e.count=Number(t.data.count||0),e.stepkey=t.data.remark,e.percentage=Number(t.data.rate),e.$refs.importFile.title=t.data.title),t.data&&t.data.rate&&"100"===t.data.rate?(e.clearTimeOut(),e.$refs.importFile.showCurrentInfo=!1,e.$refs.importFile.title="导入完成",e.disabled=!1):t.data&&t.data.rate&&"100"!==t.data.rate?(e.t&&e.clearTimeOut(),e.t=setTimeout(e.handleImport,2e3),e.$refs.importFile.uploadingVisible=!0,e.$refs.importFile.showCurrentInfo=!0,e.disabled=!0):e.$refs.importFile.uploadingVisible=!1}),(function(t){console.log(t),console.log("code错误"),e.$refs.importFile.uploadingVisible=!1}))},listMaintainBooklet:function(){var e=this,t={shopId:window.top.SHOP_ID||"",brand:this.filters[0].value,series:this.filters[1].value,carType:this.filters[2].value,pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage};this.loading=!0,l["a"].listMaintainBooklet(t,(function(t){e.tableData=t.dataList,e.pagination.total=Number(t.total),e.loading=!1}),(function(t){console.log(t),e.loading=!1}))},getServiceHandbookList:function(){var e=this,t={shopId:window.top.SHOP_ID||"",brand:this.filters[0].value,series:this.filters[1].value,carType:this.filters[2].value,pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage};this.loading=!0,l["a"].getServiceHandbookList(t,(function(t){e.tableData=t.dataList,e.pagination.total=Number(t.total),e.loading=!1}),(function(t){console.log(t),e.loading=!1}))},handleSelectionChange:function(e){"shop"===this.getUser().roleLevel||window.top.SHOP_ID?(this.operations[1].disabled=!0,e.length>0&&(this.operations[1].disabled=!1)):(this.operations[0].disabled=!0,e.length>0&&(this.operations[0].disabled=!1)),this.multipleSelection=e},filterDataChange:function(e){e[0].value&&("shop"===this.getUser().roleLevel||window.top.SHOP_ID?this.baseShopData("1",this.filters[0].value):this.baseData("1",this.filters[0].value)),e[1].value&&("shop"===this.getUser().roleLevel||window.top.SHOP_ID?this.baseShopData("2",this.filters[0].value,this.filters[1].value):this.baseData("2",this.filters[0].value,this.filters[1].value)),this.refresh()},rowClick:function(e){this.open=!0,this.itemId=String(e.id)},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()}})},L=I,D=(i("cd5d"),Object(g["a"])(L,a,o,!1,null,null,null));t["default"]=D.exports},"3f5f":function(e,t,i){},cd5d:function(e,t,i){"use strict";var a=i("3f5f"),o=i.n(a);o.a},e815:function(e,t,i){"use strict";var a=i("ed02"),o=i.n(a);o.a},ed02:function(e,t,i){}}]);