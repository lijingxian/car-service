(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e40820c"],{5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,i){var a=i("1d80"),s=i("5899"),o="["+s+"]",n=RegExp("^"+o+o+"*"),r=RegExp(o+o+"*$"),l=function(t){return function(e){var i=String(a(e));return 1&t&&(i=i.replace(n,"")),2&t&&(i=i.replace(r,"")),i}};t.exports={start:l(1),end:l(2),trim:l(3)}},"5b8e":function(t,e,i){"use strict";var a=i("9678"),s=i.n(a);s.a},"6bf4":function(t,e,i){"use strict";var a=i("d916"),s=i.n(a);s.a},"6f8f":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("biz-grid",{staticClass:"process-setting"},[i("div",{attrs:{slot:"top"},slot:"top"},[i("div",{staticClass:"slot-top"},[i("biz-header",{attrs:{operations:t.operations,filters:t.filters,views:t.views},on:{operate:t.operate,filterDataChange:t.filterDataChange,onSwitch:t.onViewSwitch}}),i("div",{staticClass:"model"},[i("div",{staticClass:"font"},[t._v("销售流程模板")]),i("img",{attrs:{src:t.xslc,height:"150"}})])],1)]),i("biz-flex-table",{directives:[{name:"show",rawName:"v-show",value:!t.showList,expression:"!showList"}],ref:"table",attrs:{tableData:t.tableData,loading:t.loading,pagination:t.pagination},on:{"size-change":t.handlePageSizeChange,"current-change":t.handleCurrentPageChange,"selection-change":t.handleSelectionChange,"row-click":t.handleRowClick}},[i("el-table-column",{attrs:{label:"流程名称",prop:"name","min-width":"100"}}),i("el-table-column",{attrs:{label:"流程","min-width":"700"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticClass:"process"},[e.row.configs&&"1"===e.row.configs[0].state?i("img",{attrs:{src:t.xslc,height:"150",align:"center"}}):t._e(),e.row.configs&&"0"===e.row.configs[0].state?i("img",{attrs:{src:t.xslc1,height:"150",align:"center"}}):t._e(),e.row.configs&&"1"===e.row.configs[0].state?i("span",{staticClass:"step1",attrs:{title:t.formatRow(e.row)}},[t._v(t._s(t.formatRow(e.row)))]):t._e(),e.row.configs&&"1"===e.row.configs[0].state?i("span",{staticClass:"step2"},[t._v(t._s("0"===e.row.configs[1].way?"系统审批":"人工审批"))]):t._e(),i("span",{class:e.row.configs&&"1"===e.row.configs[0].state?"step3":"step33"},[t._v(t._s("0"===e.row.configs[2].way?"自动提交":"手动提交"))]),i("span",{class:e.row.configs&&"1"===e.row.configs[0].state?"step4":"step22"},[t._v(t._s("0"===e.row.configs[3].way?"系统审批":"人工审批"))])])]}}])}),i("el-table-column",{attrs:{prop:"tag",label:"操作","min-width":"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),t.handleDeleteClick(e.row)}}},[t._v(" 删除 ")])]}}])})],1),i("biz-flex-table",{directives:[{name:"show",rawName:"v-show",value:t.showList,expression:"showList"}],ref:"table",attrs:{tableData:t.tableData,loading:t.loading,pagination:t.pagination},on:{"size-change":t.handlePageSizeChange,"current-change":t.handleCurrentPageChange,"selection-change":t.handleSelectionChange,"row-click":t.handleRowClick}},[i("el-table-column",{attrs:{label:"流程名称",prop:"name","min-width":"180"}}),i("el-table-column",{attrs:{label:"提交销售申请","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",["0"===e.row.configs[0].state?i("div",[t._v("✖")]):t._e(),"1"===e.row.configs[0].state?t._l(e.row.configs[0].items,(function(e){return i("div",{key:e.id},[t._v(" "+t._s(e.shop.name?e.shop.name+":":"全部门店")+" "+t._s(e.shop.name?e.approver.name?e.approver.name:"全部":"")+" ")])})):t._e()],2)]}}])}),i("el-table-column",{attrs:{label:"销售申请审批","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"===e.row.configs[0].state?i("div",[t._v("✖")]):t._e(),"1"===e.row.configs[0].state?["0"===e.row.configs[1].way?i("span",[t._v("自动通过")]):t._e(),t._l(e.row.configs[1].items,(function(a,s){return i("div",{key:a.id},["1"===e.row.configs[1].way?[t._v(t._s(a.approver.name)),s<e.row.configs[1].items.length-1?[t._v("→")]:t._e()]:t._e()],2)}))]:t._e()]}}])}),i("el-table-column",{attrs:{label:"提交销售订单","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",["0"===e.row.configs[2].way?i("span",[t._v("自动通过")]):t._e(),t._l(e.row.configs[2].items,(function(a){return i("div",{key:a.id},["1"===e.row.configs[2].way?[t._v(" "+t._s(a.shop.name?a.shop.name+":":"全部门店")+" "+t._s(a.shop.name?a.approver.name?a.approver.name:"全部":"")+" ")]:t._e()],2)}))],2)]}}])}),i("el-table-column",{attrs:{label:"销售订单审批","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"===e.row.configs[3].way?i("span",[t._v("自动通过")]):t._e(),t._l(e.row.configs[3].items,(function(a,s){return i("div",{key:a.id},["1"===e.row.configs[3].way?[t._v(t._s(a.approver.name)),s<e.row.configs[3].items.length-1?[t._v("→")]:t._e()]:t._e()],2)}))]}}])}),i("el-table-column",{attrs:{label:"流程描述","min-width":"100",prop:"memo"}}),i("el-table-column",{attrs:{prop:"tag",label:"操作","min-width":"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return i.stopPropagation(),t.handleDeleteClick(e.row)}}},[t._v(" 删除 ")])]}}])})],1),i("div",{attrs:{slot:"float"},slot:"float"},[i("biz-popup-tabs",{attrs:{open:t.open},on:{close:function(e){t.open=!1}},model:{value:t.tabName,callback:function(e){t.tabName=e},expression:"tabName"}},[i("el-tab-pane",{attrs:{label:"设置",name:"first"}},[i("sale-setting-info",{attrs:{idObject:t.infoId},on:{"item-updated":t.refresh}})],1)],1)],1)],1)},s=[],o=(i("4160"),i("b0c0"),i("a9e3"),i("d3b7"),i("159b"),i("f36f")),n=i("9b38"),r=i.n(n),l=i("9d1f"),c=i.n(l),p=i("1ab1"),f=i("c596"),d=i("7132"),m=i("04d3"),u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("biz-grid",{staticClass:"process-sale-bsae"},[i("div",{staticClass:"popup",attrs:{slot:"top"},slot:"top"},[i("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operate},slot:"top"})],1),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"150px",size:"small",model:t.formData,rules:t.rules}},[i("el-form-item",{attrs:{label:"流程名称",prop:"name","label-width":"80px"}},[i("el-input",{attrs:{placeholder:"代理商销售流程"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),i("el-form-item",{attrs:{label:"流程描述","label-width":"80px"}},[i("el-input",{attrs:{placeholder:"请输入",type:"textarea"},model:{value:t.formData.memo,callback:function(e){t.$set(t.formData,"memo",e)},expression:"formData.memo"}})],1),i("el-form-item",{attrs:{label:"流程设置","label-width":"80px"}},[i("span",{staticStyle:{"font-size":"12px"}},[t._v("点击流程各节点可进行对应流程的设置，黄色字体的为可进行设置的节点")])]),i("div",{staticClass:"image"},[i("img",{attrs:{src:t.xslc}}),i("div",{staticClass:"step1",on:{click:function(e){return e.stopPropagation(),t.step1Click(e)}}},[t._v("提交销售申请")]),i("div",{class:"1"===t.formData.configs[0].state?"step2":"step2-disabled",on:{click:function(e){return e.stopPropagation(),t.step2Click(e)}}},[t._v("销售申请审批")]),i("div",{staticClass:"step3",on:{click:function(e){return e.stopPropagation(),t.step3Click(e)}}},[t._v("提交销售订单")]),i("div",{staticClass:"step4",on:{click:function(e){return e.stopPropagation(),t.step4Click(e)}}},[t._v("销售订单审批")])]),i("div",{staticClass:"content"},[t.step1?i("el-form-item",{staticClass:"isRequired",attrs:{label:"启用",prop:"state"}},[i("el-switch",{attrs:{"inactive-value":"0","active-value":"1"},on:{change:t.stateChange},model:{value:t.formData.configs[0].state,callback:function(e){t.$set(t.formData.configs[0],"state",e)},expression:"formData.configs[0].state"}})],1):t._e(),t.step3&&"1"===t.formData.configs[0].state?i("el-form-item",{staticClass:"isRequired",attrs:{label:"提交方式",prop:"subType"}},[i("el-radio-group",{model:{value:t.formData.configs[2].way,callback:function(e){t.$set(t.formData.configs[2],"way",e)},expression:"formData.configs[2].way"}},[i("el-radio",{attrs:{label:"0"}},[t._v("自动提交")]),i("el-radio",{attrs:{label:"1"}},[t._v("手动提交")])],1)],1):t._e(),t.step1&&"1"===t.formData.configs[0].state?i("el-form-item",{staticClass:"isRequired",attrs:{label:"适用对象",prop:"object1"}},[t._l(t.formData.configs[0].items,(function(e,a){return i("div",{key:e.id,staticClass:"object"},[i("div",{staticClass:"index"},[t._v(t._s(a+1))]),i("el-cascader",{attrs:{options:t.serviceDatas,props:t.cascaderProps},on:{"active-item-change":t.getChildList},model:{value:e.ids,callback:function(i){t.$set(e,"ids",i)},expression:"item.ids"}}),i("i",{staticClass:"el-icon-delete",attrs:{size:"small"},on:{click:function(i){return i.stopPropagation(),t.deleteRow(e)}}})],1)})),i("div",{staticClass:"addButton"},[i("i",{staticClass:"el-icon-plus plus-cs",attrs:{size:"small"},on:{click:function(e){return e.stopPropagation(),t.addRow(e)}}})])],2):t._e(),t.step3&&"1"===t.formData.configs[2].way?i("el-form-item",{staticClass:"isRequired",attrs:{label:"适用对象",prop:"object3"}},["1"===t.formData.configs[0].state?i("div",{staticStyle:{"fonr-size":"12px",color:"#666666"}},[t._v("适用对象与提交申请处一致，如需修改请至提交申请处修改")]):t._e(),t._l(t.formData.configs[2].items,(function(e,a){return i("div",{key:a,staticClass:"object"},[i("div",{staticClass:"index"},[t._v(t._s(a+1))]),i("el-cascader",{attrs:{options:t.serviceDatas,props:t.cascaderProps,disabled:"1"===t.formData.configs[0].state},on:{"active-item-change":t.getChildList},model:{value:e.ids,callback:function(i){t.$set(e,"ids",i)},expression:"item.ids"}}),"0"===t.formData.configs[0].state?i("i",{staticClass:"el-icon-delete",attrs:{size:"small"},on:{click:function(i){return i.stopPropagation(),t.deleteRow(e)}}}):t._e()],1)})),"0"===t.formData.configs[0].state?i("div",{staticClass:"addButton"},[i("i",{staticClass:"el-icon-plus plus-cs",attrs:{size:"small"},on:{click:function(e){return e.stopPropagation(),t.addRow(e)}}})]):t._e()],2):t._e(),t.step4?i("el-form-item",{staticClass:"isRequired",attrs:{label:"审批后自动采购",prop:"autoNext"}},[i("el-button",{directives:[{name:"popover",rawName:"v-popover:UnionType",arg:"UnionType"}],attrs:{type:"text",size:"small"}},[i("i",{staticClass:"iconfont el-icon-question"})]),i("el-popover",{ref:"UnionType",attrs:{placement:"bottom-start",width:"300",trigger:"hover"}},[i("p",[t._v("设置为自动采购后，系统将为您自动向供应商提交采购单，此种设置适用代销方式的门店；")]),i("p",[t._v("设置为人工采购，则需要相关人员手动创建采购单，适用直销方式的门店。")])]),i("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.formData.configs[3].autoNext,callback:function(e){t.$set(t.formData.configs[3],"autoNext",e)},expression:"formData.configs[3].autoNext"}})],1):t._e(),t.step2||t.step4?i("el-form-item",{staticClass:"isRequired",attrs:{label:"审批方式",prop:"way"}},[t.step2?i("el-radio-group",{model:{value:t.formData.configs[1].way,callback:function(e){t.$set(t.formData.configs[1],"way",e)},expression:"formData.configs[1].way"}},[i("el-radio",{attrs:{label:"0"}},[t._v("系统审批")]),i("el-radio",{attrs:{label:"1"}},[t._v("人工审批")])],1):t._e(),t.step4?i("el-radio-group",{model:{value:t.formData.configs[3].way,callback:function(e){t.$set(t.formData.configs[3],"way",e)},expression:"formData.configs[3].way"}},[i("el-radio",{attrs:{label:"0"}},[t._v("系统审批")]),i("el-radio",{attrs:{label:"1"}},[t._v("人工审批")])],1):t._e()],1):t._e(),t.step2&&"1"===t.formData.configs[1].way||t.step4&&"1"===t.formData.configs[3].way?i("el-form-item",{staticClass:"isRequired",attrs:{label:"审批流程"}},[t.step2?i("el-steps",{attrs:{direction:"vertical"}},t._l(t.formData.configs[1].items,(function(e,a){return i("el-step",{key:a},[i("div",{staticClass:"stepItem",attrs:{slot:"description"},slot:"description"},[i("el-form",{ref:"processForm",refInFor:!0},[i("el-form-item",{attrs:{prop:"process"}},[i("el-cascader",{attrs:{options:t.roleDatas,props:t.cascaderProps},on:{"active-item-change":t.listAdminByRoleId},model:{value:e.ids,callback:function(i){t.$set(e,"ids",i)},expression:"list.ids"}}),i("div",{staticStyle:{float:"right"}},[i("el-button",{attrs:{type:"text"}},[i("i",{staticClass:"iconfont biz-icon-iconfontshanchu1",on:{click:function(i){return t.deleteLevel(e)}}})])],1)],1),i("el-form-item",{attrs:{prop:"money"}},[t._v(" 审批金额标准>= "),i("el-input",{staticStyle:{width:"215px"},attrs:{placeholder:"请输入金额"},model:{value:e.money,callback:function(i){t.$set(e,"money",i)},expression:"list.money"}})],1)],1)],1)])})),1):t._e(),t.step4?i("el-steps",{attrs:{direction:"vertical"}},t._l(t.formData.configs[3].items,(function(e,a){return i("el-step",{key:a},[i("div",{staticClass:"stepItem",attrs:{slot:"description"},slot:"description"},[i("el-form",{ref:"processForm",refInFor:!0},[i("el-form-item",{attrs:{prop:"process"}},[i("el-cascader",{attrs:{options:t.roleDatas,props:t.cascaderProps},on:{"active-item-change":t.listAdminByRoleId},model:{value:e.ids,callback:function(i){t.$set(e,"ids",i)},expression:"list.ids"}}),i("div",{staticStyle:{float:"right"}},[i("el-button",{attrs:{type:"text"}},[i("i",{staticClass:"iconfont biz-icon-iconfontshanchu1",on:{click:function(i){return t.deleteLevel(e)}}})])],1)],1),i("el-form-item",{attrs:{prop:"money"}},[t._v(" 审批金额标准>= "),i("el-input",{staticStyle:{width:"215px"},attrs:{placeholder:"请输入金额"},model:{value:e.money,callback:function(i){t.$set(e,"money",i)},expression:"list.money"}})],1)],1)],1)])})),1):t._e(),this.formData.configs[3].items.length<6&&t.step4&&"1"===t.formData.configs[3].way?i("div",[i("div",{staticClass:"addButton"},[i("i",{staticClass:"el-icon-plus plus-cs",attrs:{size:"small"},on:{click:function(e){return e.stopPropagation(),t.addLevel(e)}}})])]):t._e(),this.formData.configs[1].items.length<6&&t.step2&&"1"===t.formData.configs[1].way?i("div",[i("div",{staticClass:"addButton"},[i("i",{staticClass:"el-icon-plus plus-cs",attrs:{size:"small"},on:{click:function(e){return e.stopPropagation(),t.addLevel(e)}}})])]):t._e()],1):t._e()],1)],1)],1)},g=[],h=(i("99af"),i("c975"),i("d81d"),i("a434"),i("5530")),v=i("8330"),b=i("fe0a"),w=i.n(b),y=i("2f62"),D={name:"ApproveSettingBsae",components:{BizSaveButton:v["a"],BizGrid:o["a"]},props:{idObject:{required:!0,type:Object}},data:function(){var t=this,e=function(e,i,a){t.step1&&!t.formData.configs[0].state?a(new Error("请选择状态")):a()},i=function(e,i,a){t.step3&&!t.formData.configs[2].way?a(new Error("请选择提交方式")):a()},a=function(e,i,a){!t.step1||0!==t.formData.configs[0].items.length&&0!==t.formData.configs[0].items[0].ids.length?a():a(new Error("请选择适用对象"))},s=function(e,i,a){!t.step3||"1"!==t.formData.configs[2].way||0!==t.formData.configs[2].items.length&&0!==t.formData.configs[2].items[0].ids.length?a():a(new Error("请选择适用对象"))},o=function(e,i,a){t.step4&&!t.formData.configs[3].autoNext?a(new Error("请选择采购方式")):a()},n=function(e,i,a){t.step2&&!t.formData.configs[1].way||t.step4&&!t.formData.configs[3].way?a(new Error("请选择审批方式")):a()};return{addFormVisible:!1,loading:!1,isCreate:!1,serviceDatas:[],cascaderProps:{label:"label",value:"value",children:"children"},xslc:w.a,step1:!0,step2:!1,step3:!1,step4:!1,tableData:[],roleDatas:[],operations:[{label:"保存",name:"save",type:"primary"}],formData:this.getDefaultModel(),rollList:[],rollDatas:[],roleName:"",rules:{name:[{required:!0,message:"请输入流程名称",trigger:"blur"}],state:[{required:!1,message:"请选择状态",trigger:"change"},{validator:e,trigger:"change"}],subType:[{required:!1,message:"请选择提交方式",trigger:"change"},{validator:i,trigger:"change"}],object1:[{required:!1,message:"请选择适用对象",trigger:"change"},{validator:a,trigger:"change"}],object3:[{required:!1,message:"请选择适用对象",trigger:"change"},{validator:s,trigger:"change"}],autoNext:[{required:!1,message:"请选择自动采购方式",trigger:"change"},{validator:o,trigger:"change"}],way:[{required:!1,message:"请选择审批方式",trigger:"change"},{validator:n,trigger:"change"}]}}},computed:{},watch:{idObject:function(t){t.id?(this.step1=!0,this.step2=!1,this.step3=!1,this.step4=!1,this.refresh(),this.isCreate=!1):(this.isCreate=!0,this.formData=this.getDefaultModel())}},created:function(){this.queryagencyList(),this.queryRollList()},methods:Object(h["a"])(Object(h["a"])({},Object(y["c"])(["getUser"])),{},{operate:function(t){this[t]()},stateChange:function(t){"0"===t?this.formData.configs[2].way="1":(this.formData.configs[2].items=this.formData.configs[0].items,this.formData.configs[2].items.map((function(t){t.id=""})))},getChildList:function(t){var e,i=this,a={cooperationId:t[0],cooperationType:1,pageSize:1e3};p["a"].get("/admin/cooperationInfo/admins.jhtml",a).then((function(a){i.serviceDatas.forEach((function(i){if(i.value===t[0])return i.children=[{label:"全部",value:""}],a.dataList.forEach((function(t){e={},e.label=t.name,e.value=t.id,i.children.push(e)})),!1}))})).catch((function(t){console.log(t),console.log("code错误"),i.$message.warning(t.errorMessage)}))},deleteRow:function(t){this.step1&&this.formData.configs[0].items.splice(this.formData.configs[0].items.indexOf(t),1),this.step3&&this.formData.configs[2].items.splice(this.formData.configs[2].items.indexOf(t),1)},addRow:function(){this.step1&&this.formData.configs[0].items.push({approver:{id:"",name:""},auditId:"",ids:[],id:"",money:"0",role:{id:"",name:"",type:""},shop:{id:"",name:"",type:""}}),this.step3&&this.formData.configs[2].items.push({approver:{id:"",name:""},auditId:"",ids:[""],id:"",money:"0",role:{id:"",name:"",type:""},shop:{id:"",name:"",type:""}})},step1Click:function(){this.$refs.form.clearValidate(),this.step1=!0,this.step2=!1,this.step3=!1,this.step4=!1},step2Click:function(){if(this.$refs.form.clearValidate(),"1"!==this.formData.configs[0].state)return!1;this.step2=!0,this.step1=!1,this.step3=!1,this.step4=!1},step3Click:function(){this.$refs.form.clearValidate(),"1"===this.formData.configs[0].state&&(this.formData.configs[2].items=this.formData.configs[0].items),this.step1=!1,this.step2=!1,this.step3=!0,this.step4=!1},step4Click:function(){this.$refs.form.clearValidate(),this.step1=!1,this.step2=!1,this.step3=!1,this.step4=!0},getDefaultModel:function(){return{name:"",memo:"",type:"1",configs:[{billName:"提交销售申请",billType:"11",flowId:"",id:"",items:[{approver:{id:"",name:""},auditId:"",ids:[""],id:"",money:"0",role:{id:"",name:"",type:""},shop:{id:"",name:"",type:""}}],remark:"",state:"1"},{autoNext:"0",billName:"销售申请审批",billType:"12",flowId:"",id:"",items:[{approver:{id:"",name:""},auditId:"",id:"",ids:[""],money:"0",role:{id:"",name:"",type:""},shop:{id:"",name:"",type:""}}],remark:"",way:"0"},{autoNext:"0",billName:"提交销售订单",billType:"13",flowId:"",id:"",items:[{approver:{id:"",name:""},auditId:"",id:"",ids:[""],money:"0",role:{id:"",name:"",type:""},shop:{id:"",name:"",type:""}}],remark:"",state:"0",way:"0"},{autoNext:"0",billName:"销售订单审批",billType:"14",flowId:"",id:"",items:[{approver:{id:"",name:""},auditId:"",id:"",ids:[""],money:"0",role:{id:"",name:"",type:""},shop:{id:"",name:"",type:""}}],remark:"",state:"0",way:"0"}]}},refresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i={id:this.idObject.id||e,shopId:window.top.SHOP_ID||""};this.loading=!0,p["a"].get(f["g"].invoicing.shopApprovalFlow,i).then((function(e){t.formData=e.data,t.formData.configs[0].items.map((function(e){t.$set(e,"ids",[]),e.shop.id?(e.ids.push(e.shop.id),t.getChildList([e.shop.id]),e.approver.id?e.ids.push(e.approver.id):e.ids.push("")):t.$set(e,"ids",[""])})),t.formData.configs[1].items.map((function(e){t.$set(e,"ids",[]),e.role.id?(e.ids.push(e.role.id),t.listAdminByRoleId([e.role.id]),e.approver.id?e.ids.push(e.approver.id):e.ids.push("")):t.$set(e,"ids",[""])})),t.formData.configs[2].items.map((function(e){t.$set(e,"ids",[]),e.shop.id?(e.ids.push(e.shop.id),t.getChildList([e.shop.id]),e.approver.id?e.ids.push(e.approver.id):e.ids.push("")):t.$set(e,"ids",[""])})),t.formData.configs[3].items.map((function(e){t.$set(e,"ids",[]),e.role.id?(e.ids.push(e.role.id),t.listAdminByRoleId([e.role.id]),e.approver.id?e.ids.push(e.approver.id):e.ids.push("")):t.$set(e,"ids",[""])}))})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))},listAdminByRoleId:function(t){var e,i=this,a={roleId:t[0]};p["a"].get("/admin/admin/listAdminByRoleId.jhtml",a).then((function(a){i.roleDatas.forEach((function(i){if(i.value===t[0])return i.children=[{label:"全部",value:""}],a.dataList.forEach((function(t){e={},e.label=t.name,e.value=t.id,i.children.push(e)})),!1}))})).catch((function(t){console.log(t),console.log("code错误"),i.$message.warning(t.errorMessage)}))},queryRollList:function(){var t=this,e={id:this.idObject.id,shopId:window.top.SHOP_ID||""};p["a"].get("/admin/admin/json/getVisibleRoles.jhtml",e).then((function(e){t.roleDatas=[{label:"全部",value:""}].concat(e.allRoles.map((function(t){return{label:t.name,value:t.id,children:[]}})))})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(t){}))},queryagencyList:function(){var t=this,e={cooperationType:"1",shopId:window.top.SHOP_ID||"",pageSize:1e3};p["a"].get("/admin/cooperationInfo/cooperationInfos.jhtml",e).then((function(e){t.serviceDatas=[{label:"全部",value:""}].concat(e.dataList.map((function(t){return{label:t.name,value:t.id,children:[]}})))})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(t){}))},deleteLevel:function(t){this.step2&&this.formData.configs[1].items.splice(this.formData.configs[1].items.indexOf(t),1),this.step4&&this.formData.configs[3].items.splice(this.formData.configs[3].items.indexOf(t),1)},addLevel:function(){this.isCreate=!0,this.step2&&this.formData.configs[1].items.push({approver:{id:"",name:""},auditId:"",ids:[""],id:"",money:"0",role:{id:"",name:"",type:""},shop:{id:"",name:"",type:""}}),this.step4&&this.formData.configs[3].items.push({approver:{id:"",name:""},auditId:"",ids:[""],id:"",money:"0",role:{id:"",name:"",type:""},shop:{id:"",name:"",type:""}})},deleteRegion:function(t,e){this.tableData.splice(e,1)},updateRegion:function(){var t=this;p["a"].put(f["g"].invoicing.shopApprovalFlow,this.formData).then((function(e){t.$message.success("保存成功"),t.$emit("item-updated")})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))},createRegion:function(){var t=this;p["a"].post(f["g"].invoicing.shopApprovalFlow,this.formData).then((function(e){t.$message.success("保存成功"),t.refresh(e.id),t.$emit("item-updated")})).catch((function(e){t.$message({message:e.errorMessage,type:"warning"}),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))},save:function(){var t=this;this.$refs.form.validate((function(e){if(e){if(console.log(t.step2),console.log(t.formData.configs[1].way),console.log(t.formData.configs[1].items.length),t.step2&&"1"===t.formData.configs[1].way&&(0===t.formData.configs[1].items.length||!t.formData.configs[1].items[0].money)||t.step4&&"1"===t.formData.configs[3].way&&(0===t.formData.configs[3].items.length||!t.formData.configs[3].items[0].money))return void t.$message.warning("请输入审批金额");if(t.step2&&"1"===t.formData.configs[1].way&&(0===t.formData.configs[1].items.length||0===t.formData.configs[1].items[0].ids.length)||t.step4&&"1"===t.formData.configs[3].way&&(0===t.formData.configs[3].items.length||0===t.formData.configs[3].items[0].ids.length))return void t.$message.warning("请选择审批流程");t.formData.configs[0].items.map((function(t){t.shop.id=t.ids.length>0?t.ids[0]:"",t.approver.id=t.ids.length>1?t.ids[1]:""})),t.formData.configs[1].items.map((function(t){t.role.id=t.ids.length>0?t.ids[0]:"",t.approver.id=t.ids.length>1?t.ids[1]:""})),t.formData.configs[2].items.map((function(e){e.shop.id=e.ids.length>0?e.ids[0]:"",e.approver.id=e.ids.length>1?e.ids[1]:"","1"===t.formData.configs[0].state&&(e.id="")})),t.formData.configs[3].items.map((function(t){t.role.id=t.ids.length>0?t.ids[0]:"",t.approver.id=t.ids.length>1?t.ids[1]:""})),t.idObject.id?t.updateRegion():t.createRegion()}}))}})},_=D,C=(i("6bf4"),i("2877")),x=Object(C["a"])(_,u,g,!1,null,null,null),k=x.exports,I={name:"ProcessSettingSale",components:{BizGrid:o["a"],BizPopupTabs:d["a"],SaleSettingInfo:k,BizFlexTable:m["c"],BizHeader:m["d"]},data:function(){return{tabName:"first",loading:!1,open:!1,showList:!1,infoId:{id:""},orderId:{id:""},purchaseId:{id:""},selections:[],tableData:[],xslc:r.a,xslc1:c.a,pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},operations:[{label:"添加",name:"create",type:"primary"},{label:"删除",name:"delete",type:"",disabled:!0},{label:"刷新",name:"refresh",type:""}],views:[{actived:!0,class:"iconfont biz-icon-qiapianshitu",title:"流程视图",name:"card"},{actived:!1,class:"iconfont biz-icon-liebiaoshitu",title:"列表视图",name:"list"}],filters:[{type:"input",label:"",placeholder:"请输入流程名称",select:[],name:"searchValue",value:""}]}},computed:{},watch:{},created:function(){this.getList()},methods:{formatRow:function(t){return 1===t.configs[0].items.length?t.configs[0].items[0].shop.name?t.configs[0].items[0].shop.name+(t.configs[0].items[0].approver.name?t.configs[0].items[0].approver.name:"全部"):"全部门店":t.configs[0].items[0].shop.name?t.configs[0].items[0].shop.name+(t.configs[0].items[0].approver.name?t.configs[0].items[0].approver.name:"全部")+"等":"全部门店等"},operate:function(t){this[t]()},onViewSwitch:function(t){"card"===t?(this.views[0].actived=!0,this.views[1].actived=!1,this.showList=!1):(this.views[1].actived=!0,this.views[0].actived=!1,this.showList=!0)},filterDataChange:function(){this.pagination.currentPage=1,this.getList()},handlePageSizeChange:function(t){this.pagination.pageSize=t,this.pagination.currentPage=1,this.getList()},handleCurrentPageChange:function(t){this.pagination.currentPage=t,this.getList()},handleSelectionChange:function(t){this.selections=t,this.operations[1].disabled=!0,t.length>0&&(this.operations[1].disabled=!1)},create:function(){this.infoId={id:""},this.open=!0},handleRowClick:function(t){this.infoId={id:t.id},this.open=!0},deleteItem:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,p["a"].delete(f["g"].invoicing.shopApprovalFlow,{ids:t}).then((function(t){e.$message.success("删除成功"),e.getList()})).catch((function(t){console.log(t),console.log("code错误"),"店铺不存在"!==t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))}))},delete:function(){if(this.selections&&this.selections.length>0){var t=[];this.selections.forEach((function(e){t.push(e.id)})),this.deleteItem(t)}else this.$message("请选择一条数据")},handleDeleteClick:function(t){this.deleteItem([t.id])},refresh:function(){this.getList()},getList:function(){var t=this,e={pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage,shopId:window.top.SHOP_ID||"",searchValue:this.filters[0].value,type:"1"};this.loading=!0,p["a"].get(f["g"].invoicing.shopApprovalFlows,e).then((function(e){t.tableData=e.dataList,t.pagination.total=Number(e.total)})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))}}},R=I,S=(i("f1b9"),Object(C["a"])(R,a,s,!1,null,null,null));e["default"]=S.exports},7132:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"biz-fade-t"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"biz-popup",on:{click:function(e){return e.target!==e.currentTarget?null:t.close(e)}}},[i("transition",{attrs:{name:"biz-fade-t-right"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"popup-content",style:t.contentStyle},[t._t("default")],2)])],1)])},s=[],o={name:"BizPopup",props:{open:{type:Boolean,default:function(){return!1}},contentStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{close:function(){this.$emit("close")}}},n=o,r=(i("5b8e"),i("2877")),l=Object(r["a"])(n,a,s,!1,null,null,null),c=l.exports,p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"biz-popup-tabs"},[i("biz-popup",{attrs:{open:t.open,contentStyle:t.contentStyle},on:{close:t.close}},[i("el-tabs",{attrs:{type:"border-card",value:t.value},on:{"tab-click":t.tabClick}},[t._t("default")],2)],1)],1)},f=[],d=(i("b0c0"),{name:"BizPopupTabs",data:function(){return{}},props:{open:{type:Boolean,default:!1},value:{type:String,required:!0},contentStyle:{type:Object,default:function(){return{}}}},components:{BizPopup:c},methods:{close:function(){var t=this;this.$confirm("是否保存当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("close")}))},tabClick:function(t){this.$emit("input",t.name)}}}),m=d,u=(i("d4c2"),Object(r["a"])(m,p,f,!1,null,null,null)),g=u.exports;i.d(e,"a",(function(){return g}))},9678:function(t,e,i){},"97fc":function(t,e,i){},"9b38":function(t,e,i){t.exports=i.p+"static/img/01.13ef1df0.png"},"9d1f":function(t,e,i){t.exports=i.p+"static/img/02.4bddf763.png"},a9e3:function(t,e,i){"use strict";var a=i("83ab"),s=i("da84"),o=i("94ca"),n=i("6eeb"),r=i("5135"),l=i("c6b6"),c=i("7156"),p=i("c04e"),f=i("d039"),d=i("7c73"),m=i("241c").f,u=i("06cf").f,g=i("9bf2").f,h=i("58a8").trim,v="Number",b=s[v],w=b.prototype,y=l(d(w))==v,D=function(t){var e,i,a,s,o,n,r,l,c=p(t,!1);if("string"==typeof c&&c.length>2)if(c=h(c),e=c.charCodeAt(0),43===e||45===e){if(i=c.charCodeAt(2),88===i||120===i)return NaN}else if(48===e){switch(c.charCodeAt(1)){case 66:case 98:a=2,s=49;break;case 79:case 111:a=8,s=55;break;default:return+c}for(o=c.slice(2),n=o.length,r=0;r<n;r++)if(l=o.charCodeAt(r),l<48||l>s)return NaN;return parseInt(o,a)}return+c};if(o(v,!b(" 0o1")||!b("0b1")||b("+0x1"))){for(var _,C=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof C&&(y?f((function(){w.valueOf.call(i)})):l(i)!=v)?c(new b(D(e)),i,C):D(e)},x=a?m(b):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),k=0;x.length>k;k++)r(b,_=x[k])&&!r(C,_)&&g(C,_,u(b,_));C.prototype=w,w.constructor=C,n(s,v,C)}},d4c2:function(t,e,i){"use strict";var a=i("e725"),s=i.n(a);s.a},d916:function(t,e,i){},e725:function(t,e,i){},f1b9:function(t,e,i){"use strict";var a=i("97fc"),s=i.n(a);s.a},fe0a:function(t,e,i){t.exports=i.p+"static/img/05.512d00ec.png"}}]);