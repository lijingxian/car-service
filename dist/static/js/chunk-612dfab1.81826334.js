(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-612dfab1"],{"01ce":function(e,t,a){},"0504":function(e,t,a){},"0943":function(e,t,a){"use strict";var i=a("1fac"),n=a.n(i);n.a},"0a05":function(e,t,a){},"17d6":function(e,t,a){},"19f0":function(e,t,a){"use strict";var i=a("17d6"),n=a.n(i);n.a},"1d33":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"depot-in-mgmt"},[a("biz-flex-table",{ref:"table",staticClass:"depot-in-mgmt-tabel",attrs:{operations:e.operations,filters:e.filters,tableData:e.tableData,loading:e.loading,pagination:e.pagination},on:{operate:e.operate,"filter-data-change":e.filterDataChange,"selection-change":e.handleSelectionChange,"row-click":e.rowClick,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{label:"订单","min-width":"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(e._s(t.row.sn))]),a("div",{staticClass:"overflow"},[e._v("创建日期："+e._s(t.row.createDate))]),a("div",{staticClass:"overflow"},[e._v("状态："+e._s(e.getStatus(t.row)))])])]}}])}),a("el-table-column",{attrs:{label:"往来方","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" "+e._s(t.row.relatePartnerName)+" ")])])]}}])}),a("el-table-column",{attrs:{label:"业务类型","min-width":"60px",prop:"amount"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" "+e._s(e.getBusinessType(t.row))+" ")])])]}}])}),a("el-table-column",{attrs:{label:"关联单据","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"shop-over overflow",staticStyle:{color:"#ff7300",cursor:"pointer"},on:{click:function(a){return e.clickRelateBill(a,t.row)}}},[e._v(" "+e._s(t.row.relateBillSn?t.row.relateBillSn:"")+" ")])])]}}])}),a("el-table-column",{attrs:{label:"商品信息","min-width":"240px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[a("div",{staticStyle:{width:"100%"}},e._l(t.row.itemDatas.length>0?[t.row.itemDatas[0]]:[],(function(i){return a("div",{key:i.sn,staticClass:"product-info-content"},[i.thumbnail&&" "!==i.thumbnail?a("img",{attrs:{src:i.thumbnail}}):a("img",{attrs:{src:"/resources/admin/images/default/product-default-100.png"}}),a("div",{staticClass:"wrapper"},[a("div",{staticClass:"titleClass",attrs:{title:i.specValue}},[e._v(e._s(i.specValue))]),a("div",{staticClass:"overflow"},[e._v(e._s(i.product?i.product.barCode:""))])]),a("div",{staticClass:"amount"},[e._v(e._s(i.amount)+e._s(t.row.itemDatas.length>1?"...":""))])])})),0)])]}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("biz-column-operation",{attrs:{row:t.row}},["0"===t.row.state||"2"===t.row.state?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.statusChange(t.row)}}},[e._v("确认入库")]):e._e(),"0"===t.row.state&&e.hasAuthDel?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.deleteApply(a,t.row)}}},[e._v("删除")]):e._e(),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.printApply(t.row)}}},[e._v("凭证")])],1)]}}])})],1),a("biz-popup-tabs",{attrs:{open:e.open},on:{close:function(t){e.open=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[a("base-info",{ref:"baseInfo",attrs:{itemId:e.itemId,isEdit:e.isEdit},on:{setOrderItems:e.setOrderItems,operationSuccess:e.createdSuccess}})],1),e.isCreate?a("el-tab-pane",{attrs:{label:"商品信息",name:"productinfo"}},[a("product-info",{ref:"productInfo",attrs:{itemId:e.itemId,isEdit:e.isEdit,returnId:e.returnId},on:{operationSuccess:e.operationSuccess}})],1):e._e(),e.isCreate?a("el-tab-pane",{attrs:{label:"入库信息",name:"depotinfo"}},[a("depot-in-info",{ref:"depotinfo",attrs:{itemId:e.itemId,isEdit:e.isEdit,tabSelection:e.tabName},on:{operationSuccess:e.operationSuccess}})],1):e._e()],1),a("biz-popup-tabs",{attrs:{open:e.openPurchaseOrder},on:{close:function(t){e.openPurchaseOrder=!1}},model:{value:e.relateBillPurchase,callback:function(t){e.relateBillPurchase=t},expression:"relateBillPurchase"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[a("purchase-order-info",{ref:"orderinfo",attrs:{orderId:e.purchaseOrderId,isRalateBill:e.isRalateBill},on:{closeTabByEvaluate:e.closeTabByEvaluate,closeTabByLogistics:e.closeTabByLogistics}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openReview},on:{close:function(t){e.openReview=!1}},model:{value:e.tabNameReview,callback:function(t){e.tabNameReview=t},expression:"tabNameReview"}},[a("el-tab-pane",{attrs:{label:"评价",name:"reviewinfo"}},[a("my-evaluate",{ref:"reviewinfo",attrs:{orderId:e.orderId,editable:e.editable},on:{operationSuccess:e.operationSuccess}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openAllottedOrder},on:{close:function(t){e.openAllottedOrder=!1}},model:{value:e.relateBillAttolled,callback:function(t){e.relateBillAttolled=t},expression:"relateBillAttolled"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[a("allotted-order-info",{ref:"allottedOrderinfo",attrs:{itemId:e.allottedOrderId,shopDepots:e.shopDepots}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openRelateBillOrder},on:{close:function(t){e.openRelateBillOrder=!1}},model:{value:e.relateBillOrder,callback:function(t){e.relateBillOrder=t},expression:"relateBillOrder"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"baseinfo"}},[a("order-base-info",{attrs:{itemId:e.relateBillOrderId,isEdit:e.isEdit},on:{operationSuccess:e.refresh}})],1),a("el-tab-pane",{attrs:{label:"商品信息",name:"productinfo"}},[a("order-product-info",{attrs:{itemId:e.relateBillProductId,isEdit:e.isEdit},on:{operationSuccess:e.refresh}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openInventory},on:{close:function(t){e.openInventory=!1}},model:{value:e.tabInventoryName,callback:function(t){e.tabInventoryName=t},expression:"tabInventoryName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[a("inventory-base-info",{ref:"baseInfo",attrs:{itemId:e.inventoryId,isEdit:e.isEdit},on:{operationSuccess:e.refresh}})],1),a("el-tab-pane",{attrs:{label:"商品信息",name:"productinfo"}},[a("inventory-product-info",{ref:"productinfo",attrs:{itemId:e.inventoryId,isEdit:e.isEdit},on:{operationSuccess:e.refresh}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openLogistics},on:{close:function(t){e.openLogistics=!1}},model:{value:e.tabNameLogistics,callback:function(t){e.tabNameLogistics=t},expression:"tabNameLogistics"}},[a("el-tab-pane",{attrs:{label:"物流追踪",name:"loginfo"}},[a("logistics-following",{ref:"logistics",attrs:{orderId:e.orderId,sn:e.sn}})],1)],1),a("el-dialog",{attrs:{visible:e.dialogTableVisible,center:"",width:"800px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"left"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.print}},[e._v("打印")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.exportInvoice}},[e._v("导出")])],1)])],1),a("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[e._v(e._s(e.title))])]),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"center"}},[e._v("打印日期："+e._s(e.formatDate((new Date).getTime())))])])],1),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("编号："+e._s(e.form.sn))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("创建时间："+e._s(e.form.createDate))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("往来方："+e._s(e.form.relatePartnerName))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("状态："+e._s(e.form.state))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("业务类型："+e._s(e.formatType(e.form.businessType)))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("创建人："+e._s(e.form.creatorName))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("备注："+e._s(e.form.remark))])])],1),a("el-table",{staticClass:"table-class",attrs:{data:e.gridData,"show-summary":"",size:"small"}},[a("el-table-column",{attrs:{type:"index",width:"50",label:"序号"}}),a("el-table-column",{attrs:{property:"fullName",label:"商品"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s((t.row.product?t.row.product.fullName:"")||t.row.productName))]}}])}),a("el-table-column",{attrs:{property:"product.barCode",label:"商品条码"}}),a("el-table-column",{attrs:{property:"amount",label:"入库数量"}}),a("el-table-column",{attrs:{property:"depotName",label:"仓库"}})],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("客户签字：")])])],1)],1)])],1)],1)},n=[],o=(a("99af"),a("4160"),a("caad"),a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("ac1f"),a("2532"),a("3ca3"),a("466d"),a("1276"),a("159b"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),r=a("5530"),s=a("7132"),l=a("04d3"),c=a("f705"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"product-info"},[e.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),a("biz-list",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{tableData:e.tableData,height:"100%"}},[a("el-table-column",{attrs:{prop:"fullName",label:"商品"}}),a("el-table-column",{attrs:{prop:"barCode",label:"条码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product&&t.row.product.barCode?t.row.product.barCode:""))]}}])}),a("el-table-column",{attrs:{prop:"amount",label:"订单数量"}}),a("el-table-column",{attrs:{prop:"depotedQuantity",label:"已入库数量"}}),a("el-table-column",{attrs:{prop:"unDepotedQuantity",label:"待入库数量"}}),e.isEdit?a("el-table-column",{attrs:{prop:"date",label:"操作",type:"index",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteHandeler(t)}}},[e._v("删除")]),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.confirm(t.row)}}},[e._v("确认入库")])],1)]}}],null,!1,2867198790)}):e._e()],1),a("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:e.showDialog,tableData:e.giftList,pagination:e.dialogPagination,filters:e.dialogFilters,selectionKeys:e.selectedGiftIds},on:{"update:visibility":function(t){e.showDialog=t},pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,confirmed:e.confirmedProduct,filterDataChange:e.dialogFilterDataChange,selectionChange:e.selectionChange,"active-item-change":e.activeItemChange,cascaderChange:e.cascaderChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"dialog-column"},[a("img",{staticClass:"productImg",attrs:{src:t.row.image||e.DefaultImg,onerror:e.errorImg}}),a("div",{staticClass:"biz-two-row"},[a("div",{staticClass:"titleClass",staticStyle:{"margin-left":"10px"},attrs:{title:t.row.fullName}},[e._v(e._s(t.row.fullName))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("编号："+e._s(t.row.sn))])])])]}}])}),a("el-table-column",{attrs:{property:"barCode",label:"条码"}}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),a("el-table-column",{attrs:{property:"price",label:"价格"}}),a("el-table-column",{attrs:{property:"price",label:"商品数量",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{attrs:{size:"mini",min:1},model:{value:t.row.amount,callback:function(a){e.$set(t.row,"amount",a)},expression:"scope.row.amount"}})]}}])}),a("el-table-column",{attrs:{label:"在库库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.realStock))])]}}])})],1),a("el-dialog",{attrs:{title:"确认入库",visible:e.showDialogInDepot,"append-to-body":"","custom-class":"depot-in-dialog",width:"80%"},on:{"update:visible":function(t){e.showDialogInDepot=t}}},[a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("span",[e._v("商品名称："+e._s(e.row.productName||e.row.fullName))]),a("span",[e._v("条码："+e._s(e.row.product?e.row.product.barCode:""))]),a("span",[e._v("待入库数量："+e._s(e.row.unDepotedQuantity||e.row.amount))]),a("span",[e._v("本次数量："+e._s(e.amount))])]),a("biz-header",{attrs:{filters:e.filters},on:{"filter-data-change":e.handleFilterDataChange}}),a("expand-table",{ref:"expandTable",staticStyle:{height:"500px","min-height":"95%"},attrs:{data:e.tableDataInDePot,loading:e.loading},on:{"expand-change":e.expandChange,delete:e.handleDeleteClick,quantityChange:e.quantityChange,"row-click":e.handleRowClick}}),a("biz-pagination",{attrs:{pagination:e.paginationExpend}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.close}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmed}},[e._v("确定")])],1)],1)],1)},u=[],p=(a("c975"),a("a434"),a("25f0"),a("b85c")),m=a("7558"),g=a("8330"),h=a("f36f"),f=a("2f62"),b=a("c596"),v=a("1ab1"),y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"expandTable",staticClass:"expand-table",staticStyle:{width:"100%","min-height":"100%"},attrs:{size:"small","tooltip-effect":"dark","row-key":"id",height:"auto",border:e.showBorder,data:e.data,"show-header":e.showHeader,rowClassName:e.setClassName,"cell-class-name":e.cellClassName,"expand-row-keys":e.expandedRowKeys},on:{"expand-change":e.expandChangeHandler,"row-click":e.rowClickHandler,handleAgent:e.handleAgent,handleAdmin:e.handleAdmin,quantityChange:e.quantityChange}},[e.isSearch?a("el-table-column",{attrs:{type:"expand",label:e.maxLevel,width:"100","class-name":"1"===e.hasChild?"cell"+e.layer:"cell0"+e.layer},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.children.length>0?a("expand-table",{staticClass:"expand-table-child",attrs:{height:"auto",hasChild:t.row.hasChild,layer:e.layer+1,data:t.row.children,"show-header":!1,"show-border":!1,"expand-row-keys":e.expandedRowKeys},on:{delete:e.handleDeleteClick,handleAgent:e.handleAgent,handleAdmin:e.handleAdmin,"expand-change":e.expandChangeHandler,"row-click":e.rowClickHandler,quantityChange:e.quantityChange}}):e._e()]}}],null,!1,3593099644)}):e._e(),a("el-table-column",{attrs:{label:"仓库名称",prop:"name","class-name":"first-name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.name))]}}])}),a("el-table-column",{attrs:{label:"合计库存",prop:"sumStockQuantity"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.sumStockQuantity))]}}])}),a("el-table-column",{attrs:{label:"在库库存",prop:"stockQuantity"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.stockQuantity))]}}])}),a("el-table-column",{attrs:{label:"本次数量",prop:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{attrs:{size:"mini",min:0,disabled:"0"===t.row.enabled},on:{change:e.quantityChange},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})]}}])})],1)},w=[],C=(a("cb29"),a("a15b"),{name:"ExpandTable",filters:{},props:{showHeader:{type:Boolean,default:!0},isSearch:{type:Boolean,default:!0},hasChild:{type:String,default:"1"},data:{type:Array,default:function(){return[]}},height:{type:String,default:"100%"},loading:{type:Boolean,default:!1},showBorder:{type:Boolean,default:!0},layer:{type:Number,default:0},expandedRowKeys:{type:Array,default:function(){return[]}}},data:function(){return{maxLevel:"1",currentLevel:1,className:""}},components:{},computed:Object(r["a"])(Object(r["a"])({},Object(f["c"])("Authority",["currentAuth"])),{},{hasAuthAdmin:function(){return this.currentAuth.includes("admin:agent.usermanage")},hasAuthDel:function(){return this.currentAuth.includes("admin:agent.delete")},hasAuthAdd:function(){return this.currentAuth.includes("admin:agent.add")}}),watch:{},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight,t=String(e-205);document.querySelectorAll(".expand-table.el-table__body-wrapper")[0].style.height=t+"px",document.querySelectorAll(".expand-table.el-table__body-wrapper")[0].style.overflowX="hidden",document.querySelectorAll(".expand-table.el-table__body-wrapper")[0].style.overflowY="auto"},updated:function(){this.doLayout()},methods:{setClassName:function(e){var t=e.row;e.index;return t.hasChild>0?"expand":"noexpand"},cellClassName:function(e){var t=e.row;e.column,e.rowIndex,e.columnIndex;return"row"+t.id},doLayout:function(){document.querySelectorAll(".expand-table-child .el-table__body-wrapper").forEach((function(e){e.style.height="auto"})),document.querySelectorAll(".el-table__expand-icon").forEach((function(e){e.children[0].className="iconfont biz-icon-i-web-zk1"}))},formatTreeLayer:function(e,t){var a=[];return t&&(a.push(new Array(t).fill("|").join(" ")),a.push("--")),a.push(e),a.join("")},expandChangeHandler:function(e,t){this.doLayout(),this.className&&this.className.split(".")[1]!=="row"+e.id&&(document.querySelector(this.className).children[0].children[0].style.color="#666666"),this.className=".row"+e.id,document.querySelector(this.className).children[0].children[0].style.color="#ff7300";var a=[];console.log("this.currentLevel"+this.currentLevel),console.log("row.grade"+this.currentLevel),t&&t.length>0?this.currentLevel=Number(e.grade)+1:this.currentLevel=Number(e.grade);for(var i=0;i<=this.currentLevel;i++)a.push(i+1);this.maxLevel=a.join(" "),console.log(this.$refs.expandTable),this.$emit("expand-change",e,t)},rowClickHandler:function(e){this.$emit("row-click",e)},handleDeleteClick:function(e,t){this.$emit("delete",e,t)},handleAgent:function(e,t){this.$emit("handleAgent",e,t)},handleAdmin:function(e,t){this.$emit("handleAdmin",e,t)},quantityChange:function(e,t){console.log(0),this.$emit("quantityChange",e,t)}}}),I=C,S=(a("19f0"),a("2877")),D=Object(S["a"])(I,y,w,!1,null,null,null),_=D.exports,P=a("af3f"),x=a("f3ac"),k=a.n(x),T={name:"ProductInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},returnId:{type:String}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},errorImg:'this.src="/resources/admin/images/default/product-default.png"',selectedGiftList:[],selectedGiftIds:[],selectionList:[],tableDataInDePot:[],showDialog:!1,showDialogInDepot:!1,DefaultImg:k.a,productCategoryId:"",amount:"",filters:[{type:"input",label:"",placeholder:"请输入仓库名称",name:"searchValue",value:""}],paginationExpend:{pageSize:1e3,pageSizes:[1e3],currentPage:1,total:9},dialogFilters:[{type:"cascader",label:"分类",name:"category",filterable:!1,value:[],options:[]},{type:"select",label:"品牌",value:"",options:[]},{type:"input",placeholder:"请输入编号/商品名/条码",name:"searchbar",value:""}],giftList:[],categoryDatas:[],loading:!1,open:!1,totalFee:"",row:{},height:"585",tableData:[],restaurants:[],selections:[],itemDatas:[],dialogTableVisible:!1,currentRow:{},storeList:[],title:"",operations:[{label:"新增商品",name:"addProduct",type:"primary"},{label:"保存",name:"save",type:"primary",auth:["admin:inport.edit"]}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:m["a"],BizGrid:h["a"],BizSaveButton:g["a"],ExpandTable:_,BizPagination:l["f"],BizHeader:l["d"],BizDialogSelector:P["a"]},watch:{itemId:function(e){this.tableData=[],this.storeList=[],this.itemId&&this.getList(),this.queryStoreHouseList()},returnId:function(e){this.tableData=[],this.storeList=[],this.returnId&&this.getList(),this.queryStoreHouseList()}},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},methods:Object(r["a"])(Object(r["a"])({},Object(f["c"])(["getUser"])),{},{expandChange:function(e){this.currentRow=e},getQueryParams:function(){return{shopId:window.top.SHOP_ID||"",productId:this.row.productId,searchValue:this.filters[0].value}},query:function(){var e=this;this.loading=!0,v["a"].get("/admin/invoicing/stock/productDepots.jhtml",this.getQueryParams()).then((function(t){e.loading=!1,e.tableDataInDePot=t.dataList;var a,i=Object(p["a"])(e.tableDataInDePot);try{for(i.s();!(a=i.n()).done;){var n=a.value;if(e.$set(n,"quantity",0),n.children&&n.children.length>0){n.hasChild="1";var o,r=Object(p["a"])(n.children);try{for(r.s();!(o=r.n()).done;){var s=o.value;if(e.$set(s,"quantity",0),s.parentName=n.name,s.children.length>0){s.hasChild="1";var l,c=Object(p["a"])(s.children);try{for(c.s();!(l=c.n()).done;){var d=l.value;e.$set(d,"quantity",0),d.parentName=s.name}}catch(u){c.e(u)}finally{c.f()}}}}catch(u){r.e(u)}finally{r.f()}}}}catch(u){i.e(u)}finally{i.f()}e.paginationExpend.total=Number(t.total),e.quantityChange(),e.showDialogInDepot=!0})).catch((function(t){console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},close:function(){this.showDialogInDepot=!1},confirmed:function(){var e,t=this,a=[],i=Object(p["a"])(this.tableDataInDePot);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.quantity&&a.push({itemId:this.row.id,depot:{id:n.id},quantity:n.quantity}),n.children.length>0){var o,r=Object(p["a"])(n.children);try{for(r.s();!(o=r.n()).done;){var s=o.value;if(s.quantity&&a.push({itemId:this.row.id,depot:{id:s.id},quantity:s.quantity}),s.children.length>0){var l,c=Object(p["a"])(s.children);try{for(c.s();!(l=c.n()).done;){var d=l.value;d.quantity&&a.push({itemId:this.row.id,depot:{id:d.id},quantity:d.quantity})}}catch(u){c.e(u)}finally{c.f()}}}}catch(u){r.e(u)}finally{r.f()}}}}catch(u){i.e(u)}finally{i.f()}console.log(this.row.unDepotedQuantity),console.log(this.amount),this.amount.toString()!==(this.row.unDepotedQuantity||this.row.amount)?this.$confirm("您本次入库的商品的数量与关联单据的需入库数量不符，确认入库?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.depotInConfirm(a)})):this.depotInConfirm(a)},depotInConfirm:function(e){var t=this;this.loading=!0,v["a"].post("/admin/invoicing/stock/depotIn/records.jhtml",{id:this.itemId,records:e}).then((function(e){t.loading=!1,t.$message.success("操作成功"),t.showDialogInDepot=!1,t.refresh(),t.$emit("operationSuccess")})).catch((function(e){console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))},confirm:function(e){this.row=e,this.query()},handleFilterDataChange:function(){this.query()},handleRowClick:function(e,t,a){},handleDeleteClick:function(e,t){e.stopPropagation(),this.deleteItem([t.id])},quantityChange:function(e,t){var a,i=0,n=Object(p["a"])(this.tableDataInDePot);try{for(n.s();!(a=n.n()).done;){var o=a.value;if(o.quantity&&(i+=Number(o.quantity)),o.children&&o.children.length>0){var r,s=Object(p["a"])(o.children);try{for(s.s();!(r=s.n()).done;){var l=r.value;if(l.quantity&&(i+=Number(l.quantity)),l.children.length>0){var c,d=Object(p["a"])(l.children);try{for(d.s();!(c=d.n()).done;){var u=c.value;u.quantity&&(i+=Number(u.quantity))}}catch(m){d.e(m)}finally{d.f()}}}}catch(m){s.e(m)}finally{s.f()}}}}catch(m){n.e(m)}finally{n.f()}this.amount=i},addProduct:function(){this.queryFilters(),this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getGiftList()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getGiftList()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getGiftList()},getGiftList:function(){var e=this,t={productCategoryId:this.productCategoryId,brandId:this.getSelectedBrandId(),pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[2].value,shopId:window.top.SHOP_ID||""};v["a"].get(b["g"].commodity.getCommodityList,t).then((function(t){e.giftList=t.content,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},confirmedProduct:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(t.$set(e,"amount",e.amount),t.$set(e,"depotedQuantity",0),t.$set(e,"product",{fullName:e.fullName,barCode:e.barCode}),e.productName=e.fullName,t.selectedGiftList.push(e))})),this.selectedGiftList.forEach((function(e){t.handleSelect(e)})),this.storeList=[],this.queryStoreHouseList()},handleSelect:function(e){var t=!1;if(e.productId=e.id,e.id="",0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].productId===e.productId){this.tableData[a].amount=(Number(this.tableData[a].amount)+1).toString(),t=!0;break}t||this.tableData.push(e)}else this.tableData.push(e)},operate:function(e){this[e]()},refresh:function(){this.flag=!0,this.getList()},getList:function(){var e=this;this.loading=!0;var t={id:this.itemId||this.returnId,shopId:window.top.SHOP_ID||""};v["a"].get(b["g"].invoicing.depotInMgmt.shopDepotInItems,t).then((function(t){e.loading=!1,e.tableData=t.itemList})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},queryStoreHouseList:function(){var e=this;this.loading=!0;var t={shopId:window.top.SHOP_ID||""};v["a"].get(b["g"].invoicing.storeHouseMgmt.shopDepotList,t).then((function(t){e.storeList=t.dataList;var a,i=Object(p["a"])(t.dataList);try{for(i.s();!(a=i.n()).done;){var n=a.value;"1"===n.enabled?n.isShow=!0:n.isShow=!1}}catch(o){i.e(o)}finally{i.f()}})).catch((function(t){console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},deleteHandeler:function(e){var t=this;""===e.row.id?this.tableData.splice(e.$index,1):this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,v["a"].delete(b["g"].invoicing.depotInMgmt.shopDepotInItem,{ids:[e.row.id]}).then((function(e){t.$message.success("删除成功"),t.getList()})).catch((function(e){e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))}))},save:function(){var e=this;this.itemDatas=this.tableData.map((function(t){return{id:t.id||"",billId:e.itemId||e.returnId,product:{id:t.productId?t.productId:t.id,barCode:t.product?t.product.barCode:""},actualQuantity:t.unDepotedQuantity||"",amount:t.amount||"",depot:{id:t.depotId},productName:t.fullName?t.fullName:t.productName,specId:t.specId||"",specValue:t.specValue||"",categoryId:t.categoryId,categoryName:t.categoryName}}));var t=!1;if(this.tableData.forEach((function(a){-1!==String(a.amount).indexOf(".")&&(e.$message.warning("数量不能为小数"),t=!0)})),t)return!1;this.loading=!0;var a={id:this.itemId||this.returnId,itemDatas:this.itemDatas};v["a"].post("/admin/invoicing/stock/shopDepotInItem.jhtml",a).then((function(t){e.$message.success("保存成功"),e.$emit("operationSuccess"),e.getList(),e.loading=!1})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()},queryFilters:function(){var e=this,t={shopId:window.top.SHOP_ID||""};v["a"].get("/admin/shopProduct/filter.jhtml",t).then((function(t){e.categoryDatas=t.categoryDatas,e.setCategoryFilters(),e.setBrandFilters(t.brandDatas)})).catch((function(){}))},setCategoryFilters:function(){var e=[{value:"",label:"全部"}];this.categoryDatas.forEach((function(t){e.push({value:t.id,label:t.name,children:[{label:"全部",value:""}]})})),this.dialogFilters[0].options=e},setBrandFilters:function(e){this.dialogFilters[1].options=e.map((function(e){return{value:e.id,label:e.name}})),this.dialogFilters[1].options.splice(0,0,{value:"",label:"全部"})},getSelectedBrandId:function(){return this.dialogFilters[1].value},activeItemChange:function(e){var t=this,a={shopId:this.getUser().shop.id,parentId:e.toString()};v["a"].get("/admin/shopProduct/productCategorys.jhtml",a).then((function(a){var i;t.setCategoryFilters(),t.dialogFilters[0].options.forEach((function(t){t.value===e[0]&&(i=t.children)})),a.dateList.forEach((function(e){i.push({value:e.id,label:e.name})}))})).catch((function(){}))},cascaderChange:function(e){this.productCategoryId=e[e.length-1],e.length>1&&""===this.productCategoryId&&(this.productCategoryId=e[e.length-2]),this.getGiftList()}})},M=T,$=(a("f58d"),Object(S["a"])(M,d,u,!1,null,null,null)),O=$.exports,N=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"product-info"},[a("biz-list",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],key:Math.random(),ref:"table",attrs:{tableData:e.tableData,height:"100%",loading:e.loading}},[a("el-table-column",{attrs:{prop:"productName",label:"商品名称","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product&&t.row.product.fullName?t.row.product.fullName:t.row.productName))]}}])}),a("el-table-column",{attrs:{prop:"barCode",label:"条码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product&&t.row.product.barCode?t.row.product.barCode:""))]}}])}),a("el-table-column",{attrs:{prop:"depotName",label:"仓库"}}),a("el-table-column",{attrs:{prop:"quantity",label:"入库数量"}}),a("el-table-column",{attrs:{prop:"createDate",label:"入库时间"}}),a("el-table-column",{attrs:{prop:"operator",label:"入库人"}})],1)],1)},z=[],L={name:"ProductInfo",props:{itemId:{type:String},tabSelection:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{tableData:[],loading:!1,pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:m["a"],BizGrid:h["a"]},watch:{itemId:function(e){this.tableData=[],this.itemId&&this.query()},tabSelection:function(e){"depotinfo"===e&&this.query()}},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},methods:Object(r["a"])(Object(r["a"])({},Object(f["c"])(["getUser"])),{},{query:function(){var e=this;this.loading=!0,v["a"].get("/admin/invoicing/stock/depotIn/records.jhtml",{id:this.itemId}).then((function(t){e.loading=!1,e.tableData=t.dataList})).catch((function(t){console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))}})},B=L,F=(a("2b23"),Object(S["a"])(B,N,z,!1,null,null,null)),j=F.exports,E=a("bc3a"),R=a.n(E),A=a("225d"),q=a("276c"),V=a("8d33"),G=a("934e"),H=a("c954"),U=a("d6d1"),K=a("7ba2"),Q=a("4382"),Y=a("fc46"),J=a("443b"),X={name:"DepotInMgmtList",data:function(){return{tabName:"info",tabNameLogistics:"loginfo",relateBillPurchase:"info",relateBillOrder:"baseinfo",tabInventoryName:"info",relateBillAttolled:"info",itemId:"",orderId:"",allottedOrderId:"",purchaseOrderId:"",relateBillOrderId:{id:""},relateBillProductId:"",inventoryId:"",returnId:"",title:"",formData:{},isEdit:!0,isCreate:!1,openReview:!1,form:{},loading:!1,visiable:!1,open:!1,isRalateBill:!1,openPurchaseOrder:!1,openRelateBillOrder:!1,openInventory:!1,dialogTableVisible:!1,openAllottedOrder:!1,openLogistics:!1,tabNameReview:"reviewinfo",editable:!0,sn:"",selections:[],shopDepots:[],operations:[{label:"添加",name:"add",type:"primary",auth:["admin:inport.add"]},{label:"删除",name:"delete",type:"",disabled:!0,auth:["admin:inport.delete"]},{label:"刷新",name:"refresh",type:""},{label:"导出",name:"export",type:"",auth:["admin:inport.export"]}],filters:[{type:"select",label:"业务类型",name:"businessType",value:"",options:[{value:"",label:"全部"},{value:"0",label:"采购入库"},{value:"1",label:"销售退货"},{value:"2",label:"其他入库"},{value:"3",label:"盘点调整"},{value:"4",label:"调拨"}]},{type:"select",label:"状态",name:"state",value:"",options:[{value:"",label:"全部"},{value:"0",label:"未确认"},{value:"1",label:"已确认"},{value:"2",label:"部分确认"}]},{type:"daterange",label:"创建日期",name:"publishDate",value:[]},{type:"input",label:"",placeholder:"请输入编号/往来方名称/条码",name:"searchValue",value:""}],tableData:[],gridData:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:9}}},components:{BizPopupTabs:s["a"],BizFlexTable:l["c"],BaseInfo:c["a"],DepotInInfo:j,vueEasyPrint:A["a"],ProductInfo:O,PurchaseOrderInfo:q["a"],OrderBaseInfo:G["a"],OrderProductInfo:H["a"],InventoryBaseInfo:U["a"],InventoryProductInfo:K["a"],AllottedOrderInfo:V["a"],LogisticsFollowing:Q["a"],MyEvaluate:Y["a"]},created:function(){this.getList(),this.queryKpi(),this.getDepots()},watch:{},mixins:[J["a"]],computed:Object(r["a"])(Object(r["a"])({},Object(f["c"])("Authority",["currentAuth"])),{},{hasAuthComfirm:function(){return this.currentAuth.includes("admin:inport.comfirm")},hasAuthDel:function(){return this.currentAuth.includes("admin:inport.delete")}}),mounted:function(){},methods:Object(r["a"])(Object(r["a"])({},Object(f["c"])(["getUser"])),{},{operate:function(e){this[e]()},createdSuccess:function(e){e?(this.itemId=String(e),this.tabName="productinfo",this.isCreate=!0):this.refresh()},closeTabByEvaluate:function(e,t){var a=this;console.log(111),this.editable=!1,this.openPurchaseOrder=!1,this.tabNameReview="reviewinfo",this.orderId=e,this.$nextTick((function(){a.openReview=!0,a.$refs.reviewinfo.getOrderInfo(e)}))},refresh:function(){this.getList()},operationSuccess:function(e){e||(this.open=!1),this.refresh()},formatType:function(e){return"0"===e?"采购入库":"1"===e?"销售退货":"2"===e?"其它入库":"3"===e?"盘点调整":"4"===e?"调拨":void 0},formatDate:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),o=a+"-"+(i<10?"0"+i:i)+"-"+(n<10?"0"+n:n);return o},getDepots:function(){var e=this,t={shopId:window.top.SHOP_ID||"",pageSize:"1000",pageNumber:1};v["a"].get("/admin/invoicing/stock/shopDepots.jhtml",t).then((function(t){e.shopDepots=t.dataList})).catch((function(t){console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},statusChange:function(e){var t=this;this.tabName="productinfo",this.open=!0,this.isCreate=!0,this.$nextTick((function(){t.itemId=e.id})),"0"===e.state||"2"===e.state?this.isEdit=!0:this.isEdit=!1},confrim:function(e,t){var a=this,i={shopId:window.top.SHOP_ID||"",id:e.id,actionType:t};v["a"].get(b["g"].invoicing.depotInMgmt.state,i).then((function(e){a.$message.success("操作成功！"),a.refresh()})).catch((function(e){e.errorMessage&&a.$message.warning(e.errorMessage)})).finally((function(){}))},deleteApply:function(e,t){e.stopPropagation(),this.deleteItem([t.id])},deleteItem:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,v["a"].delete(b["g"].invoicing.depotInMgmt.shopDepotIn,{ids:e}).then((function(e){t.$message.success("删除成功"),t.refresh()})).catch((function(e){console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))}))},delete:function(){if(this.selections&&this.selections.length>0){var e=[];this.selections.forEach((function(t){e.push(t.id)})),this.deleteItem(e)}else this.$message("请选择一条数据")},printApply:function(e){var t=this,a={id:e.id};v["a"].get(b["g"].invoicing.depotInMgmt.print,a).then((function(e){t.dialogTableVisible=!0,t.title=t.getUser().shop.name+"入库单",t.form=e.data,"0"===t.form.state?t.form.state="未确认":"1"===t.form.state?t.form.state="已确认":t.form.state="",t.gridData=e.data.itemDatas,t.loading=!1})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))},print:function(){this.$refs.easyPrint.print()},exportInvoice:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n,o,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={id:e.form.id},t.prev=1,t.next=4,R.a.post("/admin/invoicing/stock/voucher/depotIn/export.jhtml",a,{responseType:"blob"});case 4:return i=t.sent,console.log("response => ",i),n=new Blob([i.data],{type:"application/vnd.ms-excel"}),console.log(decodeURI(i.headers["content-disposition"])),o=decodeURI(i.headers["content-disposition"].split("filename=")[1]),r=document.createElement("a"),r.download=o.match(/"(\S*)"/)[1],r.style.display="none",r.href=URL.createObjectURL(n),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r),t.abrupt("return");case 20:throw t.prev=20,t.t0=t["catch"](1),new Error(t.t0);case 23:case"end":return t.stop()}}),t,null,[[1,20]])})))()},export:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n,o,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],e.selections&&e.selections.length>0&&e.selections.forEach((function(e){a.push(e.id)})),i={ids:a,pageSize:e.pagination.pageSize,pageNumber:e.pagination.currentPage,shopId:window.top.SHOP_ID||"",searchValue:e.filters[3].value,businessId:e.filters[0].value,state:e.filters[1].value,beginTime:e.filters[2].value[0]?e.filters[2].value[0]+" 00:00:00":"",endTime:e.filters[2].value[1]?e.filters[2].value[1]+" 23:59:59":""},t.prev=3,t.next=6,R.a.post(b["g"].invoicing.depotInMgmt.export,i,{responseType:"blob"});case 6:return n=t.sent,console.log("response => ",n),o=new Blob([n.data],{type:"application/vnd.ms-excel"}),console.log(decodeURI(n.headers["content-disposition"])),r=decodeURI(n.headers["content-disposition"].split("filename=")[1]),s=document.createElement("a"),s.download=r.match(/"(\S*)"/)[1],s.style.display="none",s.href=URL.createObjectURL(o),document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s),t.abrupt("return");case 22:throw t.prev=22,t.t0=t["catch"](3),new Error(t.t0);case 25:case"end":return t.stop()}}),t,null,[[3,22]])})))()},add:function(){this.tabName="info",this.open=!0,this.isEdit=!0,this.isCreate=!1,this.itemId="",this.$refs.baseInfo.resetModel()},rowClick:function(e,t,a){var i=this;this.tabName="info",this.open=!0,this.isCreate=!0,this.$nextTick((function(){i.itemId=e.id})),"0"===e.state?this.isEdit=!0:this.isEdit=!1},setOrderItems:function(e){var t=this;this.tabName="productinfo",this.isCreate=!0,this.$nextTick((function(){t.returnId=String(e)}))},getList:function(){var e=this,t={pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage,shopId:window.top.SHOP_ID||"",searchValue:this.filters[3].value,businessId:this.filters[0].value,state:this.filters[1].value,beginTime:this.filters[2].value[0]?this.filters[2].value[0]+" 00:00:00":"",endTime:this.filters[2].value[1]?this.filters[2].value[1]+" 23:59:59":""};this.loading=!0,v["a"].get(b["g"].invoicing.depotInMgmt.shopDepotInList,t).then((function(t){console.log(t),e.tableData=t.dataList,e.pagination.total=Number(t.total),e.loading=!1})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},queryKpi:function(){var e=this,t={shopId:window.top.SHOP_ID||""};v["a"].get("/admin/invoicing/stock/queryShopDepotInsKpi.jhtml",t).then((function(t){e.$message({customClass:"motorists-club-activity__kpi",showClose:!0,message:"今日新增".concat(t.data.dayNewAdd,"条，待确认入库").concat(t.data.unConfirm,"条"),duration:3e3})})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},clickRelateBill:function(e,t){var a=this;e.stopPropagation(),"0"===t.businessType||"1"===t.businessType&&"2"===t.relatePartnerType?(this.purchaseOrderId=t.relateBill,this.openPurchaseOrder=!0,this.$nextTick((function(){a.$refs.orderinfo.getOrderInfo()})),this.isRalateBill=!0):"1"===t.businessType&&"1"===t.relatePartnerType?(this.relateBillOrderId={id:t.relateBill},this.relateBillProductId=t.relateBill,this.openRelateBillOrder=!0,this.isEdit=!1):"3"===t.businessType?(this.inventoryId=String(t.relateBill),this.openInventory=!0,this.isEdit=!1):"4"===t.businessType&&(this.allottedOrderId=String(t.relateBill),this.openAllottedOrder=!0,this.isEdit=!1)},closeTabByLogistics:function(e){var t=this;this.tabNameLogistics="loginfo",this.sn=e,this.openLogistics=!0,this.openPurchaseOrder=!1,this.$nextTick((function(){t.$refs.logistics.getLogisticsInfo()}))},getStatus:function(e){switch(e.state){case"0":return"未确认";case"1":return"已确认";case"2":return"部分确认";default:return"--"}},getBusinessType:function(e){switch(e.businessType){case"0":return"采购入库";case"1":return"销售退货";case"2":return"其他入库";case"3":return"盘点调整";case"4":return"调拨";default:return"--"}},handleSelectionChange:function(e){this.selections=e,this.operations.map((function(e){"delete"===e.name&&(e.disabled=!0)})),e.length>0&&this.operations.map((function(e){"delete"===e.name&&(e.disabled=!1)}))},filterDataChange:function(e){this.filters=e,this.pagination.currentPage=1,this.refresh()},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()}})},W=X,Z=(a("7643"),Object(S["a"])(W,i,n,!1,null,null,null));t["default"]=Z.exports},"1dad":function(e,t,a){"use strict";var i=a("fdfa"),n=a.n(i);n.a},"1fac":function(e,t,a){},2086:function(e,t,a){"use strict";var i=a("2497"),n=a("bc3a"),o=a.n(n),r=a("c596");t["a"]={getList:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.getMemberCardList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getRightsList:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listDistributeRights:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.listDistributeRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listCardTemplate:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.listCardTemplate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistVbean:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.getlistVbean,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getIntegralList:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.getIntegralList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listProduct:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.listProduct,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryUserRights:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.queryUserRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryUserCoupons:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.queryUserCoupons,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listByRights:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.listByRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardInfo:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.getVipCardInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardTemplate:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.getVipCardTemplate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},memberRankList:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.memberRankList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},setting:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.setting,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},settingUpdate:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.setting,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryPeople:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.queryPeople,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delete:function(e,t,a){o.a.delete(r["g"].memberCardMgmt.memberCard.deleteManage,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},verification:function(e,t,a){o.a.post(r["g"].memberCardMgmt.vipRights.verification,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateTemplate:function(e,t,a){o.a.put(r["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createTemplate:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delTemplate:function(e,t,a){o.a.delete(r["g"].memberCardMgmt.memberCard.updateTemplate,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},distributeRights:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.distributeRights,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},distributeAssignedRights:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.distributeAssignedRights,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateVipCardState:function(e,t,a){o.a.put(r["g"].memberCardMgmt.memberCard.updateVipCardState,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createVipCard:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.createVipCard,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createBean:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.createBean,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createPoint:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.createPoint,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},addScore:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.addScore,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},reduceDeposit:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.reduceDeposit,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistUpgrade:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.getlistUpgrade,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistStore:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.getlistStore,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateGrade:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.updateGrade,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardGradeInfo:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.getVipCardGradeInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},editVipCardGrade:function(e,t,a){o.a.put(r["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},addVipCardGrade:function(e,t,a){o.a.post(r["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delVipCardGrade:function(e,t,a){o.a.delete(r["g"].memberCardMgmt.memberCard.VipCardGrade,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listAuthority:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.listAuthority,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},vipRightsList:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryrightsClass:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.get,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getFirstClassifies:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.getFirstClassifies,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponList:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.rightsCouponList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryRightsCoupon:function(e,t,a){o.a.get(r["g"].memberCardMgmt.vipRights.queryRightsCoupon,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},memberCardBox:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.memberCardBox,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},editRightsClass:function(e,t,a){o.a.put(r["g"].memberCardMgmt.vipRights.edit,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createRightsClass:function(e,t,a){o.a.post(r["g"].memberCardMgmt.vipRights.add,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponUpdate:function(e,t,a){o.a.put(r["g"].memberCardMgmt.vipRights.rightsCouponUpdate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponCreate:function(e,t,a){o.a.post(r["g"].memberCardMgmt.vipRights.rightsCouponCreate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},deleteRightscoupon:function(e,t,a){o.a.delete(r["g"].memberCardMgmt.vipRights.deleteRightscoupon,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},deleteRights:function(e,t,a){o.a.delete(r["g"].memberCardMgmt.vipRights.delete,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},certificate:function(e,t,a){o.a.get(r["g"].memberCardMgmt.memberCard.certificate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))}}},2119:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"biz-avatar-uploader-multi"},[a("div",{staticClass:"el-upload-list el-upload-list--picture-card"},[e._l(e.value,(function(t){return a("div",{key:t.index,staticClass:"el-upload-list__item is-success",attrs:{tabindex:"0"}},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:t,alt:""}}),a("span",{staticClass:"el-upload-list__item-actions"},[a("span",{staticClass:"el-upload-list__item-preview",on:{click:function(a){return e.handlePictureCardPreview(t)}}},[a("i",{staticClass:"el-icon-zoom-in"})]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isShowDelete,expression:"isShowDelete"}],staticClass:"el-upload-list__item-delete",on:{click:function(a){return e.handleRemove(t)}}},[a("i",{staticClass:"el-icon-delete"})])])])})),e.showUploader?a("el-upload",{ref:"upload",class:e.disabled?"avatar-uploader-disabled":"avatar-uploader",style:e.avatarStyle,attrs:{multiple:"","show-file-list":!1,accept:"image/*",limit:Number(e.limit),"file-list":e.fileList,data:e.fileData,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,name:"file",action:"/admin/file/uploads.jhtml",disabled:e.disabled}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:e.plusStyle})]):e._e()],2),a("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},n=[],o=(a("99af"),a("d81d"),a("a434"),a("ac1f"),a("1276"),{name:"ImgUploader",props:{value:{type:Array,default:function(){return[]}},imageForm:{type:Array,default:function(){return[]}},showUploader:{type:Boolean,default:function(){return!0}},size:{type:Object,default:function(){return{width:100,height:100}}},limit:{default:"9"},disabled:{type:Boolean,default:function(){return!1}},isShowDelete:{type:Boolean,default:function(){return!0}}},data:function(){return{fileData:{type:"0"},fileList:[],dialogVisible:!1,dialogImageUrl:""}},methods:{handleSuccess:function(e){var t=this.value.concat(e.fis[0].url);this.$emit("input",t)},handleExceed:function(e,t){this.$message.warning("只能上传".concat(this.limit,"张图片"))},handleRemove:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.removePic(e)}))},removePic:function(e){for(var t=this.value,a=0;a<t.length;a++)t[a]===e&&t.splice(a,1);this.$emit("input",t)},handlePictureCardPreview:function(e){this.dialogImageUrl=e,this.dialogVisible=!0}},computed:{plusStyle:function(){return{"line-height":this.size.height+"px"}},avatarStyle:function(){return{height:this.size.height+"px",width:this.size.width+"px"}}},watch:{value:function(e,t){console.log("value: ",this.value),this.fileList=e.map((function(e){return{name:e.split("/")[e.split("/").length-1],url:e}}))}},components:{}}),r=o,s=(a("d74a"),a("2877")),l=Object(s["a"])(r,i,n,!1,null,null,null);t["a"]=l.exports},"21c5":function(e,t,a){},"2b23":function(e,t,a){"use strict";var i=a("4974"),n=a.n(i);n.a},"3c2c":function(e,t,a){"use strict";var i=a("fc59"),n=a.n(i);n.a},"3ed3":function(e,t,a){"use strict";var i=a("5467"),n=a.n(i);n.a},4382:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logistic-following"},[a("div",{staticClass:"product-info"},[a("div",{staticClass:"img"},[a("img",{attrs:{src:e.image||e.defaultProductImg}})]),a("div",{staticClass:"info"},[a("div",{staticClass:"i-item"},[e._v("物流状态： "),a("span",{staticClass:"l-state"},[e._v(e._s(e.logisticState))])]),a("div",{staticClass:"i-item"},[e._v("物流公司："+e._s(e.logistics))]),a("div",{staticClass:"i-item"},[e._v("快递单号："+e._s(e.expressSn))])])]),e.shippingTraces&&e.shippingTraces.length>0?a("div",{staticClass:"logistic-info"},[a("div",{staticClass:"track-list"},[a("ul",e._l(e.shippingTraces,(function(t){return a("li",{key:t.id},[a("i",{staticClass:"node-icon"}),a("span",{staticClass:"txt"},[e._v(e._s(t.station))]),a("span",{staticClass:"time"},[e._v(e._s(t.happenTime))])])})),0)])]):e._e()])},n=[],o=a("5530"),r=a("2f62"),s=a("1ab1"),l=a("c596"),c=a("e83a"),d=a.n(c),u={name:"LogisticsFollowing",components:{},data:function(){return{shippingSn:"",defaultProductImg:d.a,shippingTraces:[],state:"",logistics:"",expressSn:"",image:""}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(r["c"])(["getUser"])),Object(r["c"])("Order",["curApplySaleItem","orderInfo"])),{},{logisticState:function(){switch(this.state){case"0":return"无轨迹";case"1":return"已揽收";case"2":return"在途中";case"201":return"到达派件城市";case"3":return"签收";case"4":return"问题件";default:return""}}}),props:{sn:{type:String,default:""}},watch:{},created:function(){},methods:{getLogisticsInfo:function(){var e=this,t={methodName:"QueryLogistics",clientType:"2",shopId:this.getUser.shop.id,userId:this.getUser.id,shippingSn:this.sn};s["a"].get(l["g"].hypermarketMgmt.logistics,t).then((function(t){console.log("物流追踪",t),e.state=t.shipping.state,e.image=t.shipping.shippingItems.length>0?t.shipping.shippingItems[0].image:"",e.logistics=t.shipping.logistics,e.expressSn=t.shipping.expressSn,e.shippingTraces=t.shipping.shippingTraces})).catch((function(t){e.$message.warning(t.errorMessage)}))}}},p=u,m=(a("b15b"),a("2877")),g=Object(m["a"])(p,i,n,!1,null,null,null);t["a"]=g.exports},"443b":function(e,t,a){"use strict";a("4de4");var i=a("c596"),n=a("1ab1"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":"",visible:e.visible,title:"自定义列","custom-class":"biz-columns",width:"500px"},on:{close:e.onClose}},[a("div",{staticClass:"columns-wrap"},[a("biz-flex-table",{ref:"table",attrs:{checkable:!1,tableData:e.tableData},on:{"selection-change":e.selectionChangeHandler}},[a("el-table-column",{attrs:{type:"selection",width:"50",selectable:e.getSelectable}}),a("el-table-column",{attrs:{label:"信息",prop:"name"}}),a("el-table-column",{attrs:{prop:"tag",label:"排序"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.$index;return[a("el-button",{attrs:{icon:"el-icon-sort-up",type:"text",disabled:0===i},on:{click:function(t){return e.onUp(i)}}}),a("el-button",{attrs:{icon:"el-icon-sort-down",type:"text",disabled:i===e.tableData.length-1},on:{click:function(t){return e.onBottom(i)}}})]}}])})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.onClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确 定")])],1)])},r=[],s=(a("7db0"),a("a434"),a("b85c")),l=a("04d3"),c={name:"biz-columns",components:{BizFlexTable:l["c"]},props:{visible:Boolean,tableId:String},data:function(){return{id:"",tableName:"",selections:[],tableData:[]}},computed:{},watch:{visible:function(e){e?this.makeRowDisplayable():this.saveSelection()},tableId:function(){this.getTableColumns()}},mounted:function(){this.getTableColumns()},methods:{getTableColumns:function(){var e=this;n["a"].get(i["g"].user.columns,{tableId:this.tableId}).then((function(t){e.tableData=t.data.columnDatas,e.id=t.data.id,e.tableName=t.data.tableName}))},getSelectable:function(e){return e.isEditable},selectionChangeHandler:function(e){this.selections=e},saveSelection:function(){var e,t=this,a=Object(s["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var i=e.value;i.displayable=!1}}catch(l){a.e(l)}finally{a.f()}var n,o=Object(s["a"])(this.selections);try{var r=function(){var e=n.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(o.s();!(n=o.n()).done;)r()}catch(l){o.e(l)}finally{o.f()}},onUp:function(e){this.tableData[e]=this.tableData.splice(e-1,1,this.tableData[e])[0]},onBottom:function(e){this.tableData[e]=this.tableData.splice(e+1,1,this.tableData[e])[0]},onClose:function(){this.$emit("update:visible",!1)},update:function(){var e,t=this,a=Object(s["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var o=e.value;o.displayable=!1}}catch(u){a.e(u)}finally{a.f()}var r,l=Object(s["a"])(this.selections);try{var c=function(){var e=r.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(l.s();!(r=l.n()).done;)c()}catch(u){l.e(u)}finally{l.f()}var d={columnDatas:this.tableData,id:this.id,tableId:this.tableId,tableName:this.tableName};console.log(d),n["a"].put(i["g"].user.columns,d).then((function(e){t.$emit("update"),t.$emit("update:visible",!1)}))},makeRowDisplayable:function(){var e=this;setTimeout((function(){var t,a=Object(s["a"])(e.tableData);try{for(a.s();!(t=a.n()).done;){var i=t.value;e.$refs.table.$refs.table.toggleRowSelection(i,i.displayable)}}catch(n){a.e(n)}finally{a.f()}}),20)}}},d=c,u=(a("ec6b"),a("2877")),p=Object(u["a"])(d,o,r,!1,null,null,null),m=p.exports,g=m;t["a"]={components:{BizColumnOperation:l["a"],BizColumns:g},data:function(){return{columnsSettingVisible:!1,columns:[]}},created:function(){this.getTableId(),this.getColumns()},methods:{onCustomColumns:function(){this.columnsSettingVisible=!0},getColumns:function(){var e=this;console.log(12),n["a"].get(i["A"].columns,{tableId:this.tableId}).then((function(t){e.columns=[],setTimeout((function(){e.columns=t.data.columnDatas.filter((function(e){return e.displayable})),e.$refs.table&&setTimeout((function(){e.$refs.table.doLayout()}),50)}),20)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getTableId:function(){}}}},4974:function(e,t,a){},5467:function(e,t,a){},5742:function(e,t,a){"use strict";var i=a("01ce"),n=a.n(i);n.a},"697f":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:e.title,visible:e.dialogVisible,"append-to-body":e.appendToBody},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close,open:e.open}},[e._t("top"),a("biz-flex-table",{ref:"table",attrs:{showTable:e.showTable,operations:e.operations,filters:e.filters,tags:e.tags,rowKeys:e.rowKeys,pagination:e.pagination,tableData:e.tableData,rowClassName:e.rowClassName,loading:e.loading,memberIds:e.memberIds,checkable:e.checkable,isDepotOutNew:e.isDepotOutNew,checkedTable:e.checkedTable},on:{operate:e.operate,"row-click":e.rowClick,"filter-data-change":e.filterDataChange,"select-all":e.handleSelectAll,select:e.handleSelectionChange,"size-change":e.pageSizeChange,"current-change":e.currentPageChange,"cascader-change":e.cascaderChange,"active-item-change":e.activeItemChange,"sort-change":e.handleSortChange}},[e._t("default")],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isClear?a("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v("清除")]):e._e(),a("el-button",{attrs:{size:"small"},on:{click:e.close}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmed}},[e._v("确定")])],1)],2)},n=[],o=(a("99af"),a("4160"),a("c975"),a("a434"),a("a9e3"),a("159b"),a("04d3")),r={name:"BizDialogSelector",components:{BizFlexTable:o["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},max:{type:Number,default:0},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},isClear:{default:!0,type:Boolean},rowClassName:{type:Function,default:function(){return null}},selectionKeys:{type:Array,default:function(){return[]}},memberIds:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},isDepotOut:{type:Boolean,default:function(){return!1}},checkTable:{type:Array,default:function(){return[]}},showTable:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],isDepotOutNew:!1,checkedTable:[],innerSelection:[]}},methods:{rowKeys:function(e){return e.id},generateSelectionKeys:function(e,t){if(e.indexOf(t)>=0)this.innerSelectionKeys.push(t[this.keyField]),this.innerSelection.push(t);else{var a=this.innerSelectionKeys.indexOf(t[this.keyField]);this.innerSelectionKeys.splice(a,1),this.innerSelection.splice(a,1)}},open:function(e){this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(e){this.innerSelectionKeys=[],this.innerSelection=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){if(this.innerSelectionKeys.length>0||!this.showTable){if(!this.showTable&&!/(http|https):\/\/([\w.]+\/?)\S*/.test(this.filters[2].value))return void this.$message.warning("必须以http,https开头,且需符合URL规范,检查格式是否正确");this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1}else this.$message("请选择一项")},clear:function(){var e=this;this.tableData.forEach((function(t){e.$refs.table.toggleRowSelection(t,!1)})),this.innerSelectionKeys=[],this.innerSelection=[]},updateSelection:function(){var e=this;this.$refs&&this.$refs.table&&this.tableData.forEach((function(t){e.innerSelectionKeys.indexOf(t[e.keyField])>=0?(e.$refs.table.toggleRowSelection(t,!0),"single"===e.selectionMode&&(e.$refs.table.$refs.table.setCurrentRow(t),e.innerSelection=[t])):e.$refs.table.toggleRowSelection(t,!1)}))},operate:function(e){this.$emit("operate",e)},filterDataChange:function(e){this.$emit("filterDataChange",e)},handleSelectAll:function(e){var t=this;0===e.length?this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a>=0&&t.innerSelectionKeys.splice(a,1)})):this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a<0&&t.innerSelectionKeys.push(e[t.keyField])})),this.$emit("selectionChange",e)},handleSelectionChange:function(e,t){this.generateSelectionKeys(e,t),this.$emit("selectionChange",e)},pageSizeChange:function(e){this.$emit("pageSizeChange",e)},currentPageChange:function(e){this.$emit("currentPageChange",e)},cascaderChange:function(e){this.$emit("cascaderChange",e)},activeItemChange:function(e){this.$emit("active-item-change",e)},handleSortChange:function(e){this.$emit("sort-change",e)},rowClick:function(e,t,a){"single"===this.selectionMode&&(this.innerSelectionKeys=[e[this.keyField]],this.innerSelection=[e])}},watch:{visibility:function(e,t){this.dialogVisible=e,this.isDepotOutNew=this.isDepotOut,this.checkedTable=this.checkTable}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){},updated:function(){this.updateSelection()}},s=r,l=(a("0943"),a("2877")),c=Object(l["a"])(s,i,n,!1,null,null,null);t["a"]=c.exports},"6ac0":function(e,t,a){},7643:function(e,t,a){"use strict";var i=a("ef6d"),n=a.n(i);n.a},"7ba2":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"product-info"},[a("div",{attrs:{slot:"top"},slot:"top"},[e.isEdit?a("biz-save-button",{attrs:{operations:e.operations},on:{operate:e.operate}}):e._e(),a("el-form",{attrs:{inline:!0,disabled:!e.isEdit}},[a("el-form-item",{staticClass:"subTotal",attrs:{label:"商品总数:",prop:"productTotal"}},[e._v(e._s(e.productTotal?e.productTotal:"0"))]),a("el-form-item",{staticClass:"subTotal",attrs:{label:"盈亏总数:",prop:"profitTotal"}},[e._v(e._s(e.profitTotal?e.profitTotal:"0"))])],1)],1),a("biz-list",{key:Math.random(),ref:"table",attrs:{tableData:e.tableData,loading:e.loading},on:{handleSelectionChange:e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),a("el-table-column",{attrs:{prop:"fullName",label:"商品","min-width":"100"}}),a("el-table-column",{attrs:{prop:"barCode",label:"条码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product&&t.row.product.barCode?t.row.product.barCode:""))]}}])}),a("el-table-column",{attrs:{prop:"amount",label:"账目数量","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.amount))]}}])}),a("el-table-column",{attrs:{prop:"inventoryAmount",label:"盘点数量","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{staticStyle:{width:"120px"},attrs:{size:"mini",min:0,disabled:!e.isEdit},on:{input:function(a){return e.amountChange(t.row)}},model:{value:t.row.inventoryAmount,callback:function(a){e.$set(t.row,"inventoryAmount",a)},expression:"scope.row.inventoryAmount"}})],1)])}}])}),a("el-table-column",{attrs:{label:"盈亏",prop:"profit","min-width":"60"}}),e.isEdit?a("el-table-column",{attrs:{prop:"date",label:"操作",type:"index","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteHandeler(t.row)}}},[e._v("删除")])],1)])}}],null,!1,3776432633)}):e._e()],1),a("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:e.showDialog,tableData:e.giftList,pagination:e.dialogPagination,filters:e.dialogFilters,selectionKeys:e.selectedGiftIds},on:{"update:visibility":function(t){e.showDialog=t},pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,confirmed:e.confirmedProduct,filterDataChange:e.dialogFilterDataChange,selectionChange:e.selectionChange,"active-item-change":e.activeItemChange,cascaderChange:e.cascaderChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"dialog-column"},[a("img",{staticClass:"productImg",attrs:{src:t.row.image||e.DefaultImg,onerror:e.errorImg}}),a("div",{staticClass:"biz-two-row"},[a("div",{staticClass:"titleClass",staticStyle:{"margin-left":"10px"},attrs:{title:t.row.fullName}},[e._v(e._s(t.row.fullName))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("编号："+e._s(t.row.sn))])])])]}}])}),a("el-table-column",{attrs:{property:"barCode",label:"条码"}}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),a("el-table-column",{attrs:{property:"price",label:"价格"}}),a("el-table-column",{attrs:{label:"在库库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.realStock))])]}}])})],1)],1)},n=[],o=(a("99af"),a("4160"),a("c975"),a("d81d"),a("a434"),a("b0c0"),a("a9e3"),a("d3b7"),a("25f0"),a("159b"),a("b85c")),r=a("5530"),s=a("7558"),l=a("8330"),c=a("f36f"),d=a("2f62"),u=a("c596"),p=a("1ab1"),m=a("af3f"),g=a("f3ac"),h=a.n(g),f={name:"ProductInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},productCategoryId:"",categoryDatas:[],selectedGiftList:[],selectedGiftIds:[],showDialog:!1,DefaultImg:h.a,errorImg:'this.src="'+a("b89e")+'"',dialogFilters:[{type:"cascader",label:"分类",name:"category",filterable:!1,value:[],options:[]},{type:"select",label:"品牌",value:"",options:[]},{type:"input",placeholder:"请输入编号/商品名/条码",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,profitTotal:"",productTotal:"",height:"585",tableData:[],restaurants:[],selections:[],itemDatas:[],dialogTableVisible:!1,storeList:[],selectionList:[],multipleSelection:[],title:"",operations:[{label:"删除",name:"del",type:"",disabled:!0},{label:"新增商品",name:"addProduct",type:"primary"},{label:"保存",name:"save",type:"primary",auth:["admin:check.edit"]}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:s["a"],BizGrid:c["a"],BizSaveButton:l["a"],BizDialogSelector:m["a"]},watch:{itemId:function(e){this.tableData=[],this.productTotal="",this.profitTotal="",this.itemId&&this.getList()}},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},methods:Object(r["a"])(Object(r["a"])({},Object(d["c"])(["getUser"])),{},{addProduct:function(){this.queryFilters(),this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getGiftList()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getGiftList()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getGiftList()},getGiftList:function(){var e=this,t={productCategoryId:this.productCategoryId,brandId:this.getSelectedBrandId(),pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[2].value,shopId:window.top.SHOP_ID||""};p["a"].get(u["g"].commodity.getCommodityList,t).then((function(t){e.giftList=t.content,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},confirmedProduct:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(t.$set(e,"productName",e.fullName),t.$set(e,"profit","--"),t.$set(e,"amount",e.minimumPackQuantity),t.$set(e,"barCode",e.barCode),t.selectedGiftList.push(e))})),this.selectedGiftList.forEach((function(e){t.handleSelect(e)}))},operate:function(e){this[e]()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},getList:function(){var e=this;this.loading=!0;var t={id:this.itemId,shopId:window.top.SHOP_ID||""};p["a"].get(u["g"].invoicing.inventory.itemList,t).then((function(t){e.tableData=t.itemList,e.productTotal=t.data.totalAmount,e.profitTotal=t.data.profit})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},handleSelect:function(e){var t=!1;if(e.productId=e.id,e.id="",0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].productId===e.productId){this.tableData[a].amount=(Number(this.tableData[a].amount)+Number(e.availableStock)).toString(),this.tableData[a].inventoryAmount&&(this.tableData[a].profit=Number(this.tableData[a].inventoryAmount)-Number(this.tableData[a].amount)),t=!0;break}t||this.tableData.push(e)}else this.tableData.push(e)},handleSelectionChange:function(e){console.log(e),this.multipleSelection=e,this.operations[0].disabled=!0,this.multipleSelection.length>0&&(this.operations[0].disabled=!1)},del:function(){var e=this,t=[];this.multipleSelection.map((function(a){a.id?t.push(a.id):e.deleteHandeler(a)})),t.length>0&&(this.loading=!0,p["a"].delete(u["g"].invoicing.inventory.inventoryItem,{ids:t}).then((function(t){e.$message.success("删除成功"),e.$emit("operationSuccess"),e.getList()})).catch((function(t){t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1})))},deleteHandeler:function(e){var t=this;""===e.id?this.tableData.splice(this.tableData.indexOf(e),1):this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,p["a"].delete(u["g"].invoicing.inventory.inventoryItem,{ids:[e.id]}).then((function(e){t.$message.success("删除成功"),t.$emit("operationSuccess"),t.getList()})).catch((function(e){e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))})),this.productTotal=Number(this.productTotal)-Number(e.amount),"--"===e.profit?this.profitTotal=Number(this.profitTotal)-0:this.profitTotal=Number(this.profitTotal)-Number(e.profit)},save:function(){var e=this;this.itemDatas=this.tableData.map((function(t){return{id:t.id,billId:e.itemId,productId:t.productId?t.productId:t.id,amount:t.amount||"",price:t.price||"",depotId:t.depotId||"",depotName:t.depotName||"",productName:t.fullName,categoryId:"",categoryName:"",specId:t.specId||"",specValue:t.specValue||"",inventoryAmount:t.inventoryAmount||"",profit:t.profit||""}}));var t=!1;if(this.tableData.forEach((function(a){-1!==String(a.inventoryAmount).indexOf(".")&&(e.$message.warning("盘点商品数不能为小数"),t=!0)})),t)return!1;var a={id:this.itemId,itemDatas:this.itemDatas};p["a"].post(u["g"].invoicing.inventory.inventoryItem,a).then((function(t){e.$message.success("保存成功"),e.$emit("operationSuccess"),e.getList(),e.loading=!1})).catch((function(t){e.loading=!1,e.getList(),e.$message.warning(t.errorMessage)}))},amountChange:function(e){var t,a=0,i=Object(o["a"])(this.tableData);try{for(i.s();!(t=i.n()).done;){var n=t.value;""===n.inventoryAmount||"undefined"===n.inventoryAmount?(this.$set(n,"profit",""),a+=0):(n.id===e.id&&n.inventoryAmount&&this.$set(n,"profit",Number(n.inventoryAmount)-Number(n.amount)),a+=Number(n.profit))}}catch(r){i.e(r)}finally{i.f()}this.profitTotal=a||""},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()},queryFilters:function(){var e=this,t={shopId:window.top.SHOP_ID||""};p["a"].get("/admin/shopProduct/filter.jhtml",t).then((function(t){e.categoryDatas=t.categoryDatas,e.setCategoryFilters(),e.setBrandFilters(t.brandDatas)})).catch((function(){}))},setCategoryFilters:function(){var e=[{value:"",label:"全部"}];this.categoryDatas.forEach((function(t){e.push({value:t.id,label:t.name,children:[{label:"全部",value:""}]})})),this.dialogFilters[0].options=e},setBrandFilters:function(e){this.dialogFilters[1].options=e.map((function(e){return{value:e.id,label:e.name}})),this.dialogFilters[1].options.splice(0,0,{value:"",label:"全部"})},getSelectedBrandId:function(){return this.dialogFilters[1].value},activeItemChange:function(e){var t=this,a={shopId:this.getUser().shop.id,parentId:e.toString()};p["a"].get("/admin/shopProduct/productCategorys.jhtml",a).then((function(a){var i;t.setCategoryFilters(),t.dialogFilters[0].options.forEach((function(t){t.value===e[0]&&(i=t.children)})),a.dateList.forEach((function(e){i.push({value:e.id,label:e.name})}))})).catch((function(){}))},cascaderChange:function(e){this.productCategoryId=e[e.length-1],e.length>1&&""===this.productCategoryId&&(this.productCategoryId=e[e.length-2]),this.getGiftList()}})},b=f,v=(a("3ed3"),a("2877")),y=Object(v["a"])(b,i,n,!1,null,null,null);t["a"]=y.exports},"81d5":function(e,t,a){"use strict";var i=a("7b0b"),n=a("23cb"),o=a("50c4");e.exports=function(e){var t=i(this),a=o(t.length),r=arguments.length,s=n(r>1?arguments[1]:void 0,a),l=r>2?arguments[2]:void 0,c=void 0===l?a:n(l,a);while(c>s)t[s++]=e;return t}},"8b35":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"product-video-uploader"},[a("el-upload",{attrs:{accept:"application/zip,video/*",name:"file",action:e.uploadAction,data:e.uploadData,"file-list":e.fileList,"on-remove":e.handleRemove,"on-success":e.handleSuccess,"on-error":e.handleError,"before-upload":e.beforeAvatarUpload,disabled:e.disabled}},[a("el-button",{attrs:{size:"small",type:"primary",disabled:e.disabled}},[e._v("点击上传")])],1),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.hasFile(),expression:"hasFile()"}],attrs:{size:"small",type:"primary",disabled:!e.preview,loading:e.loading},on:{click:function(t){return t.stopPropagation(),e.handlePreview(t)}}},[e._v(" 预览")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.hasFile(),expression:"hasFile()"}],attrs:{size:"small",type:"primary",disabled:e.preview},on:{click:function(t){return t.stopPropagation(),e.handlePreview(t)}}},[e._v("取消预览")]),a("iframe",{directives:[{name:"show",rawName:"v-show",value:!e.preview,expression:"!preview"}],ref:"vrFrame",staticClass:"vrframe",attrs:{src:e.url,frameborder:"0"}})],1)},n=[],o=(a("c975"),a("d81d"),a("b0c0"),{data:function(){return{preview:!0,loading:!1,fileList:[],url:""}},props:{isTestDrive:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},productId:String,open:{type:Boolean,default:!1},value:{type:Array,default:function(){return[]}}},watch:{open:function(e){e||(this.url="",this.preview=!0)},value:function(e,t){console.log("value: ",this.value),this.fileList=e.map((function(e){return{name:e.name,url:e.url}}))}},computed:{uploadAction:function(){return"/admin/file/uploads.jhtml"},uploadData:function(){return{type:"2"}}},methods:{handlePreview:function(){var e=this;!0===this.preview?(this.url=this.getFilePath(),setTimeout((function(){e.preview=!1}),800)):(this.url="",this.preview=!0)},handleRemove:function(e,t){this.$emit("input",[]),this.url="",this.preview=!0},handleSuccess:function(e){this.$emit("input",e.fis),this.url="",this.preview=!0},beforeAvatarUpload:function(e){var t=/^video\/(.*)$/.test(e.type);return t||this.$message.error("请选择符合视频格式的文件上传!"),t},handleError:function(e,t,a){e?this.$message.warning(e):this.$message.warning("发生错误")},hasFile:function(){return 0!==this.fileList.length},getFilePath:function(){if(0!==this.fileList.length){var e=this.fileList[0].url.indexOf("/upload/");if(-1===e)return console.log("文件路径错误",this.fileList[0].url),"";var t=location.protocol+"//"+location.host,a=this.fileList[0].url.substr(e),i=t+a;return console.log("src",i),i}return""}}}),r=o,s=(a("aae9"),a("2877")),l=Object(s["a"])(r,i,n,!1,null,null,null);t["a"]=l.exports},"8d33":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"bar-basic-info"},[a("biz-header",{attrs:{operations:e.operations},on:{operate:e.operate}}),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"120px",size:"small",rules:e.rules,disabled:"1"===e.form.state,"inline-message":!0}},[a("el-form-item",{attrs:{label:"编号",prop:"sn"}},[a("el-input",{attrs:{value:e.form.sn,disabled:!0}})],1),a("el-form-item",{attrs:{label:"业务类型",prop:"type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[a("el-option",{attrs:{label:"调拨",value:"1"}})],1)],1),a("el-form-item",{attrs:{label:"调出仓库",prop:"depotOut"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.form.depotOut.id,callback:function(t){e.$set(e.form.depotOut,"id",t)},expression:"form.depotOut.id"}},[a("el-option",{attrs:{label:"请选择",value:""}}),e._l(e.shopDepots,(function(t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:t.id!==e.form.depotIn.id,expression:"shopDepot.id!==form.depotIn.id"}],key:t.id,attrs:{label:t.name,value:t.id,disabled:"0"===t.enabled}})}))],2)],1),a("el-form-item",{attrs:{label:"调入仓库",prop:"depotIn"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.form.depotIn.id,callback:function(t){e.$set(e.form.depotIn,"id",t)},expression:"form.depotIn.id"}},[a("el-option",{attrs:{label:"请选择",value:""}}),e._l(e.shopDepots,(function(t,i){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:t.id!==e.form.depotOut.id,expression:"shopDepot.id!==form.depotOut.id"}],key:i,attrs:{label:t.name,value:t.id,disabled:"0"===t.enabled}})}))],2)],1),a("el-form-item",{attrs:{label:"关联出库单",prop:"relateDepotOutBill"}},[a("el-input",{attrs:{value:e.form.relateDepotOutBill?e.form.relateDepotOutBill.sn:"",disabled:!0}})],1),a("el-form-item",{attrs:{label:"关联入库单",prop:"relateDepotInBill"}},[a("el-input",{attrs:{value:e.form.relateDepotInBill?e.form.relateDepotInBill.sn:"",disabled:!0}})],1),a("el-form-item",{attrs:{label:"创建人",prop:"creator"}},[a("el-input",{attrs:{value:e.form.creator||e.getUser().name,disabled:!0}})],1),a("el-form-item",{attrs:{label:"确认人",prop:"modifier"}},[a("el-input",{attrs:{value:e.form.auditorName,disabled:!0}})],1),a("el-form-item",{attrs:{label:"状态",prop:"state"}},[a("el-input",{attrs:{value:"1"===e.form.state?"已确认":"未确认",disabled:!0}})],1),a("el-form-item",{attrs:{label:"创建日期",prop:"createDate"}},[a("el-input",{attrs:{value:e.form.createDate,disabled:!0}})],1),a("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],1),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"mini",disabled:"1"===e.form.state},on:{click:function(t){e.showDialog=!0}}},[e._v("选择商品 ")]),a("el-table",{attrs:{size:"small",data:e.form.items}},[a("el-table-column",{attrs:{label:"商品",prop:"fullName","min-width":"140"}}),a("el-table-column",{attrs:{prop:"barCode",label:"条码","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product&&t.row.product.barCode?t.row.product.barCode:""))]}}])}),"1"!==e.form.state?a("el-table-column",{attrs:{label:"库存数量",prop:"stockAmount","min-width":"80"}}):e._e(),a("el-table-column",{attrs:{label:"调拨数量",prop:"quantity","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{attrs:{size:"mini",min:1,disabled:"1"===e.form.state},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})],1)])}}])}),a("el-table-column",{attrs:{label:"操作","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",disabled:"1"===e.form.state},on:{click:function(a){return a.stopPropagation(),e.deleteHandeler(t)}}},[e._v("删除")])]}}])})],1),a("biz-dialog-selector",{attrs:{title:"选择商品",visibility:e.showDialog,appendToBody:!0,keyField:"id",selectionKeys:e.selectedGiftIds,loading:e.dialogLoading,tableData:e.dialogTableData,pagination:e.dialogPagination,filters:e.dialogFilters},on:{"update:visibility":function(t){e.showDialog=t},confirmed:e.handleConfirmed,open:e.opened,operate:e.dialogOperate,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,selectionChange:e.selectionChange,currentPageChange:e.dialogCurrentPageChange,"active-item-change":e.activeItemChange,cascaderChange:e.cascaderChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"dialog-column"},[a("div",{staticClass:"biz-two-row"},[a("div",{staticClass:"titleClass",staticStyle:{"margin-left":"10px"},attrs:{title:t.row.productName}},[e._v(e._s(t.row.productName))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("编号："+e._s(t.row.productSn))])])])]}}])}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{label:"在库库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.stockAmount))])]}}])})],1)],1)},n=[],o=(a("99af"),a("4160"),a("c975"),a("d81d"),a("a434"),a("b0c0"),a("a9e3"),a("d3b7"),a("25f0"),a("159b"),a("5530")),r=a("f36f"),s=a("04d3"),l=a("af3f"),c=a("c596"),d=a("1ab1"),u=a("2f62"),p=a("c466"),m={name:"MemberBaseInfo",props:{itemId:{type:String},templateId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},shopDepots:{type:Array}},components:{BizGrid:r["a"],BizHeader:s["d"],BizDialogSelector:l["a"]},data:function(){var e=this,t=function(t,a,i){e.form.depotOut.id?i():i(new Error("请选择调出仓库"))},a=function(t,a,i){e.form.depotIn.id?i():i(new Error("请选择调入仓库"))};return{loading:!1,form:this.getDefaultForm(),operations:[{label:"保存",name:"save",disabled:!1,type:"primary",auth:["admin:storage.transfer.edit"]}],dialogLoading:!0,dialogTableData:[],selectedGiftList:[],selectedGiftIds:[],selectionList:[],productCategoryId:"",dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},dialogFilters:[{type:"cascader",label:"分类",name:"category",filterable:!1,value:[],options:[]},{type:"select",label:"品牌",value:"",options:[]},{type:"input",label:"",placeholder:"请输入名称",name:"searchValue",value:""}],showDialog:!1,errorMobile:"",errorRole:"",categoryDatas:[],errUserName:"",errName:"",rules:{type:[{required:!0,message:"请选择业务类型",trigger:"change"}],depotOut:[{required:!0,message:"请选择调出仓库",trigger:"change"},{validator:t,trigger:"change"}],depotIn:[{required:!0,message:"请选择调入仓库",trigger:"change"},{validator:a,trigger:"change"}]}}},watch:{itemId:{handler:function(e){e?(this.$refs.form.resetFields(),this.query()):(this.form=this.getDefaultForm(),this.operations[0].type="primary",this.operations[0].disabled=!1)}}},mounted:function(){},methods:Object(o["a"])(Object(o["a"])({},Object(u["c"])(["getUser"])),{},{operate:function(e){this[e]()},getDefaultForm:function(){return{sn:"",type:"1",depotIn:{id:"",name:""},depotOut:{id:"",name:""},relateDepotInBill:{id:"",name:""},relateDepotOutBill:{id:"",name:""},state:"",items:[],remarks:"",createDate:p["a"].dateTimeConverter(new Date),creator:""}},deleteHandeler:function(e){this.form.items.splice(e.$index,1)},showNotify:function(e,t){this.$notify({showClose:!0,message:e,type:t})},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},handleConfirmed:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(t.$set(e,"quantity",1),t.$set(e,"fullName",e.productName),t.selectedGiftList.push(e))})),this.selectedGiftList.forEach((function(e){t.handleSelect(e)}))},handleSelect:function(e){var t=!1;if(e.id="",0!==this.form.items.length){for(var a=0;a<this.form.items.length;a++)if(this.form.items[a].productId===e.productId){this.form.items[a].quantity=(Number(this.form.items[a].quantity)+1).toString(),t=!0;break}t||this.form.items.push(e)}else this.form.items.push(e)},query:function(){var e=this;this.itemId&&(this.loading=!0,d["a"].get(c["g"].invoicing.allottedMgmt.depotTransfer,{id:this.itemId}).then((function(t){e.loading=!1,e.form=Object.assign(e.getDefaultForm(),t.data),"1"===e.form.state&&(e.operations[0].type="",e.operations[0].disabled=!0),e.$emit("operationSuccess")})).catch((function(t){e.loading=!1,console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})))},save:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.loading=!0,e.itemId&&d["a"].put(c["g"].invoicing.allottedMgmt.depotTransfer,e.form).then((function(t){e.loading=!1,e.$message.success("更新成功"),e.$emit("operationSuccess")})).catch((function(t){e.loading=!1,console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})),!e.itemId&&d["a"].post(c["g"].invoicing.allottedMgmt.depotTransfer,e.form).then((function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("operationSuccess")})).catch((function(t){e.loading=!1,console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})))}))},showStorePicker:function(e){this.showDialog=!0},queryProducts:function(e){var t=this;d["a"].get(c["g"].invoicing.allottedMgmt.products,e).then((function(e){t.dialogLoading=!1,t.dialogTableData=e.dataList,t.dialogPagination.total=Number(e.total)})).catch((function(e){console.log(e),console.log("code错误"),t.dialogLoading=!1,e.errorMessage&&t.$message.warning(e.errorMessage)}))},opened:function(){this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.dialogPagination.currentPage=1,this.dialogPagination.pageSize=20,this.dialogFilters=[{type:"cascader",label:"分类",name:"category",filterable:!1,value:[],options:[]},{type:"select",label:"品牌",value:"",options:[]},{type:"input",label:"",placeholder:"请输入名称",name:"searchValue",value:""}],this.queryFilters(),this.queryProducts(this.getDialogQueryParams())},getDialogQueryParams:function(){return{productCategoryId:this.productCategoryId,brandId:this.getSelectedBrandId(),depotId:this.form.depotOut.id,pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[2].value}},dialogFilterDataChange:function(e){this.dialogPagination.currentPage=1,this.queryProducts(this.getDialogQueryParams())},dialogPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.queryProducts(this.getDialogQueryParams())},dialogCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.queryProducts(this.getDialogQueryParams())},dialogOperate:function(e){},queryFilters:function(){var e=this,t={shopId:window.top.SHOP_ID||""};d["a"].get("/admin/shopProduct/filter.jhtml",t).then((function(t){e.categoryDatas=t.categoryDatas,e.setCategoryFilters(),e.setBrandFilters(t.brandDatas)})).catch((function(){}))},setCategoryFilters:function(){var e=[{value:"",label:"全部"}];this.categoryDatas.forEach((function(t){e.push({value:t.id,label:t.name,children:[{label:"全部",value:""}]})})),this.dialogFilters[0].options=e},setBrandFilters:function(e){this.dialogFilters[1].options=e.map((function(e){return{value:e.id,label:e.name}})),this.dialogFilters[1].options.splice(0,0,{value:"",label:"全部"})},getSelectedBrandId:function(){return this.dialogFilters[1].value},activeItemChange:function(e){var t=this,a={shopId:this.getUser().shop.id,parentId:e.toString()};d["a"].get("/admin/shopProduct/productCategorys.jhtml",a).then((function(a){var i;t.setCategoryFilters(),t.dialogFilters[0].options.forEach((function(t){t.value===e[0]&&(i=t.children)})),a.dateList.forEach((function(e){i.push({value:e.id,label:e.name})}))})).catch((function(){}))},cascaderChange:function(e){this.productCategoryId=e[e.length-1],e.length>1&&""===this.productCategoryId&&(this.productCategoryId=e[e.length-2]),this.queryProducts(this.getDialogQueryParams())}})},g=m,h=(a("3c2c"),a("2877")),f=Object(h["a"])(g,i,n,!1,null,null,null);t["a"]=f.exports},"934e":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"store-value-mgmt-base-info"},[e.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"order",attrs:{rules:e.rules,model:e.order,disabled:"","label-width":"100px",size:"small","inline-message":!0}},[a("el-form-item",{attrs:{label:"订单编号",prop:"sn"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.sn,callback:function(t){e.$set(e.order,"sn",t)},expression:"order.sn"}})],1),a("el-form-item",{attrs:{label:"订单状态",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择状态"},model:{value:e.order.type,callback:function(t){e.$set(e.order,"type",t)},expression:"order.type"}},[a("el-option",{attrs:{value:"0",label:"全部"}}),a("el-option",{attrs:{value:"1",label:"待商家确认"}}),a("el-option",{attrs:{value:"2",label:"商家已确认"}}),a("el-option",{attrs:{value:"3",label:"买家已付款"}}),a("el-option",{attrs:{value:"4",label:"订单已执行"}}),a("el-option",{attrs:{value:"5",label:"交易完成"}}),a("el-option",{attrs:{value:"6",label:"交易关闭"}}),a("el-option",{attrs:{value:"7",label:"已评价"}}),a("el-option",{attrs:{value:"8",label:"订单过期"}}),a("el-option",{attrs:{value:"9",label:"退款退货中"}}),a("el-option",{attrs:{value:"10",label:"退款退货完成"}})],1)],1),a("el-form-item",{attrs:{label:"订单金额",prop:"amount"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.amount,callback:function(t){e.$set(e.order,"amount",t)},expression:"order.amount"}})],1),a("el-form-item",{attrs:{label:"调整金额",prop:"offsetAmount"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.offsetAmount,callback:function(t){e.$set(e.order,"offsetAmount",t)},expression:"order.offsetAmount"}})],1),a("el-form-item",{attrs:{label:"实付金额",prop:"amountPaid"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.amountPaid,callback:function(t){e.$set(e.order,"amountPaid",t)},expression:"order.amountPaid"}})],1),a("el-collapse",{model:{value:e.activeTabName,callback:function(t){e.activeTabName=t},expression:"activeTabName"}},[a("el-collapse-item",{attrs:{name:"customerInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("客户信息")])]),a("el-form-item",{attrs:{label:"会员昵称"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.member.nickname,callback:function(t){e.$set(e.order.member,"nickname",t)},expression:"order.member.nickname"}})],1),a("el-form-item",{attrs:{label:"性别"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.order.member.gender,callback:function(t){e.$set(e.order.member,"gender",t)},expression:"order.member.gender"}},[a("el-option",{attrs:{label:"男",value:"0"}}),a("el-option",{attrs:{label:"女",value:"1"}}),a("el-option",{attrs:{label:"保密",value:"2"}})],1)],1),a("el-form-item",{attrs:{label:"电话"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.member.mobile,callback:function(t){e.$set(e.order.member,"mobile",t)},expression:"order.member.mobile"}})],1),a("el-form-item",{attrs:{label:"车辆"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.car.plateNumber,callback:function(t){e.$set(e.order.car,"plateNumber",t)},expression:"order.car.plateNumber"}})],1)],2),a("el-collapse-item",{attrs:{name:"serviceInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("服务信息")])]),a("el-form-item",{attrs:{label:"顾问"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.order.consultant.id,callback:function(t){e.$set(e.order.consultant,"id",t)},expression:"order.consultant.id"}},[a("el-option",{attrs:{label:e.order.consultant.userName,value:e.order.consultant.id}})],1)],1),a("el-form-item",{attrs:{label:"地区"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.areaName,callback:function(t){e.$set(e.order,"areaName",t)},expression:"order.areaName"}})],1),a("el-form-item",{attrs:{label:"服务地址"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.address,callback:function(t){e.$set(e.order,"address",t)},expression:"order.address"}})],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{placeholder:"",type:"textarea"},model:{value:e.order.memo,callback:function(t){e.$set(e.order,"memo",t)},expression:"order.memo"}})],1)],2),a("el-collapse-item",{attrs:{name:"promotionInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("优惠信息")])]),a("el-form-item",{attrs:{label:"销售折扣"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.promotionDiscount,callback:function(t){e.$set(e.order,"promotionDiscount",t)},expression:"order.promotionDiscount"}})],1),a("el-form-item",{attrs:{label:"优惠券折扣"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.couponDiscount,callback:function(t){e.$set(e.order,"couponDiscount",t)},expression:"order.couponDiscount"}})],1),a("el-form-item",{attrs:{label:"V豆抵扣"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.beanDiscount,callback:function(t){e.$set(e.order,"beanDiscount",t)},expression:"order.beanDiscount"}})],1),a("el-form-item",{attrs:{label:"赠送积分"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.point,callback:function(t){e.$set(e.order,"point",t)},expression:"order.point"}})],1),a("el-form-item",{attrs:{label:"赠送V豆"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.giftBean,callback:function(t){e.$set(e.order,"giftBean",t)},expression:"order.giftBean"}})],1)],2),a("el-collapse-item",{attrs:{name:"paymentInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("付款信息")])]),a("el-form-item",{attrs:{label:"支付方式"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.paymentMethodName,callback:function(t){e.$set(e.order,"paymentMethodName",t)},expression:"order.paymentMethodName"}})],1),a("el-form-item",{attrs:{label:"付款方式"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.paymentTypeName,callback:function(t){e.$set(e.order,"paymentTypeName",t)},expression:"order.paymentTypeName"}})],1),"会员卡余额"===e.order.payments[0].paymentType?a("el-form-item",{attrs:{label:"会员卡",prop:"payments[0].memberCardId"}},[a("el-select",{attrs:{disabled:"",placeholder:"请选择会员卡"},model:{value:e.order.payments[0].memberCardId,callback:function(t){e.$set(e.order.payments[0],"memberCardId",t)},expression:"order.payments[0].memberCardId"}},e._l(e.listExistCard,(function(e,t){return a("el-option",{key:t,attrs:{label:e.template.name,value:e.id}})})),1)],1):e._e(),"刷卡"===e.order.payments[0].paymentType||"汇款"===e.order.payments[0].paymentType?a("el-form-item",{attrs:{label:"付款银行",prop:"payments[0].payBank"}},[a("el-input",{attrs:{placeholder:"请输入付款银行"},model:{value:e.order.payments[0].payBank,callback:function(t){e.$set(e.order.payments[0],"payBank",t)},expression:"order.payments[0].payBank"}})],1):e._e(),"刷卡"===e.order.payments[0].paymentType||"汇款"===e.order.payments[0].paymentType?a("el-form-item",{attrs:{label:"付款账号",prop:"payments[0].payAccount"}},[a("el-input",{attrs:{placeholder:"请输入付款账号"},model:{value:e.order.payments[0].payAccount,callback:function(t){e.$set(e.order.payments[0],"payAccount",t)},expression:"order.payments[0].payAccount"}})],1):e._e()],2),a("el-collapse-item",{attrs:{name:"logisticsInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("物流信息")])]),a("el-form-item",{attrs:{label:"配送方式"}},[a("el-select",{attrs:{placeholder:"请选择配送方式"},model:{value:e.shippingMethodId,callback:function(t){e.shippingMethodId=t},expression:"shippingMethodId"}},e._l(e.shippingMethods,(function(e){return a("el-option",{key:e.index,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"物流公司",prop:"shippings[0].logistics"}},[a("el-input",{attrs:{placeholder:"请选择物流公司"},model:{value:e.order.shippings[0].logistics,callback:function(t){e.$set(e.order.shippings[0],"logistics",t)},expression:"order.shippings[0].logistics"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"物流单号",prop:"shippings[0].expressSn"}},[a("el-input",{attrs:{placeholder:"请输入物流单号"},model:{value:e.order.shippings[0].expressSn,callback:function(t){e.$set(e.order.shippings[0],"expressSn",t)},expression:"order.shippings[0].expressSn"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"物流费用",prop:"shippings[0].freight"}},[a("el-input",{attrs:{placeholder:"请输入物流费用"},model:{value:e.order.shippings[0].freight,callback:function(t){e.$set(e.order.shippings[0],"freight",t)},expression:"order.shippings[0].freight"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"收货地址",prop:"shippings[0].address"}},[a("el-input",{attrs:{placeholder:"请输入收货地址"},model:{value:e.order.shippings[0].address,callback:function(t){e.$set(e.order.shippings[0],"address",t)},expression:"order.shippings[0].address"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"收货人",prop:"shippings[0].consignee"}},[a("el-input",{attrs:{placeholder:"请输入收货人"},model:{value:e.order.shippings[0].consignee,callback:function(t){e.$set(e.order.shippings[0],"consignee",t)},expression:"order.shippings[0].consignee"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"电话",prop:"shippings[0].phone"}},[a("el-input",{attrs:{placeholder:"请输入电话"},model:{value:e.order.shippings[0].phone,callback:function(t){e.$set(e.order.shippings[0],"phone",t)},expression:"order.shippings[0].phone"}})],1)],2),a("el-collapse-item",{attrs:{name:"invoiceInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("发票信息")])]),a("el-form-item",{attrs:{label:"是否需要发票",prop:"invoiceState"}},[a("el-select",{attrs:{disabled:!0},model:{value:e.order.invoiceState,callback:function(t){e.$set(e.order,"invoiceState",t)},expression:"order.invoiceState"}},[a("el-option",{attrs:{label:"否",value:e.order.invoiceState}}),a("el-option",{attrs:{label:"是",value:e.order.invoiceState}})],1)],1)],2),a("el-collapse-item",{attrs:{name:"otherInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("其他信息")])]),a("el-form-item",{attrs:{label:"创建时间"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd"},model:{value:e.order.orderTime,callback:function(t){e.$set(e.order,"orderTime",t)},expression:"order.orderTime"}})],1),a("el-form-item",{attrs:{label:"执行时间"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd"},model:{value:e.order.deliveryTime,callback:function(t){e.$set(e.order,"deliveryTime",t)},expression:"order.deliveryTime"}})],1),a("el-form-item",{attrs:{label:"付款时间"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd"},model:{value:e.order.payments[0].paymentDate,callback:function(t){e.$set(e.order.payments[0],"paymentDate",t)},expression:"order.payments[0].paymentDate"}})],1),a("el-form-item",{attrs:{label:"完成时间"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd"},model:{value:e.order.orderTime,callback:function(t){e.$set(e.order,"orderTime",t)},expression:"order.orderTime"}})],1)],2)],1)],1)],1)},n=[],o=(a("99af"),a("d81d"),a("b0c0"),a("f36f")),r=a("8330"),s=a("e42c"),l=a("c596"),c=a("1ab1"),d={name:"StoreValueMgmtBaseInfo",props:{itemId:{type:Object,default:function(){return{id:""}}},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{activeTabName:"",loading:!1,operations:[],rules:{},adminCurrentId:"",afterSales:[],listExistCard:[],consultants:[],adminCurrent:[],order:this.resetOrder(),shippingMethodId:"",shippingMethods:[]}},components:{BizGrid:o["a"],BizSaveButton:r["a"]},methods:{operate:function(e){this[e]()},resetOrder:function(){return{sn:"",type:"",userId:"",amount:"",offsetAmount:"",amountPaid:"",member:{},car:{},consultant:{},area:"",consignee:"",areaName:"",address:"",phone:"",memo:"",promotionDiscount:"",couponDiscount:"",beanDiscount:"",point:"",giftBean:"",paymentMethodName:"",paymentTypeName:"",payments:[{}],payAccount:"",shippings:[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:"",consignee:"",phone:"",zipCode:""}],invoiceState:"",invoiceType:"",invoiceTitle:"",taxNumber:"",orderTime:"",deliveryTime:"",paymentTime:"",completeTime:""}},resetForm:function(){return{order:{}}},clear:function(){this.activeTabName="",this.form=this.resetForm()},refresh:function(){var e=this;this.loading=!0;var t={orderId:this.itemId.id};c["a"].get(l["i"].store.baseInfo.query,t).then((function(t){e.loading=!1,e.adminCurrentId=t.adminCurrent.id,e.afterSales=t.afterSales,e.shippingMethods=t.shippingMethods,t.shippingMethods.map((function(a){t.order.shippingMethodName===a.name&&(e.shippingMethodId=a.id)})),e.order=Object.assign(e.resetOrder(),t.order),e.order.payments.length||(e.order.payments=[{}]),0===e.order.shippings.length&&(e.order.shippings=[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:e.order.areaName?e.order.areaName+e.order.address:e.order.address,consignee:e.order.consignee,phone:e.order.phone,zipCode:e.order.zipCode}]),e.adminCurrent=[{id:t.adminCurrent.id,name:t.adminCurrent.realName}],e.order.consultant.id?e.adminCurrent=[{id:e.order.consultant.id,name:e.order.consultant.realName}]:e.order.consultant={id:t.adminCurrent.id,userName:t.adminCurrent.realName},e.listExistCardTemplate()})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},listAdminByRole:function(){var e=this,t="";t="car"===this.$route.params.orderType?["salesman"]:["afterSale","reception","testDriver"],s["a"].listAdminByRole({roleTypes:t},(function(t){e.loading=!1,e.flag=!1,console.log(e.form.consultant.id),t.dataList.map((function(t){t.id===e.adminCurrent[0].id&&(e.flag=!0)})),e.flag?e.consultants=t.dataList:e.consultants=t.dataList.concat(e.adminCurrent)}),(function(e){console.log(e)}))},save:function(){var e=this;this.$refs.form.validate((function(t){t&&e.submit()}))},submit:function(){this.itemId.id?this.update():this.create()},listExistCardTemplate:function(){var e=this;s["a"].listExistCardTemplate({userId:this.order.userId},(function(t){e.loading=!1,e.listExistCard=t.content}),(function(e){console.log(e)}))},create:function(){var e=this;this.loading=!0;var t=this.form;c["a"].post(l["i"].store.baseInfo.create,t).then((function(t){e.loading=!1,e.$message.success("操作成功"),e.$emit("update"),e.form=e.resetForm()})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},update:function(){var e=this;this.loading=!0;var t=Object.assign(this.form,this.itemId);c["a"].put(l["i"].store.baseInfo.update,t).then((function(t){e.loading=!1,e.$message.success("操作成功"),e.$emit("update"),e.refresh()})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},showMessage:function(e,t){this.$notify({message:e,type:t,showClose:!0})}},mounted:function(){this.itemId.id&&this.refresh()},watch:{itemId:function(e,t){this.clear(),""!==e.id&&this.refresh()}}},u=d,p=(a("d1ce"),a("2877")),m=Object(p["a"])(u,i,n,!1,null,null,null);t["a"]=m.exports},"9b2e":function(e,t,a){"use strict";var i=a("0a05"),n=a.n(i);n.a},aae9:function(e,t,a){"use strict";var i=a("6ac0"),n=a.n(i);n.a},ab4f:function(e,t,a){},af3f:function(e,t,a){"use strict";var i=a("697f");t["a"]=i["a"]},b15b:function(e,t,a){"use strict";var i=a("bbfa"),n=a.n(i);n.a},b4ab:function(e,t,a){},b547:function(e,t,a){},b89e:function(e,t,a){e.exports=a.p+"static/img/pic_default_fail.876971c2.png"},bbfa:function(e,t,a){},c1fc:function(e,t,a){"use strict";var i=a("ab4f"),n=a.n(i);n.a},c466:function(e,t,a){"use strict";a("99af"),a("d3b7"),a("ac1f"),a("25f0"),a("5319");t["a"]={nowDate:function(){var e=new Date,t=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()+1<10?"0"+e.getDate():e.getDate();return e.getFullYear().toString()+"-"+t+"-"+a},getMonthDays:function(e){var t=new Date(Date.parse(e.replace(/-/g,"/"))),a=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,1),n=(i-a)/864e5;return n},halfYearAgo:function(e){var t="";return t=e?new Date(Date.parse(e.replace(/-/g,"/"))):new Date,console.log(t),t.setMonth(t.getMonth()-6),"".concat(t.getFullYear(),"-").concat(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,"-").concat(t.getDate()<10?"0"+t.getDate():t.getDate())},lastMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1<10?"0"+e.getMonth():e.getMonth(),i=e.getDate()+1<10?"0"+e.getDate():e.getDate();return"00"===a&&(a="12",t--),t.toString()+"-"+a+"-"+i},nextMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),n=parseInt(a)+1;13===n&&(t=parseInt(t)+1,n=1);var o=new Date(t,n,0);return o=o.getDate(),i>o&&(i=o),n<10&&(n="0"+n),t+"-"+n+"-"+i},lastYearDate:function(){var e=new Date,t=new Date(e.getFullYear()-1,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastTwoYearDate:function(){var e=new Date,t=new Date(e.getFullYear()+2,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastNYearDate:function(e,t){var a=new Date(e),i=new Date(a.getFullYear()+parseInt(t),a.getMonth(),a.getDate());return i.getFullYear()+"-"+this.convertToFullMode(i.getMonth()+1)+"-"+this.convertToFullMode(i.getDate())},dateConverter:function(e){return e instanceof Date?e.getFullYear()+"-"+this.convertToFullMode(e.getMonth()+1)+"-"+this.convertToFullMode(e.getDate()):e},timeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes())+":"+this.convertToFullMode(e.getSeconds()):e},shortTimeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes()):e},dateTimeConverter:function(e){return e instanceof Date?this.dateConverter(e)+" "+this.timeConverter(e):e},convertToFullMode:function(e){return e=e.toString(),1===e.length?"0"+e:e}}},c954:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"order-product-info"},[e.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),a("el-form",{attrs:{inline:!0,disabled:!e.isEdit,"inline-message":!0}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addProduct}},[e._v("新增")]),a("el-form-item",{staticClass:"subTotal",attrs:{label:"合计:",prop:"subTotal"}},[e._v(" "+e._s(e.subTotal)+" ")])],1),a("biz-list",{key:Math.random(),ref:"table",attrs:{tableData:e.tableData,loading:e.loading}},[a("el-table-column",{attrs:{prop:"sn",label:"编号"}}),a("el-table-column",{attrs:{prop:"name",label:"商品名称"}}),a("el-table-column",{attrs:{prop:"price",label:"商品价格","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{attrs:{size:"mini",min:0},on:{change:function(a){return e.priceChange(t.row.price)}},model:{value:t.row.price,callback:function(a){e.$set(t.row,"price",a)},expression:"scope.row.price"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"quantity",label:"数量","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{attrs:{size:"mini",min:1},on:{change:function(a){return e.quantityChange(t.row.quantity)}},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[e._v(" "+e._s(t.row.quantity?(Number(t.row.quantity)*Number(t.row.price)).toFixed(2):"")+" ")])])}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作",type:"index"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[e.isEdit?a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteHandeler(t)}}},[e._v(" 删除 ")])],1):e._e()])}}])})],1),a("biz-pagination",{attrs:{pagination:e.pagination},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),a("el-dialog",{attrs:{visible:e.dialogTableVisible,center:"",width:"1200px","append-to-body":""},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"right"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.print}},[e._v("打印")])],1)])],1),a("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[e._v(" "+e._s(e.title)+" ")])]),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"right"}},[e._v("打印日期："+e._s(e.formatDate((new Date).getTime())))])])],1),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("订单编号："+e._s(e.formData.sn))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("配送方式："+e._s(e.shippingData.shippingMethod))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("收货人："+e._s(e.shippingData.consignee))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("电话："+e._s(e.shippingData.phone))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("地址："+e._s(e.shippingData.address))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("买家留言："+e._s(e.formData.memo))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"})])],1),a("el-table",{staticClass:"table-class",attrs:{data:e.gridData}},[a("el-table-column",{attrs:{property:"isTotal",width:"50",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isTotal?a("div",[e._v("合计")]):a("div",[e._v(e._s(t.$index+1))])]}}])}),a("el-table-column",{attrs:{property:"name",label:"商品名",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(" "+e._s(t.row.name)+" ")]}}],null,!0)}),a("el-table-column",{attrs:{property:"address",label:"规格"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(" "+e._s(-1!==t.row.fullName.indexOf("[")?t.row.fullName.split("[")[1].split("]")[0]:"")+" ")]}}],null,!0)}),a("el-table-column",{attrs:{property:"price",label:"单价"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(" ￥"+e._s(t.row.price)+" ")]}}],null,!0)}),a("el-table-column",{attrs:{property:"quantity",label:"数量"}}),a("el-table-column",{attrs:{property:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" ￥"+e._s(t.row.subTotal)+" ")]}}])})],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("运费：￥"+e._s(e.formData.freight))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("优惠金额：￥"+e._s(e.formData.couponDiscount))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("调整金额：￥"+e._s(e.formData.offsetAmount))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("订单金额：￥"+e._s(e.formData.originalAmount))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("仓库签字：")])])],1)],1)])],1),a("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:e.showDialog,tableData:e.giftList,pagination:e.dialogPagination,filters:e.dialogFilters,selectionKeys:e.selectedGiftIds},on:{"update:visibility":function(t){e.showDialog=t},pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,confirmed:e.confirmedProduct,filterDataChange:e.dialogFilterDataChange,selectionChange:e.selectionChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"400px"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-two-column"},[a("img",{attrs:{src:t.row.image||e.DefaultImg,onerror:e.errorImg}}),a("div",{staticClass:"biz-two-row"},[a("div",{staticStyle:{"margin-left":"10px","font-size":"14px"}},[e._v(e._s(t.row.name))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("编号："+e._s(t.row.sn))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("规格："+e._s(t.row.fullName&&-1!==t.row.fullName.indexOf("[")?t.row.fullName.split("[")[1].split("]")[0]:""))])])])])}}])}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),a("el-table-column",{attrs:{property:"price",label:"价格"}}),a("el-table-column",{attrs:{label:"剩余库存/库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.availableStock)+"/"+e._s(t.row.stock))])]}}])})],1)],1)},n=[],o=(a("99af"),a("4de4"),a("4160"),a("c975"),a("d81d"),a("a434"),a("b0c0"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("159b"),a("5530")),r=a("7558"),s=a("5c40"),l=a("8330"),c=a("f36f"),d=a("e42c"),u=a("2086"),p=a("225d"),m=a("2f62"),g=a("c596"),h=a("1ab1"),f=a("af3f"),b=a("f3ac"),v=a.n(b),y={name:"NewsMgmt",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},errorImg:'this.src="/resources/admin/images/default/product-default.png"',DefaultImg:v.a,selectedGiftList:[],selectedGiftIds:[],showDialog:!1,dialogFilters:[{type:"input",placeholder:"请输入编号或商品名",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,subTotal:"",height:"585",subTotalAll:"",tableData:[],restaurants:[],selections:[],orderItems:[],selectionList:[],dialogTableVisible:!1,gridData:[],formData:{},shippingData:{},title:"",form:{products:""},operations:[{label:"保存",name:"save",type:"primary"},{label:"打印",name:"certificate",type:"primary"}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:r["a"],BizPagination:s["a"],BizGrid:c["a"],BizSaveButton:l["a"],vueEasyPrint:p["a"],BizDialogSelector:f["a"]},watch:{itemId:function(e){this.tableData=[],this.subTotal="",this.itemId&&this.getList()}},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},methods:Object(o["a"])(Object(o["a"])({},Object(m["c"])(["getUser"])),{},{addProduct:function(){this.dialogFilters[0].value="",this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getGiftList()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getGiftList()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getGiftList()},getGiftList:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[0].value,shopId:window.top.SHOP_ID||"",isOutOfStock:"0",type:"couponOrder"===this.$route.params.orderType?"7":"",orderType:this.$route.params.orderType};h["a"].get("purchaseOrder"===window.top.dType?"/admin/purchaseOrderManage/product/list.jhtml":g["g"].memberCardMgmt.memberCard.listProduct,t).then((function(t){e.giftList=t.content,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},confirmedProduct:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(e.quantity="1",t.selectedGiftList.push(e))}));this.selectedGiftList.map((function(e){Number(e.quantity)*Number(e.price)})),this.selectedGiftList.forEach((function(e){t.handleSelect(e),t.listProduct(e)}))},print:function(){this.$refs.easyPrint.print()},certificate:function(){var e=this;if(!this.itemId)return this.$message.warning("请先生成一个订单"),!1;var t={orderId:this.itemId,shopId:window.top.SHOP_ID||""};h["a"].get("purchaseOrder"===window.dType?g["l"].delivery.queryShippingVoucherPurchase:g["l"].delivery.queryShippingVoucher,t).then((function(t){e.dialogTableVisible=!0,e.title=e.getUser().shop?e.getUser().shop.name+"发货单":"发货单",e.formData=t.order,e.shippingData=t.shipping||{},e.userCard=t.userCard,e.gridData=t.order.orderItems})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},formatDate:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),o=a+"-"+(i<10?"0"+i:i)+"-"+(n<10?"0"+n:n);return o},resize:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},operate:function(e){this[e]()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},getList:function(){var e=this;console.log("window.top.dType"+window.top.dType),this.loading=!0;var t={orderId:this.itemId,pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};d["a"].viewProducts(t,(function(t){e.loading=!1,e.tableData=t.orderItems,e.subTotal=t.order.price,e.pagination.total=Number(t.total),console.log("this.tableData",e.tableData)}),(function(e){console.log(e)}))},handleSelect:function(e){var t=!1;if(e.productId=e.id,e.id="",this.subTotal=(Number(this.subTotal)+Number(e.quantity)*Number(e.price)).toFixed(2),0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].productId===e.productId){this.tableData[a].quantity=(Number(this.tableData[a].quantity)+1).toString(),t=!0;break}t||this.tableData.push(e)}else this.tableData.push(e)},deleteHandeler:function(e){console.log(1),this.tableData.splice(e.$index,1),this.tableData.length>0?this.subTotal=(Number(this.subTotal)-Number(e.row.price)*Number(e.row.quantity)).toFixed(2):this.subTotal=0},quantityChange:function(e){var t=0;this.tableData.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.subTotal=t?t.toFixed(2):""},priceChange:function(e){var t=0;this.tableData.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.subTotal=t?t.toFixed(2):""},save:function(){var e=this;this.orderItems=this.tableData.map((function(e){return{id:e.id||"",productId:e.productId?e.productId:e.id,quantity:e.quantity||"",price:e.price||""}}));var t=!1;if(this.tableData.forEach((function(e){console.log(e.quantity),-1!==String(e.quantity).indexOf(".")&&(t=!0)})),t)return this.$message.warning("数量不能为小数"),!1;!this.itemId&&this.$emit("setOrderItems",this.orderItems),this.itemId&&d["a"].addOrderItems({orderId:this.itemId,orderData:{orderItems:this.orderItems},shopId:window.top.SHOP_ID},(function(t){e.$emit("setOrderItems",e.orderItems),e.$emit("operationSuccess"),e.loading=!1}),(function(t){e.loading=!1,e.getList(),e.$message.warning(t.errorMessage)}))},listProduct:function(e){var t=this;u["a"].listProduct({searchValue:e.name},(function(e){t.restaurants=e.content.map((function(e){return{fullName:e.fullName,sn:e.sn,price:e.price,quantity:"1",subTotal:e.price,productId:e.id,value:e.fullName}})),t.loading=!1}),(function(e){console.log(e),console.log("code错误")}))},querySearchAsync:function(e,t){var a=this.restaurants,i=e?a.filter(this.createStateFilter(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout((function(){t(i)}),300*Math.random())},createStateFilter:function(e){return function(e){return!0}},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()}})},w=y,C=(a("1dad"),a("2877")),I=Object(C["a"])(w,i,n,!1,null,null,null);t["a"]=I.exports},cb29:function(e,t,a){var i=a("23e7"),n=a("81d5"),o=a("44d2");i({target:"Array",proto:!0},{fill:n}),o("fill")},d1ce:function(e,t,a){"use strict";var i=a("b4ab"),n=a.n(i);n.a},d6d1:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"inventory-base-info"},[e.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px",size:"small",disabled:!e.isEdit,"inline-message":!0}},[e.itemId?a("el-form-item",{attrs:{label:"编号",prop:"sn"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.form.sn,callback:function(t){e.$set(e.form,"sn",t)},expression:"form.sn"}})],1):e._e(),a("el-form-item",{attrs:{label:"盘点仓库",prop:"depotId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择盘点仓库",disabled:!!e.itemId},model:{value:e.form.depotId,callback:function(t){e.$set(e.form,"depotId",t)},expression:"form.depotId"}},e._l(e.depotList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e.itemId?a("el-form-item",{attrs:{label:"创建者",prop:"creatorName"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.form.creatorName,callback:function(t){e.$set(e.form,"creatorName",t)},expression:"form.creatorName"}})],1):e._e(),e.itemId?a("el-form-item",{attrs:{label:"状态",prop:"state"}},[a("el-input",{attrs:{value:e.stateFormatter,disabled:!0}})],1):e._e(),e.itemId?a("el-form-item",{attrs:{label:"创建时间",prop:"createDate"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.form.createDate,callback:function(t){e.$set(e.form,"createDate",t)},expression:"form.createDate"}})],1):e._e(),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1)},n=[],o=(a("d3b7"),a("b85c")),r=a("5530"),s=a("f36f"),l=a("8330"),c=a("2f62"),d=a("1ab1"),u=a("c596"),p=function(){return{depotId:"",remark:"",id:"",shopId:""}},m={name:"baseInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},components:{BizGrid:s["a"],BizSaveButton:l["a"]},data:function(){return{loading:!1,showDialog:!1,dialogVisible:!1,form:p(),depotList:[],itemDatas:[],operations:[{label:"保存",name:"save",type:"primary",auth:["admin:check.edit"]}],rules:{depotId:[{required:!0,message:"请选择盘点仓库",trigger:"blur"}]}}},computed:{stateFormatter:function(){switch(this.form.state){case"0":return"盘点中";case"1":return"盘点完成";case"2":return"已调整";default:return"--"}}},created:function(){this.queryDepotList()},watch:{itemId:function(e){""!==e?this.queryInventory(e):this.form=this.getDefaultModel()}},methods:Object(r["a"])(Object(r["a"])({},Object(c["c"])(["getUser"])),{},{operate:function(e){this[e]()},initModel:function(e){e?this.form=Object.assign(this.getDefaultModel(),e):this.resetModel(),this.$refs.form.resetFields()},resetModel:function(){this.form=this.getDefaultModel()},queryInventory:function(e){var t=this;this.loading=!0,d["a"].get(u["g"].invoicing.inventory.inventory,{shopId:window.top.SHOP_ID||"",id:e}).then((function(e){t.loading=!1,t.initModel(e.data)})).catch((function(e){t.loading=!1,console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))},getDefaultModel:function(){return p()},queryDepotList:function(){var e=this;this.loading=!0;var t={shopId:window.top.SHOP_ID||""};d["a"].get(u["g"].invoicing.storeHouseMgmt.shopDepotList,t).then((function(t){var a,i=Object(o["a"])(t.dataList);try{for(i.s();!(a=i.n()).done;){var n=a.value;"1"===n.enabled&&e.depotList.push(n)}}catch(r){i.e(r)}finally{i.f()}})).catch((function(t){console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},getSaveParams:function(){return{id:this.form.id,depotId:this.form.depotId,remark:this.form.remark,shopId:window.top.SHOP_ID||""}},save:function(){var e=this;this.$refs.form.validate((function(t,a){if(!t)return!1;e.loading=!0,e.form.id?d["a"].put(u["g"].invoicing.inventory.inventory,e.getSaveParams()).then((function(t){e.$message.success("保存成功"),e.$emit("operationSuccess"),e.loading=!1})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)})).finally((function(t){e.loading=!1})):d["a"].post(u["g"].invoicing.inventory.inventory,e.getSaveParams()).then((function(t){e.$message.success("保存成功"),e.$emit("operationSuccess",t.id),e.queryInventory(t.id),e.loading=!1})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)})).finally((function(t){e.loading=!1}))}))}})},g=m,h=(a("5742"),a("2877")),f=Object(h["a"])(g,i,n,!1,null,null,null);t["a"]=f.exports},d74a:function(e,t,a){"use strict";var i=a("21c5"),n=a.n(i);n.a},ec6b:function(e,t,a){"use strict";var i=a("b547"),n=a.n(i);n.a},ef6d:function(e,t,a){},f3ac:function(e,t,a){e.exports=a.p+"static/img/pic_default_none_100.6603f4ac.png"},f58d:function(e,t,a){"use strict";var i=a("0504"),n=a.n(i);n.a},f705:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"depot-base-info"},[e.isEdit?i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px",size:"small",disabled:!e.isEdit,"inline-message":!0}},[e.itemId?i("el-form-item",{attrs:{label:"单据编号",prop:"sn"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.sn,callback:function(t){e.$set(e.form,"sn",t)},expression:"form.sn"}})],1):e._e(),i("el-form-item",{attrs:{label:"业务类型",prop:"businessType"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择业务类型",disabled:!!e.itemId},on:{change:e.businessTypeChange},model:{value:e.form.businessType,callback:function(t){e.$set(e.form,"businessType",t)},expression:"form.businessType"}},[i("el-option",{attrs:{label:"采购入库",value:"0"}}),i("el-option",{attrs:{label:"销售退货",value:"1"}}),i("el-option",{attrs:{label:"其它入库",value:"2"}}),"3"===e.form.businessType?i("el-option",{attrs:{label:"盘点调整",value:"3"}}):e._e(),"4"===e.form.businessType?i("el-option",{attrs:{label:"调拨",value:"4"}}):e._e()],1)],1),"3"!==e.form.businessType?i("el-form-item",{attrs:{label:"往来方",prop:"relatePartnerType"}},[i("el-select",{attrs:{placeholder:"",disabled:"0"===e.form.businessType||!!e.itemId},on:{change:e.relateTypeChange},model:{value:e.form.relatePartnerType,callback:function(t){e.$set(e.form,"relatePartnerType",t)},expression:"form.relatePartnerType"}},["1"!==e.form.businessType?i("el-option",{attrs:{label:"供应商",value:"0"}}):e._e(),"0"!==e.form.businessType?i("el-option",{attrs:{label:"会员",value:"1"}}):e._e(),"0"!==e.form.businessType?i("el-option",{attrs:{label:"代理商",value:"2"}}):e._e(),"0"!==e.form.businessType&&e.itemId?i("el-option",{attrs:{label:"仓库",value:"3"}}):e._e()],1),"0"===e.form.relatePartnerType?i("el-input",{attrs:{placeholder:"请选择供应商",disabled:!!e.itemId},on:{focus:function(t){e.showSupplierDialog=!0}},model:{value:e.form.relatePartnerName,callback:function(t){e.$set(e.form,"relatePartnerName",t)},expression:"form.relatePartnerName"}}):e._e(),"1"===e.form.relatePartnerType?i("el-input",{attrs:{placeholder:"请选择会员",disabled:!!e.itemId},on:{focus:function(t){e.showMemberDialog=!0}},model:{value:e.form.relatePartnerName,callback:function(t){e.$set(e.form,"relatePartnerName",t)},expression:"form.relatePartnerName"}}):e._e(),"2"===e.form.relatePartnerType?i("el-input",{attrs:{placeholder:"请选择代理商",disabled:!!e.itemId},on:{focus:function(t){e.showAgentDialog=!0}},model:{value:e.form.relatePartnerName,callback:function(t){e.$set(e.form,"relatePartnerName",t)},expression:"form.relatePartnerName"}}):e._e(),"3"===e.form.relatePartnerType&&e.itemId?i("el-input",{attrs:{disabled:!!e.itemId},model:{value:e.form.relatePartnerName,callback:function(t){e.$set(e.form,"relatePartnerName",t)},expression:"form.relatePartnerName"}}):e._e()],1):e._e(),"0"===e.form.businessType||"1"===e.form.businessType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"关联单据"}},[i("el-input",{attrs:{placeholder:"请选择关联单据",disabled:""===e.form.relatePartnerName||!!e.itemId},on:{focus:e.showDialog},model:{value:e.form.relateBillSn,callback:function(t){e.$set(e.form,"relateBillSn",t)},expression:"form.relateBillSn"}})],1):e._e(),e.itemId?i("el-form-item",{attrs:{label:"创建者",prop:"creatorName"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.creatorName,callback:function(t){e.$set(e.form,"creatorName",t)},expression:"form.creatorName"}})],1):e._e(),"1"===e.form.state&&"3"!==e.form.businessType?i("el-form-item",{attrs:{label:"提交者",prop:"auditorName"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.auditorName,callback:function(t){e.$set(e.form,"auditorName",t)},expression:"form.auditorName"}})],1):e._e(),e.itemId?i("el-form-item",{attrs:{label:"状态",prop:"state"}},[i("el-input",{attrs:{value:e.stateFormatter,disabled:!0}})],1):e._e(),e.itemId?i("el-form-item",{attrs:{label:"创建时间",prop:"createDate"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.createDate,callback:function(t){e.$set(e.form,"createDate",t)},expression:"form.createDate"}})],1):e._e(),i("el-form-item",{attrs:{label:"图片资源",prop:"image"}},[i("img-uploader",{attrs:{limit:3,disabled:!!e.itemId,isShowDelete:!e.itemId},model:{value:e.form.images,callback:function(t){e.$set(e.form,"images",t)},expression:"form.images"}})],1),i("el-form-item",{attrs:{label:"视频资源",prop:"video"}},[i("BizVideoUpload",{attrs:{disabled:!!e.itemId},model:{value:e.form.videos,callback:function(t){e.$set(e.form,"videos",t)},expression:"form.videos"}})],1),i("el-form-item",{attrs:{label:"扫码入库备注",prop:"memo"}},[i("el-input",{attrs:{disabled:!!e.itemId,type:"textarea"},model:{value:e.form.memo,callback:function(t){e.$set(e.form,"memo",t)},expression:"form.memo"}})],1),i("el-form-item",{attrs:{label:"备注",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",disabled:"1"===e.form.state,placeholder:"请输入备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),i("biz-dialog-selector",{staticClass:"memberDialog",attrs:{title:"选择会员",visibility:e.showMemberDialog,appendToBody:!0,loading:e.dialogLoading,tableData:e.dialogMemberTableData,pagination:e.dialogPagination,selectionMode:"single",isClear:!1,filters:e.dialogMemberFilters},on:{"update:visibility":function(t){e.showMemberDialog=t},confirmed:e.handleMemberConfirmed,open:e.opened,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange}},[i("el-table-column",{attrs:{label:"用户名",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"customer-info"},[t.row.head?i("img",{attrs:{src:t.row.head}}):i("img",{attrs:{src:a("624d")}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"title"},[e._v(e._s(t.row.name))]),i("div",{staticClass:"gender"},["0"===t.row.gender?i("i",{staticClass:"male iconfont biz-icon-i-web-m"}):e._e(),"1"===t.row.gender?i("i",{staticClass:"female iconfont biz-icon-i-web-f"}):e._e(),"2"===t.row.gender?i("i",{staticClass:"none iconfont biz-icon-i-web-bm"}):e._e(),i("span",[e._v(e._s(t.row.mobile))])])])])]}}])}),i("el-table-column",{attrs:{label:"状态",formatter:e.stateConverterMember}}),i("el-table-column",{attrs:{prop:"",label:"店铺"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",e._l(t.row.shops,(function(t,a){return i("div",{key:a,staticClass:"customer-info"},[e._v(e._s(t.name))])})),0)]}}])}),i("el-table-column",{attrs:{prop:"nickname",label:"最后登录"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.lastLoginDate)+" ")]}}])})],1),i("biz-dialog-selector",{staticClass:"supplierDialog",attrs:{title:"选择供应商",visibility:e.showSupplierDialog,appendToBody:!0,tableData:e.dialogSupplierTableData,pagination:e.dialogPagination,selectionMode:"single",isClear:!1,filters:e.dialogSupplierFilters},on:{"update:visibility":function(t){e.showSupplierDialog=t},open:e.openedSupplier,confirmed:e.handleSupplierConfirmed,filterDataChange:e.supplierFilterDataChange,pageSizeChange:e.supplierPageSizeChange,currentPageChange:e.supplierCurrentPageChange}},[i("el-table-column",{attrs:{label:"供应商名称",width:"200px",prop:"name"}}),i("el-table-column",{attrs:{prop:"address",label:"地址"}}),i("el-table-column",{attrs:{prop:"phone",label:"电话"}})],1),i("biz-dialog-selector",{staticClass:"agentDialog",attrs:{title:"选择代理商",visibility:e.showAgentDialog,appendToBody:!0,tableData:e.dialogAgentTableData,pagination:e.dialogPagination,selectionMode:"single",isClear:!1,filters:e.dialogAgentFilters},on:{"update:visibility":function(t){e.showAgentDialog=t},open:e.openedAgent,confirmed:e.handleAgentConfirmed,filterDataChange:e.agentFilterDataChange,pageSizeChange:e.agentPageSizeChange,currentPageChange:e.agentCurrentPageChange}},[i("el-table-column",{attrs:{label:"代理商名称",width:"200px",prop:"name"}}),i("el-table-column",{attrs:{prop:"address",label:"地址"}}),i("el-table-column",{attrs:{prop:"phone",label:"电话"}})],1),i("biz-dialog-selector",{staticClass:"supplierDialog",attrs:{title:"选择关联单据",visibility:e.showRelateDialog,appendToBody:!0,tableData:e.dialogRelateTableData,pagination:e.dialogPagination,selectionMode:"single",isClear:!1,filters:e.dialogRelateFilters},on:{"update:visibility":function(t){e.showRelateDialog=t},open:e.openedRelate,confirmed:e.handleRelateConfirmed,filterDataChange:e.relateFilterDataChange,pageSizeChange:e.relatePageSizeChange,currentPageChange:e.relateCurrentPageChange}},[i("el-table-column",{attrs:{prop:"relateBillSn",label:"编号","min-width":"150"}}),i("el-table-column",{attrs:{label:"商品信息","min-width":"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[i("div",{staticStyle:{width:"100%","margin-right":"30px"}},e._l(t.row.itemDatas,(function(t){return i("div",{key:t.id,staticClass:"product-info",staticStyle:{display:"flex",width:"100%"}},[i("div",{staticClass:"wrapper"},[i("div",{staticClass:"titleClass",staticStyle:{"text-overflow":"ellipsis",overflow:"hidden",width:"250px","white-space":"nowrap"},attrs:{title:t.productName}},[e._v(e._s(t.productName))])]),i("div",{staticClass:"info-bottom"},[i("div",[e._v(" *"+e._s(t.amount))])])])})),0)])]}}])}),i("el-table-column",{attrs:{prop:"relatePartnerName",label:"往来方","min-width":"150"}})],1)],1)},n=[],o=(a("b0c0"),a("a9e3"),a("d3b7"),a("ac1f"),a("5319"),a("5530")),r=a("f36f"),s=a("8330"),l=a("af3f"),c=a("e42c"),d=a("2f62"),u=a("1ab1"),p=a("c596"),m=a("c466"),g=a("2119"),h=a("8b35"),f={stateConverter:function(e){return"0"===e.enabled?"X":"1"===e.enabled?"√":"--"},stateConverterMember:function(e){return"0"===e.enableState?"停用":"1"===e.enableState?"启用":"--"},createDateConverter:function(e){if(e.createDate){e.createDate=e.createDate.replace(/-/g,"/");var t=new Date(e.createDate);return m["a"].dateConverter(t)}return"--"},loginDateConverter:function(e){if(e.lastLoginDate){e.lastLoginDate=e.lastLoginDate.replace(/-/g,"/");var t=new Date(e.lastLoginDate);return m["a"].dateConverter(t)}return"--"},ipConverter:function(e){return e.lastLoginIp?e.lastLoginIp:"--"}},b=function(){return{id:"",businessType:"2",shopId:"",relatePartnerType:"0",relatePartnerId:"",relatePartnerName:"",relateBill:"",relateBillSn:"",remark:"",memo:"",images:[],videos:[]}},v={name:"baseInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},components:{BizGrid:r["a"],BizSaveButton:s["a"],BizDialogSelector:l["a"],ImgUploader:g["a"],BizVideoUpload:h["a"]},data:function(){var e=this,t=function(t,a,i){""===e.form.relatePartnerName?i(new Error("请选择往来方名称")):i()};return{loading:!1,dialogLoading:!1,showSupplierDialog:!1,showAgentDialog:!1,showMemberDialog:!1,showRelateDialog:!1,dialogVisible:!1,picDialogVisible:!1,dialogImageUrl:"",refundsId:"",form:b(),itemDatas:[],operations:[{label:"保存",name:"save",type:"primary",auth:["admin:inport.edit"]}],dialogMemberTableData:[],dialogSupplierTableData:[],dialogAgentTableData:[],dialogRelateTableData:[],dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},dialogMemberFilters:[{type:"input",label:"",placeholder:"请输入会员姓名/电话",name:"searchValue",value:""}],dialogSupplierFilters:[{type:"input",label:"",placeholder:"请输入供应商名称",name:"searchValue",value:""}],dialogAgentFilters:[{type:"input",label:"",placeholder:"请输入代理商名称",name:"searchValue",value:""}],dialogRelateFilters:[{type:"input",label:"",placeholder:"请输入单据编号/商品名称",name:"searchValue",value:""}],rules:{businessType:[{required:!0,message:"请选择业务类型",trigger:"blur"}],relatePartnerType:[{required:!0,trigger:"blur",validator:t}],relateBillSn:[{required:!0,message:"请选择关联单据",trigger:"blur"}]}}},computed:{stateFormatter:function(){switch(this.form.state){case"0":return"未确认";case"1":return"已确认";default:return"--"}}},created:function(){},watch:{itemId:function(e){""!==e?(this.query(),this.$refs.form.clearValidate("relatePartnerType")):this.form=this.getDefaultModel()}},methods:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(d["c"])(["getUser"])),f),{},{operate:function(e){this[e]()},view:function(e){this.dialogImageUrl=e,this.picDialogVisible=!0},showDialog:function(){this.showRelateDialog=!0,this.form.relateBillSn&&this.$refs.form.clearValidate("relateBillSn")},businessTypeChange:function(e){"0"===e?this.form.relatePartnerType="0":"1"===e&&(this.form.relatePartnerType="1"),this.form.relatePartnerName="",this.form.relateBillSn=""},relateTypeChange:function(e){this.form.relatePartnerName=""},initModel:function(e){e?this.form=Object.assign(this.getDefaultModel(),e):this.resetModel()},resetModel:function(){this.form=this.getDefaultModel(),this.$refs.form&&this.$refs.form.resetFields()},query:function(){this.queryDepot()},queryDepot:function(){var e=this;this.loading=!0,u["a"].get(p["g"].invoicing.depotInMgmt.shopDepotIn,{shopId:window.top.SHOP_ID||"",id:this.itemId}).then((function(t){e.loading=!1,e.initModel(t.data)})).catch((function(t){e.loading=!1,console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},getDefaultModel:function(){return b()},getSaveParams:function(){return{id:this.form.id,businessType:this.form.businessType,relatePartnerType:this.form.relatePartnerType,relatePartnerId:this.form.relatePartnerId,relateBill:this.form.relateBill,remark:this.form.remark,memo:this.form.memo,images:this.form.images,videos:this.form.videos,shopId:window.top.SHOP_ID||"",refundsId:this.refundsId||""}},save:function(){var e=this;if(("0"===this.form.businessType||"1"===this.form.businessType)&&!this.form.relateBillSn)return this.$message.warning("请选择关联单据"),!1;this.$refs.form.validate((function(t,a){if(!t)return!1;e.loading=!0,e.form.id?u["a"].put(p["g"].invoicing.depotInMgmt.shopDepotIn,e.getSaveParams()).then((function(t){e.$message.success("保存成功"),e.$emit("operationSuccess"),e.loading=!1})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)})).finally((function(t){e.loading=!1})):u["a"].post(p["g"].invoicing.depotInMgmt.shopDepotIn,e.getSaveParams()).then((function(t){e.$message.success("保存成功"),e.$emit("operationSuccess",t.id),e.$emit("setOrderItems",t.id),e.loading=!1})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)})).finally((function(t){e.loading=!1}))}))},opened:function(){this.dialogMemberTableData=[],this.getMemberList()},openedSupplier:function(){this.dialogSupplierTableData=[],this.getSupplier()},openedAgent:function(){this.dialogAgentTableData=[],this.getAgent()},openedRelate:function(){this.dialogRelateTableData=[],this.getRelateList()},getSupplier:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogSupplierFilters[0].value,shopId:window.top.SHOP_ID||"",cooperationType:"0",state:"1"};u["a"].get(p["g"].invoicing.supplierMgmt.shopSupplierList,t).then((function(t){e.dialogSupplierTableData=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getAgent:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogAgentFilters[0].value,shopId:window.top.SHOP_ID||"",cooperationType:"1",state:""};u["a"].get(p["g"].invoicing.supplierMgmt.shopSupplierList,t).then((function(t){e.dialogAgentTableData=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getMemberList:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogMemberFilters[0].value};c["a"].memberList(t,(function(t){e.dialogLoading=!1,e.dialogMemberTableData=t.content,e.dialogPagination.total=Number(t.total)}),(function(e){console.log(e),console.log("code错误")}))},getRelateList:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,shopId:window.top.SHOP_ID||"",businessType:this.form.businessType,partnerType:this.form.relatePartnerType,partnerId:this.form.relatePartnerId,searchValue:this.dialogRelateFilters[0].value};u["a"].get(p["g"].invoicing.depotInMgmt.relateBill,t).then((function(t){e.dialogRelateTableData=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},dialogFilterDataChange:function(e){this.dialogMemberFilters=e,this.dialogPagination.currentPage=1,this.getMemberList()},dialogPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.getMemberList()},dialogCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.getMemberList()},supplierPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.getSupplier()},supplierCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.getSupplier()},supplierFilterDataChange:function(e){this.dialogSupplierFilters=e,this.dialogPagination.currentPage=1,this.getSupplier()},agentPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.getAgent()},agentCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.getAgent()},agentFilterDataChange:function(e){this.dialogAgentFilters=e,this.dialogPagination.currentPage=1,this.getAgent()},relatePageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.getRelateList()},relateCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.getRelateList()},relateFilterDataChange:function(e){this.dialogRelateFilters=e,this.dialogPagination.currentPage=1,this.getRelateList()},handleMemberConfirmed:function(e,t){this.form.relatePartnerId=t[0].id,this.form.relatePartnerName=t[0].name,this.$refs.form.clearValidate("relatePartnerType")},handleSupplierConfirmed:function(e,t){this.form.relatePartnerName=t[0].name,this.form.relatePartnerId=t[0].id,this.$refs.form.clearValidate("relatePartnerType")},handleAgentConfirmed:function(e,t){this.form.relatePartnerName=t[0].name,this.form.relatePartnerId=t[0].id,this.$refs.form.clearValidate("relatePartnerType")},handleRelateConfirmed:function(e,t){this.form.relateBillSn=t[0].relateBillSn,this.form.relateBill=t[0].relateBill,this.refundsId=t[0].refundsId,this.$refs.form.clearValidate("relateBillSn")}})},y=v,w=(a("c1fc"),a("2877")),C=Object(w["a"])(y,i,n,!1,null,null,null);t["a"]=C.exports},fc46:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"my-evaluate"},[a("div",{staticClass:"evaluate-content"},[e.orderInfo&&e.reviews.length?a("div",e._l(e.orderInfo.orderItems,(function(t,i){return a("div",{key:i,staticClass:"my-evaluate-div"},[a("div",{staticClass:"order-info"},[a("div",{staticClass:"info"},[a("img",{attrs:{src:t.thumbnail?t.thumbnail:e.defaultImg},on:{error:e.errorHandle}}),a("div",{staticClass:"info-right"},[a("span",[e._v(e._s(t.name))]),a("span",[e._v("￥"+e._s(e.getAmount(t)))])])])]),e.editable&&t.product?a("div",{staticClass:"evaluate"},[a("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[a("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px",padding:"0px 30px"}}),a("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),a("el-radio-group",{staticStyle:{height:"10px"},attrs:{horizontal:!0},model:{value:e.reviews[i].score,callback:function(t){e.$set(e.reviews[i],"score",t)},expression:"reviews[index].score"}},e._l(e.options,(function(e,t){return a("el-radio",{key:t,attrs:{label:e}})})),1)],1),a("el-input",{attrs:{type:"textarea",size:"mini",placeholder:"来分享您的使用感受吧...",maxlength:e.maxlength},model:{value:e.reviews[i].content,callback:function(t){e.$set(e.reviews[i],"content",t)},expression:"reviews[index].content"}}),a("img-uploader",{model:{value:e.reviews[i].images,callback:function(t){e.$set(e.reviews[i],"images",t)},expression:"reviews[index].images"}})],1):e._e(),!e.editable&&t.product?a("div",{staticClass:"evaluate-dis"},[a("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[a("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px"}}),a("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),a("span",[e._v(e._s(e.reviews[i].score?e.已reviews[i].score:""))])]),a("div",{staticClass:"eva-content"},[a("p",{staticStyle:{"margin-bottom":"10px","margin-left":"20px"}},[e._v(e._s(e.reviews[i].content?e.reviews[i].content:"很遗憾，您没有留下任何评价。"))]),a("div",{staticClass:"img-group",staticStyle:{"margin-left":"20px"}},e._l(e.reviews[i].images,(function(t,n){return a("div",{key:n,staticClass:"img-eva"},[t?a("img",{attrs:{src:t},on:{click:function(t){return e.handleImagePreview(e.reviews[i].images,n)}}}):e._e()])})),0)])]):e._e()])})),0):e._e(),a("div",{staticClass:"shop-evaluate"},[a("div",{staticClass:"shop-title"},[a("img",{attrs:{src:e.iconShop}}),a("span",{staticStyle:{fontSize:"14px"}},[e._v("店铺评分")])]),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("服务态度")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.serValue,callback:function(t){e.serValue=t},expression:"serValue"}})],1),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("服务速度")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.speedValue,callback:function(t){e.speedValue=t},expression:"speedValue"}})],1),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("专业技能")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.proValue,callback:function(t){e.proValue=t},expression:"proValue"}})],1)])]),e.editable?a("div",{staticClass:"submit"},[a("span",{staticClass:"btn-submit",on:{click:e.submitEvaluate}},[e._v("提交评价")])]):e._e()])},n=[],o=(a("4160"),a("d81d"),a("a434"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("159b"),a("b85c")),r=a("5530"),s=a("2f62"),l=a("1ab1"),c=a("c596"),d=a("624d"),u=a.n(d),p=a("517a"),m=a.n(p),g=a("2119"),h=a("f606"),f=a.n(h),b={name:"my-evaluate",data:function(){return{iconShop:f.a,defaultImg:u.a,defaultFailImg:m.a,selected:"好评",options:["好评","中评","差评"],evaluateValue:"",maxlength:100,serValue:5,speedValue:5,proValue:5,reviews:[],info:null,initialIndex:0}},props:{orderId:{type:String,default:""},editable:{type:Boolean,default:function(){return!0}}},components:{ImgUploader:g["a"]},computed:Object(r["a"])(Object(r["a"])({},Object(s["c"])("Order",["orderInfo"])),Object(s["c"])(["getUser"])),watch:{orderId:function(e,t){this.getParams(),this.getOrderInfo()}},methods:Object(r["a"])(Object(r["a"])({},Object(s["d"])("Order",["updateOrderInfo"])),{},{showToast:function(e){this.$createToast({time:1e3,txt:e,type:"warn"}).show()},images:function(e){var t,a=[],i=Object(o["a"])(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;a.push(n)}}catch(r){i.e(r)}finally{i.f()}return a},handleImagePreview:function(e,t){var a=this;this.initialIndex=t;var i=[];e.map((function(e){i.push(e)}));var n={$props:{imgs:i,initialIndex:"initialIndex",loop:!1},$events:{change:function(e){a.initialIndex=e}}};this.$createImagePreview(Object(r["a"])({},n)).show()},getAmount:function(e){var t=Number(e.price)*Number(e.quantity);return t.toFixed(2)},submitEvaluate:function(){for(var e=this,t={serviceAttitude:this.serValue.toString(),serviceSpeed:this.speedValue.toString(),professional:this.proValue.toString(),methodName:"CreateProductReview",clientType:"2",shopId:this.getUser.shop.id,orderId:this.orderInfo.id,userId:this.getUser.id},a=this.orderInfo.orderItems,i=a.length,n=this.reviews,o=!1,r=0;r<i;r++){if(n[r]&&("好评"===n[r].score?(n[r].score="5",o=!0):"中评"===n[r].score?(n[r].score="3",o=!0):"差评"===n[r].score&&(n[r].score="1",o=!0)),!o&&a[r].product)return void this.$message.warning("请选择商品评分");a[r].product&&(n[r].images=this.images(n[r].images))}a.forEach((function(e,t){if(!e.product)return n.splice(t,1),!1})),o&&(t.reviews=this.reviews),l["a"].post(c["g"].hypermarketMgmt.review,t).then((function(t){e.$message.success("评价成功"),e.$emit("operationSuccess")})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){}))},errorHandle:function(e){e.currentTarget.src=this.defaultFailImg},getOrderInfo:function(e){var t=this;this.open=!1;var a="";a=e||this.orderId;var i={clientType:this.clientType,methodName:"QueryOrderDetail",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:a};l["a"].get(c["g"].hypermarketMgmt.queryOrder,i).then((function(e){console.log("订单信息",e);var i,n,o=e.order.orderItems,r=o.length;for(t.reviews=[],n=0;n<r;n++)i={score:"",content:"",reviewOrderId:e.order.id,images:[]},o[n].product&&(i.productId=o[n].product.id),t.reviews.push(i);t.editable?t.updateOrderInfo(e.order):(t.info=e.order,t.getEvaluationInfo(a))})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))},getParams:function(){this.editable=!0},getEvaluationInfo:function(e){var t=this,a={clientType:this.clientType,methodName:"QueryOrderReview",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:e};l["a"].get(c["g"].hypermarketMgmt.reviews,a).then((function(e){if(console.log(e),t.serValue=parseInt(e.serviceAttitude),t.speedValue=parseInt(e.serviceSpeed),t.proValue=parseInt(e.professional),e.reviews.length!==t.reviews.length){var a={score:"",content:"",images:[]};e.reviews.unshift(a)}t.reviews=e.reviews;for(var i=t.reviews,n=i.length,o=0;o<n;o++)"5"===i[o].score?i[o].score="好评":"3"===i[o].score?i[o].score="中评":"1"===i[o].score&&(i[o].score="差评");t.updateOrderInfo(t.info)})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))}}),created:function(){}},v=b,y=(a("9b2e"),a("2877")),w=Object(y["a"])(v,i,n,!1,null,null,null);t["a"]=w.exports},fc59:function(e,t,a){},fdfa:function(e,t,a){}}]);