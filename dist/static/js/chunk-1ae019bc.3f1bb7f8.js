(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1ae019bc"],{"0c3c":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("biz-grid",{staticClass:"staff-mgmt-role-edit"},[i("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operate},slot:"top"}),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{rules:t.rules,model:t.form,"label-position":"right","inline-message":!0}},[i("div",{staticClass:"block-title"},[t._v("角色基本信息")]),i("div",{staticClass:"form-item-container item-border"},[i("el-form-item",{attrs:{label:"角色类别",prop:"type"}},[i("el-select",{attrs:{placeholder:"请选择角色类别",size:"small"},on:{change:t.typeChange},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},t._l(t.typeList,(function(t){return i("el-option",{key:t.index,attrs:{label:t.name,value:t.type}})})),1)],1),i("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入角色名称",size:"small"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"角色描述",prop:"description"}},[i("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入角色描述"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),i("div",{staticClass:"block-title"},[t._v("角色权限设置")]),i("el-form-item",{staticClass:"authority",attrs:{prop:"authorityIds"}},[i("el-checkbox-group",{staticClass:"item-border",model:{value:t.form.authorityIds,callback:function(e){t.$set(t.form,"authorityIds",e)},expression:"form.authorityIds"}},t._l(t.authorityList,(function(e){return i("div",{key:e.index},[i("div",{staticClass:"platform"},[t._v(" "+t._s(e.name)+" ")]),t._l(e.child,(function(e){return i("div",{key:e.index,staticClass:"auth-group"},[i("label",{staticClass:"auth-category",attrs:{for:"auth"}},[t._v(" "+t._s(e.name)+" ")]),i("div",{staticClass:"checkbox-box"},t._l(e.authorities,(function(e){return i("div",{key:e.id,staticClass:"check-box-line"},[i("el-checkbox",{staticClass:"keep-left",attrs:{label:e.id}},[t._v(" "+t._s(e.name)+" ")]),e.subAuthority?i("div",{staticClass:"sub-auth"},t._l(e.subAuthority,(function(e){return i("el-checkbox",{key:e.index,staticClass:"sub-auth-checkbox",attrs:{label:e.id}},[t._v(" "+t._s(e.name)+" ")])})),1):t._e()],1)})),0)])}))],2)})),0)],1)],1)],1)},s=[],r=(i("a4d3"),i("e01a"),i("d81d"),i("b0c0"),i("f36f")),o=i("8330"),n=i("8bf6"),c={name:"RoleEdit",props:{},data:function(){return{id:this.$route.query.id,rules:{type:[{required:!0,message:"请选择角色类别",trigger:"submit"}],name:[{required:!0,message:"请填写角色名称",trigger:"blur"},{max:20,message:"长度不大于20位",trigger:"blur"}],description:[{max:100,message:"不多于100字",trigger:"blur"}],authorityIds:[{required:!0,message:"您还未选择角色权限",trigger:"submit"}]},form:{type:"",name:"",description:"",authorityIds:[]},typeList:[],authorityList:[],loading:!1,isSave:!1}},computed:{operations:function(){return void 0===this.id||""===this.id?[{label:"保存",name:"save",type:"primary",auth:["admin:role.edit"]},{label:"保存并添加",name:"continue",type:"primary",auth:["admin:role.edit"]},{label:"返回",name:"back",type:"primary"}]:[{label:"保存",name:"save",type:"primary",auth:["admin:role.edit"]},{label:"返回",name:"back",type:"primary"}]}},methods:{operate:function(t){this[t]()},showMessage:function(t,e){this.$message({showClose:!0,message:t,type:e})},refresh:function(){var t=this;if(void 0===this.id||""===this.id){var e={};n["a"].init(e,(function(e){t.$refs.form.resetFields(),t.typeList=e.types,t.authorityList=e.authorityList}),(function(e){t.$message.warning(e.errorMessage)}))}else{var i={id:this.id};n["a"].get(i,(function(e){t.typeList=e.types,t.id=e.role.id,t.form.name=e.role.name,t.form.description=e.role.description,t.form.type=e.role.roleTypeData.type,t.form.authorityIds=[],e.authority.map((function(e){t.form.authorityIds.push(e.id)})),t.authorityList=e.authorityList}),(function(e){t.$message.warning(e.errorMessage)}))}},save:function(){var t=this;this.isSave=!0,this.$refs.form.validate((function(e){if(!e)return t.form.authorityIds.length||t.$message.warning("请选择角色权限"),!1;t.submit()}))},submit:function(){void 0===this.id||""===this.id?this.create():this.update()},create:function(){var t=this,e={name:this.form.name,type:this.form.type,description:this.form.description,authorityIds:this.form.authorityIds};n["a"].create(e,(function(e){!0===t.isSave?(t.$message.success("操作成功"),t.back()):(t.$message.success("操作成功"),t.refresh()),t.isSave=!1}),(function(e){t.$message.warning(e.errorMessage)}))},update:function(){var t=this,e={id:this.id,name:this.form.name,type:this.form.type,description:this.form.description,authorityIds:this.form.authorityIds};n["a"].update(e,(function(e){!0===t.isSave?(t.$message.success("操作成功"),t.back()):(t.$message.success("操作成功"),t.refresh()),t.isSave=!1}),(function(e){t.$message.warning(e.errorMessage)}))},continue:function(){var t=this;this.isSave=!1,this.$refs.form.validate((function(e){if(!e)return t.form.authorityIds.length||t.$message.warning("请选择角色权限"),!1;t.submit()}))},getAuthority:function(t){var e=this,i={roleType:t};n["a"].getAuthority(i,(function(t){e.form.authorityIds=[],t.authority.map((function(t){e.form.authorityIds.push(t.id)})),e.authorityList=t.authorityList}),(function(t){e.$message.warning(t.errorMessage)}))},back:function(){this.$router.go(-1)},typeChange:function(t){this.getAuthority(t)}},mounted:function(){this.refresh()},watch:{},components:{BizSaveButton:o["a"],BizGrid:r["a"]}},u=c,l=(i("a2b4"),i("2877")),m=Object(l["a"])(u,a,s,!1,null,null,null);e["default"]=m.exports},2497:function(t,e,i){"use strict";var a=i("4360"),s=i("a18c");e["a"]=function(t,e){return function(i){var r=i.data;"100"===r.resultCode?t(r):"709"===r.resultCode?(a["a"].commit("updateUser",{shop:{}}),console.log("未登录: ",a["a"].getters.currentUser),s["a"].push("/login")):e(r)}}},"8bf6":function(t,e,i){"use strict";var a=i("2497"),s=i("bc3a"),r=i.n(s),o=i("c596");e["a"]={getList:function(t,e,i){r.a.get(o["g"].staffMgmt.getRoleList,{params:t}).then(Object(a["a"])(e,i)).catch((function(t){console.error(t)}))},init:function(t,e,i){r.a.get(o["g"].staffMgmt.roleInit,{params:t}).then(Object(a["a"])(e,i)).catch((function(t){console.error(t)}))},delete:function(t,e,i){r.a.post(o["g"].staffMgmt.roleDelete,t).then(Object(a["a"])(e,i)).catch((function(t){console.error(t)}))},get:function(t,e,i){r.a.get(o["g"].staffMgmt.queryAuth,{params:t}).then(Object(a["a"])(e,i)).catch((function(t){console.error(t)}))},create:function(t,e,i){r.a.post(o["g"].staffMgmt.roleCreate,t).then(Object(a["a"])(e,i)).catch((function(t){console.error(t)}))},update:function(t,e,i){r.a.post(o["g"].staffMgmt.updateAuth,t).then(Object(a["a"])(e,i)).catch((function(t){console.error(t)}))},getAuthority:function(t,e,i){r.a.get(o["g"].staffMgmt.roleGetAuth,{params:t}).then(Object(a["a"])(e,i)).catch((function(t){console.error(t)}))}}},a2b4:function(t,e,i){"use strict";var a=i("c28b"),s=i.n(a);s.a},c28b:function(t,e,i){}}]);