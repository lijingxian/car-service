(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ab9bc078"],{"0943":function(e,t,a){"use strict";var n=a("1fac"),i=a.n(n);i.a},"15a0":function(e,t,a){"use strict";var n=a("c0cb"),i=a.n(n);i.a},"1fac":function(e,t,a){},"225d":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:e.tableShow,expression:"tableShow"}],ref:"template"},[e._t("default",[a("span",[e._v("编写你自己的打印区域组件，然后slot插入到vue-easy-print")])],{getChineseNumber:e.getChineseNumber})],2),e.buttonShow?a("button",{class:e.buttonClass,attrs:{type:"button"},on:{click:e.print}},[a("span",[e._v("开始打印")])]):e._e()])},i=[],o=(a("a9e3"),a("d3b7"),a("ac1f"),a("25f0"),a("466d"),a("5319"),a("1276"),{name:"vue-easy-print",components:{},props:{spaceRow:{type:Boolean,default:!1},tableData:{type:Object,default:function(){}},tableShow:{type:Boolean,default:!1},buttonShow:{type:Boolean,default:!1},buttonClass:{type:String,default:"el-button el-button--default"},onePageRow:{type:Number,default:5},beforeCopy:Function,beforePrint:Function},data:function(){return{}},mounted:function(){this.init()},methods:{init:function(){var e=this,t=document.getElementById("easyPrintIframe");t?this.getStyle():(t=document.createElement("iframe"),t.id="easyPrintIframe",t.style.position="fixed",t.style.width="0",t.style.height="0",t.style.top="-100px",window.location.hostname!==document.domain&&navigator.userAgent.match(/msie/i)&&(t.src='javascript:document.write("<head><script>document.domain=\\"'+document.domain+'\\";<\/script></head><body></body>")'),t.onload=function(){e.getStyle()},document.body.appendChild(t))},print:function(){"function"===typeof this.beforeCopy&&this.beforeCopy();var e=document.getElementById("easyPrintIframe");e.contentDocument.body.innerHTML=this.$refs.template.innerHTML,"function"===typeof this.beforePrint&&this.beforePrint(),setTimeout((function(){e.contentWindow.print()}),100)},getStyle:function(){for(var e=document.getElementById("easyPrintIframe"),t="",a=document.querySelectorAll("style"),n=0;n<a.length;n++)t+=a[n].outerHTML;e.contentDocument.head.innerHTML=t;for(var i=document.querySelectorAll("link"),o=0;o<i.length;o++){var r=document.createElement("link");r.setAttribute("rel","stylesheet"),i[o].type?r.setAttribute("type",i[o].type):r.setAttribute("type","text/css"),r.setAttribute("href",i[o].href),r.setAttribute("media","all"),e.contentDocument.head.appendChild(r)}},getChineseNumber:function(e){var t,a,n,i,o,r,l,s,c,u,d,p,f,h,g=99999999999.99,m="零",b="壹",v="贰",y="叁",w="肆",C="伍",D="陆",S="柒",_="捌",T="玖",I="拾",x="佰",N="仟",k="万",M="亿",$="",R="元",z="角",F="分",P="整";if(void 0===e)return"";if(e=e.toString(),""==e)return"";if(null!=e.match(/[^,.\d]/))return"";if(null==e.match(/^((\d{1,3}(,\d{3})*(.((\d{3},)*\d{1,3}))?)|(\d+(.\d+)?))$/))return"";if(e=e.replace(/,/g,""),e=e.replace(/^0+/,""),Number(e)>g)return alert("您输入的金额太大，请重新输入!"),"";if(i=e.split("."),i.length>1?(t=i[0],a=i[1],a=a.substr(0,2)):(t=i[0],a=""),o=new Array(m,b,v,y,w,C,D,S,_,T),r=new Array("",I,x,N),l=new Array("",k,M),s=new Array(z,F),n="",Number(t)>0){for(c=0,u=0;u<t.length;u++)d=t.length-u-1,p=t.substr(u,1),f=d/4,h=d%4,"0"==p?c++:(c>0&&(n+=o[0]),c=0,n+=o[Number(p)]+r[h]),0==h&&c<4&&(n+=l[f]);n+=R}if(""!=a)for(u=0;u<a.length;u++)p=a.substr(u,1),"0"!=p&&(n+=o[Number(p)]+s[u]);return""==n&&(n=m+R),""==a&&(n+=P),n=$+n,n}}}),r=o,l=a("2877"),s=Object(l["a"])(r,n,i,!1,null,null,null),c=s.exports;t["a"]=c},"443b":function(e,t,a){"use strict";a("4de4");var n=a("c596"),i=a("1ab1"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":"",visible:e.visible,title:"自定义列","custom-class":"biz-columns",width:"500px"},on:{close:e.onClose}},[a("div",{staticClass:"columns-wrap"},[a("biz-flex-table",{ref:"table",attrs:{checkable:!1,tableData:e.tableData},on:{"selection-change":e.selectionChangeHandler}},[a("el-table-column",{attrs:{type:"selection",width:"50",selectable:e.getSelectable}}),a("el-table-column",{attrs:{label:"信息",prop:"name"}}),a("el-table-column",{attrs:{prop:"tag",label:"排序"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.$index;return[a("el-button",{attrs:{icon:"el-icon-sort-up",type:"text",disabled:0===n},on:{click:function(t){return e.onUp(n)}}}),a("el-button",{attrs:{icon:"el-icon-sort-down",type:"text",disabled:n===e.tableData.length-1},on:{click:function(t){return e.onBottom(n)}}})]}}])})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.onClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确 定")])],1)])},r=[],l=(a("7db0"),a("a434"),a("b85c")),s=a("04d3"),c={name:"biz-columns",components:{BizFlexTable:s["c"]},props:{visible:Boolean,tableId:String},data:function(){return{id:"",tableName:"",selections:[],tableData:[]}},computed:{},watch:{visible:function(e){e?this.makeRowDisplayable():this.saveSelection()},tableId:function(){this.getTableColumns()}},mounted:function(){this.getTableColumns()},methods:{getTableColumns:function(){var e=this;i["a"].get(n["g"].user.columns,{tableId:this.tableId}).then((function(t){e.tableData=t.data.columnDatas,e.id=t.data.id,e.tableName=t.data.tableName}))},getSelectable:function(e){return e.isEditable},selectionChangeHandler:function(e){this.selections=e},saveSelection:function(){var e,t=this,a=Object(l["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var n=e.value;n.displayable=!1}}catch(s){a.e(s)}finally{a.f()}var i,o=Object(l["a"])(this.selections);try{var r=function(){var e=i.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(o.s();!(i=o.n()).done;)r()}catch(s){o.e(s)}finally{o.f()}},onUp:function(e){this.tableData[e]=this.tableData.splice(e-1,1,this.tableData[e])[0]},onBottom:function(e){this.tableData[e]=this.tableData.splice(e+1,1,this.tableData[e])[0]},onClose:function(){this.$emit("update:visible",!1)},update:function(){var e,t=this,a=Object(l["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var o=e.value;o.displayable=!1}}catch(d){a.e(d)}finally{a.f()}var r,s=Object(l["a"])(this.selections);try{var c=function(){var e=r.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(s.s();!(r=s.n()).done;)c()}catch(d){s.e(d)}finally{s.f()}var u={columnDatas:this.tableData,id:this.id,tableId:this.tableId,tableName:this.tableName};console.log(u),i["a"].put(n["g"].user.columns,u).then((function(e){t.$emit("update"),t.$emit("update:visible",!1)}))},makeRowDisplayable:function(){var e=this;setTimeout((function(){var t,a=Object(l["a"])(e.tableData);try{for(a.s();!(t=a.n()).done;){var n=t.value;e.$refs.table.$refs.table.toggleRowSelection(n,n.displayable)}}catch(i){a.e(i)}finally{a.f()}}),20)}}},u=c,d=(a("ec6b"),a("2877")),p=Object(d["a"])(u,o,r,!1,null,null,null),f=p.exports,h=f;t["a"]={components:{BizColumnOperation:s["a"],BizColumns:h},data:function(){return{columnsSettingVisible:!1,columns:[]}},created:function(){this.getTableId(),this.getColumns()},methods:{onCustomColumns:function(){this.columnsSettingVisible=!0},getColumns:function(){var e=this;console.log(12),i["a"].get(n["A"].columns,{tableId:this.tableId}).then((function(t){e.columns=[],setTimeout((function(){e.columns=t.data.columnDatas.filter((function(e){return e.displayable})),e.$refs.table&&setTimeout((function(){e.$refs.table.doLayout()}),50)}),20)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getTableId:function(){}}}},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,a){var n=a("1d80"),i=a("5899"),o="["+i+"]",r=RegExp("^"+o+o+"*"),l=RegExp(o+o+"*$"),s=function(e){return function(t){var a=String(n(t));return 1&e&&(a=a.replace(r,"")),2&e&&(a=a.replace(l,"")),a}};e.exports={start:s(1),end:s(2),trim:s(3)}},"5b8e":function(e,t,a){"use strict";var n=a("9678"),i=a.n(n);i.a},"697f":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:e.title,visible:e.dialogVisible,"append-to-body":e.appendToBody},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close,open:e.open}},[e._t("top"),a("biz-flex-table",{ref:"table",attrs:{showTable:e.showTable,operations:e.operations,filters:e.filters,tags:e.tags,rowKeys:e.rowKeys,pagination:e.pagination,tableData:e.tableData,rowClassName:e.rowClassName,loading:e.loading,memberIds:e.memberIds,checkable:e.checkable,isDepotOutNew:e.isDepotOutNew,checkedTable:e.checkedTable},on:{operate:e.operate,"row-click":e.rowClick,"filter-data-change":e.filterDataChange,"select-all":e.handleSelectAll,select:e.handleSelectionChange,"size-change":e.pageSizeChange,"current-change":e.currentPageChange,"cascader-change":e.cascaderChange,"active-item-change":e.activeItemChange,"sort-change":e.handleSortChange}},[e._t("default")],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isClear?a("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v("清除")]):e._e(),a("el-button",{attrs:{size:"small"},on:{click:e.close}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmed}},[e._v("确定")])],1)],2)},i=[],o=(a("99af"),a("4160"),a("c975"),a("a434"),a("a9e3"),a("159b"),a("04d3")),r={name:"BizDialogSelector",components:{BizFlexTable:o["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},max:{type:Number,default:0},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},isClear:{default:!0,type:Boolean},rowClassName:{type:Function,default:function(){return null}},selectionKeys:{type:Array,default:function(){return[]}},memberIds:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},isDepotOut:{type:Boolean,default:function(){return!1}},checkTable:{type:Array,default:function(){return[]}},showTable:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],isDepotOutNew:!1,checkedTable:[],innerSelection:[]}},methods:{rowKeys:function(e){return e.id},generateSelectionKeys:function(e,t){if(e.indexOf(t)>=0)this.innerSelectionKeys.push(t[this.keyField]),this.innerSelection.push(t);else{var a=this.innerSelectionKeys.indexOf(t[this.keyField]);this.innerSelectionKeys.splice(a,1),this.innerSelection.splice(a,1)}},open:function(e){this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(e){this.innerSelectionKeys=[],this.innerSelection=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){if(this.innerSelectionKeys.length>0||!this.showTable){if(!this.showTable&&!/(http|https):\/\/([\w.]+\/?)\S*/.test(this.filters[2].value))return void this.$message.warning("必须以http,https开头,且需符合URL规范,检查格式是否正确");this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1}else this.$message("请选择一项")},clear:function(){var e=this;this.tableData.forEach((function(t){e.$refs.table.toggleRowSelection(t,!1)})),this.innerSelectionKeys=[],this.innerSelection=[]},updateSelection:function(){var e=this;this.$refs&&this.$refs.table&&this.tableData.forEach((function(t){e.innerSelectionKeys.indexOf(t[e.keyField])>=0?(e.$refs.table.toggleRowSelection(t,!0),"single"===e.selectionMode&&(e.$refs.table.$refs.table.setCurrentRow(t),e.innerSelection=[t])):e.$refs.table.toggleRowSelection(t,!1)}))},operate:function(e){this.$emit("operate",e)},filterDataChange:function(e){this.$emit("filterDataChange",e)},handleSelectAll:function(e){var t=this;0===e.length?this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a>=0&&t.innerSelectionKeys.splice(a,1)})):this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a<0&&t.innerSelectionKeys.push(e[t.keyField])})),this.$emit("selectionChange",e)},handleSelectionChange:function(e,t){this.generateSelectionKeys(e,t),this.$emit("selectionChange",e)},pageSizeChange:function(e){this.$emit("pageSizeChange",e)},currentPageChange:function(e){this.$emit("currentPageChange",e)},cascaderChange:function(e){this.$emit("cascaderChange",e)},activeItemChange:function(e){this.$emit("active-item-change",e)},handleSortChange:function(e){this.$emit("sort-change",e)},rowClick:function(e,t,a){"single"===this.selectionMode&&(this.innerSelectionKeys=[e[this.keyField]],this.innerSelection=[e])}},watch:{visibility:function(e,t){this.dialogVisible=e,this.isDepotOutNew=this.isDepotOut,this.checkedTable=this.checkTable}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){},updated:function(){this.updateSelection()}},l=r,s=(a("0943"),a("2877")),c=Object(s["a"])(l,n,i,!1,null,null,null);t["a"]=c.exports},"6a14":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"invoice-mgmt"},[a("div",{staticClass:"toggle-btn",on:{click:e.isShow}},[e._v(" "+e._s(e.toggleRecommendTxt)+" "),a("div",{staticClass:"iconfont biz-icon-i-web-zd1",class:{"rotate-180":e.showRecommend}})]),a("biz-flex-table",{ref:"table",staticClass:"invoice-mgmt-tabel",attrs:{operations:e.operations,filters:e.filters,tableData:e.tableData,pagination:e.pagination},on:{operate:e.operate,"filter-data-change":e.filterDataChange,"selection-change":e.handleSelectionChange,"row-click":e.rowClick,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{label:"订单","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" 发票号码："+e._s(t.row.invoiceCode)+" ")]),a("div",{staticClass:"overflow"},[e._v(" 发票代码："+e._s(t.row.invoiceNum)+" ")]),a("div",{staticClass:"overflow"},[e._v(" 开票日期："+e._s(t.row.invoiceDate)+" ")]),a("div",[e._v(" 状态："+e._s(e.getStatus(t.row))+" ")])])]}}])}),a("el-table-column",{attrs:{label:"分类","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" 类别："+e._s(e.getCategory(t.row))+" ")]),a("div",{staticClass:"overflow"},[e._v(" 发票类型："+e._s(e.getType(t.row))+" ")])])]}}])}),a("el-table-column",{attrs:{label:"购销方","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" 购买方："+e._s(t.row.buyerName)+" ")]),a("div",{staticClass:"overflow"},[e._v(" 销售方："+e._s(t.row.sellerName)+" ")])])]}}])}),a("el-table-column",{attrs:{label:"金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" 不含税："+e._s(t.row.price)+" ")]),a("div",{staticClass:"overflow"},[e._v(" 税额："+e._s(t.row.tax)+" ")]),a("div",{staticClass:"overflow"},[e._v(" 含税："+e._s(t.row.priceWithTax)+" ")])])]}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("biz-column-operation",{attrs:{row:t.row}},["0"===t.row.state?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.statusChange(t.row,"3")}}},[e._v("确认")]):e._e(),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.deleteApply(a,t.row)}}},[e._v("删除")]),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.printApply(t.row)}}},[e._v("凭证")])],1)]}}])})],1),a("biz-popup-tabs",{attrs:{open:e.openAdd},on:{close:function(t){e.openAdd=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"addinfo"}},[a("base-info",{ref:"step1Info",attrs:{backForm:e.backForm,itemId:e.itemId},on:{operationSuccess:e.operationSuccess}})],1)],1),a("el-dialog",{attrs:{visible:e.dialogTableVisible,center:"",width:"800px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"left"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.print}},[e._v("打印")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.exportInvoice}},[e._v("导出")])],1)])],1),a("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[e._v(e._s(e.title))])]),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"center"}},[e._v("打印日期："+e._s(e.formatDate((new Date).getTime())))])])],1),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("发票代码："+e._s(e.form.invoiceCode))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("发票号码："+e._s(e.form.invoiceNum))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("发票类型："+e._s(e.form.type))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("发票类别："+e._s(e.form.category))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("购买方："+e._s(e.form.buyerName))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("销售方："+e._s(e.form.sellerName))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("开票日期："+e._s(e.form.invoiceDate))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("创建者："+e._s(e.form.creatorName))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("状态："+e._s(e.form.state))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("创建时间："+e._s(e.form.createDate))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("备注："+e._s(e.form.remarks))])])],1),a("el-table",{staticClass:"table-class",attrs:{data:e.gridData,"show-summary":"",size:"small"}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),a("el-table-column",{attrs:{label:"订单编号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.orderSn))]}}])}),a("el-table-column",{attrs:{property:"name",label:"商品名称","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.name))]}}])}),a("el-table-column",{attrs:{property:"product.barCode",label:"条码"}}),a("el-table-column",{attrs:{property:"quantity",label:"数量"}}),a("el-table-column",{attrs:{property:"price",label:"不含税单价"}}),a("el-table-column",{attrs:{property:"",label:"不含税金额"}}),a("el-table-column",{attrs:{property:"",label:"税率"}}),a("el-table-column",{attrs:{property:"tax",label:"税额"}}),a("el-table-column",{attrs:{property:"priceWithTax",label:"含税单价"}}),a("el-table-column",{attrs:{property:"",label:"含税金额"}})],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("客户签字：")])])],1)],1)])],1)],1)},i=[],o=(a("4160"),a("caad"),a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("ac1f"),a("2532"),a("3ca3"),a("466d"),a("1276"),a("159b"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),r=a("5530"),l=a("7132"),s=a("04d3"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"invoice-mgmt-base-info"},[a("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"基本信息",name:"1"}},[a("biz-save-button",{attrs:{operations:e.operations},on:{operate:e.operate}}),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.form,inline:!0,"label-width":"125px",size:"small",disabled:!e.isEdit,"inline-message":!0}},[a("el-form-item",{attrs:{label:"发票代码",prop:"invoiceCode"}},[a("el-input",{model:{value:e.form.invoiceCode,callback:function(t){e.$set(e.form,"invoiceCode",t)},expression:"form.invoiceCode"}})],1),a("el-form-item",{attrs:{label:"发票号码",prop:"invoiceNum"}},[a("el-input",{model:{value:e.form.invoiceNum,callback:function(t){e.$set(e.form,"invoiceNum",t)},expression:"form.invoiceNum"}})],1),a("el-form-item",{attrs:{label:"发票类型",prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择发票类型"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.conditionData.invoiceTypeList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"发票类别",prop:"category"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择发票类别"},on:{change:e.typeChange},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}},e._l(e.conditionData.invoiceRecordCategoryList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),"1"===e.form.category?a("el-form-item",{attrs:{label:"购买方类型",prop:"buyer"}},[a("el-select",{attrs:{placeholder:"请选择购买方类型"},on:{change:e.buyerTypeChange},model:{value:e.form.buyerType,callback:function(t){e.$set(e.form,"buyerType",t)},expression:"form.buyerType"}},[a("el-option",{attrs:{label:"会员",value:"1"}}),a("el-option",{attrs:{label:"代理商",value:"2"}})],1)],1):e._e(),"1"===e.form.category?a("el-form-item",{attrs:{label:"购买方",prop:"buyer"}},[a("el-input",{attrs:{value:e.form.buyerName},on:{focus:e.buyerFocus}})],1):e._e(),"0"===e.form.category?a("el-form-item",{attrs:{label:"购买方",prop:"buyer"}},[a("el-input",{attrs:{value:e.getUser.shop.name,disabled:""}})],1):e._e(),"0"===e.form.category?a("el-form-item",{attrs:{label:"销售方",prop:"seller"}},[a("el-select",{attrs:{placeholder:"请选择销售方",filterable:""},model:{value:e.form.seller,callback:function(t){e.$set(e.form,"seller",t)},expression:"form.seller"}},e._l(e.sellerList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"1"===e.form.category?a("el-form-item",{attrs:{label:"销售方",prop:"seller"}},[a("el-input",{attrs:{value:e.getUser.shop.name,disabled:""}})],1):e._e(),a("el-form-item",{attrs:{label:"开票日期",prop:"invoiceDate"}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期"},model:{value:e.form.invoiceDate,callback:function(t){e.$set(e.form,"invoiceDate",t)},expression:"form.invoiceDate"}})],1),a("el-form-item",{attrs:{label:"创建者",prop:"creator"}},[a("el-input",{attrs:{placeholder:"",value:e.getUser.shop.name,disabled:!0}})],1),a("el-form-item",{attrs:{label:"状态",prop:"state"}},[a("el-input",{attrs:{placeholder:"",value:e.getStatus(e.form.state),disabled:!0}})],1),a("el-form-item",{attrs:{label:"创建时间",prop:"createDate"}},[a("el-input",{attrs:{placeholder:"",disabled:!0},model:{value:e.form.createDate,callback:function(t){e.$set(e.form,"createDate",t)},expression:"form.createDate"}})],1),a("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[a("el-input",{attrs:{type:"textarea",placeholder:""},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],1)],1),e.form.id?a("el-collapse-item",{attrs:{name:"2",title:"明细信息"}},[a("biz-save-button",{attrs:{operations:e.operationsDetail},on:{operate:e.operate}}),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"450",border:"",size:"small"}},[a("el-table-column",{attrs:{prop:"orderSn",label:"订单编号","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" "+e._s(t.row.orderSn)+" ")])])]}}],null,!1,1617011269)}),a("el-table-column",{attrs:{prop:"name",label:"商品","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" "+e._s(t.row.name)+" ")]),a("div",{staticClass:"overflow"},[e._v(" "+e._s(t.row.product.barCode)+" ")])])]}}],null,!1,1035176247)}),a("el-table-column",{attrs:{prop:"amount",label:"数量","min-width":"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{attrs:{min:0,size:"mini",max:Number(t.row.totalQuantity)},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})]}}],null,!1,41400197)}),a("el-table-column",{attrs:{prop:"price",label:"单价","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" 不含税单价："+e._s(t.row.price)+" ")]),a("div",{staticClass:"overflow"},[e._v(" 含税单价："+e._s(t.row.priceWithTax)+" ")])])]}}],null,!1,3439152651)}),a("el-table-column",{attrs:{prop:"taxRate",label:"税率","min-width":"50px"}}),a("el-table-column",{attrs:{prop:"",label:"金额","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" 不含税金额："+e._s(t.row.quantity?t.row.quantity*t.row.price:"")+" ")]),a("div",{staticClass:"overflow"},[e._v(" 税额："+e._s(t.row.tax)+" ")]),a("div",{staticClass:"overflow"},[e._v(" 含税金额："+e._s(t.row.quantity?t.row.quantity*t.row.priceWithTax:"")+" ")])])]}}],null,!1,1374842736)}),a("el-table-column",{attrs:{prop:"",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteHandeler(t.row)}}},[e._v("删除")])],1)]}}],null,!1,3101881529)})],1)],1):e._e()],1),a("biz-dialog-selector",{attrs:{title:"选择购买方",visibility:e.showDialogM,appendToBody:!0,tableData:e.buyerList,pagination:e.dialogMemberPagination,selectionMode:"single",filters:e.dialogFilters},on:{"update:visibility":function(t){e.showDialogM=t},confirmed:e.handleConfirmed,filterDataChange:e.dialogMemberFilterDataChange,pageSizeChange:e.dialogMemberPageSizeChange,currentPageChange:e.dialogMemberCurrentPageChange}},[a("el-table-column",{attrs:{prop:"name",label:"用户名"}}),a("el-table-column",{attrs:{prop:"mobile",label:"手机号"}}),a("el-table-column",{attrs:{prop:"createDate",label:"创建日期"}})],1),a("biz-dialog-selector",{attrs:{title:"选择购买方",visibility:e.showDialogD,appendToBody:!0,tableData:e.buyerList,pagination:e.dialogMemberPagination,selectionMode:"single",filters:e.dialogFilters},on:{"update:visibility":function(t){e.showDialogD=t},confirmed:e.handleConfirmed,filterDataChange:e.dialogMemberFilterDataChange,pageSizeChange:e.dialogMemberPageSizeChange,currentPageChange:e.dialogMemberCurrentPageChange}},[a("el-table-column",{attrs:{label:"门店名称",prop:"name"}}),a("el-table-column",{attrs:{label:"地址",prop:"address"}}),a("el-table-column",{attrs:{label:"电话",prop:"phone"}})],1),a("biz-dialog-selector",{staticClass:"invoiceDialog-class",attrs:{title:"添加明细",visibility:e.showInfoDialog,appendToBody:!0,loading:e.dialogLoading,tableData:e.dialogInfoTableData,pagination:e.dialogPagination,selectionMode:"multi",isClear:!1,filters:e.dialogInfoFilters},on:{"update:visibility":function(t){e.showInfoDialog=t},selectionChange:e.selectionChange,confirmed:e.handleInfoConfirmed,open:e.opened,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange}},[a("div",{attrs:{slot:"top"},slot:"top"},[a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("span",[e._v("已选订单："+e._s(e.orderNum))]),a("span",[e._v("已选明细："+e._s(e.infoNum))]),a("span",[e._v("开票数量："+e._s(e.invoiceNum))]),a("span",[e._v("不含税金额："+e._s(e.amount))]),a("span",[e._v("税额：")]),a("span",[e._v("含税金额：")])])]),a("el-table-column",{attrs:{label:"订单编号",prop:"orderSn"}}),a("el-table-column",{attrs:{label:"商品名称",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:"条码",prop:"product.barCode"}}),a("el-table-column",{attrs:{label:"数量",prop:"totalQuantity"}}),a("el-table-column",{attrs:{label:"已开票数量",prop:"invoicedQuantity"}}),a("el-table-column",{attrs:{label:"本次开票数量",prop:"sn",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{attrs:{min:0,size:"mini",max:Number(t.row.totalQuantity)},on:{change:e.quantityChange},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})]}}])}),a("el-table-column",{attrs:{label:"不含税单价",prop:"price"}}),a("el-table-column",{attrs:{label:"不含税金额",prop:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.quantity?t.row.quantity*t.row.price:""))])]}}])}),a("el-table-column",{attrs:{label:"税率",prop:"taxRate"}}),a("el-table-column",{attrs:{label:"税额",prop:"tax"}}),a("el-table-column",{attrs:{label:"含税单价",prop:"priceWithTax"}}),a("el-table-column",{attrs:{label:"含税金额",prop:"subTotalWithTax"}})],1)],1)},u=[],d=(a("99af"),a("7db0"),a("c975"),a("a434"),a("5319"),a("f36f")),p=a("8330"),f=a("af3f"),h=a("1ab1"),g=a("c466"),m=a("2f62"),b={stateConverter:function(e){return"0"===e.enableState?"停用":"1"===e.enableState?"启用":"--"},stateSupplierConverter:function(e){return"0"===e.enabled?"X":"1"===e.enabled?"√":"--"},createDateConverter:function(e){if(e.createDate){e.createDate=e.createDate.replace(/-/g,"/");var t=new Date(e.createDate);return g["a"].dateConverter(t)}return"--"},loginDateConverter:function(e){if(e.lastLoginDate){e.lastLoginDate=e.lastLoginDate.replace(/-/g,"/");var t=new Date(e.lastLoginDate);return g["a"].dateConverter(t)}return"--"},ipConverter:function(e){return e.lastLoginIp?e.lastLoginIp:"--"}},v={name:"ReceiptMgmtBaseInfo",props:{itemId:{type:Object},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){var e=this,t=function(t,a,n){""===e.form.amount&&n(new Error("请输入有效的付款金额")),Number(e.form.amount)>=0?n():Number(e.form.amount)<0?n(new Error("付款金额不能为负数")):n(new Error("付款金额必须为数字值"))},a=function(t,a,n){""===e.form.relateUnit.id?n(new Error("请选择往来方")):n()},n=function(t,a,n){""===e.form.relateBill.sn?n(new Error("请选择关联单据")):n()},i=function(t,a,n){""===e.form.paymentType.id?n(new Error("请选择付款方式")):n()};return{loading:!1,operations:[{label:"保存",name:"save",type:"primary"}],operationsDetail:[{label:"添加",name:"add",type:"primary"},{label:"保存",name:"saveDetail",type:"primary"}],rules:{type:[{required:!0,message:"请选择业务类型",trigger:["blur","change"]}],relateUnitType:[{required:!0,trigger:"blur",validator:a}],relateBill:[{required:!0,trigger:"blur",validator:n}],amount:[{required:!0,trigger:"blur",validator:t}],paymentType:[{required:!0,trigger:"blur",validator:i}],relateUnitBank:[{required:!0,trigger:"blur",message:"请选择往来方银行"}],relateUnitAccount:[{required:!0,trigger:"blur",message:"请输入往来方账号"}]},form:this.resetForm(),showSupplierDialog:!1,showInfoDialog:!1,dialogLoading:!0,showDialogD:!1,showDialogM:!1,activeNames:["1"],orderNum:"",infoNum:"",amount:"",invoiceNum:"",dialogInfoTableData:[],sellerList:[],buyerList:[],tableData:[],dialogMemberPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},isCreated:!1,dialogFilters:[{type:"input",label:"",placeholder:"请输入用户名/手机号",name:"searchValue",value:""}],dialogInfoFilters:[{type:"input",label:"",placeholder:"请输入订单编号/商品名称/条码",name:"searchValue",value:""}],paymentMethodId:"",conditionData:{},selections:[],userId:""}},components:{BizGrid:d["a"],BizSaveButton:p["a"],BizDialogSelector:f["a"]},computed:Object(r["a"])(Object(r["a"])({},Object(m["c"])(["getUser"])),{},{stateFormatter:function(){switch(this.form.state){case"0":return"已创建";case"1":return"已提交";default:return"--"}}}),created:function(){this.getConditionData(),this.querySeller()},methods:Object(r["a"])(Object(r["a"])({},b),{},{operate:function(e){this[e]()},quantityChange:function(){var e=this;console.log(1),this.amount=0,this.selections.map((function(t){e.amount=Number(t.price*(t.quantity?t.quantity:0))+Number(e.amount)}))},handleConfirmed:function(e,t){this.form.buyer=t[0].id,this.form.buyerName=t[0].name},buyerFocus:function(){"1"===this.form.buyerType?(this.showDialogD=!1,this.showDialogM=!0,this.dialogFilters[0].placeholder="请输入用户名/手机号"):(this.showDialogM=!1,this.showDialogD=!0,this.dialogFilters[0].placeholder="请输入门店名称")},buyerTypeChange:function(){var e=this;if("1"===this.form.buyerType){var t={pageSize:this.dialogMemberPagination.pageSize,pageNumber:this.dialogMemberPagination.currentPage,searchValue:this.dialogFilters[0].value,userSource:"1213"};h["a"].get("/admin/member/members.jhtml",t).then((function(t){e.loading=!1,e.buyerList=t.content,e.dialogMemberPagination.total=Number(t.total)})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))}else{var a={pageSize:this.dialogMemberPagination.pageSize,pageNumber:this.dialogMemberPagination.currentPage,searchValue:this.dialogFilters[0].value,cooperationType:"1"};h["a"].get("admin/cooperationInfo/cooperationInfo/list.jhtml",a).then((function(t){e.loading=!1,e.buyerList=t.dataList,e.dialogMemberPagination.total=Number(t.total)})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))}},deleteHandeler:function(e){var t=this,a=[];a.push(e.id),this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,h["a"].delete("/admin/invoicing/invoiceRecord/invoiceRecordItem.jhtml",{ids:a}).then((function(a){t.$message.success("删除成功"),t.tableData.splice(t.tableData.indexOf(e),1)})).catch((function(e){console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))}))},resetForm:function(){return{id:"",invoiceCode:"",invoiceNum:"",type:"1",category:"0",buyerType:"",relateUnitBank:"1",buyer:"",buyerName:"",state:"0",sellerType:"0",seller:"",invoiceDate:"",remarks:""}},clear:function(){this.form=this.resetForm(),this.listExistCard=[],this.$refs.form.resetFields()},typeChange:function(){this.form.buyerType="",this.form.seller="",this.form.buyerName="",this.querySeller()},querySeller:function(){var e=this;this.loading=!0;var t={cooperationType:"0",pageSize:20,pageNumber:1,searchValue:this.dialogFilters[0].value};h["a"].get("/admin/cooperationInfo/cooperationInfos.jhtml",t).then((function(t){e.loading=!1,e.sellerList=t.dataList})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},getConditionData:function(e){var t=this;this.loading=!0;var a={id:e};h["a"].get("/admin/invoicing/invoiceRecord/backgrounds.jhtml",a).then((function(e){t.loading=!1,t.conditionData=e})).catch((function(e){t.loading=!1,console.log("ERR_REFRESH: ",e),t.$message.warning(e.errorMessage)}))},refresh:function(e){var t=this;this.loading=!0;var a={id:e};h["a"].get("/admin/invoicing/invoiceRecord/invoiceRecord.jhtml",a).then((function(e){t.loading=!1,t.form=Object.assign(t.resetForm(),e.data),t.tableData=e.data.items||[]})).catch((function(e){t.loading=!1,console.log("ERR_REFRESH: ",e),t.$message.warning(e.errorMessage)}))},add:function(){this.showInfoDialog=!0,this.orderNum="",this.infoNum="",this.amount="",this.invoiceNum=""},queryInfoList:function(){var e=this,t={id:this.form.id,pageSize:20,pageNumber:1,searchValue:this.dialogInfoFilters[0].value};h["a"].get("/admin/invoicing/invoiceRecord/relatedItems.jhtml",t).then((function(t){e.dialogLoading=!1,e.showInfoDialog=!0,e.dialogInfoTableData=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},opened:function(){this.dialogInfoTableData=[],this.dialogInfoFilters[0].value="",this.queryInfoList(this.getDialogQueryParams())},getDialogQueryParams:function(){return{pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogInfoFilters[0].value}},dialogFilterDataChange:function(e){this.dialogPagination.currentPage=1,this.queryInfoList(this.getDialogQueryParams())},dialogPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.queryInfoList(this.getDialogQueryParams())},dialogCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.queryInfoList(this.getDialogQueryParams())},dialogMemberFilterDataChange:function(e){this.dialogMemberPagination.currentPage=1,this.buyerTypeChange()},dialogMemberPageSizeChange:function(e){this.$set(this.dialogMemberPagination,"pageSize",e),this.buyerTypeChange()},dialogMemberCurrentPageChange:function(e){this.$set(this.dialogMemberPagination,"currentPage",e),this.buyerTypeChange()},selectionChange:function(e){var t=this;console.log(2),this.selections=e;var a=[],n=[];this.amount=0,this.invoiceNum=0,e.map((function(e){a.push(e.orderSn),t.amount=Number(e.price*(e.quantity?e.quantity:0))+Number(t.amount),t.invoiceNum=Number(e.quantity||0)+Number(t.invoiceNum)})),a.forEach((function(e){-1===n.indexOf(e)&&n.push(e)})),this.orderNum=n.length,this.infoNum=e.length},handleInfoConfirmed:function(e,t){var a=this;this.showInfoDialog=!1,console.log(e),this.tableData.map((function(e){a.selections.find((function(t){return t.productId===e.productId}))&&a.selections.splice(e,1)})),this.selections.forEach((function(e){a.$set(e,"orderItemId",e.id),a.$set(e,"id","")})),this.tableData=this.tableData.concat(this.selections)},saveDetail:function(){var e=this;this.loading=!0;var t=[];t=this.tableData.map((function(e){return{orderItemId:e.orderItemId,quantity:e.quantity,id:e.id}})),h["a"].post("/admin/invoicing/invoiceRecord/invoiceRecordItem.jhtml",{id:this.form.id,items:t}).then((function(t){e.loading=!1,e.refresh(e.form.id),e.$message.success("操作成功"),e.$emit("operationSuccess",e.itemId.id)})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},save:function(){var e=this;this.$refs.form.validate((function(t,a){if(!t)return!1;e.loading=!0,"0"===e.form.category?(e.form.sellerType="0",e.form.buyerType="5",e.form.buyer=e.getUser.shop.id):(e.form.sellerType="5",e.form.seller=e.getUser.shop.id),e.form.id?e.update():e.create()}))},create:function(){var e=this;this.loading=!0;var t=this.form;h["a"].post("/admin/invoicing/invoiceRecord/invoiceRecord.jhtml",t).then((function(t){e.loading=!1,e.$message.success("操作成功"),e.$emit("operationSuccess",t.id),e.refresh(t.id)})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},update:function(){var e=this;this.loading=!0;var t=this.form;h["a"].put("/admin/invoicing/invoiceRecord/invoiceRecord.jhtml",t).then((function(t){e.loading=!1,e.$message.success("操作成功"),e.$emit("operationSuccess")})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},getStatus:function(e){switch(e){case"0":return"未确认";case"5":return"已确认";default:return"--"}},showMessage:function(e,t){this.$notify({message:e,type:t,showClose:!0})}}),mounted:function(){},watch:{itemId:function(e){""!==e.id?this.refresh(e.id):this.clear()}}},y=v,w=(a("15a0"),a("2877")),C=Object(w["a"])(y,c,u,!1,null,null,null),D=C.exports,S=a("225d"),_=a("bc3a"),T=a.n(_),I=a("443b"),x={name:"PurchaseApplyMgmtList",data:function(){return{tabName:"addinfo",tabNameInfo:"info",itemId:{id:""},remarks:"",title:"",showRecommend:!1,isEdit:!0,isPend:!1,returnId:"",auditState:"1",form:{},formData:{},backForm:{},row:{},loading:!1,open:!1,openAdd:!1,dialogTableVisible:!1,step1:!0,step2:!1,showCloseOrder:!1,showPassOrder:!1,selections:[],operations:[{label:"添加",name:"add",type:"primary",class:"show",auth:["admin:purchaseApplication.add"]},{label:"删除",name:"delete",type:"",disabled:!0,auth:["admin:purchaseApplication.delete"]},{label:"刷新",name:"refresh",type:""},{label:"导出",name:"export",type:"",auth:["admin:purchaseApplication.export"]}],filters:[{type:"select",label:"发票类别",name:"supplier",value:"",class:"hidden",options:[{label:"全部",value:""},{label:"采购发票",value:"0"},{label:"销售发票",value:"1"}]},{type:"select",label:"发票类型",name:"people",value:"",class:"hidden",options:[{label:"全部",value:""},{label:"个人",value:"0"},{label:"增值税普通发票",value:"1"},{label:"增值税专用发票",value:"2"}]},{type:"select",label:"状态",name:"state",value:"",class:"hidden",options:[{label:"全部",value:""},{label:"未确认",value:"0"},{label:"已确认",value:"1"}]},{type:"daterange",label:"开票日期",name:"publishDate",class:"hidden",value:[]},{type:"input",label:"",placeholder:"请输入发票代码/发票号码",name:"searchValue",value:""}],tableData:[],gridData:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizPopupTabs:l["a"],BizFlexTable:s["c"],BaseInfo:D,vueEasyPrint:S["a"]},mixins:[I["a"]],created:function(){this.getList()},watch:{},computed:Object(r["a"])(Object(r["a"])({},Object(m["c"])("Authority",["currentAuth"])),{},{hasAuthExamine:function(){return this.currentAuth.includes("admin:purchaseApplication.examine")},hasAuthDel:function(){return this.currentAuth.includes("admin:purchaseApplication.delete")},toggleRecommendTxt:function(){var e=this.showRecommend;return e?"收起":"筛选"}}),mounted:function(){},methods:Object(r["a"])(Object(r["a"])({},Object(m["c"])(["getUser"])),{},{operate:function(e){this[e]()},isShow:function(){this.showRecommend?(this.filters[0].class="hidden",this.filters[1].class="hidden",this.filters[2].class="hidden",this.filters[3].class="hidden",document.getElementsByClassName("biz-table-filter")[0].style.marginTop=""):(this.filters[0].class="show",this.filters[1].class="show",this.filters[2].class="show",this.filters[3].class="show",document.getElementsByClassName("biz-table-filter")[0].style.marginTop="30px"),this.showRecommend=!this.showRecommend},refresh:function(){this.getList()},operationSuccess:function(){this.openAdd=!1,this.refresh()},formatDate:function(e){var t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),o=a+"-"+(n<10?"0"+n:n)+"-"+(i<10?"0"+i:i);return o},statusChange:function(e,t){var a=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0;var t={ids:[e.id]};h["a"].post("/admin/invoicing/invoiceRecord/submmit.jhtml",t).then((function(e){a.$message.success("操作成功！"),a.showPassOrder=!1,a.loading=!1,a.refresh()})).catch((function(e){a.loading=!1,e.errorMessage&&a.$message.warning(e.errorMessage)})).finally((function(){}))}))},deleteApply:function(e,t){e.stopPropagation(),this.deleteItem([t.id])},deleteItem:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,h["a"].delete("/admin/invoicing/invoiceRecord/invoiceRecord.jhtml",{ids:e}).then((function(e){t.$message.success("删除成功"),t.refresh()})).catch((function(e){console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))}))},delete:function(){if(this.selections&&this.selections.length>0){var e=[];this.selections.forEach((function(t){e.push(t.id)})),this.deleteItem(e)}else this.$message("请选择一条数据")},printApply:function(e){var t=this,a={id:e.id};h["a"].get("/admin/invoicing/invoiceRecord/voucher.jhtml",a).then((function(e){t.dialogTableVisible=!0,t.title=t.getUser().shop.name+"发票单",t.form=e.data,t.gridData=e.data.items||[],t.loading=!1})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))},print:function(){this.$refs.easyPrint.print()},exportInvoice:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,n,i,o,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={id:e.form.id,type:"0"},t.prev=1,t.next=4,T.a.post("/admin/invoicing/invoiceRecord/voucher/export.jhtml",a,{responseType:"blob"});case 4:return n=t.sent,console.log("response => ",n),i=new Blob([n.data],{type:"application/vnd.ms-excel"}),console.log(decodeURI(n.headers["content-disposition"])),o=decodeURI(n.headers["content-disposition"].split("filename=")[1]),r=document.createElement("a"),r.download=o.match(/"(\S*)"/)[1],r.style.display="none",r.href=URL.createObjectURL(i),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r),t.abrupt("return");case 20:throw t.prev=20,t.t0=t["catch"](1),new Error(t.t0);case 23:case"end":return t.stop()}}),t,null,[[1,20]])})))()},export:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,n,i,o,r,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],e.selections&&e.selections.length>0&&e.selections.forEach((function(e){a.push(e.id)})),n={ids:a,pageSize:e.pagination.pageSize,pageNumber:e.pagination.currentPage,shopId:window.top.SHOP_ID||"",searchValue:e.filters[4].value,type:e.filters[1].value,category:e.filters[0].value,state:e.filters[2].value,beginDate:e.filters[3].value[0]?e.filters[3].value[0]+" 00:00:00":"",endDate:e.filters[3].value[1]?e.filters[3].value[1]+" 23:59:59":""},t.prev=3,t.next=6,T.a.post("/admin/invoicing/invoiceRecord/export.jhtml",n,{responseType:"blob"});case 6:return i=t.sent,console.log("response => ",i),o=new Blob([i.data],{type:"application/vnd.ms-excel"}),console.log(decodeURI(i.headers["content-disposition"])),r=decodeURI(i.headers["content-disposition"].split("filename=")[1]),l=document.createElement("a"),l.download=r.match(/"(\S*)"/)[1],l.style.display="none",l.href=URL.createObjectURL(o),document.body.appendChild(l),l.click(),URL.revokeObjectURL(l.href),document.body.removeChild(l),t.abrupt("return");case 22:throw t.prev=22,t.t0=t["catch"](3),new Error(t.t0);case 25:case"end":return t.stop()}}),t,null,[[3,22]])})))()},add:function(){this.tabName="addinfo",this.itemId={id:""},this.openAdd=!0,this.$nextTick((function(){}))},rowClick:function(e,t,a){var n=this;this.tabNameInfo="addinfo",this.openAdd=!0,this.$nextTick((function(){n.itemId={id:e.id}}))},getList:function(){var e=this,t={pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage,shopId:window.top.SHOP_ID||"",searchValue:this.filters[4].value,type:this.filters[1].value,category:this.filters[0].value,state:this.filters[2].value,beginDate:this.filters[3].value[0]?this.filters[3].value[0]+" 00:00:00":"",endDate:this.filters[3].value[1]?this.filters[3].value[1]+" 23:59:59":""};this.loading=!0,h["a"].get("/admin/invoicing/invoiceRecord/list.jhtml",t).then((function(t){console.log(t),e.tableData=t.dataList,e.pagination.total=Number(t.total),e.loading=!1})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},getStatus:function(e){switch(e.state){case"0":return"未确认";case"1":return"已确认";default:return"--"}},getType:function(e){switch(e.type){case"0":return"个人发票";case"1":return"增值税普通发票";case"2":return"增值税专用发票";default:return"--"}},getCategory:function(e){switch(e.category){case"0":return"采购发票";case"1":return"销售发票";default:return"--"}},handleSelectionChange:function(e){this.selections=e,this.operations.map((function(e){"delete"===e.name&&(e.disabled=!0)})),e.length>0&&this.operations.map((function(e){"delete"===e.name&&(e.disabled=!1)}))},filterDataChange:function(e){this.filters=e,this.pagination.currentPage=1,this.refresh()},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()}})},N=x,k=(a("70d1"),Object(w["a"])(N,n,i,!1,null,null,null));t["default"]=k.exports},"70d1":function(e,t,a){"use strict";var n=a("9ed6"),i=a.n(n);i.a},7132:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"biz-fade-t"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.open,expression:"open"}],staticClass:"biz-popup",on:{click:function(t){return t.target!==t.currentTarget?null:e.close(t)}}},[a("transition",{attrs:{name:"biz-fade-t-right"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.open,expression:"open"}],staticClass:"popup-content",style:e.contentStyle},[e._t("default")],2)])],1)])},i=[],o={name:"BizPopup",props:{open:{type:Boolean,default:function(){return!1}},contentStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{close:function(){this.$emit("close")}}},r=o,l=(a("5b8e"),a("2877")),s=Object(l["a"])(r,n,i,!1,null,null,null),c=s.exports,u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"biz-popup-tabs"},[a("biz-popup",{attrs:{open:e.open,contentStyle:e.contentStyle},on:{close:e.close}},[a("el-tabs",{attrs:{type:"border-card",value:e.value},on:{"tab-click":e.tabClick}},[e._t("default")],2)],1)],1)},d=[],p=(a("b0c0"),{name:"BizPopupTabs",data:function(){return{}},props:{open:{type:Boolean,default:!1},value:{type:String,required:!0},contentStyle:{type:Object,default:function(){return{}}}},components:{BizPopup:c},methods:{close:function(){var e=this;this.$confirm("是否保存当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$emit("close")}))},tabClick:function(e){this.$emit("input",e.name)}}}),f=p,h=(a("d4c2"),Object(l["a"])(f,u,d,!1,null,null,null)),g=h.exports;a.d(t,"a",(function(){return g}))},9678:function(e,t,a){},"9ed6":function(e,t,a){},a9e3:function(e,t,a){"use strict";var n=a("83ab"),i=a("da84"),o=a("94ca"),r=a("6eeb"),l=a("5135"),s=a("c6b6"),c=a("7156"),u=a("c04e"),d=a("d039"),p=a("7c73"),f=a("241c").f,h=a("06cf").f,g=a("9bf2").f,m=a("58a8").trim,b="Number",v=i[b],y=v.prototype,w=s(p(y))==b,C=function(e){var t,a,n,i,o,r,l,s,c=u(e,!1);if("string"==typeof c&&c.length>2)if(c=m(c),t=c.charCodeAt(0),43===t||45===t){if(a=c.charCodeAt(2),88===a||120===a)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+c}for(o=c.slice(2),r=o.length,l=0;l<r;l++)if(s=o.charCodeAt(l),s<48||s>i)return NaN;return parseInt(o,n)}return+c};if(o(b,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var D,S=function(e){var t=arguments.length<1?0:e,a=this;return a instanceof S&&(w?d((function(){y.valueOf.call(a)})):s(a)!=b)?c(new v(C(t)),a,S):C(t)},_=n?f(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),T=0;_.length>T;T++)l(v,D=_[T])&&!l(S,D)&&g(S,D,h(v,D));S.prototype=y,y.constructor=S,r(i,b,S)}},af3f:function(e,t,a){"use strict";var n=a("697f");t["a"]=n["a"]},b547:function(e,t,a){},c0cb:function(e,t,a){},c466:function(e,t,a){"use strict";a("99af"),a("d3b7"),a("ac1f"),a("25f0"),a("5319");t["a"]={nowDate:function(){var e=new Date,t=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()+1<10?"0"+e.getDate():e.getDate();return e.getFullYear().toString()+"-"+t+"-"+a},getMonthDays:function(e){var t=new Date(Date.parse(e.replace(/-/g,"/"))),a=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()+1,1),i=(n-a)/864e5;return i},halfYearAgo:function(e){var t="";return t=e?new Date(Date.parse(e.replace(/-/g,"/"))):new Date,console.log(t),t.setMonth(t.getMonth()-6),"".concat(t.getFullYear(),"-").concat(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,"-").concat(t.getDate()<10?"0"+t.getDate():t.getDate())},lastMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1<10?"0"+e.getMonth():e.getMonth(),n=e.getDate()+1<10?"0"+e.getDate():e.getDate();return"00"===a&&(a="12",t--),t.toString()+"-"+a+"-"+n},nextMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),i=parseInt(a)+1;13===i&&(t=parseInt(t)+1,i=1);var o=new Date(t,i,0);return o=o.getDate(),n>o&&(n=o),i<10&&(i="0"+i),t+"-"+i+"-"+n},lastYearDate:function(){var e=new Date,t=new Date(e.getFullYear()-1,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastTwoYearDate:function(){var e=new Date,t=new Date(e.getFullYear()+2,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastNYearDate:function(e,t){var a=new Date(e),n=new Date(a.getFullYear()+parseInt(t),a.getMonth(),a.getDate());return n.getFullYear()+"-"+this.convertToFullMode(n.getMonth()+1)+"-"+this.convertToFullMode(n.getDate())},dateConverter:function(e){return e instanceof Date?e.getFullYear()+"-"+this.convertToFullMode(e.getMonth()+1)+"-"+this.convertToFullMode(e.getDate()):e},timeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes())+":"+this.convertToFullMode(e.getSeconds()):e},shortTimeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes()):e},dateTimeConverter:function(e){return e instanceof Date?this.dateConverter(e)+" "+this.timeConverter(e):e},convertToFullMode:function(e){return e=e.toString(),1===e.length?"0"+e:e}}},d4c2:function(e,t,a){"use strict";var n=a("e725"),i=a.n(n);i.a},e725:function(e,t,a){},ec6b:function(e,t,a){"use strict";var n=a("b547"),i=a.n(n);i.a}}]);