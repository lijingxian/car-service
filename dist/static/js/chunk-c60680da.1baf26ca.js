(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c60680da"],{"0e1c":function(t,e,i){},"1fb6":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dynamic"},[i("biz-save-button",{attrs:{operations:t.operations},on:{operate:t.operate}}),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{rules:t.rules,model:t.form,"label-width":"100px",size:"small","inline-message":!0}},[i("el-form-item",{attrs:{label:"车友会",prop:"fleetId"}},[i("el-select",{attrs:{disabled:""!==t.id},on:{change:t.onChange},model:{value:t.form.fleetId,callback:function(e){t.$set(t.form,"fleetId",e)},expression:"form.fleetId"}},t._l(t.motoristsClubList,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),i("el-form-item",{attrs:{label:"标题",prop:"dynamicTitle"}},[i("el-input",{attrs:{placeholder:"请输入标题（6-30字以内）",maxlength:30,disabled:""!==t.id},model:{value:t.form.dynamicTitle,callback:function(e){t.$set(t.form,"dynamicTitle",e)},expression:"form.dynamicTitle"}})],1),i("el-form-item",{attrs:{label:"栏目",prop:"columnSelList"}},[i("div",{staticClass:"column-style"},[i("el-checkbox-group",{attrs:{size:"small"},model:{value:t.form.columnSelList,callback:function(e){t.$set(t.form,"columnSelList",e)},expression:"form.columnSelList"}},t._l(t.form.columns,(function(e){return i("el-checkbox-button",{key:e.id,staticClass:"tag-column",attrs:{label:e.name}},[t._v(t._s(e.name))])})),1)],1)]),"2"===t.infoType?i("el-form-item",{attrs:{label:"文字描述",prop:"dynamicContent"}},[i("el-input",{attrs:{disabled:""!==t.id,maxlength:100,placeholder:"请添加问答描述（选填）",type:"textarea",rows:4},model:{value:t.form.dynamicContent,callback:function(e){t.$set(t.form,"dynamicContent",e)},expression:"form.dynamicContent"}})],1):t._e(),"2"===t.infoType?i("el-form-item",{attrs:{label:"图片描述"}},[i("img-uploader",{attrs:{disabled:Boolean(""!==t.id||t.dynamicVideos.length)},model:{value:t.dynamicImages,callback:function(e){t.dynamicImages=e},expression:"dynamicImages"}})],1):t._e(),"2"===t.infoType?i("el-form-item",{attrs:{label:"视频描述"}},[i("product-vr-file-uploader",{attrs:{fileList:t.dynamicVideos,disabled:Boolean(""!==t.id||t.dynamicImages.length)},on:{"upload-success":t.handleTestDriveUpload,"remove-success":t.handleTestDriveRemove}})],1):t._e(),"0"===t.infoType?i("div",{staticClass:"publish"},[i("biz-editor",{ref:"editor",attrs:{width:"430px",hasVideo:!0,disabled:t.editorDisabled},model:{value:t.form.dynamicContent,callback:function(e){t.$set(t.form,"dynamicContent",e)},expression:"form.dynamicContent"}})],1):t._e()],1),i("el-dialog",{staticClass:"dynamic-preview",attrs:{"append-to-body":"",title:"预览",visible:t.previewDialogOpen,width:"450px"},on:{close:t.closePreviewDialog}},[i("div",{staticClass:"bg",style:{background:t.background}},[i("div",{staticClass:"cpreview"},[i("div",{staticClass:"pcontent"},[i("div",{staticClass:"title"},[t._v(t._s(t.form.dynamicTitle))]),i("div",{staticClass:"detail"},[i("div",{staticClass:"avater"},[i("img",{attrs:{src:t.form.authorData.head||t.DefaultAvatar,alt:""}})]),i("div",{staticClass:"vt"},[i("div",{staticClass:"name"},[t._v(t._s(t.form.authorData.name))]),i("div",{staticClass:"time"},[t._v(t._s(t.now))])])]),i("div",{domProps:{innerHTML:t._s(t.form.dynamicContent)}}),i("div",{staticStyle:{display:"flex","flex-wrap":"wrap"}},t._l(t.dynamicImages,(function(t){return i("div",{key:t},[i("img",{staticStyle:{padding:"0px 2px"},attrs:{src:t,alt:"",width:"88",height:"80"}})])})),0)])])])])],1)},s=[],n=(i("99af"),i("4160"),i("d81d"),i("b0c0"),i("d3b7"),i("25f0"),i("159b"),i("b85c")),o=i("5530"),c=i("8330"),r=i("fc15"),l=i("4139"),d=i("40ae"),u=i("2a8a"),m=i.n(u),p=i("a3df"),h=i("c466"),f=i("2f62"),g=i("624d"),v=i.n(g),y=i("1ab1"),b=i("c596"),C=i("2119"),T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"product-vr-file-uploader"},[i("el-upload",{directives:[{name:"show",rawName:"v-show",value:!t.disabled,expression:"!disabled"}],attrs:{accept:"application/zip,video/*",name:"uploadName",action:t.uploadAction,data:t.uploadData,"file-list":t.fileList,"on-remove":t.handleRemove,"on-success":t.handleSuccess,"on-error":t.handleError,limit:1,"before-upload":t.beforeAvatarUpload}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.disabled,expression:"disabled"}],staticClass:"view",attrs:{title:t.fileList[0]?t.fileList[0].url:""}},[t._v(t._s(t.fileList[0]?t.fileList[0].url:""))]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.hasFile(),expression:"hasFile()"}],attrs:{size:"small",type:"primary",disabled:!t.preview,loading:t.loading},on:{click:function(e){return e.stopPropagation(),t.handlePreview(e)}}},[t._v("预览")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.hasFile(),expression:"hasFile()"}],attrs:{size:"small",type:"primary",disabled:t.preview},on:{click:function(e){return e.stopPropagation(),t.handlePreview(e)}}},[t._v("取消预览")]),i("iframe",{directives:[{name:"show",rawName:"v-show",value:!t.preview,expression:"!preview"}],ref:"vrFrame",staticClass:"vrframe",attrs:{src:t.url,frameborder:"0"}})],1)},w=[],I=(i("c975"),i("baa5"),i("bc3a")),_=i.n(I),L={name:"ProductVrFileUploader",data:function(){return{preview:!0,loading:!1,url:""}},props:{isTestDrive:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},productId:String,open:{type:Boolean,default:!1},fileList:{type:Array,default:function(){return[]}}},watch:{open:function(t){t||(this.url="",this.preview=!0)}},computed:{uploadAction:function(){return this.isTestDrive?"/admin/file/uploads.jhtml":"/admin/shopProduct/productVrZip.jhtml"},uploadName:function(){return this.isTestDrive?"file":"uploadFile0"},uploadData:function(){return this.isTestDrive?{type:"2"}:{productId:this.productId}}},methods:{handlePreview:function(){var t=this;if(this.isTestDrive)!0===this.preview?(this.url=this.getFilePath(),setTimeout((function(){t.preview=!1}),800)):(this.url="",this.preview=!0);else if(!0===this.preview){var e=this.getFilePath();this.loading=!0,_.a.get(e).then((function(e){t.loading=!1,t.url=t.getFilePath(),t.$refs.vrFrame.contentWindow.location.reload(!0),setTimeout((function(){t.preview=!1}),800),console.log("url请求成功")})).catch((function(e){t.loading=!1,404===e.response.status?t.$message.warning("文件解析,十分钟后可预览"):console.log("url请求失败:",e.response)}))}else this.url="",this.loading=!1,this.preview=!0},handleRemove:function(t,e){this.$emit("remove-success",t,e),this.url="",this.preview=!0},handleSuccess:function(t,e,i){this.$emit("upload-success",t,e,i),this.url="",this.preview=!0},beforeAvatarUpload:function(t){if(this.isTestDrive){var e=/^video\/(.*)$/.test(t.type);return e||this.$message.error("请选择符合视频格式的文件上传!"),e}var i="application/zip"===t.type;if(!i){var a=t.name.substring(t.name.lastIndexOf(".")).toLowerCase();if(".zip"!==a)return this.$message.error("请选择zip格式的VR资源包!"),i}var s=t.size/1024/1024<=200;return s||this.$message.error("请上传小于200M的文件!"),s},handleError:function(t,e,i){t?this.$message.warning(t):this.$message.warning("发生错误")},hasFile:function(){return 0!==this.fileList.length},getFilePath:function(){if(0!==this.fileList.length){var t=this.fileList[0].url.indexOf("/upload/");if(-1===t)return console.log("文件路径错误",this.fileList[0].url),"";var e=location.protocol+"//"+location.host,i=this.fileList[0].url.substr(t),a=e+i;return this.isTestDrive||(a+="/index.html"),console.log("src",a),a}return""}}},D=L,S=(i("f372"),i("2877")),x=Object(S["a"])(D,T,w,!1,null,null,null),$=x.exports,k={name:"Dynamic",data:function(){var t=this,e=function(e,i,a){""===t.id&&(i.length<6||i.length>30)?a(new Error("长度限6-30字以内")):a()};return{editorDisabled:!1,curTagId:"",tagList:[],selectedTags:[],authorName:"",isCreated:!1,DefaultAvatar:v.a,member:{},now:"",fleet:{},previewDialogOpen:!1,background:"url("+m.a+") no-repeat no-repeat",editorStyle:{height:"300px",width:"428px"},categoryList:[],loading:!1,fileData:{type:"0"},dynamicVideos:[],dynamicImages:[],form:{typeList:[],authorData:{},columnSelList:["推荐"],columns:[],fleetId:"",type:"0",dynamicTitle:"",dynamicContent:"",topicLogoImageUrl:"",articleCategoryId:""},operations:[{disabled:!1,label:"预览",name:"previewDynamic",type:""},{label:"保存",name:"publish",type:"primary"}],rules:{fleetId:[{required:!0,message:"请选择车友会",trigger:"change"}],dynamicTitle:[{required:!0,validator:e,trigger:"change"}],columnSelList:[{required:!0,message:"请选择栏目",trigger:"change"}]},pictureList:[],isDynamic:!0,textarea:"",checked:!1,toolbars:[[{name:"bold",title:"加粗",type:"toolbtn",status:"checked"},{name:"italic",title:"斜体",type:"toolbtn",status:"checked"},{name:"underline",title:"下划线",type:"toolbtn",status:""}]]}},props:{id:{type:String,default:""},author:{type:String,default:""},motoristsClubList:{type:Array},infoType:{type:String,default:"0"}},components:{BizSaveButton:c["a"],BizEditor:d["a"],ImgUploader:C["a"],ProductVrFileUploader:$},created:function(){this.getColumns(),this.getCategoryList(),this.getMember(),this.getNow(),this.getStoreTagcategories()},watch:{motoristsClubList:function(t){t.length>0&&(this.form.fleetId=t[0].value,this.form.authorData.head=t[0].head,this.form.authorData.name=t[0].label)},id:function(t){this.$refs.form.resetFields(),""===t?(this.clearForm(),console.log("this.motoristsClubList[0]",this.motoristsClubList[0]),this.form.authorData.head=this.motoristsClubList[0].head,this.form.authorData.name=this.motoristsClubList[0].label,this.getStoreTagcategories(),this.editorDisabled=!1):this.getColumns()},author:function(t){this.authorName=t}},computed:Object(o["a"])(Object(o["a"])({},Object(f["c"])(["getUser"])),{},{getUeditorType:function(){return"2"===this.infoType?"standard":"video"},activedFleet:function(){var t,e=Object(n["a"])(this.motoristsClubList);try{for(e.s();!(t=e.n()).done;){var i=t.value;if(i.value===this.form.fleetId)return i}}catch(a){e.e(a)}finally{e.f()}return{label:""}}}),methods:{handleTestDriveUpload:function(t,e,i){if("100"===t.resultCode){var a=[];a.push({name:t.urls[0],url:t.urls[0]}),this.dynamicVideos=a}},handleTestDriveRemove:function(t,e){this.dynamicVideos=[]},onAddSuccess:function(){this.getStoreTags()},onTypeChange:function(t){var e=this;this.form.typeList.forEach((function(i,a){if(t===a.toString())return e.curTagId=i.id,e.getStoreTags(),!1}))},getStoreTags:function(){var t=this,e={shopId:window.top.SHOP_ID||"",tagCategoryId:this.curTagId};y["a"].get(b["g"].systemSetting.storeTags,e).then((function(e){t.tagList=e.content})).catch((function(t){console.log(t.errorMessage)}))},getStoreTagcategories:function(){var t=this,e={categoryType:"资讯文章/内容分类",shopId:window.top.SHOP_ID||""};y["a"].get(b["g"].systemSetting.storeTagcategories,e).then((function(e){t.form.typeList=e.content,t.form.typeList.length?(t.form.type="0",t.curTagId=t.form.typeList[0].id):(t.form.type="无数据",t.curTagId=""),t.getStoreTags()})).catch((function(t){console.log(t.errorMessage)}))},onChange:function(t){var e=this;this.motoristsClubList.forEach((function(i){i.value===t&&(e.form.authorData.head=i.head,e.form.authorData.name=i.label)}))},clearForm:function(){var t=this;this.form.fleetId=this.motoristsClubList[0].value,this.form.dynamicTitle="",this.form.dynamicContent="",this.form.type="",this.isCreated=!0,this.form.articleCategoryId="",this.form.columnSelList=["推荐"],this.form.typeList=[],this.tagList=[],this.selectedTags=[],this.dynamicImages=[],this.dynamicVideos=[],this.$nextTick((function(){t.isCreated=!1}))},getNow:function(){this.now=h["a"].nowDate()},getMember:function(){this.member=this.getUser},previewDynamic:function(){this.previewDialogOpen=!0,""===this.id&&(this.authorName=this.activedFleet?this.activedFleet.label:"")},closePreviewDialog:function(){this.previewDialogOpen=!1},operate:function(t){this[t]()},publish:function(){var t=this;this.$refs.form.validate((function(e){if(e){console.log(t.form.columnSelList);var i=[];switch(t.form.columnSelList.map((function(e){t.form.columns.map((function(t){e===t.name&&i.push({id:t.id,name:t.name})})),t.form.columnSelList=i})),t.infoType){case"0":if(""===t.id){if(""===t.form.dynamicContent)return void t.$notify({title:"警告",message:"请输入动态正文",type:"warning"});t.publishDynamic()}else t.updateDynamic();break;case"2":""===t.id?t.publishTopic():t.updateTopic();break;default:break}}}))},updateTopic:function(){var t=this,e={id:this.id,fleet:{id:this.form.fleetId},content:this.form.dynamicContent,columnList:this.form.columnSelList,images:this.dynamicImages,videos:this.dynamicVideos.length?[this.dynamicVideos[0].url]:[]};l["a"].updateTopic(e,(function(e){t.$message.success("保存成功"),t.$emit("updateTopic"),t.$emit("created")}),(function(e){t.$message.warning(e.errorMessage)}))},publishTopic:function(){var t=this,e={title:this.form.dynamicTitle,content:this.form.dynamicContent,fleet:{id:this.form.fleetId},columnList:this.form.columnSelList,images:this.dynamicImages,videos:this.dynamicVideos.length?[this.dynamicVideos[0].url]:[]};y["a"].post(b["g"].motoristsClubDynamic.createTopic,e).then((function(e){t.$message.success("操作成功"),t.$emit("created")})).catch((function(e){t.$message.warning(e.errorMessage)}))},tagMapping:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i={type:t,tags:this.$refs.tagSelect.getCurSelectedTags(),category:this.form.typeList.length?this.form.typeList[parseInt(this.form.type)].name:""};i.refId=""!==e?e:this.id,y["a"].post(b["g"].systemSetting.tagMapping,i).then((function(t){console.log("映射成功")})).catch((function(t){console.log(t.errorMessage)}))},publishDynamic:function(){var t=this;this.dynamicImages=p["a"].textToImageSrc(this.form.dynamicContent),this.dynamicVideos=p["a"].textToVideoSrc1(this.form.dynamicContent);var e=p["a"].contentToVideoSrc(this.form.dynamicContent);this.dynamicVideos=this.dynamicVideos.concat(e);var i={fleet:{id:this.form.fleetId},title:this.form.dynamicTitle,content:this.form.dynamicContent,images:this.dynamicImages,videos:this.dynamicVideos,columnList:this.form.columnSelList};y["a"].post(b["g"].motoristsClubDynamic.createDynamic,i).then((function(e){t.$message.success("操作成功"),t.$emit("created")})).catch((function(e){t.$message.warning(e.errorMessage)}))},updateDynamic:function(){var t=this;this.dynamicImages=p["a"].textToImageSrc(this.form.dynamicContent),this.dynamicVideos=p["a"].textToVideoSrc1(this.form.dynamicContent);var e=p["a"].contentToVideoSrc(this.form.dynamicContent);this.dynamicVideos=this.dynamicVideos.concat(e);var i={id:this.id,fleet:{id:this.form.fleetId},title:this.form.dynamicTitle,content:this.form.dynamicContent,images:this.dynamicImages,videos:this.dynamicVideos,columnList:this.form.columnSelList};r["a"].updateDynamic(i,(function(e){t.$message.success("操作成功"),t.$emit("created")}),(function(e){console.log(e),t.$message.warning(e.errorMessage)}))},emojiChoosed:function(t){this.textarea=this.textarea.concat(t)},pictureUploadSuccess:function(t,e,i){this.pictureList=i},pictureRemoveSuccess:function(t,e){this.pictureList=e},beyondLimit:function(){this.$message({message:"最多只能上传9张图片",type:"warning"})},typeChange:function(t){"2"===t&&this.getCategoryList(),this.operations[0].disabled=!0,"0"!==t&&"1"!==t||(this.operations[0].disabled=!1)},getCategoryList:function(){var t=this,e={shopId:window.top.SHOP_ID||""};r["a"].getArticleTypeList(e,(function(e){t.categoryList=e.articleCategorys,t.categoryList.length>1&&(t.form.articleCategoryId=t.categoryList[0].id)}),(function(t){console.log(t)}))},getTagMapping:function(t,e){var i=this;this.selectedTags=[];var a={refId:e,type:t};y["a"].get(b["g"].systemSetting.tagMapping,a).then((function(t){console.log("查看映射信息",t),t.data.tags&&t.data.tags.length&&(i.selectedTags=t.data.tags),t.data.category?i.form.typeList.forEach((function(e,a){e.name===t.data.category&&(i.form.type=a.toString())})):i.form.typeList.length?i.form.type="0":i.form.type="无数据",i.curTagId=i.form.typeList.length?i.form.typeList[parseInt(i.form.type)].id:"",i.getStoreTags()})).catch((function(t){console.log(t.errorMessage)}))},refresh:function(t){var e,i,a=this;i=t||this.id,this.loading=!0,"2"===this.infoType?(this.dynamicVideos=[],this.dynamicImages=[],console.log("选择问答"),e={topicId:i},this.isCreated=!0,l["a"].selectTopic(e,(function(t){a.loading=!1,a.form.authorData=t.data.authorData||{},a.form.dynamicContent=t.data.content||"",a.dynamicImages=t.data.images||[],a.form.fleetId=t.data.fleet?t.data.fleet.id:"无",a.fleet=t.data.fleet||{},a.form.dynamicTitle=t.data.title;var e=[];t.data.columnList.map((function(t){e.push(t.name)})),a.form.columnSelList=e||[],t.data.videos.length>0&&a.dynamicVideos.push({name:t.data.videos[0],url:t.data.videos[0]}),a.$nextTick((function(){a.isCreated=!1}))}),(function(t){a.loading=!1,a.$nextTick((function(){a.isCreated=!1})),console.log(t)}))):(console.log("选择动态"),e={spaceId:i},this.isCreated=!0,r["a"].selectDynamic(e,(function(t){a.loading=!1,a.form.authorData=t.data.authorData||{},a.form.dynamicContent=t.data.content||"",a.form.fleetId=t.data.fleet?t.data.fleet.id:"无",a.fleet=t.data.fleet||{},a.form.dynamicTitle=t.data.title;var e=[];t.data.columnList.map((function(t){e.push(t.name)})),a.form.columnSelList=e||[],a.$nextTick((function(){a.isCreated=!1})),a.editorDisabled=!0}),(function(t){a.loading=!1,console.log(t)})))},getColumns:function(){var t=this;y["a"].get(b["g"].motoristsClubDynamic.visibleColumns).then((function(e){t.form.columns=e.content})).catch((function(t){console.log(t.errorMessage)}))}}},z=k,P=(i("de0f"),Object(S["a"])(z,a,s,!1,null,null,null));e["a"]=P.exports},2119:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"biz-avatar-uploader-multi"},[i("div",{staticClass:"el-upload-list el-upload-list--picture-card"},[t._l(t.value,(function(e){return i("div",{key:e.index,staticClass:"el-upload-list__item is-success",attrs:{tabindex:"0"}},[i("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:e,alt:""}}),i("span",{staticClass:"el-upload-list__item-actions"},[i("span",{staticClass:"el-upload-list__item-preview",on:{click:function(i){return t.handlePictureCardPreview(e)}}},[i("i",{staticClass:"el-icon-zoom-in"})]),i("span",{directives:[{name:"show",rawName:"v-show",value:t.isShowDelete,expression:"isShowDelete"}],staticClass:"el-upload-list__item-delete",on:{click:function(i){return t.handleRemove(e)}}},[i("i",{staticClass:"el-icon-delete"})])])])})),t.showUploader?i("el-upload",{ref:"upload",class:t.disabled?"avatar-uploader-disabled":"avatar-uploader",style:t.avatarStyle,attrs:{multiple:"","show-file-list":!1,accept:"image/*",limit:Number(t.limit),"file-list":t.fileList,data:t.fileData,"on-success":t.handleSuccess,"on-exceed":t.handleExceed,name:"file",action:"/admin/file/uploads.jhtml",disabled:t.disabled}},[i("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:t.plusStyle})]):t._e()],2),i("el-dialog",{attrs:{visible:t.dialogVisible,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)},s=[],n=(i("99af"),i("d81d"),i("a434"),i("ac1f"),i("1276"),{name:"ImgUploader",props:{value:{type:Array,default:function(){return[]}},imageForm:{type:Array,default:function(){return[]}},showUploader:{type:Boolean,default:function(){return!0}},size:{type:Object,default:function(){return{width:100,height:100}}},limit:{default:"9"},disabled:{type:Boolean,default:function(){return!1}},isShowDelete:{type:Boolean,default:function(){return!0}}},data:function(){return{fileData:{type:"0"},fileList:[],dialogVisible:!1,dialogImageUrl:""}},methods:{handleSuccess:function(t){var e=this.value.concat(t.fis[0].url);this.$emit("input",e)},handleExceed:function(t,e){this.$message.warning("只能上传".concat(this.limit,"张图片"))},handleRemove:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.removePic(t)}))},removePic:function(t){for(var e=this.value,i=0;i<e.length;i++)e[i]===t&&e.splice(i,1);this.$emit("input",e)},handlePictureCardPreview:function(t){this.dialogImageUrl=t,this.dialogVisible=!0}},computed:{plusStyle:function(){return{"line-height":this.size.height+"px"}},avatarStyle:function(){return{height:this.size.height+"px",width:this.size.width+"px"}}},watch:{value:function(t,e){console.log("value: ",this.value),this.fileList=t.map((function(t){return{name:t.split("/")[t.split("/").length-1],url:t}}))}},components:{}}),o=n,c=(i("d74a"),i("2877")),r=Object(c["a"])(o,a,s,!1,null,null,null);e["a"]=r.exports},"21c5":function(t,e,i){},3653:function(t,e,i){},"43cdc":function(t,e,i){},"458b":function(t,e,i){"use strict";var a=i("0e1c"),s=i.n(a);s.a},"73a8":function(t,e,i){},7577:function(t,e,i){"use strict";var a=i("b51a"),s=i.n(a);s.a},"878a":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("biz-grid",{staticClass:"question-answer-release"},[i("div",{attrs:{slot:"top"},slot:"top"},[i("biz-header",{attrs:{operations:t.operations,filters:t.filters},on:{operate:t.operate,filterDataChange:t.filterDataChange}})],1),i("div",{staticClass:"container"},[0===t.topicList.length?i("biz-empty-table"):t._e(),i("div",{staticClass:"topic-list"},t._l(t.topicList,(function(e,a){return i("div",{key:e.id},[i("topic-item",{attrs:{topic:e},on:{deleteTopic:t.deleteTopic,selectTopic:t.selectTopic,updated:t.updateTopicList}}),a+1!==t.topicList.length?i("div",{staticClass:"line"}):t._e()],1)})),0)],1),i("div",{attrs:{slot:"float"},slot:"float"},[t.topicList.length?i("div",{staticClass:"m-pagination"},[i("biz-pagination",{attrs:{pagination:t.topicPagination},on:{handleSizeChange:t.handleTopicSizeChange,handleCurrentChange:t.handleTopicCurrentChange}})],1):t._e()]),i("biz-popup-tabs",{staticClass:"popup-tab",attrs:{open:t.openPopup},on:{close:t.onClose},model:{value:t.popupTabName,callback:function(e){t.popupTabName=e},expression:"popupTabName"}},[t.isActivate("columnSetting")?i("el-tab-pane",{attrs:{label:"栏目设置",name:"columnSetting"}},[i("column-setting",{attrs:{refresh:t.refreshColumn}})],1):t._e(),t.isActivate("topicDetail")&&!t.addTopic?i("el-tab-pane",{attrs:{label:"问答详情",name:"topicDetail"}},[i("topic",{ref:t.topic,attrs:{topic:t.topic,spaces:t.spaces},on:{"change-thumb-up":t.changeThumbUp,updateTopic:t.updateTopic}})],1):t._e(),t.isActivate("topicDetail")?i("el-tab-pane",{attrs:{label:"问答编辑",name:"topicEditor"}},[i("dynamic",{ref:"dynamic",attrs:{motoristsClubList:t.motoristsClubList,id:t.topicId,author:t.dynamicAuthor,infoType:"2"},on:{created:t.refresh}})],1):t._e()],1),i("dynamic-preview",{attrs:{open:t.previewDialog,dynamicId:t.dynamicId,author:t.dynamicAuthor},on:{"update:open":function(e){t.previewDialog=e}}})],1)},s=[],n=(i("99af"),i("b0c0"),i("a9e3"),i("96cf"),i("1da1")),o=i("b85c"),c=i("1fb6"),r=i("7132"),l=i("04d3"),d=i("c466"),u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"topic-item"},[i("div",{staticClass:"item-body"},[i("div",{staticClass:"left"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.topic.authorData.head||t.DefaultAvatar,alt:""}})]),i("div",{staticClass:"right-detail"},[i("div",{staticClass:"title",on:{click:t.select}},[t._v("#"+t._s(t.topic.title)+"#")]),i("div",{staticClass:"introduction"},[t._v(t._s(t.topic.introduction))]),i("div",{staticClass:"from"},[i("div",{staticClass:"name"},[t._v(t._s(t.topic.author))]),i("div",{staticClass:"detail"},[t._v(t._s(t.topic.createDatetime))])])])]),i("div",{staticClass:"handle"},[i("i",{staticClass:"iconfont biz-icon-zhiding",class:{active:"1"===t.topic.isTop},attrs:{title:"置顶"},on:{click:t.top}}),i("i",{staticClass:"iconfont biz-icon-vertical_line"}),t.hasAuthDel?i("i",{staticClass:"el-icon-delete",attrs:{title:"删除"},on:{click:t.deleteTopic}}):t._e()])])])},m=[],p=(i("caad"),i("2532"),i("5530")),h=i("4139"),f=i("624d"),g=i.n(f),v=i("2f62"),y={name:"TopicItem",data:function(){return{DefaultAvatar:g.a}},props:{topic:Object},computed:Object(p["a"])(Object(p["a"])({},Object(v["c"])("Authority",["currentAuth"])),{},{hasAuthDel:function(){return this.currentAuth.includes("admin:space.topic.delete")}}),methods:{reply:function(){this.$emit("reply")},select:function(){this.$emit("selectTopic",this.topic.id)},top:function(){var t=this,e={topicId:this.topic.id,shopId:window.top.SHOP_ID||""};h["a"].topTopic(e,(function(e){var i=t.topic;"1"===e.isTop?i.isTop="1":i.isTop="0",t.$emit("updated")}),(function(t){console.log(t)}))},deleteTopic:function(){this.$emit("deleteTopic",this.topic.id)}}},b=y,C=(i("c174"),i("2877")),T=Object(C["a"])(b,u,m,!1,null,null,null),w=T.exports,I=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"topic"},[i("div",{staticClass:"publish"},[i("div",{staticClass:"editor"},[i("biz-editor",{attrs:{width:"450px",hasVideo:!0},model:{value:t.form.dynamicContent,callback:function(e){t.$set(t.form,"dynamicContent",e)},expression:"form.dynamicContent"}})],1),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.publish}},[t._v("发布")])],1),i("div",{staticClass:"topic-detail"},[i("div",{staticClass:"header"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.topic.authorData&&t.topic.authorData.head||t.DefaultAvatar,alt:""}})]),i("div",{staticClass:"right-detail"},[i("div",{staticClass:"title"},[t._v("#"+t._s(t.topic.title)+"#")]),i("div",{staticClass:"from"},[i("div",{staticClass:"name"},[t._v(t._s(t.topic.creator.nickname))]),i("div",{staticClass:"detail"},[t._v(t._s(t.topic.createDatetime))])])])]),i("div",{staticClass:"content"},[t._v(" "+t._s(t.topic.introduction)+" ")])]),i("div",{staticClass:"comment-list"},t._l(t.spaces,(function(e,a){return i("div",{key:e.id},[i("comment-item",{attrs:{comment:e,space:e,relative:t.relative,topicTitle:t.topic.title},on:{"change-thumb-up":t.changeThumbUp,refreshComment:t.updateTopic}}),a+1!==t.spaces.length?i("div",{staticClass:"line"}):t._e()],1)})),0)])},_=[],L=(i("4160"),i("4d63"),i("ac1f"),i("25f0"),i("5319"),i("1276"),i("159b"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"comment-item"},[i("div",{staticClass:"info"},[i("div",{staticClass:"person"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:t.comment.member.head||t.DefaultAvatar,alt:""}})]),i("div",{staticClass:"name-time"},[i("div",{staticClass:"name"},[t._v(t._s(t.comment.member.nickname))]),i("div",{staticClass:"time"},[t._v(t._s(t.comment.publishDate))])])]),i("div",{staticClass:"content"},[i("span",{domProps:{innerHTML:t._s(t.comment.content)}})]),i("div",{staticClass:"content"},[t._l(t.comment.images,(function(t){return i("img",{key:t,attrs:{src:t,width:"100px"}})})),0!==t.comment.videos.length?i("video",{staticClass:"content-videos",attrs:{controls:"",src:t.comment.videos[0]}}):t._e()],2),i("div",{staticClass:"handle"},[i("div",{staticClass:"p-btn"},[i("i",{staticClass:"iconfont biz-icon-eye"}),i("div",{staticClass:"p-number"},[t._v(t._s(t.comment.readCount))])]),i("ReplyName",{staticClass:"p-btn reply-commen",attrs:{space:t.space,relative:t.relative,name:t.comment.member.nickname||""},on:{updated:t.getSpace}},[i("i",{staticClass:"iconfont biz-icon-message2"}),t._v(t._s(t.comment.commentCount)+" ")]),i("div",{staticClass:"p-btn"},[i("i",{staticClass:"iconfont",class:t.zanClass,on:{click:t.thumbsUp}}),i("div",{staticClass:"p-number"},[t._v(t._s(t.comment.supportCount))])])],1)]),t.content.length>0?i("div",{staticClass:"comments"},t._l(t.content,(function(e){return i("div",{key:e.id,staticClass:"comment"},[i("ReplyName",{staticClass:"p-btn",attrs:{space:t.space,comment:e,relative:t.relative1,name:e.member.nickname},on:{updated:t.getSpace}},[i("span",{staticClass:"name"},[t._v(" "+t._s(e.member.nickname)+" ")])]),i("span",{staticClass:"content"},[t._v(t._s(e.content))])],1)})),0):t._e()])}),D=[],S=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"reply-name"},[i("el-popover",{ref:"popoverpicture",attrs:{placement:"bottom-end","popper-class":"reply-name-popover",offset:t.offset,width:"430",trigger:"click"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[i("el-input",{attrs:{type:"textarea",rows:2,placeholder:t.holder},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}}),i("el-button",{attrs:{size:"mini"},on:{click:t.reply}},[t._v("回复")])],1),i("span",{directives:[{name:"popover",rawName:"v-popover:popoverpicture",arg:"popoverpicture"}],staticClass:"name"},[t._t("default")],2)],1)},x=[],$=i("8028"),k={name:"ReplyName",data:function(){return{input:"",offset:0,show:!1}},mounted:function(){this.offset=this.relative-this.$el.offsetLeft-this.$el.offsetWidth},props:{name:{type:String,required:!0},relative:{type:Number,required:!0},space:Object,comment:Object},computed:{holder:function(){return"回复"+this.name}},methods:{reply:function(){var t=this;if(""!==this.input){var e={spaceId:this.space.id,content:this.input,spaceCommentId:this.comment?this.comment.id:""};$["a"].reply(e,(function(e){t.$emit("updated"),t.show=!1}),(function(t){console.log(t)}))}else this.$notify({title:"警告",message:"评论内容不能为空",type:"warning"})}}},z=k,P=(i("7577"),Object(C["a"])(z,S,x,!1,null,null,null)),O=P.exports,V={name:"CommentItem",data:function(){return{DefaultAvatar:g.a,input:"",content:[],relative1:450}},props:{relative:{type:Number,required:!0},comment:Object,space:Object,topicTitle:{type:String}},computed:{spaceId:function(){return this.comment.id},zanClass:function(){return{"biz-icon-dianzan_normal":"1"!==this.comment.isSupport,active:"1"===this.comment.isSupport,"biz-icon-dianzan_press":"1"===this.comment.isSupport}}},mounted:function(){this.getSpace()},components:{ReplyName:O},methods:{getSpace:function(){var t=this,e={spaceId:this.spaceId,pageable:{pageNumber:1,pageSize:100}};$["a"].getCommentList(e,(function(e){console.log(e),t.content=e.content,t.$emit("refreshComment")}),(function(t){console.log(t)}))},thumbsUp:function(){var t=this,e={spaceId:this.spaceId};h["a"].thumbsUp(e,(function(e){t.$emit("change-thumb-up")}),(function(t){console.log(t)}))}}},N=V,A=(i("cc78"),Object(C["a"])(N,L,D,!1,null,null,null)),j=A.exports,U=i("a3df"),E=i("40ae"),M=i("1ab1"),F=i("c596"),B={name:"Topic",data:function(){return{DefaultAvatar:g.a,relative:460,textarea:"",dynamicVideos:[],form:{fleetId:"",type:"0",dynamicTitle:"",dynamicContent:"",topicContent:"",topicLogoImageUrl:"",topicIntroduction:"",articleCategoryId:""}}},components:{CommentItem:j,BizEditor:E["a"]},props:{topic:Object,spaces:Array},computed:{dynamicImages:function(){var t=[];return t=U["a"].textToImageSrc(this.form.dynamicContent),t}},watch:{spaces:function(t){t&&t.length&&t.forEach((function(t){var e=t.content.split("#")[1],i=new RegExp("#".concat(e,"#"),"g");t.content=t.content.replace(i,'<span style="color:#ff7300;">#'.concat(e,"#</span>"))}))},topic:function(t,e){t.fleet&&t.fleet.id&&(this.form.dynamicContent="",this.form.fleetId=t.fleet.id)}},methods:{operate:function(t){this[t]()},updateTopic:function(){this.$emit("updateTopic")},publish:function(){var t=this;this.dynamicVideos=U["a"].textToVideoSrc1(this.form.dynamicContent);var e={fleet:{id:this.form.fleetId},title:this.form.dynamicTitle,content:'<a style="color:#ff7300;" href="#/community/qa/'.concat(this.topic.id,'">#').concat(this.topic.title,"#</a>")+this.form.dynamicContent,images:this.dynamicImages,videos:this.dynamicVideos,topics:[this.topic]};M["a"].post(F["g"].motoristsClubDynamic.createDynamic,e).then((function(e){t.$message.success("操作成功"),t.$emit("updateTopic"),t.form.dynamicContent=""})).catch((function(e){t.$message.warning(e.errorMessage)}))},changeThumbUp:function(){this.$emit("change-thumb-up")}}},R=B,H=(i("458b"),Object(C["a"])(R,I,_,!1,null,null,null)),q=H.exports,K=i("04d5"),W=i("d6b0"),J=i("7624"),G=i("1f39"),Z=i("f36f"),Q={name:"question-answer-release",data:function(){return{refreshColumn:!1,addTopic:!1,dynamicAuthor:"",topicId:"",topic:{creator:{nickname:""},fleet:{id:"",name:""}},spaces:[],dynamicId:"",previewDialog:!1,activeName:"dynamic-list",popupTabName:"dynamicDetail",popupTabAreaName:"dynamicDetail",topicList:[],topicPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:9},operations:[{label:"添加",name:"add",type:"primary",auth:["admin:space.topic.add"]},{label:"刷新",name:"refresh",type:""},{label:"栏目设置",name:"columnSetting",type:"",auth:["admin:space.topic.set"]}],filters:[{type:"select",label:"车友会",name:"add",value:"",options:[]},{type:"daterange",label:"发布时间：",name:"日期区间：",value:["2017-12-12","2018-02-12"]},{type:"input",label:"",placeholder:"请输入作者/标题进行",name:"add",value:""}],height:"600",openPopup:!1,pictureList:[],textarea:"",visible:!1,checked:!1,logoImageUrl:""}},components:{Dynamic:c["a"],BizPopupTabs:r["a"],BizHeader:l["d"],Topic:q,TopicItem:w,BizPagination:l["f"],DynamicPreview:K["a"],BizEmptyTable:W["a"],ColumnSetting:G["a"],BizGrid:Z["a"]},created:function(){this.resize(),this.initDate(),this.getMotoristsClub(),this.getTopicList(),this.getKPI()},computed:{motoristsClubList:function(){var t,e=[],i=Object(o["a"])(this.filters[0].options);try{for(i.s();!(t=i.n()).done;){var a=t.value;""!==a.value&&e.push(a)}}catch(s){i.e(s)}finally{i.f()}return e}},methods:{onClose:function(){this.openPopup=!1,this.addTopic=!1,this.refreshColumn=!1},columnSetting:function(){console.log("栏目设置"),this.popupTabName="columnSetting",this.popupTabAreaName="columnSetting",this.refreshColumn=!0,this.openPopup=!0},updateTopicList:function(){this.getTopicList()},isActivate:function(t){return this.popupTabAreaName===t},updateTopic:function(){this.getTopic()},initDate:function(){this.filters[1].value[0]=d["a"].lastMonthDate(),this.filters[1].value[1]=d["a"].nowDate()},openpusharticle:function(){this.visible=!0},emojiChoosed:function(t){this.textarea=this.textarea.concat(t)},uploadLogoSuccess:function(t,e){this.logoImageUrl=e.url},pictureUploadSuccess:function(t,e,i){this.pictureList=i},pictureRemoveSuccess:function(t,e){this.pictureList=e},beyondLimit:function(){this.$message({message:"最多只能上传9张图片",type:"warning"})},operate:function(t){this[t]()},filterDataChange:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.refresh();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),add:function(){0!==this.motoristsClubList.length?(this.addTopic=!0,this.topicId="",this.popupTabName="topicEditor",this.popupTabAreaName="topicDetail",this.openPopup=!0):this.$message({type:"warning",message:"车友会为空，不能新建！"})},getKPI:function(){var t=this,e={};h["a"].getKPI(e,(function(e){var i="今日新增动态"+e.data.daySpaceCount+"条,今日新增话题"+e.data.dayTopicCount+"条。";t.$message({customClass:"motorists-club-dynamic-kpi",showClose:!0,message:i})}),(function(t){console.log(t)}))},searchKeyWord:function(){this.refresh()},deleteTopic:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var i=[];i.push(t);var a={ids:i};h["a"].deleteTopic(a,(function(t){e.$message({type:"success",message:"删除成功!"}),e.refresh()}),(function(t){e.$message({type:"warning",message:t.errorMessage})}))})).catch((function(){}))},resize:function(){var t=document.documentElement.clientHeight||window.innerHeight;this.height=String(t-246)},selectTopic:function(t){var e=this;this.topicId=t,this.addTopic=!1,this.popupTabAreaName="topicDetail",this.popupTabName="topicEditor",this.$nextTick((function(){e.$refs.dynamic.refresh(e.topicId)})),this.openPopup=!0,this.getTopic()},handleTopicSizeChange:function(t){this.topicPagination.pageSize=t,this.getTopicList()},handleTopicCurrentChange:function(t){this.topicPagination.currentPage=t,this.getTopicList()},refresh:function(){this.getTopicList(),this.openPopup=!1,this.$refs.dynamic.clearForm()},getTopic:function(){var t=this,e={topicId:this.topicId};h["a"].selectTopic(e,(function(e){t.topic=e.data,t.spaces=e.spaces;var i,a=Object(o["a"])(t.spaces);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.content=J["a"].transform(s.content)}}catch(n){a.e(n)}finally{a.f()}}),(function(t){console.log(t)}))},getTopicList:function(){var t=this,e={pageable:{pageNumber:this.topicPagination.currentPage,pageSize:this.topicPagination.pageSize},keyword:this.filters[2].value,shopId:window.top.SHOP_ID||"",fleetId:this.filters[0].value,memberId:"",beginDate:this.filters[1].value[0],endDate:this.filters[1].value[1]};h["a"].getTopicList(e,(function(e){t.topicPagination.total=Number(e.total||1),t.topicList=e.content}),(function(t){console.log(t),console.log("code错误")}))},getMotoristsClub:function(){var t=this,e={shopId:window.top.SHOP_ID};h["a"].getMotoristsClub(e,(function(e){t.filters[0].options=[],t.filters[0].options.push({value:"",label:"全部",head:""});var i,a=Object(o["a"])(e.content);try{for(a.s();!(i=a.n()).done;){var s=i.value;t.filters[0].options.push({value:s.id,label:s.name,head:s.head})}}catch(n){a.e(n)}finally{a.f()}}),(function(t){console.log(t),console.log("code错误")}))},changeThumbUp:function(){this.getTopic()}}},X=Q,Y=(i("887b"),Object(C["a"])(X,a,s,!1,null,null,null));e["default"]=Y.exports},"887b":function(t,e,i){"use strict";var a=i("3653"),s=i.n(a);s.a},a3df:function(t,e,i){"use strict";i("ac1f"),i("466d"),i("841c");var a=i("b85c");e["a"]={textToImg:function(t){var e=/<img.*?(?:>|\/>)/gi;return t.match(e)},textToIframe:function(t){var e=/<iframe.*?(?:>|\/>)/gi;return t.match(e)},textToImageSrc:function(t){var e,i=/<img.*?(?:>|\/>)/gi,s=/src=[\\'\\"]?([^\\'\\"]*)[\\'\\"]?/i,n=t.match(i)||[],o=[],c=Object(a["a"])(n);try{for(c.s();!(e=c.n()).done;){var r=e.value,l=r.match(s);o.push(l[1])}}catch(d){c.e(d)}finally{c.f()}return o},textToVideoSrc:function(t){var e,i=/<iframe.*?(?:>|\/>)/gi,s=/src=[\\'\\"]?([^\\'\\"]*)[\\'\\"]?/i,n=t.match(i)||[],o=[],c=Object(a["a"])(n);try{for(c.s();!(e=c.n()).done;){var r=e.value,l=r.match(s);o.push(l[1])}}catch(d){c.e(d)}finally{c.f()}return o},textToVideoSrc1:function(t){var e,i=/<video.*?(?:>|\/>)/gi,s=/src=[\\'\\"]?([^\\'\\"]*)[\\'\\"]?/i,n=t.match(i)||[],o=[],c=Object(a["a"])(n);try{for(c.s();!(e=c.n()).done;){var r=e.value,l=r.match(s);o.push(l[1])}}catch(d){c.e(d)}finally{c.f()}return o},contentToVideoSrc:function(t){var e,i=/<iframe.*?(?:>|\/>)/gi,s=/src=[\\'\\"]?([^\\'\\"]*)[\\'\\"]?/i,n=t.match(i)||[],o=[],c=Object(a["a"])(n);try{for(c.s();!(e=c.n()).done;){var r=e.value;if(console.log(r),-1!==r.search(/biz_video_iframe/)){var l=r.match(s);o.push(l[1])}}}catch(d){c.e(d)}finally{c.f()}return o}}},b04b:function(t,e,i){},b51a:function(t,e,i){},c174:function(t,e,i){"use strict";var a=i("d2f5"),s=i.n(a);s.a},cc78:function(t,e,i){"use strict";var a=i("43cdc"),s=i.n(a);s.a},d2f5:function(t,e,i){},d74a:function(t,e,i){"use strict";var a=i("21c5"),s=i.n(a);s.a},de0f:function(t,e,i){"use strict";var a=i("b04b"),s=i.n(a);s.a},f372:function(t,e,i){"use strict";var a=i("73a8"),s=i.n(a);s.a}}]);