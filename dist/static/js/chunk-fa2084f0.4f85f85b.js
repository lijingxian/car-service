(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fa2084f0"],{"075d":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"apply-info"},[a("div",{staticClass:"apply-info-div"},[a("div",{staticClass:"apply-info-content"},[a("div",{staticClass:"apply-top-content"},[a("div",{staticClass:"apply-follow-up",on:{click:function(t){return e.onOrderSchedules(e.orderData.id)}}},[a("span",[e._v("申请单跟踪")]),a("div",{staticClass:"apply-state"},[a("span",[e._v(e._s(e.getOrderState))]),a("i",{staticClass:"el-icon-arrow-right",staticStyle:{"margin-left":"10px",color:"#808080"}})])]),a("div",{staticClass:"receiver-info"},[a("span",[e._v(e._s(e.orderData.receiver?e.orderData.receiver.consignee:""))]),a("span",[e._v(e._s(e.orderData.receiver?e.orderData.receiver.phone:""))]),a("p",[a("i",{staticClass:"el-icon-location-outline",staticStyle:{"margin-right":"5px"}}),e._v(" "+e._s(e.orderData.receiver?e.orderData.receiver.address:"")+" ")])])]),a("div",{staticClass:"apply-info-new"},[a("div",{staticClass:"shop-name",on:{click:e.goSupplier}},[a("img",{attrs:{src:e.iconShop}}),a("span",{staticStyle:{fontSize:"14px"}},[e._v(e._s(e.orderData.shop?e.orderData.shop.name:""))])]),e._l(e.orderData.itemDatas,(function(t,i){return a("div",{key:i},[a("div",{staticClass:"good-info"},[a("div",{staticClass:"goods-img"},[a("img",{ref:"img",refInFor:!0,staticClass:"img",attrs:{src:t.thumbnail&&t.thumbnail.indexOf("/")>=0?t.thumbnail:e.defaultImg},on:{error:function(t){return e.imgError(i)}}})]),a("div",{staticClass:"good-right"},[a("div",{staticClass:"good-name"},[a("span",{staticStyle:{flex:"1"}},[e._v(e._s(t.specValue)+" ")])]),a("div",{staticStyle:{"margin-bottom":"10px"}},[t.product.barCode?a("span",{staticStyle:{"font-size":"14px","margin-right":"10px"}},[e._v(e._s(t.product.barCode))]):e._e()]),a("div",{staticClass:"good-price"},[a("span",[e._v("￥"+e._s(t.price))]),a("span",[e._v("X"+e._s(t.amount))])])])])])}))],2),a("div",{staticClass:"price-info-content"},[a("div",{staticClass:"total-price"},[a("span",[e._v("合计")]),a("span",{staticStyle:{color:"red"}},[e._v("￥"+e._s(e.orderData.totalFee))])])]),a("div",{staticClass:"pay-type"},[a("span",[e._v("单据编号: "+e._s(e.orderData.sn))]),a("span",[e._v("创建时间: "+e._s(e.orderData.createDate))]),a("span",[e._v("申请人: "+e._s(e.orderData.applierName))])])])]),e.isPend?a("div",{staticStyle:{float:"right"},attrs:{slot:"bottom"},slot:"bottom"},["1"===e.orderData.state&&"1"===e.orderData.audit||"2"===e.orderData.state&&"1"===e.orderData.audit?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.toPass(e.orderData,"1")}}},[e._v("审核")]):e._e(),"0"===e.orderData.state?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.statusChange(e.orderData,"0")}}},[e._v("提交")]):e._e(),"1"===e.orderData.state&&"1"===e.orderData.isApplier?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.statusChange(e.orderData,"3")}}},[e._v("撤回")]):e._e()],1):e._e(),a("el-dialog",{attrs:{visible:e.dialogVisiable,center:"",width:"800px","min-height":"400px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(t){e.dialogVisiable=t}}},[a("apply-follow",{ref:"invoice"})],1),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.showPassOrder,center:"","append-to-body":"","custom-class":"close-order-dialog",title:"审核"},on:{"update:visible":function(t){e.showPassOrder=t}}},[a("div",[a("div",{staticClass:"reson-container"},[a("span",[e._v("审核结果：")]),a("el-radio",{attrs:{label:"1",size:"mini"},model:{value:e.auditState,callback:function(t){e.auditState=t},expression:"auditState"}},[e._v("通过")]),a("el-radio",{attrs:{label:"2",size:"mini"},model:{value:e.auditState,callback:function(t){e.auditState=t},expression:"auditState"}},[e._v("驳回")]),a("div",{directives:[{name:"show",rawName:"v-show",value:"2"===e.auditState,expression:"auditState==='2'"}],staticStyle:{padding:"5px 0px","margin-top":"15px"}},[a("span",[e._v("驳回理由：")]),a("el-select",{staticClass:"order-select",attrs:{placeholder:"请选择驳回理由",size:"mini"},model:{value:e.curSelectCloseReason,callback:function(t){e.curSelectCloseReason=t},expression:"curSelectCloseReason"}},e._l(e.reasonList,(function(e){return a("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-input",{staticStyle:{"margin-top":"15px"},attrs:{type:"textarea"},model:{value:e.remarks,callback:function(t){e.remarks=t},expression:"remarks"}})],1)]),a("div",{staticClass:"close-button",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.showPassOrder=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.statusChange(e.row,e.auditState)}}},[e._v("确定")])],1)])],1)},r=[],o=(a("d3b7"),a("5530")),n=a("f36f"),s=a("2f62"),l=a("1ab1"),c=a("c596"),d=a("e83a"),p=a.n(d),m=a("f606"),u=a.n(m),f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"order-log-info"},[a("div",{staticStyle:{"text-align":"center","font-size":"15px","margin-bottom":"20px"}},[e._v("单据进度跟踪")]),a("el-steps",{attrs:{direction:"vertical",space:"auto"}},[a("el-step",{attrs:{title:"新申请",status:"1"===e.active?"finish":"wait "}},[a("div",{attrs:{slot:"description"},slot:"description"},e._l(e.orderData.schedules,(function(t,i){return"0"===t.state||"1"===t.state?a("div",{key:i,staticClass:"logInfo"},[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s("0"===t.state?"已创建":"已提交"))]),a("p",[e._v(e._s(t.time))])]):e._e()})),0)]),a("el-step",{attrs:{title:"审核",status:"2"===e.active?"finish":"wait "}},[a("div",{attrs:{slot:"description"},slot:"description"},[e._l(e.orderData.schedules,(function(t,i){return"3"===t.state?a("div",{key:i},[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(t.adminName+"已通过"))]),a("p",[e._v("备注："+e._s(t.remarks))]),a("p",[e._v(e._s(t.time))])]):e._e()})),e._l(e.orderData.schedules,(function(t,i){return"4"===t.state?a("div",{key:i},[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(t.adminName+"审核不通过"))]),a("p",[e._v("理由："+e._s(t.details))]),a("p",[e._v("备注："+e._s(t.remarks))]),a("p",[e._v(e._s(t.time))])]):e._e()}))],2)]),a("el-step",{attrs:{title:"审核通过/驳回",status:"3"===e.active?"finish":"wait "}},[a("div",{attrs:{slot:"description"},slot:"description"},["3"===e.orderData.state?a("div",[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s("审核通过"))])]):e._e(),"4"===e.orderData.state?a("div",[a("p",{staticStyle:{"margin-right":"20px"}},[e._v(e._s("审核驳回"))])]):e._e()])])],1)],1)},g=[],h={name:"NewsMgmt",props:{},data:function(){return{loading:!1,orderData:[],active:"",state:""}},components:{},watch:{},created:function(){},computed:{getOrderLogState:function(e){switch(this.state){case"0":return"已创建";case"1":return"已提交";case"2":return"审核中";case"3":return"已通过";case"4":return"审核通过";default:return""}}},methods:{operate:function(e){this[e]()},getList:function(e){var t=this,a={id:e};l["a"].get(c["g"].invoicing.purchaseApplyMgmt.purchaseApplyNew,a).then((function(e){t.orderData=e.data})).catch((function(){})).finally((function(){}))}}},b=h,v=(a("9ce9"),a("2877")),y=Object(v["a"])(b,f,g,!1,null,null,null),C=y.exports,I={name:"apply-info",data:function(){return{orderData:{},iconShop:u.a,defaultImg:p.a,dialogVisiable:!1,showPassOrder:!1,loading:!1,remarks:"",auditState:"1",row:{},curSelectCloseReason:"申报的商品与实际需要采购的商品不符",reasonList:[{label:"申报的商品与实际需要采购的商品不符",value:"申报的商品与实际需要采购的商品不符"},{label:"送达仓库地址填写错误",value:"送达仓库地址填写错误"},{label:"申报的商品供应方已停售或缺货",value:"申报的商品供应方已停售或缺货"},{label:"申报的商品数量有误",value:"申报的商品数量有误"},{label:"已与部分商品供应商终止合作",value:"已与部分商品供应商终止合作"},{label:"其他原因",value:"其他原因"}]}},props:{itemId:{type:String,default:""},isPend:{type:Boolean,default:!1}},watch:{itemId:function(e){this.getOrderInfo()}},components:{BizGrid:n["a"],ApplyFollow:C},computed:Object(o["a"])(Object(o["a"])({},Object(s["c"])(["getUser"])),{},{getOrderState:function(){switch(this.orderData.state){case"0":return"已创建";case"1":return"已提交";case"2":return"审核中";case"3":return"已通过";case"4":return"已驳回";default:return""}}}),methods:{goSupplier:function(){},showToast:function(e){this.$createToast({time:1e3,txt:e,type:"warn"}).show()},onOrderSchedules:function(e){var t=this;this.dialogVisiable=!0,this.$nextTick((function(){t.$refs.invoice.getList(e)}))},toPass:function(e,t){this.remarks="",this.row=e,this.showPassOrder=!0},getOrderInfo:function(){var e=this,t={id:this.itemId};l["a"].get(c["g"].invoicing.purchaseApplyMgmt.purchaseApplyNew,t).then((function(t){e.orderData=t.data})).catch((function(){})).finally((function(){}))},statusChange:function(e,t){var a=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0;var i={shopId:window.top.SHOP_ID||"",id:e.id,actionType:t,details:"2"===t?a.curSelectCloseReason:"",remarks:a.remarks};l["a"].post("/admin/invoicing/purchase/agentPurchaseApplyState.jhtml",i).then((function(e){a.$message.success("操作成功！"),a.showPassOrder=!1,a.loading=!1,a.$emit("operationSuccess")})).catch((function(e){a.loading=!1,e.errorMessage&&a.$message.warning(e.errorMessage)})).finally((function(){}))}))}},created:function(){}},w=I,S=(a("a751"),Object(v["a"])(w,i,r,!1,null,null,null));t["a"]=S.exports},"0943":function(e,t,a){"use strict";var i=a("1fac"),r=a.n(i);r.a},"0a05":function(e,t,a){},"0d40":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sales-apply-mgmt"},[a("biz-flex-table",{ref:"table",staticClass:"sales-apply-mgmt-tabel",attrs:{operations:e.operations,filters:e.filters,showSummary:!0,tableData:e.tableData,pagination:e.pagination},on:{operate:e.operate,"filter-data-change":e.filterDataChange,"selection-change":e.handleSelectionChange,"row-click":e.rowClick,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{label:"订单","min-width":"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(e._s(t.row.sn))]),a("div",{staticClass:"overflow"},[e._v("创建日期："+e._s(t.row.createDate))]),a("div",{staticClass:"overflow"},[e._v("状态："+e._s(e.getStatus(t.row)))])])]}}])}),a("el-table-column",{attrs:{label:"代理商","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" "+e._s(t.row.agent?t.row.agent.name:"")+" ")])])]}}])}),a("el-table-column",{attrs:{label:"金额","min-width":"120px",prop:"amount"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"overflow"},[e._v(" 不含税： ")]),a("div",[e._v(" 税额： ")]),a("div",[e._v(" 含税："+e._s(t.row.totalFee)+" ")])])]}}])}),a("el-table-column",{attrs:{label:"商品信息","min-width":"220px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[a("div",{staticStyle:{width:"100%"}},e._l(t.row.itemDatas.length>0?[t.row.itemDatas[0]]:[],(function(i){return a("div",{key:i.sn,staticClass:"product-info-content"},[i.thumbnail&&" "!==i.thumbnail?a("img",{attrs:{src:i.thumbnail,onerror:e.errorImg}}):a("img",{attrs:{src:"/resources/admin/images/default/product-default-100.png"}}),a("div",{staticClass:"wrapper"},[a("div",{staticClass:"titleClass",attrs:{title:i.name}},[e._v(e._s(i.name))]),a("div",{staticClass:"overflow"},[e._v(e._s(i.product?i.product.barCode:""))]),a("div",{staticClass:"overflow"},[e._v("单价(不含税)：")]),a("div",{staticClass:"overflow"},[e._v("单价(含税)："+e._s(i.price))])]),a("div",{staticClass:"amount"},[e._v(e._s(i.amount)+e._s(t.row.itemDatas.length>1?"...":""))])])})),0)])]}}])}),a("el-table-column",{attrs:{prop:"",label:"申请状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.getStatus(t.row)))]}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("biz-column-operation",{attrs:{row:t.row}},["1"===t.row.state&&"1"===t.row.audit||"2"===t.row.state&&"1"===t.row.audit?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.toPass(t.row,"1")}}},[e._v("审核")]):e._e(),"0"===t.row.state?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.statusChange(t.row,"0")}}},[e._v("提交")]):e._e(),"1"===t.row.state&&"1"===t.row.isApplier?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.statusChange(t.row,"3")}}},[e._v("撤回")]):e._e(),"0"===t.row.state?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.deleteApply(a,t.row)}}},[e._v("删除")]):e._e(),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.printApply(t.row)}}},[e._v("凭证")])],1)]}}])})],1),a("biz-popup-tabs",{attrs:{open:e.openAdd},on:{close:function(t){e.openAdd=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"添加申请单",name:"addinfo"}},[e.step1?a("base-info",{on:{step1Confirm:e.step1Confirm}}):e._e(),e.step2?a("product-info",{attrs:{formData:e.formData},on:{step2Confirm:e.step2Confirm,operationSuccess:e.operationSuccess}}):e._e()],1)],1),a("biz-popup-tabs",{attrs:{open:e.open},on:{close:function(t){e.open=!1}},model:{value:e.tabNameInfo,callback:function(t){e.tabNameInfo=t},expression:"tabNameInfo"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[a("apply-info",{ref:"info",attrs:{itemId:e.itemId,isPend:e.isPend}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openPurchaseOrder},on:{close:function(t){e.openPurchaseOrder=!1}},model:{value:e.relateBillPurchaseOrder,callback:function(t){e.relateBillPurchaseOrder=t},expression:"relateBillPurchaseOrder"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"baseinfo"}},[a("purchase-order-base-info",{ref:"purchaseInfo",attrs:{orderId:e.relateBillPurchaseOrderId,isEdit:e.isEdit,isRalateBill:e.isRalateBill},on:{closeTabByLogistics:e.closeTabByLogistics,closeTabByEvaluate:e.closeTabByEvaluate}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openReview},on:{close:function(t){e.openReview=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"评价",name:"reviewinfo"}},[a("my-evaluate",{ref:"reviewinfo",attrs:{orderId:e.orderId,editable:e.editable},on:{operationSuccess:e.operationSuccess}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openRelateBillOrder},on:{close:function(t){e.openRelateBillOrder=!1}},model:{value:e.relateBillOrder,callback:function(t){e.relateBillOrder=t},expression:"relateBillOrder"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"baseinfo"}},[a("order-base-info",{attrs:{itemId:e.relateBillOrderId,isEdit:e.isEdit}})],1),a("el-tab-pane",{attrs:{label:"商品信息",name:"productinfo"}},[a("order-product-info",{attrs:{itemId:e.relateBillOrderId,isEdit:e.isEdit}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openLogistics},on:{close:function(t){e.openLogistics=!1}},model:{value:e.tabNameLogistics,callback:function(t){e.tabNameLogistics=t},expression:"tabNameLogistics"}},[a("el-tab-pane",{attrs:{label:"物流追踪",name:"loginfo"}},[a("logistics-following",{ref:"logistics",attrs:{orderId:e.orderId,sn:e.sn}})],1)],1),a("el-dialog",{attrs:{visible:e.dialogTableVisible,center:"",width:"800px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"left"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.print}},[e._v("打印")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.exportInvoice}},[e._v("导出")])],1)])],1),a("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[e._v(e._s(e.title))])]),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"center"}},[e._v("打印日期："+e._s(e.formatDate((new Date).getTime())))])])],1),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("编号："+e._s(e.form.sn))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("创建时间："+e._s(e.form.createDate))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("申请人："+e._s(e.form.applierName))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("总金额(元)："+e._s(e.form.totalFee))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("备注："+e._s(e.form.remark))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("状态："+e._s(e.form.state))])])],1),a("el-table",{staticClass:"table-class",attrs:{data:e.gridData,"show-summary":""}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),a("el-table-column",{attrs:{property:"specValue",label:"商品名称","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.specValue))]}}])}),a("el-table-column",{attrs:{property:"product.barCode",label:"条码"}}),a("el-table-column",{attrs:{property:"amount",label:"采购数量"}}),a("el-table-column",{attrs:{property:"price",label:"金额(元)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("￥"+e._s(t.row.price))]}}])}),a("el-table-column",{attrs:{property:"totalFee",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("￥"+e._s(t.row.totalFee))]}}])})],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticStyle:{float:"right","padding-right":"100px"}},[e._v("客户签字：")])])],1)],1)])],1),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.showPassOrder,center:"","append-to-body":"","custom-class":"close-order-dialog",title:"审核"},on:{"update:visible":function(t){e.showPassOrder=t}}},[a("div",[a("div",{staticClass:"reson-container"},[a("span",[e._v("审核结果：")]),a("el-radio",{attrs:{label:"1",size:"mini"},model:{value:e.auditState,callback:function(t){e.auditState=t},expression:"auditState"}},[e._v("通过")]),a("el-radio",{attrs:{label:"2",size:"mini"},model:{value:e.auditState,callback:function(t){e.auditState=t},expression:"auditState"}},[e._v("驳回")]),a("div",{directives:[{name:"show",rawName:"v-show",value:"2"===e.auditState,expression:"auditState==='2'"}],staticStyle:{padding:"5px 0px","margin-top":"15px"}},[a("span",[e._v("驳回理由：")]),a("el-select",{staticClass:"order-select",attrs:{placeholder:"请选择驳回理由",size:"mini"},model:{value:e.curSelectAjectReason,callback:function(t){e.curSelectAjectReason=t},expression:"curSelectAjectReason"}},e._l(e.reasonAjectList,(function(e){return a("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-input",{staticStyle:{"margin-top":"15px"},attrs:{type:"textarea"},model:{value:e.remarks,callback:function(t){e.remarks=t},expression:"remarks"}})],1)]),a("div",{staticClass:"close-button",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.showPassOrder=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.statusChange(e.row,e.auditState)}}},[e._v("确定")])],1)])],1)},r=[],o=(a("99af"),a("4160"),a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("ac1f"),a("3ca3"),a("466d"),a("1276"),a("159b"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),n=a("5530"),s=a("7132"),l=a("04d3"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"apply-base-info"},[a("div",{attrs:{slot:"top"},slot:"top"},[a("div",{staticClass:"header-step"},[a("div",{staticClass:"step-1"},[a("span",[e._v("①")]),a("span",[e._v("填写基本信息")]),a("span",[e._v(">")])]),a("div",{staticClass:"step-2"},[a("span",[e._v("②")]),a("span",[e._v("选择商品")])])])]),a("biz-save-button",{attrs:{slot:"bottom",operations:e.operations},on:{operate:e.operate},slot:"bottom"}),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px",size:"small","inline-message":!0}},[a("el-form-item",{attrs:{label:"供应商",prop:"relatePartnerName"}},[a("el-input",{attrs:{placeholder:"请选择供应商"},on:{focus:function(t){e.showDialog=!0}},model:{value:e.form.relatePartnerName,callback:function(t){e.$set(e.form,"relatePartnerName",t)},expression:"form.relatePartnerName"}})],1),a("el-form-item",{attrs:{label:"送达仓库",prop:"depot"}},[a("el-card",{attrs:{placeholder:"请选择送达仓库"},nativeOn:{click:function(t){return e.depotButtonClick(t)}}},[a("div",{staticClass:"top",staticStyle:{"font-weight":"bold"}},[a("span",[e._v(e._s(e.form.depot.name))])]),a("div",{staticClass:"content"},[a("span",{staticStyle:{"margin-right":"15px"}},[e._v(e._s(e.form.depot.contactor))]),a("span",[e._v(e._s(e.form.depot.phone))])]),a("div",{staticClass:"bottom"},[a("span",[e._v(e._s(e.form.depot.address))])])])],1)],1),a("biz-dialog-selector",{staticClass:"supplierDialog",attrs:{title:"选择供应商",visibility:e.showDialog,appendToBody:!0,tableData:e.dialogTableData,pagination:e.dialogPagination,selectionMode:"single",isClear:!1,filters:e.dialogFilters},on:{"update:visibility":function(t){e.showDialog=t},open:e.opened,confirmed:e.handleConfirmed,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange}},[a("el-table-column",{attrs:{label:"供应商名称",width:"200px",prop:"name"}}),a("el-table-column",{attrs:{prop:"address",label:"地址"}}),a("el-table-column",{attrs:{prop:"phone",label:"电话"}})],1),a("biz-dialog-selector",{staticClass:"depotDialog",attrs:{title:"选择仓库",visibility:e.showDepotDialog,appendToBody:!0,tableData:e.dialogDepotTableData,pagination:e.dialogDepotPagination,selectionMode:"single",isClear:!1,filters:e.dialogDepotFilters},on:{"update:visibility":function(t){e.showDepotDialog=t},open:e.openedDepot,confirmed:e.handleDepotConfirmed,filterDataChange:e.dialogDepotFilterDataChange,pageSizeChange:e.dialogDepotPageSizeChange,currentPageChange:e.dialogDepotCurrentPageChange}},[a("el-table-column",{attrs:{label:"名称",prop:"name"}}),a("el-table-column",{attrs:{label:"联系人",prop:"contactor"}}),a("el-table-column",{attrs:{prop:"address",label:"地址"}}),a("el-table-column",{attrs:{prop:"phone",label:"电话"}})],1)],1)},d=[],p=a("f36f"),m=a("8330"),u=a("af3f"),f=a("2f62"),g=a("1ab1"),h=a("c596"),b=function(){return{relatePartnerId:"",relatePartnerName:"",relatePartnerType:"",totalFee:"",billType:"",sn:"",applierId:"",applierName:"",relateBill:"",relateBillType:"",discountRate:"0",discontFee:"",auditLevel:"",state:"",id:"",createDate:"",shopId:"",shop:{},depot:{id:"",name:"",address:"",phone:"",contactor:""}}},v={name:"baseInfo",props:{itemId:{type:String}},components:{BizGrid:p["a"],BizSaveButton:m["a"],BizDialogSelector:u["a"]},data:function(){var e=this;return{loading:!1,showDialog:!1,showDepotDialog:!1,dialogVisible:!1,form:b(),totalFee:0,itemDatas:[],operations:[{label:"确定",name:"save",type:"primary"}],dialogTableData:[],dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},dialogFilters:[{type:"input",label:"",placeholder:"请输入供应商名称",name:"searchValue",value:""}],dialogDepotTableData:[],dialogDepotPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},dialogDepotFilters:[{type:"input",label:"",placeholder:"请输入仓库名称",name:"searchValue",value:""}],rules:{relatePartnerName:[{required:!0,message:"请选择供应商",trigger:["blur","change"]}],depot:[{required:!0,trigger:["blur","change"],validator:function(t,a,i){""!==e.form.depot.name?i():i(new Error("请选择送达仓库"))}}]}}},computed:{},created:function(){},watch:{},methods:Object(n["a"])(Object(n["a"])({},Object(f["c"])(["getUser"])),{},{operate:function(e){this[e]()},getDefaultModel:function(){return b()},save:function(){var e=this;this.$refs.form.validate((function(t,a){if(!t)return!1;e.$emit("step1Confirm",e.form)}))},opened:function(){this.dialogTableData=[],this.getSupplier()},getSupplier:function(){var e=this;this.loading=!0;var t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[0].value,shopId:window.top.SHOP_ID||"",cooperationType:"0",state:"1"};g["a"].get(h["g"].invoicing.supplierMgmt.shopSupplierList,t).then((function(t){e.loading=!1,e.dialogTableData=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(t){e.loading=!1,t.errorMessage&&console.log(t.errorMessage)}))},depotButtonClick:function(){this.openedDepot()},openedDepot:function(){this.dialogDepotTableData=[],this.getDepotList(),this.showDepotDialog=!0},getDepotListParams:function(){return{shopId:window.top.SHOP_ID||"",state:"1",pageSize:this.dialogDepotPagination.pageSize,pageNumber:this.dialogDepotPagination.currentPage,name:this.dialogDepotFilters[0].value}},getDepotList:function(){var e=this;g["a"].get(h["g"].invoicing.storeHouseMgmt.shopDepotList,this.getDepotListParams()).then((function(t){e.dialogDepotTableData=t.dataList,e.dialogDepotPagination.total=Number(t.total)})).catch((function(t){console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getSupplier()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getSupplier()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getSupplier()},dialogDepotPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getSupplier()},dialogDepotCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getSupplier()},dialogDepotFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getSupplier()},handleConfirmed:function(e,t){this.form.relatePartnerName=t[0].name,this.form.relatePartnerId=t[0].id},handleDepotConfirmed:function(e,t){this.form.depot.id=t[0].id,this.form.depot.name=t[0].name,this.form.depot.address=t[0].address,this.form.depot.phone=t[0].phone,this.form.depot.contactor=t[0].contactor,this.$refs.form.clearValidate("depot")}})},y=v,C=(a("a08c"),a("2877")),I=Object(C["a"])(y,c,d,!1,null,null,null),w=I.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"product-info"},[a("div",{attrs:{slot:"bottom"},slot:"bottom"},[a("div",{staticClass:"subTotal"},[a("div",{staticStyle:{"margin-right":"100px","margin-top":"5px"}},[e._v(" 合计: "),a("span",{staticClass:"price"},[e._v("￥"+e._s(e.totalFee?e.totalFee:"0.00"))])]),a("biz-save-button",{attrs:{operations:e.operations},on:{operate:e.operate}})],1)]),a("div",{attrs:{slot:"top"},slot:"top"},[a("div",{staticClass:"header-step"},[a("div",{staticClass:"step-1",on:{click:e.returnStepOne}},[a("span",[e._v("①")]),a("span",[e._v("填写基本信息")]),a("span",[e._v(">")])]),a("div",{staticClass:"step-2"},[a("span",[e._v("②")]),a("span",[e._v("选择商品")])])]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addProduct}},[e._v("添加商品")])],1),a("biz-list",{key:Math.random(),ref:"table",attrs:{tableData:e.tableData,height:"100%"}},[a("el-table-column",{attrs:{prop:"productName",label:"商品","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[a("div",{staticStyle:{width:"100%","margin-right":"30px"}},[a("div",{staticClass:"product-info"},[t.row.image?a("img",{attrs:{src:t.row.image}}):a("img",{attrs:{src:"/resources/admin/images/default/product-default-100.png"}}),a("div",{staticClass:"wrapper"},[a("div",{staticClass:"titleClass",attrs:{title:t.row.productName}},[e._v(e._s(t.row.productName))]),a("div",{staticClass:"info-bottom"},[a("div",{staticStyle:{color:"red"}},[e._v("￥"+e._s(t.row.price))])])])])])])]}}])}),a("el-table-column",{attrs:{prop:"barCode",label:"条码"}}),a("el-table-column",{attrs:{prop:"amount",label:"数量","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{attrs:{size:"mini",min:1},on:{change:function(a){return e.amountChange(t.row.amount)}},model:{value:t.row.amount,callback:function(a){e.$set(t.row,"amount",a)},expression:"scope.row.amount"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作",type:"index","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteHandeler(t)}}},[e._v("删除")])],1)])}}])})],1),a("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:e.showDialog,tableData:e.giftList,pagination:e.dialogPagination,filters:e.dialogFilters,selectionKeys:e.selectedGiftIds},on:{"update:visibility":function(t){e.showDialog=t},pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,confirmed:e.confirmedProduct,filterDataChange:e.dialogFilterDataChange,selectionChange:e.selectionChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"400px"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-two-column"},[a("img",{attrs:{src:t.row.image||e.defaultImg,onerror:e.errorImg}}),a("div",{staticClass:"biz-two-row"},[a("div",{staticStyle:{"margin-left":"10px","font-size":"14px"}},[e._v(e._s(t.row.name))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("编号："+e._s(t.row.sn))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("规格："+e._s(t.row.fullName&&-1!==t.row.fullName.indexOf("[")?t.row.fullName.split("[")[1].split("]")[0]:""))])])])])}}])}),a("el-table-column",{attrs:{property:"barCode",label:"条码"}}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),a("el-table-column",{attrs:{property:"price",label:"价格"}}),a("el-table-column",{attrs:{label:"在库库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.realStock))])]}}])})],1)],1)},_=[],D=(a("c975"),a("a434"),a("b680"),a("25f0"),a("7558")),T=a("f3ac"),k=a.n(T),M={name:"ProductInfo",props:{formData:{type:Object}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},errorImg:'this.src="/resources/admin/images/default/product-default.png"',selectedGiftList:[],selectedGiftIds:[],selectionList:[],showDialog:!1,DefaultImg:k.a,dialogFilters:[{type:"input",placeholder:"请输入编号/商品名/条码",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,totalFee:"",height:"585",tableData:[],selections:[],itemDatas:[],dialogTableVisible:!1,title:"",operations:[{label:"确定申请",name:"save",type:"primary"}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:D["a"],BizGrid:p["a"],BizSaveButton:m["a"],BizDialogSelector:u["a"]},watch:{},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},methods:Object(n["a"])(Object(n["a"])({},Object(f["c"])(["getUser"])),{},{returnStepOne:function(){this.$emit("step2Confirm")},addProduct:function(){this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getGiftList()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getGiftList()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getGiftList()},getGiftList:function(){var e=this,t={supplierId:this.formData.relatePartnerId,searchValue:this.dialogFilters[0].value,shopId:window.top.SHOP_ID||"",pageNumber:this.dialogPagination.currentPage,pageSize:this.dialogPagination.pageSize};g["a"].get("/admin/purchaseOrder/supplierProducts.jhtml",t).then((function(t){e.giftList=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},confirmedProduct:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(e.amount="1",e.productName=e.fullName,t.selectedGiftList.push(e))}));this.selectedGiftList.map((function(e){Number(e.amount)*Number(e.price)})),this.selectedGiftList.forEach((function(e){t.handleSelect(e)}))},operate:function(e){this[e]()},handleSelect:function(e){var t=!1;if(e.productId=e.id,e.id="",this.totalFee=(Number(this.totalFee)+Number(e.amount)*Number(e.price)).toFixed(2),0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].productId===e.productId){this.tableData[a].amount=(Number(this.tableData[a].amount)+1).toString(),t=!0;break}t||this.tableData.push(e)}else this.tableData.push(e)},deleteHandeler:function(e){this.tableData.splice(e.$index,1),this.totalFee=(Number(this.totalFee)-Number(e.row.price)*Number(e.row.amount)).toFixed(2)},save:function(){var e=this;this.itemDatas=this.tableData.map((function(e){return{productId:e.productId?e.productId:e.id,amount:e.amount||"",price:e.price||"",image:e.image||"",productName:e.fullName,specId:e.specId||"",specValue:e.specValue||"",totalFee:e.amount*e.price||"",categoryId:e.categoryId,categoryName:e.categoryName}}));var t=!1;if(this.tableData.forEach((function(a){-1!==String(a.amount).indexOf(".")&&(e.$message.warning("数量不能为小数"),t=!0)})),t)return!1;var a={shopId:window.top.SHOP_ID||"",relatePartnerId:this.formData.relatePartnerId,depot:{id:this.formData.depot.id},itemDatas:this.itemDatas};g["a"].post(h["g"].invoicing.purchaseApplyMgmt.purchaseApplyNew,a).then((function(t){e.$message.success("保存成功"),e.$emit("operationSuccess"),e.loading=!1})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},amountChange:function(e){var t=0;this.tableData.map((function(e){t+=Number(e.amount)*Number(e.price)})),this.totalFee=t?t.toFixed(2):""}})},x=M,P=(a("ae3a"),Object(C["a"])(x,S,_,!1,null,null,null)),$=P.exports,O=a("075d"),N=a("225d"),L=a("b06a"),z=a("5801"),R=a("276c"),B=a("4382"),A=a("bc3a"),j=a.n(A),F=a("fc46"),E=a("443b"),q={name:"PurchaseApplyMgmtList",data:function(){return{tabName:"addinfo",tabNameInfo:"info",tabNameLogistics:"loginfo",itemId:"",title:"",isEdit:!0,isPend:!1,editable:!1,returnId:"",form:{},orderId:"",sn:"",formData:{},loading:!1,open:!1,openAdd:!1,dialogTableVisible:!1,step1:!0,step2:!1,selections:[],isRalateBill:!1,openLogistics:!1,openReview:!1,operations:[{label:"删除",name:"delete",type:"",disabled:!0},{label:"刷新",name:"refresh",type:""},{label:"导出",name:"export",type:"",auth:["admin:saleApplication.export"]}],filters:[{type:"select",label:"代理商",name:"supplier",filterable:!0,multiple:!0,collapseTags:!0,value:[],options:[]},{type:"select",label:"申请状态",name:"state",value:"",options:[]},{type:"daterange",label:"创建日期",name:"publishDate",value:[]},{type:"input",label:"",placeholder:"请输入销售申请单编号/条码",name:"searchValue",value:""}],auditState:"1",remarks:"",row:{},curSelectAjectReason:"申报的商品与实际需要采购的商品不符",reasonAjectList:[{label:"申报的商品与实际需要采购的商品不符",value:"申报的商品与实际需要采购的商品不符"},{label:"送达仓库地址填写错误",value:"送达仓库地址填写错误"},{label:"申报的商品供应方已停售或缺货",value:"申报的商品供应方已停售或缺货"},{label:"申报的商品数量有误",value:"申报的商品数量有误"},{label:"已与部分商品供应商终止合作",value:"已与部分商品供应商终止合作"},{label:"其他原因",value:"其他原因"}],curSelectCloseReason:"",supplierId:"",reasonList:[{label:"我不想买了",value:"我不想买了"},{label:"信息填写有误, 重新拍",value:"信息填写有误, 重新拍"},{label:"卖家缺货",value:"卖家缺货"},{label:"忘记使用优惠券",value:"忘记使用优惠券"},{label:"重复下单,误下单",value:"重复下单,误下单"},{label:"支付方式有误,无法支付",value:"支付方式有误,无法支付"}],closeDeccription:"",showPassOrder:!1,openRelateBillOrder:!1,relateBillOrder:"baseinfo",relateBillOrderId:"",openPurchaseOrder:!1,relateBillPurchaseOrder:"baseinfo",relateBillPurchaseOrderId:"",tableData:[],gridData:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:9}}},components:{BizPopupTabs:s["a"],BizFlexTable:l["c"],BaseInfo:w,vueEasyPrint:N["a"],ProductInfo:$,ApplyInfo:O["a"],OrderBaseInfo:L["a"],OrderProductInfo:z["a"],PurchaseOrderBaseInfo:R["a"],LogisticsFollowing:B["a"],MyEvaluate:F["a"]},created:function(){this.getList(),this.queryKpi(),this.querySupplier(),this.queryFilters()},watch:{},mixins:[E["a"]],computed:{},mounted:function(){},methods:Object(n["a"])(Object(n["a"])({},Object(f["c"])(["getUser"])),{},{operate:function(e){this[e]()},closeTabByEvaluate:function(e,t){var a=this;this.openPurchaseOrder=!1,this.tabName="reviewinfo",this.orderId=e,this.itemId="",this.editable=!1,this.$nextTick((function(){a.openReview=!0,a.$refs.reviewinfo.getOrderInfo(e)}))},step1Confirm:function(e){this.step1=!1,this.step2=!0,this.formData=e},step2Confirm:function(){this.step1=!0,this.step2=!1},refresh:function(){this.getList()},operationSuccess:function(){this.openAdd=!1,this.refresh()},formatDate:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=a+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r);return o},closeTabByLogistics:function(e){var t=this;this.tabNameLogistics="loginfo",this.sn=e,this.openLogistics=!0,this.openPurchaseOrder=!1,this.$nextTick((function(){t.$refs.logistics.getLogisticsInfo()}))},clickRelateBill:function(e,t){var a=this;e.stopPropagation(),"2"===t.relateBillType?(this.relateBillPurchaseOrderId=t.relateBill,this.relateBillPurchaseOrder="baseinfo",this.openPurchaseOrder=!0,this.$nextTick((function(){a.$refs.purchaseInfo.getOrderInfo()})),this.isRalateBill=!0):(this.relateBillOrderId=t.relateBill,this.relateBillOrder="baseinfo",this.openRelateBillOrder=!0),this.isEdit=!1},toPass:function(e,t){this.remarks="",this.row=e,this.showPassOrder=!0},statusChange:function(e,t){var a=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0;var i={shopId:window.top.SHOP_ID||"",id:e.id,actionType:t,details:"2"===t?a.curSelectAjectReason:"",remarks:a.remarks};g["a"].post("/admin/invoicing/purchase/agentPurchaseApplyState.jhtml",i).then((function(e){a.$message.success("操作成功！"),a.showPassOrder=!1,a.loading=!1,a.refresh()})).catch((function(e){a.loading=!1,e.errorMessage&&a.$message.warning(e.errorMessage)})).finally((function(){}))}))},deleteApply:function(e,t){e.stopPropagation(),this.deleteItem([t.id])},deleteItem:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,g["a"].delete(h["g"].invoicing.purchaseApplyMgmt.shopPurchaseApply,{ids:e}).then((function(e){t.$message.success("删除成功"),t.refresh()})).catch((function(e){console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))}))},delete:function(){if(this.selections&&this.selections.length>0){var e=[];this.selections.forEach((function(t){e.push(t.id)})),this.deleteItem(e)}else this.$message("请选择一条数据")},printApply:function(e){var t=this,a={id:e.id};g["a"].get(h["g"].invoicing.purchaseApplyMgmt.print,a).then((function(e){t.dialogTableVisible=!0,t.title=t.getUser().shop.name+"销售申请单",t.form=e.data,"0"===t.form.state?t.form.state="已创建":"1"===t.form.state?t.form.state="已提交":"2"===t.form.state?t.form.state="审核中":"3"===t.form.state?t.form.state="已通过":"4"===t.form.state?t.form.state="已驳回":t.form.state="",t.gridData=e.data.itemDatas,t.loading=!1})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))},print:function(){this.$refs.easyPrint.print()},exportInvoice:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={id:e.form.id,type:"1"},t.prev=1,t.next=4,j.a.post("/admin/invoicing/purchase/voucher/purchaseApply/export.jhtml",a,{responseType:"blob"});case 4:return i=t.sent,console.log("response => ",i),r=new Blob([i.data],{type:"application/vnd.ms-excel"}),console.log(decodeURI(i.headers["content-disposition"])),o=decodeURI(i.headers["content-disposition"].split("filename=")[1]),n=document.createElement("a"),n.download=o.match(/"(\S*)"/)[1],n.style.display="none",n.href=URL.createObjectURL(r),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n),t.abrupt("return");case 20:throw t.prev=20,t.t0=t["catch"](1),new Error(t.t0);case 23:case"end":return t.stop()}}),t,null,[[1,20]])})))()},export:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,r,o,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],e.selections&&e.selections.length>0&&e.selections.forEach((function(e){a.push(e.id)})),i={ids:a,pageable:{pageSize:e.pagination.pageSize,pageNumber:e.pagination.currentPage,searchValue:e.filters[3].value},shopId:window.top.SHOP_ID||"",agentIds:e.filters[0].value,applyState:e.filters[1].value,beginTime:e.filters[2].value[0]?e.filters[2].value[0]+" 00:00:00":"",endTime:e.filters[2].value[1]?e.filters[2].value[1]+" 23:59:59":""},t.prev=3,t.next=6,j.a.post("/admin/invoicing/purchase/storeSalesApplies/export.jhtml",i,{responseType:"blob"});case 6:return r=t.sent,console.log("response => ",r),o=new Blob([r.data],{type:"application/vnd.ms-excel"}),console.log(decodeURI(r.headers["content-disposition"])),n=decodeURI(r.headers["content-disposition"].split("filename=")[1]),s=document.createElement("a"),s.download=n.match(/"(\S*)"/)[1],s.style.display="none",s.href=URL.createObjectURL(o),document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s),t.abrupt("return");case 22:throw t.prev=22,t.t0=t["catch"](3),new Error(t.t0);case 25:case"end":return t.stop()}}),t,null,[[3,22]])})))()},add:function(){this.tabName="addinfo",this.itemId="",this.step1=!0,this.step2=!1,this.openAdd=!0},rowClick:function(e,t,a){var i=this;this.tabNameInfo="info",this.open=!0,this.$nextTick((function(){i.itemId=e.id})),this.isPend=!1,this.isRalateBill=!1},getList:function(){var e=this,t={pageable:{pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage,searchValue:this.filters[3].value},shopId:window.top.SHOP_ID||"",agentIds:this.filters[0].value,applyState:this.filters[1].value,beginTime:this.filters[2].value[0]?this.filters[2].value[0]+" 00:00:00":"",endTime:this.filters[2].value[1]?this.filters[2].value[1]+" 23:59:59":""};this.loading=!0,g["a"].post("/admin/invoicing/purchase/storeSalesApplies.jhtml",t).then((function(t){console.log(t),e.tableData=t.dataList,e.pagination.total=Number(t.total),e.loading=!1})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},queryKpi:function(){var e=this,t={shopId:window.top.SHOP_ID||""};g["a"].get("/admin/invoicing/purchase/queryStoreSalesKpi.jhtml",t).then((function(t){e.$message({customClass:"motorists-club-activity__kpi",showClose:!0,message:"今日新增".concat(t.data.dayNewAdd,"条"),duration:3e3})})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},queryFilters:function(){var e=this,t={shopId:window.top.SHOP_ID||""};g["a"].get(h["g"].invoicing.purchaseApplyMgmt.queryInfos,t).then((function(t){e.filters[1].options=[{label:"全部",value:""}].concat(t.stateList.map((function(e){return{label:e.name,value:e.id}})))})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(e){}))},querySupplier:function(){var e=this,t={shopId:window.top.SHOP_ID||"",cooperationType:"1",state:""};g["a"].get(h["g"].invoicing.supplierMgmt.shopSupplierList,t).then((function(t){e.filters[0].options=[{label:"全部",value:""}].concat(t.dataList.map((function(e){return{label:e.name,value:e.id}})))})).catch((function(t){e.loading=!1,t.errorMessage&&console.log(t.errorMessage)}))},getStatus:function(e){switch(e.state){case"0":return"已创建";case"1":return"已提交";case"2":return"审核中";case"3":return"已通过";case"4":return"已驳回";default:return"--"}},handleSelectionChange:function(e){this.selections=e,this.operations[0].disabled=!0,e.length>0&&(this.operations[0].disabled=!1)},filterDataChange:function(e){this.filters=e,this.pagination.currentPage=1,this.refresh()},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()}})},V=q,U=(a("ade8"),Object(C["a"])(V,i,r,!1,null,null,null));t["default"]=U.exports},"0e5e":function(e,t,a){"use strict";var i=a("2497"),r=a("bc3a"),o=a.n(r),n=a("c596");t["a"]={query:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_query,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryShopList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.Component_queryShops,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryBrandList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.Component_queryBrands,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},querySeriesList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.Component_querySeries,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryTypeList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.Component_queryTypes,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryDimList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_queryDimList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryInsuranceList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_queryInsuranceList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryTerminalList:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_queryTerminalList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryTerminalInfo:function(e,t,a){o.a.get(n["g"].vehicleMgmt.VehicleBaseInfo_queryTerminalInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},update:function(e,t,a){o.a.post(n["g"].vehicleMgmt.VehicleBaseInfo_update,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},add:function(e,t,a){o.a.post(n["g"].vehicleMgmt.VehicleBaseInfo_add,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))}}},"0f32":function(e,t,a){"use strict";var i=a("75e2"),r=a.n(i);r.a},1029:function(e,t,a){"use strict";var i=a("f9a5"),r=a.n(i);r.a},"18eb":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"biz-tag-select"},[a("div",{staticClass:"tag-content"},[a("div",{staticClass:"tag-show-eara"},e._l(e.curSelectedTags,(function(t,i){return a("el-tag",{key:i,staticClass:"sel-tag",attrs:{closable:""},on:{close:function(a){return e.onClose(t,i)}}},[e._v(" "+e._s(t.name?t.name:t)+" ")])})),1),a("div",{staticClass:"select-area"},[a("div",{staticClass:"search-container"},[e.bAddTag?a("el-input",{attrs:{placeholder:"请输入关键词，按回车添加新标签"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.tagName,callback:function(t){e.tagName=t},expression:"tagName"}}):e._e()],1),e.tagList.length?a("div",{staticClass:"tag-container"},[a("el-checkbox-group",{attrs:{size:"small"},on:{change:e.onChange},model:{value:e.curSelectedTags,callback:function(t){e.curSelectedTags=t},expression:"curSelectedTags"}},e._l(e.curShowTags,(function(t,i){return a("el-checkbox-button",{key:i,staticClass:"tag-column",attrs:{label:t.name}},[e._v(e._s(t.name)+" ")])})),1),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showMore,expression:"showMore"}],staticClass:"more-btn",attrs:{small:"",type:"primary"},on:{click:e.onMore}},[e._v("更多...")])],1):a("div",{staticClass:"empty"},[e._v("暂无标签数据")])])])])},r=[],o=(a("4160"),a("d81d"),a("a434"),a("b0c0"),a("ac1f"),a("5319"),a("159b"),a("1ab1")),n=a("c596"),s={name:"biz-tag-select",data:function(){return{curSelectedTags:[],tagName:"",tagCatrgoryId:"",showMore:!1,curShowTags:[]}},props:{tagList:{type:Array},selectedTags:{type:Array},bAddTag:{type:Boolean,default:!0},selectType:{type:String},categoryType:{type:String,default:function(){return""}}},components:{},computed:{},watch:{selectedTags:function(e){this.curSelectedTags=e.map((function(e){return e.name?e.name:e}))},tagList:function(e){var t=this;e&&e.length&&(this.curShowTags.splice(0,this.curShowTags.length),this.tagCatrgoryId=e[0].tagCategory.id,this.showMore=e.length>6,e.forEach((function(e,a){a<6&&t.curShowTags.push(e)})))}},methods:{getCurSelectedTags:function(e){var t,a,i=this;return t=[],this.curSelectedTags.forEach((function(e){i.tagList.forEach((function(i){i.name===e&&(a={},a.id=i.id,a.name=i.name,t.push(a))}))})),t},onChange:function(e){"order"===this.selectType&&this.curSelectedTags.length>1&&(this.curSelectedTags.pop(),this.$message.warning("您已选择标签，如需要变更请先删除之前的选择")),this.$emit("change",e)},onClose:function(e,t){console.log(e),this.curSelectedTags.splice(t,1)},handleInputConfirm:function(){this.tagName=this.tagName.replace(/\s+/g,""),this.tagName&&(this.tagCatrgoryId?this.addTag():"店铺特色"===this.categoryType&&this.getTagCatrgoryId())},getTagCatrgoryId:function(){var e=this,t={categoryType:"店铺特色",isIncludeParent:"1"};o["a"].get(n["g"].systemSetting.storeTagcategories,t).then((function(t){t.content.length&&(e.tagCatrgoryId=t.content[0].id,e.addTag())})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},addTag:function(){var e=this,t={name:this.tagName,hierarchy:"1",tagCategory:{id:this.tagCatrgoryId}};o["a"].post(n["g"].systemSetting.deleteTag,t).then((function(t){e.$emit("addSuccess"),console.log(e.curSelectedTags),e.tagName=""})).catch((function(t){e.$message.warning(t.errorMessage),console.log(t.errorMessage)}))},onMore:function(){"shopProfile"===this.selectType?this.$emit("showMore"):(this.showMore=!1,this.curShowTags=this.tagList)}}},l=s,c=(a("663e"),a("2877")),d=Object(c["a"])(l,i,r,!1,null,null,null),p=d.exports;t["a"]=p},"1fac":function(e,t,a){},2086:function(e,t,a){"use strict";var i=a("2497"),r=a("bc3a"),o=a.n(r),n=a("c596");t["a"]={getList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getMemberCardList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getRightsList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listDistributeRights:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.listDistributeRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listCardTemplate:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.listCardTemplate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistVbean:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getlistVbean,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getIntegralList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getIntegralList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listProduct:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.listProduct,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryUserRights:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.queryUserRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryUserCoupons:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.queryUserCoupons,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listByRights:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.listByRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardInfo:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getVipCardInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardTemplate:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getVipCardTemplate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},memberRankList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.memberRankList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},setting:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.setting,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},settingUpdate:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.setting,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryPeople:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.queryPeople,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delete:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.memberCard.deleteManage,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},verification:function(e,t,a){o.a.post(n["g"].memberCardMgmt.vipRights.verification,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateTemplate:function(e,t,a){o.a.put(n["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createTemplate:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delTemplate:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.memberCard.updateTemplate,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},distributeRights:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.distributeRights,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},distributeAssignedRights:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.distributeAssignedRights,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateVipCardState:function(e,t,a){o.a.put(n["g"].memberCardMgmt.memberCard.updateVipCardState,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createVipCard:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.createVipCard,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createBean:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.createBean,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createPoint:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.createPoint,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},addScore:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.addScore,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},reduceDeposit:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.reduceDeposit,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistUpgrade:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getlistUpgrade,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistStore:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getlistStore,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateGrade:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.updateGrade,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardGradeInfo:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.getVipCardGradeInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},editVipCardGrade:function(e,t,a){o.a.put(n["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},addVipCardGrade:function(e,t,a){o.a.post(n["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delVipCardGrade:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.memberCard.VipCardGrade,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listAuthority:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.listAuthority,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},vipRightsList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryrightsClass:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.get,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getFirstClassifies:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.getFirstClassifies,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponList:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.rightsCouponList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryRightsCoupon:function(e,t,a){o.a.get(n["g"].memberCardMgmt.vipRights.queryRightsCoupon,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},memberCardBox:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.memberCardBox,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},editRightsClass:function(e,t,a){o.a.put(n["g"].memberCardMgmt.vipRights.edit,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createRightsClass:function(e,t,a){o.a.post(n["g"].memberCardMgmt.vipRights.add,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponUpdate:function(e,t,a){o.a.put(n["g"].memberCardMgmt.vipRights.rightsCouponUpdate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponCreate:function(e,t,a){o.a.post(n["g"].memberCardMgmt.vipRights.rightsCouponCreate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},deleteRightscoupon:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.vipRights.deleteRightscoupon,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},deleteRights:function(e,t,a){o.a.delete(n["g"].memberCardMgmt.vipRights.delete,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},certificate:function(e,t,a){o.a.get(n["g"].memberCardMgmt.memberCard.certificate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))}}},2119:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"biz-avatar-uploader-multi"},[a("div",{staticClass:"el-upload-list el-upload-list--picture-card"},[e._l(e.value,(function(t){return a("div",{key:t.index,staticClass:"el-upload-list__item is-success",attrs:{tabindex:"0"}},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:t,alt:""}}),a("span",{staticClass:"el-upload-list__item-actions"},[a("span",{staticClass:"el-upload-list__item-preview",on:{click:function(a){return e.handlePictureCardPreview(t)}}},[a("i",{staticClass:"el-icon-zoom-in"})]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isShowDelete,expression:"isShowDelete"}],staticClass:"el-upload-list__item-delete",on:{click:function(a){return e.handleRemove(t)}}},[a("i",{staticClass:"el-icon-delete"})])])])})),e.showUploader?a("el-upload",{ref:"upload",class:e.disabled?"avatar-uploader-disabled":"avatar-uploader",style:e.avatarStyle,attrs:{multiple:"","show-file-list":!1,accept:"image/*",limit:Number(e.limit),"file-list":e.fileList,data:e.fileData,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,name:"file",action:"/admin/file/uploads.jhtml",disabled:e.disabled}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:e.plusStyle})]):e._e()],2),a("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},r=[],o=(a("99af"),a("d81d"),a("a434"),a("ac1f"),a("1276"),{name:"ImgUploader",props:{value:{type:Array,default:function(){return[]}},imageForm:{type:Array,default:function(){return[]}},showUploader:{type:Boolean,default:function(){return!0}},size:{type:Object,default:function(){return{width:100,height:100}}},limit:{default:"9"},disabled:{type:Boolean,default:function(){return!1}},isShowDelete:{type:Boolean,default:function(){return!0}}},data:function(){return{fileData:{type:"0"},fileList:[],dialogVisible:!1,dialogImageUrl:""}},methods:{handleSuccess:function(e){var t=this.value.concat(e.fis[0].url);this.$emit("input",t)},handleExceed:function(e,t){this.$message.warning("只能上传".concat(this.limit,"张图片"))},handleRemove:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.removePic(e)}))},removePic:function(e){for(var t=this.value,a=0;a<t.length;a++)t[a]===e&&t.splice(a,1);this.$emit("input",t)},handlePictureCardPreview:function(e){this.dialogImageUrl=e,this.dialogVisible=!0}},computed:{plusStyle:function(){return{"line-height":this.size.height+"px"}},avatarStyle:function(){return{height:this.size.height+"px",width:this.size.width+"px"}}},watch:{value:function(e,t){console.log("value: ",this.value),this.fileList=e.map((function(e){return{name:e.split("/")[e.split("/").length-1],url:e}}))}},components:{}}),n=o,s=(a("d74a"),a("2877")),l=Object(s["a"])(n,i,r,!1,null,null,null);t["a"]=l.exports},"21c5":function(e,t,a){},"28d7":function(e,t,a){},"3ee0":function(e,t,a){},"3f67":function(e,t,a){},4382:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logistic-following"},[a("div",{staticClass:"product-info"},[a("div",{staticClass:"img"},[a("img",{attrs:{src:e.image||e.defaultProductImg}})]),a("div",{staticClass:"info"},[a("div",{staticClass:"i-item"},[e._v("物流状态： "),a("span",{staticClass:"l-state"},[e._v(e._s(e.logisticState))])]),a("div",{staticClass:"i-item"},[e._v("物流公司："+e._s(e.logistics))]),a("div",{staticClass:"i-item"},[e._v("快递单号："+e._s(e.expressSn))])])]),e.shippingTraces&&e.shippingTraces.length>0?a("div",{staticClass:"logistic-info"},[a("div",{staticClass:"track-list"},[a("ul",e._l(e.shippingTraces,(function(t){return a("li",{key:t.id},[a("i",{staticClass:"node-icon"}),a("span",{staticClass:"txt"},[e._v(e._s(t.station))]),a("span",{staticClass:"time"},[e._v(e._s(t.happenTime))])])})),0)])]):e._e()])},r=[],o=a("5530"),n=a("2f62"),s=a("1ab1"),l=a("c596"),c=a("e83a"),d=a.n(c),p={name:"LogisticsFollowing",components:{},data:function(){return{shippingSn:"",defaultProductImg:d.a,shippingTraces:[],state:"",logistics:"",expressSn:"",image:""}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(n["c"])(["getUser"])),Object(n["c"])("Order",["curApplySaleItem","orderInfo"])),{},{logisticState:function(){switch(this.state){case"0":return"无轨迹";case"1":return"已揽收";case"2":return"在途中";case"201":return"到达派件城市";case"3":return"签收";case"4":return"问题件";default:return""}}}),props:{sn:{type:String,default:""}},watch:{},created:function(){},methods:{getLogisticsInfo:function(){var e=this,t={methodName:"QueryLogistics",clientType:"2",shopId:this.getUser.shop.id,userId:this.getUser.id,shippingSn:this.sn};s["a"].get(l["g"].hypermarketMgmt.logistics,t).then((function(t){console.log("物流追踪",t),e.state=t.shipping.state,e.image=t.shipping.shippingItems.length>0?t.shipping.shippingItems[0].image:"",e.logistics=t.shipping.logistics,e.expressSn=t.shipping.expressSn,e.shippingTraces=t.shipping.shippingTraces})).catch((function(t){e.$message.warning(t.errorMessage)}))}}},m=p,u=(a("b15b"),a("2877")),f=Object(u["a"])(m,i,r,!1,null,null,null);t["a"]=f.exports},"443b":function(e,t,a){"use strict";a("4de4");var i=a("c596"),r=a("1ab1"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":"",visible:e.visible,title:"自定义列","custom-class":"biz-columns",width:"500px"},on:{close:e.onClose}},[a("div",{staticClass:"columns-wrap"},[a("biz-flex-table",{ref:"table",attrs:{checkable:!1,tableData:e.tableData},on:{"selection-change":e.selectionChangeHandler}},[a("el-table-column",{attrs:{type:"selection",width:"50",selectable:e.getSelectable}}),a("el-table-column",{attrs:{label:"信息",prop:"name"}}),a("el-table-column",{attrs:{prop:"tag",label:"排序"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.$index;return[a("el-button",{attrs:{icon:"el-icon-sort-up",type:"text",disabled:0===i},on:{click:function(t){return e.onUp(i)}}}),a("el-button",{attrs:{icon:"el-icon-sort-down",type:"text",disabled:i===e.tableData.length-1},on:{click:function(t){return e.onBottom(i)}}})]}}])})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.onClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确 定")])],1)])},n=[],s=(a("7db0"),a("a434"),a("b85c")),l=a("04d3"),c={name:"biz-columns",components:{BizFlexTable:l["c"]},props:{visible:Boolean,tableId:String},data:function(){return{id:"",tableName:"",selections:[],tableData:[]}},computed:{},watch:{visible:function(e){e?this.makeRowDisplayable():this.saveSelection()},tableId:function(){this.getTableColumns()}},mounted:function(){this.getTableColumns()},methods:{getTableColumns:function(){var e=this;r["a"].get(i["g"].user.columns,{tableId:this.tableId}).then((function(t){e.tableData=t.data.columnDatas,e.id=t.data.id,e.tableName=t.data.tableName}))},getSelectable:function(e){return e.isEditable},selectionChangeHandler:function(e){this.selections=e},saveSelection:function(){var e,t=this,a=Object(s["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var i=e.value;i.displayable=!1}}catch(l){a.e(l)}finally{a.f()}var r,o=Object(s["a"])(this.selections);try{var n=function(){var e=r.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(o.s();!(r=o.n()).done;)n()}catch(l){o.e(l)}finally{o.f()}},onUp:function(e){this.tableData[e]=this.tableData.splice(e-1,1,this.tableData[e])[0]},onBottom:function(e){this.tableData[e]=this.tableData.splice(e+1,1,this.tableData[e])[0]},onClose:function(){this.$emit("update:visible",!1)},update:function(){var e,t=this,a=Object(s["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var o=e.value;o.displayable=!1}}catch(p){a.e(p)}finally{a.f()}var n,l=Object(s["a"])(this.selections);try{var c=function(){var e=n.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(l.s();!(n=l.n()).done;)c()}catch(p){l.e(p)}finally{l.f()}var d={columnDatas:this.tableData,id:this.id,tableId:this.tableId,tableName:this.tableName};console.log(d),r["a"].put(i["g"].user.columns,d).then((function(e){t.$emit("update"),t.$emit("update:visible",!1)}))},makeRowDisplayable:function(){var e=this;setTimeout((function(){var t,a=Object(s["a"])(e.tableData);try{for(a.s();!(t=a.n()).done;){var i=t.value;e.$refs.table.$refs.table.toggleRowSelection(i,i.displayable)}}catch(r){a.e(r)}finally{a.f()}}),20)}}},d=c,p=(a("ec6b"),a("2877")),m=Object(p["a"])(d,o,n,!1,null,null,null),u=m.exports,f=u;t["a"]={components:{BizColumnOperation:l["a"],BizColumns:f},data:function(){return{columnsSettingVisible:!1,columns:[]}},created:function(){this.getTableId(),this.getColumns()},methods:{onCustomColumns:function(){this.columnsSettingVisible=!0},getColumns:function(){var e=this;console.log(12),r["a"].get(i["A"].columns,{tableId:this.tableId}).then((function(t){e.columns=[],setTimeout((function(){e.columns=t.data.columnDatas.filter((function(e){return e.displayable})),e.$refs.table&&setTimeout((function(){e.$refs.table.doLayout()}),50)}),20)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getTableId:function(){}}}},"46fc":function(e,t,a){"use strict";a("ac1f"),a("1276");t["a"]=function(e,t){if(!e||!t)return 0;var a=t.split(":"),i=e.split(":"),r=60*(i[0]-a[0])+(i[1]-a[1]);return r<0?0:r}},5801:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"order-product-info"},[e.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),a("el-form",{attrs:{inline:!0,disabled:!e.isEdit,"inline-message":!0}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addProduct}},[e._v("新增")]),a("el-form-item",{staticClass:"subTotal",attrs:{label:"合计:",prop:"subTotal"}},[e._v(e._s(e.subTotal))])],1),a("biz-list",{key:Math.random(),ref:"table",staticStyle:{width:"100%",height:"100%"},attrs:{tableData:e.tableData,loading:e.loading}},[a("el-table-column",{attrs:{prop:"sn",label:"编号"}}),a("el-table-column",{attrs:{prop:"fullName",label:"商品名称"}}),a("el-table-column",{attrs:{prop:"barCode",label:"条码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product&&t.row.product.barCode?t.row.product.barCode:""))]}}])}),a("el-table-column",{attrs:{prop:"price",label:"商品价格"}}),a("el-table-column",{attrs:{prop:"minimumPackQuantity",label:"最小包装数","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product&&t.row.product.minimumPackQuantity?t.row.product.minimumPackQuantity:""))]}}])}),a("el-table-column",{attrs:{prop:"quantity",label:"数量","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{attrs:{size:"mini",min:1},on:{change:function(a){return e.quantityChange(t.row.quantity)}},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[e._v(e._s(t.row.quantity?(Number(t.row.quantity)*Number(t.row.price)).toFixed(2):"")+" ")])])}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作",type:"index"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[e.isEdit?a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteHandeler(t)}}},[e._v("删除")])],1):e._e()])}}])})],1),a("biz-pagination",{attrs:{pagination:e.pagination},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),a("el-dialog",{attrs:{visible:e.dialogTableVisible,center:"",width:"1200px","append-to-body":""},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"right"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.print}},[e._v("打印")])],1)])],1),a("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[e._v(e._s(e.title))])]),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"right"}},[e._v("打印日期："+e._s(e.formatDate((new Date).getTime())))])])],1),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("订单编号："+e._s(e.shippingData.sn))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("配送方式："+e._s(e.shippingData.shippingMethod))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("收货人："+e._s(e.shippingData.consignee))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("电话："+e._s(e.shippingData.phone))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("地址："+e._s(e.shippingData.address))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("买家留言："+e._s(e.shippingData.memo))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"})])],1),a("el-table",{staticClass:"table-class",attrs:{data:e.gridData}},[a("el-table-column",{attrs:{property:"isTotal",width:"50",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isTotal?a("div",[e._v("合计")]):a("div",[e._v(e._s(t.$index+1))])]}}])}),a("el-table-column",{attrs:{property:"name",label:"商品名",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(e._s(t.row.name))]}}],null,!0)}),a("el-table-column",{attrs:{property:"address",label:"规格"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(e._s(-1!==t.row.fullName.indexOf("[")?t.row.fullName.split("[")[1].split("]")[0]:""))]}}],null,!0)}),a("el-table-column",{attrs:{property:"price",label:"单价"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v("￥"+e._s(t.row.price))]}}],null,!0)}),a("el-table-column",{attrs:{property:"quantity",label:"数量"}}),a("el-table-column",{attrs:{property:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("￥"+e._s(t.row.subTotal))]}}])})],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("运费：￥"+e._s(e.formData.freight))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("优惠金额：￥"+e._s(e.formData.couponDiscount))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("调整金额：￥"+e._s(e.formData.offsetAmount))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("订单金额：￥"+e._s(e.formData.originalAmount))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("仓库签字：")])])],1)],1)])],1),a("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:e.showDialog,tableData:e.giftList,pagination:e.dialogPagination,filters:e.dialogFilters,selectionKeys:e.selectedGiftIds},on:{"update:visibility":function(t){e.showDialog=t},pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,confirmed:e.confirmedProduct,filterDataChange:e.dialogFilterDataChange,selectionChange:e.selectionChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"dialog-column"},[a("img",{staticClass:"productImg",attrs:{src:t.row.image||e.DefaultImg,onerror:e.errorImg}}),a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.fullName))])])]}}])}),a("el-table-column",{attrs:{property:"barCode",label:"条码"}}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),a("el-table-column",{attrs:{property:"price",label:"价格"}}),a("el-table-column",{attrs:{label:"剩余库存/库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.availableStock)+"/"+e._s(t.row.stock))])]}}])})],1)],1)},r=[],o=(a("99af"),a("4de4"),a("4160"),a("c975"),a("d81d"),a("a434"),a("b0c0"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("159b"),a("5530")),n=a("7558"),s=a("5c40"),l=a("8330"),c=a("f36f"),d=a("e42c"),p=a("2086"),m=a("225d"),u=a("2f62"),f=a("c596"),g=a("1ab1"),h=a("af3f"),b=a("f3ac"),v=a.n(b),y={name:"NewsMgmt",props:{itemId:{type:String},agentId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},errorImg:'this.src="/resources/admin/images/default/product-default.png"',DefaultImg:v.a,selectedGiftList:[],selectedGiftIds:[],showDialog:!1,dialogFilters:[{type:"input",placeholder:"请输入编号/商品名/条码",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,subTotal:"",height:"585",subTotalAll:"",tableData:[],restaurants:[],selections:[],orderItems:[],selectionList:[],dialogTableVisible:!1,gridData:[],formData:{},shippingData:{},title:"",form:{products:""},operations:[{label:"保存",name:"save",type:"primary"},{label:"打印",name:"certificate",type:"primary"}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:n["a"],BizPagination:s["a"],BizGrid:c["a"],BizSaveButton:l["a"],vueEasyPrint:m["a"],BizDialogSelector:h["a"]},watch:{itemId:function(e){this.tableData=[],this.subTotal="",this.itemId&&this.getList()}},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},methods:Object(o["a"])(Object(o["a"])({},Object(u["c"])(["getUser"])),{},{addProduct:function(){this.dialogFilters[0].value="",this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getGiftList()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getGiftList()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getGiftList()},getGiftList:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[0].value,shopId:window.top.SHOP_ID||"",isOutOfStock:"0",agentId:this.agentId,type:"couponOrder"===this.$route.params.orderType?"7":""};g["a"].get("purchaseOrder"===window.top.dType?"/admin/purchaseOrderManage/product/list.jhtml":f["g"].memberCardMgmt.memberCard.listProduct,t).then((function(t){e.giftList=t.content,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},confirmedProduct:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(e.quantity="1",t.selectedGiftList.push(e))}));this.selectedGiftList.map((function(e){Number(e.quantity)*Number(e.price)})),this.selectedGiftList.forEach((function(e){t.handleSelect(e),t.listProduct(e)}))},print:function(){this.$refs.easyPrint.print()},certificate:function(){var e=this;if(!this.itemId)return this.$message.warning("请先生成一个订单"),!1;var t={orderId:this.itemId,shopId:window.top.SHOP_ID||""};g["a"].get("purchaseOrder"===window.dType?f["l"].delivery.queryShippingVoucherPurchase:f["l"].delivery.queryShippingVoucher,t).then((function(t){e.dialogTableVisible=!0,e.title=e.getUser().shop?e.getUser().shop.name+"发货单":"发货单",e.formData=t.order,e.shippingData=t.shipping||{},e.userCard=t.userCard,e.gridData=t.order.orderItems})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},formatDate:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=a+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r);return o},resize:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},operate:function(e){this[e]()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},getList:function(){var e=this;console.log("window.top.dType"+window.top.dType),this.loading=!0;var t={orderId:this.itemId,pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};d["a"].viewProducts(t,(function(t){e.loading=!1,e.tableData=t.orderItems,e.subTotal=t.order.price,e.pagination.total=Number(t.total),console.log("this.tableData",e.tableData)}),(function(e){console.log(e)}))},handleSelect:function(e){var t=!1;if(e.productId=e.id,e.id="",this.subTotal=(Number(this.subTotal)+Number(e.quantity)*Number(e.price)).toFixed(2),0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].productId===e.productId){this.tableData[a].quantity=(Number(this.tableData[a].quantity)+1).toString(),t=!0;break}t||this.tableData.push(Object.assign(e,{product:{minimumPackQuantity:e.minimumPackQuantity,barCode:e.barCode}}))}else this.tableData.push(e)},deleteHandeler:function(e){this.tableData.splice(e.$index,1),this.subTotal=(Number(this.subTotal)-Number(e.row.price)*Number(e.row.quantity)).toFixed(2)},quantityChange:function(e){var t=0;this.tableData.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.subTotal=t?t.toFixed(2):""},save:function(){var e=this;this.orderItems=this.tableData.map((function(e){return{id:e.id||"",productId:e.productId?e.productId:e.id,quantity:e.quantity||"",price:e.price||""}}));var t=!1;if(this.tableData.forEach((function(a){console.log(a.quantity),-1!==String(a.quantity).indexOf(".")&&(e.$message.warning("数量不能为小数"),t=!0),a.quantity%a.product.minimumPackQuantity!==0&&(e.$message.warning("数量为最小包装数的整数倍"),t=!0)})),t)return!1;!this.itemId&&this.$emit("setOrderItems",this.orderItems),this.itemId&&d["a"].addOrderItems({orderId:this.itemId,orderData:{orderItems:this.orderItems},shopId:window.top.SHOP_ID},(function(t){e.$emit("setOrderItems",e.orderItems),e.$emit("operationSuccess"),e.loading=!1}),(function(t){e.loading=!1,e.getList(),e.$message.warning(t.errorMessage)}))},listProduct:function(e){var t=this;p["a"].listProduct({searchValue:e.name},(function(e){t.restaurants=e.content.map((function(e){return{fullName:e.fullName,sn:e.sn,price:e.price,quantity:"1",subTotal:e.price,productId:e.id,value:e.fullName}})),t.loading=!1}),(function(e){console.log(e),console.log("code错误")}))},querySearchAsync:function(e,t){var a=this.restaurants,i=e?a.filter(this.createStateFilter(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout((function(){t(i)}),300*Math.random())},createStateFilter:function(e){return function(e){return!0}},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()}})},C=y,I=(a("8f05"),a("2877")),w=Object(I["a"])(C,i,r,!1,null,null,null);t["a"]=w.exports},"663e":function(e,t,a){"use strict";var i=a("3f67"),r=a.n(i);r.a},"697f":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:e.title,visible:e.dialogVisible,"append-to-body":e.appendToBody},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close,open:e.open}},[e._t("top"),a("biz-flex-table",{ref:"table",attrs:{showTable:e.showTable,operations:e.operations,filters:e.filters,tags:e.tags,rowKeys:e.rowKeys,pagination:e.pagination,tableData:e.tableData,rowClassName:e.rowClassName,loading:e.loading,memberIds:e.memberIds,checkable:e.checkable,isDepotOutNew:e.isDepotOutNew,checkedTable:e.checkedTable},on:{operate:e.operate,"row-click":e.rowClick,"filter-data-change":e.filterDataChange,"select-all":e.handleSelectAll,select:e.handleSelectionChange,"size-change":e.pageSizeChange,"current-change":e.currentPageChange,"cascader-change":e.cascaderChange,"active-item-change":e.activeItemChange,"sort-change":e.handleSortChange}},[e._t("default")],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isClear?a("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v("清除")]):e._e(),a("el-button",{attrs:{size:"small"},on:{click:e.close}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmed}},[e._v("确定")])],1)],2)},r=[],o=(a("99af"),a("4160"),a("c975"),a("a434"),a("a9e3"),a("159b"),a("04d3")),n={name:"BizDialogSelector",components:{BizFlexTable:o["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},max:{type:Number,default:0},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},isClear:{default:!0,type:Boolean},rowClassName:{type:Function,default:function(){return null}},selectionKeys:{type:Array,default:function(){return[]}},memberIds:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},isDepotOut:{type:Boolean,default:function(){return!1}},checkTable:{type:Array,default:function(){return[]}},showTable:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],isDepotOutNew:!1,checkedTable:[],innerSelection:[]}},methods:{rowKeys:function(e){return e.id},generateSelectionKeys:function(e,t){if(e.indexOf(t)>=0)this.innerSelectionKeys.push(t[this.keyField]),this.innerSelection.push(t);else{var a=this.innerSelectionKeys.indexOf(t[this.keyField]);this.innerSelectionKeys.splice(a,1),this.innerSelection.splice(a,1)}},open:function(e){this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(e){this.innerSelectionKeys=[],this.innerSelection=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){if(this.innerSelectionKeys.length>0||!this.showTable){if(!this.showTable&&!/(http|https):\/\/([\w.]+\/?)\S*/.test(this.filters[2].value))return void this.$message.warning("必须以http,https开头,且需符合URL规范,检查格式是否正确");this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1}else this.$message("请选择一项")},clear:function(){var e=this;this.tableData.forEach((function(t){e.$refs.table.toggleRowSelection(t,!1)})),this.innerSelectionKeys=[],this.innerSelection=[]},updateSelection:function(){var e=this;this.$refs&&this.$refs.table&&this.tableData.forEach((function(t){e.innerSelectionKeys.indexOf(t[e.keyField])>=0?(e.$refs.table.toggleRowSelection(t,!0),"single"===e.selectionMode&&(e.$refs.table.$refs.table.setCurrentRow(t),e.innerSelection=[t])):e.$refs.table.toggleRowSelection(t,!1)}))},operate:function(e){this.$emit("operate",e)},filterDataChange:function(e){this.$emit("filterDataChange",e)},handleSelectAll:function(e){var t=this;0===e.length?this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a>=0&&t.innerSelectionKeys.splice(a,1)})):this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a<0&&t.innerSelectionKeys.push(e[t.keyField])})),this.$emit("selectionChange",e)},handleSelectionChange:function(e,t){this.generateSelectionKeys(e,t),this.$emit("selectionChange",e)},pageSizeChange:function(e){this.$emit("pageSizeChange",e)},currentPageChange:function(e){this.$emit("currentPageChange",e)},cascaderChange:function(e){this.$emit("cascaderChange",e)},activeItemChange:function(e){this.$emit("active-item-change",e)},handleSortChange:function(e){this.$emit("sort-change",e)},rowClick:function(e,t,a){"single"===this.selectionMode&&(this.innerSelectionKeys=[e[this.keyField]],this.innerSelection=[e])}},watch:{visibility:function(e,t){this.dialogVisible=e,this.isDepotOutNew=this.isDepotOut,this.checkedTable=this.checkTable}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){},updated:function(){this.updateSelection()}},s=n,l=(a("0943"),a("2877")),c=Object(l["a"])(s,i,r,!1,null,null,null);t["a"]=c.exports},"701f":function(e,t,a){},"75e2":function(e,t,a){},"8f05":function(e,t,a){"use strict";var i=a("28d7"),r=a.n(i);r.a},"9b2e":function(e,t,a){"use strict";var i=a("0a05"),r=a.n(i);r.a},"9ce7":function(e,t,a){},"9ce9":function(e,t,a){"use strict";var i=a("d47e"),r=a.n(i);r.a},a08c:function(e,t,a){"use strict";var i=a("9ce7"),r=a.n(i);r.a},a0f6:function(e,t,a){},a751:function(e,t,a){"use strict";var i=a("a0f6"),r=a.n(i);r.a},ade8:function(e,t,a){"use strict";var i=a("701f"),r=a.n(i);r.a},ae3a:function(e,t,a){"use strict";var i=a("3ee0"),r=a.n(i);r.a},af3f:function(e,t,a){"use strict";var i=a("697f");t["a"]=i["a"]},b06a:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"order-base-info"},[e.isEdit?i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"120px",size:"small",disabled:!e.isEdit,"inline-message":!0}},[e.itemId?i("el-form-item",{attrs:{label:"订单编号",prop:"sn"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.sn,callback:function(t){e.$set(e.form,"sn",t)},expression:"form.sn"}})],1):e._e(),i("el-form-item",{attrs:{label:"订单状态"}},[e.itemId?i("el-input",{attrs:{disabled:!0},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}}):i("el-select",{attrs:{disabled:"couponOrder"===this.$route.params.orderType},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.orderStateTypeList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e.showInfo?i("el-form-item",{attrs:{label:"订单原价",prop:"originalAmount"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.originalAmount,callback:function(t){e.$set(e.form,"originalAmount",t)},expression:"form.originalAmount"}})],1):e._e(),e.form.amountPrepay?i("el-form-item",{attrs:{label:"订金",prop:"amountPrepay"}},[i("el-input",{attrs:{disabled:""!==e.itemId&&("交易完成"===e.form.type||"订单关闭"===e.form.type||"已评价"===e.form.type)},model:{value:e.form.amountPrepay,callback:function(t){e.$set(e.form,"amountPrepay",t)},expression:"form.amountPrepay"}})],1):e._e(),e.form.amountFinalpay?i("el-form-item",{attrs:{label:"尾款",prop:"amountFinalpay"}},[i("el-input",{attrs:{disabled:""!==e.itemId&&("交易完成"===e.form.type||"订单关闭"===e.form.type||"已评价"===e.form.type)},model:{value:e.form.amountFinalpay,callback:function(t){e.$set(e.form,"amountFinalpay",t)},expression:"form.amountFinalpay"}})],1):e._e(),e.showInfo?i("el-form-item",{attrs:{label:"调整金额",prop:"offsetAmount"}},[i("el-input-number",{attrs:{"controls-position":"right",disabled:""!==e.itemId&&"2"===e.form.paymentStatus||"订单关闭"===e.form.type},on:{change:e.offsetAmountChange},model:{value:e.form.offsetAmount,callback:function(t){e.$set(e.form,"offsetAmount",t)},expression:"form.offsetAmount"}})],1):e._e(),e.showInfo?i("el-form-item",{attrs:{label:"订单现价",prop:"amount"}},[i("el-input",{attrs:{disabled:""!==e.itemId&&"2"===e.form.paymentStatus||"订单关闭"===e.form.type},on:{change:e.curAmountChange},model:{value:e.form.curAmount,callback:function(t){e.$set(e.form,"curAmount",t)},expression:"form.curAmount"}})],1):e._e(),i("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[i("el-collapse-item",{attrs:{name:"1"}},[-1!==e.activeNames.indexOf("1")&&e.handler?i("template",{slot:"title"},[i("div",{staticClass:"title-class"},[i("div",{staticClass:"title-class-one"},[i("el-badge",{staticClass:"item",attrs:{"is-dot":""}},[e._v("客户信息")])],1)])]):e._e(),-1!==e.activeNames.indexOf("1")&&e.handler?e._e():i("template",{slot:"title"},[e._v("客户信息")]),i("el-form-item",{staticClass:"isRequired",attrs:{label:"会员昵称",prop:"member.nickname"}},[i("el-input",{attrs:{disabled:!!e.itemId,placeholder:"请选择或添加会员"},on:{focus:e.showDialogFc},model:{value:e.form.member.nickname,callback:function(t){e.$set(e.form.member,"nickname",t)},expression:"form.member.nickname"}},[e.itemId?e._e():i("el-button",{attrs:{slot:"append",icon:"el-icon-plus"},on:{click:e.addMember},slot:"append"})],1)],1),i("el-form-item",{attrs:{label:"性别",prop:"member.gender"}},[i("el-select",{attrs:{disabled:!1===!e.itemId},model:{value:e.form.member.gender,callback:function(t){e.$set(e.form.member,"gender",t)},expression:"form.member.gender"}},[i("el-option",{attrs:{label:"男",value:"0"}}),i("el-option",{attrs:{label:"女",value:"1"}}),i("el-option",{attrs:{label:"保密",value:"2"}})],1)],1),i("el-form-item",{attrs:{label:"电话",prop:"member.mobile"}},[i("el-input",{attrs:{disabled:!1===!e.itemId,placeholder:"请输入电话"},model:{value:e.form.member.mobile,callback:function(t){e.$set(e.form.member,"mobile",t)},expression:"form.member.mobile"}})],1),i("el-form-item",{attrs:{label:"车辆",prop:"car.id"}},[i("el-select",{attrs:{placeholder:"请选择车辆",disabled:""!==e.itemId},on:{change:e.carChange},model:{value:e.form.car.id,callback:function(t){e.$set(e.form.car,"id",t)},expression:"form.car.id"}},e._l(e.cars,(function(e,t){return i("el-option",{key:t,attrs:{label:e.plateNumber,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"车型",prop:"car.type"}},[i("el-input",{attrs:{disabled:!0,placeholder:"选择车辆自动带入"},model:{value:e.form.car.type,callback:function(t){e.$set(e.form.car,"type",t)},expression:"form.car.type"}})],1),e.form.plateNumber?e._e():i("el-form-item",{attrs:{label:"行驶里程",prop:"car.drivingRange"}},[i("el-input",{attrs:{disabled:!0,placeholder:"选择车辆自动带入"},model:{value:e.form.car.drivingRange,callback:function(t){e.$set(e.form.car,"drivingRange",t)},expression:"form.car.drivingRange"}})],1),e.form.plateNumber?i("el-form-item",{attrs:{label:"行驶里程",prop:"drivingRange"}},[i("el-input",{attrs:{disabled:!0,placeholder:"选择车辆自动带入"},model:{value:e.form.drivingRange,callback:function(t){e.$set(e.form,"drivingRange",t)},expression:"form.drivingRange"}})],1):e._e()],2),i("el-collapse-item",{attrs:{name:"2"}},[-1!==e.activeNames.indexOf("2")&&e.handler?i("template",{slot:"title"},[i("div",{staticClass:"title-class"},[i("div",{staticClass:"title-class-one"},[i("el-badge",{staticClass:"item",attrs:{"is-dot":""}},[e._v("服务信息")])],1)])]):e._e(),-1!==e.activeNames.indexOf("2")&&e.handler?e._e():i("template",{slot:"title"},[e._v("服务信息")]),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"呼叫方式",prop:"orderItems[0].appointment.way"}},[i("el-select",{attrs:{placeholder:"请选择呼叫方式"},model:{value:e.form.orderItems[0].appointment.way,callback:function(t){e.$set(e.form.orderItems[0].appointment,"way",t)},expression:"form.orderItems[0].appointment.way"}},[i("el-option",{attrs:{label:"电话",value:"0"}}),i("el-option",{attrs:{label:"在线",value:"1"}})],1)],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"救援机构",prop:"orderItems[0].appointment.rescueUnit"}},[i("el-select",{attrs:{placeholder:"请选择救援机构"},model:{value:e.form.orderItems[0].appointment.rescueUnit,callback:function(t){e.$set(e.form.orderItems[0].appointment,"rescueUnit",t)},expression:"form.orderItems[0].appointment.rescueUnit"}},e._l(e.rescueOrganizations,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"救援人员",prop:"orderItems[0].appointment.rescuerId"}},[i("el-select",{attrs:{placeholder:"请选择救援人员"},model:{value:e.form.orderItems[0].appointment.rescuerId,callback:function(t){e.$set(e.form.orderItems[0].appointment,"rescuerId",t)},expression:"form.orderItems[0].appointment.rescuerId"}},e._l(e.workers,(function(e,t){return i("el-option",{key:t,attrs:{label:e.nickname,value:e.id}})})),1)],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"救援地点",prop:"orderItems[0].appointment.workerLocation"}},[i("el-input",{attrs:{placeholder:"请输入救援地点"},model:{value:e.form.orderItems[0].appointment.workerLocation,callback:function(t){e.$set(e.form.orderItems[0].appointment,"workerLocation",t)},expression:"form.orderItems[0].appointment.workerLocation"}})],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"服务项目",prop:"orderItems[0].appointment.reasons"}},[i("el-checkbox-group",{model:{value:e.form.orderItems[0].appointment.reasons,callback:function(t){e.$set(e.form.orderItems[0].appointment,"reasons",t)},expression:"form.orderItems[0].appointment.reasons"}},e._l(e.reasons,(function(t,a){return i("el-checkbox",{key:a,attrs:{label:t.id}},[e._v(e._s(t.content))])})),1)],1):e._e(),"rescue"===this.$route.params.orderType?i("el-form-item",{staticClass:"imgUpload",attrs:{label:"图片信息"}},[i("el-upload",{attrs:{action:"/admin/file/uploads.jhtml","before-upload":e.beforeAvatarUpload,"file-list":e.imageList,"list-type":"picture-card",name:"file",accept:"image/*",data:{type:"0"},"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,"on-success":e.handleSuccess}},[i("i",{staticClass:"el-icon-plus"})]),i("el-dialog",{attrs:{visible:e.picDialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.picDialogVisible=t}}},[i("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1):e._e(),"rescue"===this.$route.params.orderType&&e.itemId?i("el-form-item",{attrs:{label:"语音信息"}},e._l(e.form.orderItems[0].appointment.voices,(function(e,t){return i("div",{key:t},[i("audio",{attrs:{src:e.path,controls:""}})])})),0):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"服务日期",prop:"orderItems[0].appointment.appontmentDate"}},[i("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd HH:mm:ss",type:"date",placeholder:"请选择服务日期"},model:{value:e.form.orderItems[0].appointment.appontmentDate,callback:function(t){e.$set(e.form.orderItems[0].appointment,"appontmentDate",t)},expression:"form.orderItems[0].appointment.appontmentDate"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"开始时间",prop:"orderItems[0].appointment.driveStartDate"}},[i("el-time-picker",{attrs:{format:"HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择开始时间",disabled:!!e.itemId&&"service"!==e.handler},model:{value:e.form.orderItems[0].appointment.driveStartDate,callback:function(t){e.$set(e.form.orderItems[0].appointment,"driveStartDate",t)},expression:"form.orderItems[0].appointment.driveStartDate"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"结束时间",prop:"orderItems[0].appointment.driveEndDate"}},[i("el-time-picker",{attrs:{format:"HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择结束时间",disabled:!!e.itemId&&"service"!==e.handler},model:{value:e.form.orderItems[0].appointment.driveEndDate,callback:function(t){e.$set(e.form.orderItems[0].appointment,"driveEndDate",t)},expression:"form.orderItems[0].appointment.driveEndDate"}})],1):e._e(),"service"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"服务日期",prop:"appointmentDate"}},[i("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd HH:mm:ss",type:"date",placeholder:"请选择服务日期",clearable:!1,editable:!1},model:{value:e.appointmentDate,callback:function(t){e.appointmentDate=t},expression:"appointmentDate"}})],1):e._e(),"service"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"开始时间",prop:"appointmentStartDate"}},[i("el-time-picker",{attrs:{format:"HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择开始时间",editable:!1,clearable:!1},model:{value:e.form.appointmentDate,callback:function(t){e.$set(e.form,"appointmentDate",t)},expression:"form.appointmentDate"}})],1):e._e(),"service"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"结束时间",prop:"appointmentEndDate"}},[i("el-time-picker",{attrs:{format:"HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择结束时间",editable:!1,clearable:!1},model:{value:e.form.appointmentEndDate,callback:function(t){e.$set(e.form,"appointmentEndDate",t)},expression:"form.appointmentEndDate"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"使用时间(分)",prop:"useTime"}},[i("el-input",{attrs:{value:e.dateInterval(e.form.orderItems[0].appointment.driveEndDate,e.form.orderItems[0].appointment.driveStartDate),disabled:!0}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"开始里程",prop:"orderItems[0].appointment.startMileage"}},[i("el-input-number",{attrs:{"controls-position":"right",precision:0,min:0,disabled:!!e.itemId&&"service"!==e.handler},model:{value:e.form.orderItems[0].appointment.startMileage,callback:function(t){e.$set(e.form.orderItems[0].appointment,"startMileage",t)},expression:"form.orderItems[0].appointment.startMileage"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"结束里程",prop:"orderItems[0].appointment.endMileage"}},[i("el-input-number",{attrs:{"controls-position":"right",precision:0,min:0,disabled:!!e.itemId&&"service"!==e.handler},model:{value:e.form.orderItems[0].appointment.endMileage,callback:function(t){e.$set(e.form.orderItems[0].appointment,"endMileage",t)},expression:"form.orderItems[0].appointment.endMileage"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"使用里程(公里)"}},[i("el-input",{attrs:{value:e.form.orderItems[0].appointment.endMileage-e.form.orderItems[0].appointment.startMileage,disabled:!0}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"试驾车号",prop:"orderItems[0].appointment.plateNumber"}},[i("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入试驾车号"},on:{select:e.handleSelect},model:{value:e.form.orderItems[0].appointment.plateNumber,callback:function(t){e.$set(e.form.orderItems[0].appointment,"plateNumber",t)},expression:"form.orderItems[0].appointment.plateNumber"}})],1):e._e(),"ride"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"试驾车型",prop:"orderItems[0].appointment.product.fullName"}},[i("el-input",{attrs:{placeholder:"请选择试驾车型"},on:{focus:e.queryProduct},model:{value:e.form.orderItems[0].appointment.product.fullName,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"fullName",t)},expression:"form.orderItems[0].appointment.product.fullName"}})],1):e._e(),"replace"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"已有车型",prop:"orderItems[0].appointment.car.type"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.orderItems[0].appointment.car.type,callback:function(t){e.$set(e.form.orderItems[0].appointment.car,"type",t)},expression:"form.orderItems[0].appointment.car.type"}})],1):e._e(),"replace"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"行驶里程",prop:"orderItems[0].appointment.drivingRange"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.form.orderItems[0].appointment.drivingRange,callback:function(t){e.$set(e.form.orderItems[0].appointment,"drivingRange",t)},expression:"form.orderItems[0].appointment.drivingRange"}})],1):e._e(),"replace"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"上牌时间",prop:"orderItems[0].appointment.onTime"}},[i("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.orderItems[0].appointment.onTime,callback:function(t){e.$set(e.form.orderItems[0].appointment,"onTime",t)},expression:"form.orderItems[0].appointment.onTime"}})],1):e._e(),"replace"===this.$route.params.orderType||"loan"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"心仪车型",prop:"orderItems[0].appointment.product.brandId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择品牌",filterable:""},on:{change:e.handleBrandChange},model:{value:e.form.orderItems[0].appointment.product.brandId,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"brandId",t)},expression:"form.orderItems[0].appointment.product.brandId"}},e._l(e.brandList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"replace"===this.$route.params.orderType||"loan"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"",prop:"orderItems[0].appointment.product.seriesId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择系列",filterable:""},on:{change:e.handleSeriesChange},model:{value:e.form.orderItems[0].appointment.product.seriesId,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"seriesId",t)},expression:"form.orderItems[0].appointment.product.seriesId"}},e._l(e.seriesList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"replace"===this.$route.params.orderType||"loan"===this.$route.params.orderType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"",prop:"orderItems[0].appointment.product.id"}},[i("el-select",{staticClass:"isRequired",staticStyle:{width:"100%"},attrs:{placeholder:"请选择车型"},on:{change:e.productChange},model:{value:e.form.orderItems[0].appointment.product.id,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"id",t)},expression:"form.orderItems[0].appointment.product.id"}},e._l(e.modeList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"裸车总价",prop:"orderItems[0].appointment.product.price"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.orderItems[0].appointment.product.price,callback:function(t){e.$set(e.form.orderItems[0].appointment.product,"price",t)},expression:"form.orderItems[0].appointment.product.price"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"金融方案",prop:"orderItems[0].appointment.financialPlan.id"}},[i("el-select",{attrs:{placeholder:"请选择金融方案"},on:{change:function(t){return e.loanTerm(e.form.orderItems[0].appointment.financialPlan.id)}},model:{value:e.form.orderItems[0].appointment.financialPlan.id,callback:function(t){e.$set(e.form.orderItems[0].appointment.financialPlan,"id",t)},expression:"form.orderItems[0].appointment.financialPlan.id"}},e._l(e.financialPlans,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"首付比例",prop:"orderItems[0].appointment.downPayment"}},[i("el-select",{attrs:{placeholder:"请选择首付比例"},on:{change:e.monthPay},model:{value:e.form.orderItems[0].appointment.downPayment,callback:function(t){e.$set(e.form.orderItems[0].appointment,"downPayment",t)},expression:"form.orderItems[0].appointment.downPayment"}},e._l(e.form.orderItems[0].appointment.financialPlan.downPayments,(function(e,t){return i("el-option",{key:t,attrs:{label:Math.round(e)+"%",value:e}})})),1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"还款期限",prop:"orderItems[0].appointment.year"}},[i("el-select",{attrs:{placeholder:"请选择还款年限"},on:{change:e.monthPay},model:{value:e.form.orderItems[0].appointment.year,callback:function(t){e.$set(e.form.orderItems[0].appointment,"year",t)},expression:"form.orderItems[0].appointment.year"}},e._l(e.form.orderItems[0].appointment.financialPlan.loanTerms,(function(e,t){return i("el-option",{key:t,attrs:{label:e.year+"年",value:e.year}})})),1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"首付金额"}},[i("el-input",{attrs:{value:e.form.orderItems[0].appointment.product.price?e.form.orderItems[0].appointment.product.price*e.form.orderItems[0].appointment.downPayment/100:e.form.orderItems[0].appointment.product.price,disabled:!0}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"贷款额度"}},[i("el-input",{attrs:{value:e.form.orderItems[0].appointment.product.price?e.form.orderItems[0].appointment.product.price-e.form.orderItems[0].appointment.product.price*e.form.orderItems[0].appointment.downPayment/100:e.form.orderItems[0].appointment.product.price,disabled:!0}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"月供"}},[i("el-input",{attrs:{value:e.monthPay(),disabled:!0}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"手续费",prop:"orderItems[0].appointment.fee"}},[i("el-input",{attrs:{placeholder:"请输入手续费"},model:{value:e.form.orderItems[0].appointment.fee,callback:function(t){e.$set(e.form.orderItems[0].appointment,"fee",t)},expression:"form.orderItems[0].appointment.fee"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"身份证",prop:"orderItems[0].appointment.personId"}},[i("el-input",{attrs:{placeholder:"请输入身份证"},model:{value:e.form.orderItems[0].appointment.personId,callback:function(t){e.$set(e.form.orderItems[0].appointment,"personId",t)},expression:"form.orderItems[0].appointment.personId"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"工作单位",prop:"orderItems[0].appointment.workUnit"}},[i("el-input",{attrs:{placeholder:"请输入工作单位"},model:{value:e.form.orderItems[0].appointment.workUnit,callback:function(t){e.$set(e.form.orderItems[0].appointment,"workUnit",t)},expression:"form.orderItems[0].appointment.workUnit"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"房屋情况",prop:"orderItems[0].appointment.houseState"}},[i("el-select",{model:{value:e.form.orderItems[0].appointment.houseState,callback:function(t){e.$set(e.form.orderItems[0].appointment,"houseState",t)},expression:"form.orderItems[0].appointment.houseState"}},[i("el-option",{attrs:{label:"有",value:"1"}}),i("el-option",{attrs:{label:"无",value:"0"}})],1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"上牌城市",prop:"orderItems[0].appointment.onCity"}},[i("el-input",{attrs:{placeholder:"请输入上牌城市"},model:{value:e.form.orderItems[0].appointment.onCity,callback:function(t){e.$set(e.form.orderItems[0].appointment,"onCity",t)},expression:"form.orderItems[0].appointment.onCity"}})],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"意向购车时间",prop:"orderItems[0].appointment.intentionTime"}},[i("el-select",{attrs:{placeholder:"请选择意向购车时间"},model:{value:e.form.orderItems[0].appointment.intentionTime,callback:function(t){e.$set(e.form.orderItems[0].appointment,"intentionTime",t)},expression:"form.orderItems[0].appointment.intentionTime"}},[i("el-option",{attrs:{label:"一年",value:"4"}}),i("el-option",{attrs:{label:"半年",value:"3"}}),i("el-option",{attrs:{label:"三个月",value:"2"}}),i("el-option",{attrs:{label:"两个月",value:"1"}}),i("el-option",{attrs:{label:"一个月",value:"0"}})],1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"月收入",prop:"orderItems[0].appointment.monthIncome"}},[i("el-select",{attrs:{placeholder:"请选择月收入"},model:{value:e.form.orderItems[0].appointment.monthIncome,callback:function(t){e.$set(e.form.orderItems[0].appointment,"monthIncome",t)},expression:"form.orderItems[0].appointment.monthIncome"}},[i("el-option",{attrs:{label:"20000以上",value:"4"}}),i("el-option",{attrs:{label:"15000-19999",value:"3"}}),i("el-option",{attrs:{label:"10000-14999",value:"2"}}),i("el-option",{attrs:{label:"5000-9999",value:"1"}}),i("el-option",{attrs:{label:"0-4999",value:"0"}})],1)],1):e._e(),"loan"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"有车情况",prop:"orderItems[0].appointment.carState"}},[i("el-select",{attrs:{placeholder:"请选择有车情况"},model:{value:e.form.orderItems[0].appointment.carState,callback:function(t){e.$set(e.form.orderItems[0].appointment,"carState",t)},expression:"form.orderItems[0].appointment.carState"}},[i("el-option",{attrs:{label:"有",value:"1"}}),i("el-option",{attrs:{label:"无",value:"0"}})],1)],1):e._e(),i("el-form-item",{staticClass:"isRequired",attrs:{label:"顾问",prop:"consultant.id"}},[i("el-select",{attrs:{placeholder:"请选择顾问"},model:{value:e.form.consultant.id,callback:function(t){e.$set(e.form.consultant,"id",t)},expression:"form.consultant.id"}},e._l(e.consultants,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name||"未填写",value:e.id}})})),1)],1),"service"===this.$route.params.orderType?i("el-form-item",{attrs:{label:"业务类型"}},[i("tag-select",{ref:"tagSelect",attrs:{tagList:e.tagList,bAddTag:!1,selectType:"order",selectedTags:e.selectedTags},on:{addSuccess:e.onAddSuccess}})],1):e._e(),i("el-form-item",{attrs:{label:"买家留言",prop:"memo"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.memo,callback:function(t){e.$set(e.form,"memo",t)},expression:"form.memo"}})],1),i("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[i("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],2),e.showPayment?i("el-collapse-item",{attrs:{name:"4"}},[-1!==e.activeNames.indexOf("4")&&e.handler?i("template",{slot:"title"},[i("div",{staticClass:"title-class"},[i("div",{staticClass:"title-class-one"},[i("el-badge",{staticClass:"item",attrs:{"is-dot":""}},[e._v("付款信息")])],1)])]):e._e(),-1!==e.activeNames.indexOf("4")&&e.handler?e._e():i("template",{slot:"title"},[e._v("付款信息")]),e.itemId?i("el-form-item",{staticClass:"isRequired",attrs:{label:"支付方式",prop:"paymentMethodId"}},[i("el-select",{attrs:{disabled:"1"!==e.form.type&&"2"!==e.form.type,placeholder:"请选择支付方式"},model:{value:e.form.paymentMethodId,callback:function(t){e.$set(e.form,"paymentMethodId",t)},expression:"form.paymentMethodId"}},e._l(e.paymentMethods,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),i("el-form-item",{staticClass:"isRequired",attrs:{label:"付款方式",prop:"payments[0].paymentType"}},[i("el-select",{attrs:{disabled:!!e.itemId&&"payment"!==e.handler,placeholder:"请选择付款方式"},on:{change:e.paymentTypeChange},model:{value:e.form.payments[0].paymentType,callback:function(t){e.$set(e.form.payments[0],"paymentType",t)},expression:"form.payments[0].paymentType"}},e._l(e.paymentTypes,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.name}})})),1)],1),"会员卡余额"===e.form.payments[0].paymentType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"会员卡",prop:"memberCardId"}},[i("el-select",{attrs:{disabled:!!e.itemId&&"payment"!==e.handler,placeholder:"请选择会员卡"},on:{change:e.memberCardChange},model:{value:e.form.memberCardId,callback:function(t){e.$set(e.form,"memberCardId",t)},expression:"form.memberCardId"}},e._l(e.listExistCard,(function(e,t){return i("el-option",{key:t,attrs:{label:e.template.name,value:e.id}})})),1)],1):e._e(),"刷卡"===e.form.payments[0].paymentType||"汇款"===e.form.payments[0].paymentType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"付款银行",prop:"payments[0].payBank"}},[i("el-select",{attrs:{disabled:!!e.itemId&&"payment"!==e.handler,placeholder:"请选择付款银行"},model:{value:e.form.payments[0].payBank,callback:function(t){e.$set(e.form.payments[0],"payBank",t)},expression:"form.payments[0].payBank"}},[i("el-option",{attrs:{label:"中国工商银行",value:"中国工商银行"}}),i("el-option",{attrs:{label:"中国农业银行",value:"中国农业银行"}}),i("el-option",{attrs:{label:"中国银行",value:"中国银行"}}),i("el-option",{attrs:{label:"中国建设银行",value:"中国建设银行"}}),i("el-option",{attrs:{label:"交通银行",value:"交通银行"}}),i("el-option",{attrs:{label:"中信银行",value:"中信银行"}}),i("el-option",{attrs:{label:"广发银行",value:"广发银行"}}),e._v("、 "),i("el-option",{attrs:{label:"深圳发展银行",value:"深圳发展银行"}}),i("el-option",{attrs:{label:"招商银行",value:"招商银行"}}),i("el-option",{attrs:{label:"中国光大银行",value:"中国光大银行"}}),i("el-option",{attrs:{label:"华夏银行",value:"华夏银行"}}),i("el-option",{attrs:{label:"中国民生银行",value:"中国民生银行"}}),i("el-option",{attrs:{label:"兴业银行",value:"兴业银行"}}),i("el-option",{attrs:{label:"上海浦东发展银行",value:"上海浦东发展银行"}}),i("el-option",{attrs:{label:"恒丰银行",value:"恒丰银行"}}),i("el-option",{attrs:{label:"浙商银行",value:"浙商银行"}}),i("el-option",{attrs:{label:"渤海银行",value:"渤海银行"}}),i("el-option",{attrs:{label:"中国邮政储蓄银行",value:"中国邮政储蓄银行"}}),i("el-option",{attrs:{label:"其他银行",value:"其他银行"}})],1)],1):e._e(),"刷卡"===e.form.payments[0].paymentType||"汇款"===e.form.payments[0].paymentType?i("el-form-item",{staticClass:"isRequired",attrs:{label:"付款帐号",prop:"payments[0].payAccount"}},[i("el-input",{attrs:{disabled:!!e.itemId&&"payment"!==e.handler,placeholder:"请输入付款帐号"},model:{value:e.form.payments[0].payAccount,callback:function(t){e.$set(e.form.payments[0],"payAccount",t)},expression:"form.payments[0].payAccount"}})],1):e._e()],2):e._e(),e.showInfo?i("el-collapse-item",{attrs:{title:"优惠信息",name:"3"}},[e.itemId?i("div",[i("el-form-item",{attrs:{label:"优惠券折扣",prop:"couponDiscount"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.couponDiscount,callback:function(t){e.$set(e.form,"couponDiscount",t)},expression:"form.couponDiscount"}})],1),i("el-form-item",{attrs:{label:"赠送积分",prop:"point"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.point,callback:function(t){e.$set(e.form,"point",t)},expression:"form.point"}})],1)],1):i("div",[i("el-form-item",{attrs:{label:"福利",prop:"couponDiscount"}},[i("el-select",{attrs:{placeholder:"请选择"},on:{change:e.couponChange},model:{value:e.form.couponCodeId,callback:function(t){e.$set(e.form,"couponCodeId",t)},expression:"form.couponCodeId"}},e._l(e.form.couponList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.coupon.name,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"V豆抵扣",prop:"beanDiscount"}},[i("el-input",{attrs:{disabled:!("会员卡余额"===e.form.payments[0].paymentType&&e.form.memberCardId&&e.form.bean),min:0},on:{change:e.beanChange},model:{value:e.form.beanDiscount,callback:function(t){e.$set(e.form,"beanDiscount",t)},expression:"form.beanDiscount"}}),"会员卡余额"===e.form.payments[0].paymentType&&e.form.memberCardId?i("div",[e._v(e._s(e.beanCanUse))]):e._e()],1)],1)]):e._e(),e.showInfo?i("el-collapse-item",{attrs:{title:"其他信息",name:"7"}},[i("el-form-item",{attrs:{label:"创建时间"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.orderTime,callback:function(t){e.$set(e.form,"orderTime",t)},expression:"form.orderTime"}})],1),i("el-form-item",{attrs:{label:"执行时间"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.deliveryTime,callback:function(t){e.$set(e.form,"deliveryTime",t)},expression:"form.deliveryTime"}})],1),i("el-form-item",{attrs:{label:"付款时间"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.paymentTime,callback:function(t){e.$set(e.form,"paymentTime",t)},expression:"form.paymentTime"}})],1),i("el-form-item",{attrs:{label:"完成时间"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.completeTime,callback:function(t){e.$set(e.form,"completeTime",t)},expression:"form.completeTime"}})],1)],1):e._e()],1)],1),i("el-dialog",{attrs:{title:"创建会员",visible:e.dialogVisible,width:"50%",appendToBody:!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"dialogFormModel",attrs:{model:e.formModel,"label-width":"120px",size:"small",rules:e.dialogRules,"inline-message":!0}},[i("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[i("el-input",{attrs:{placeholder:"请输入手机号，如1888888888"},on:{blur:e.mobileBlur},model:{value:e.formModel.mobile,callback:function(t){e.$set(e.formModel,"mobile",t)},expression:"formModel.mobile"}})],1),i("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[i("el-input",{attrs:{placeholder:"请输入用户名，如1888888888"},model:{value:e.formModel.userName,callback:function(t){e.$set(e.formModel,"userName",t)},expression:"formModel.userName"}})],1),i("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[i("el-input",{attrs:{placeholder:"请输入昵称，如1888888888"},model:{value:e.formModel.nickname,callback:function(t){e.$set(e.formModel,"nickname",t)},expression:"formModel.nickname"}})],1),i("el-form-item",{attrs:{label:"姓名",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入姓名，如张三"},model:{value:e.formModel.name,callback:function(t){e.$set(e.formModel,"name",t)},expression:"formModel.name"}})],1),i("el-form-item",{attrs:{label:"密码",prop:"password"}},[i("el-input",{attrs:{type:"text",placeholder:"请输入密码"},model:{value:e.formModel.password,callback:function(t){e.$set(e.formModel,"password",t)},expression:"formModel.password"}})],1),i("el-form-item",{attrs:{label:"性别",prop:"gender"}},[i("el-radio-group",{model:{value:e.formModel.gender,callback:function(t){e.$set(e.formModel,"gender",t)},expression:"formModel.gender"}},[i("el-radio",{attrs:{label:"0"}},[e._v("男")]),i("el-radio",{attrs:{label:"1"}},[e._v("女")]),i("el-radio",{attrs:{label:"2"}},[e._v("保密")])],1)],1),i("el-form-item",{attrs:{label:"车牌号"}},[i("el-input",{attrs:{placeholder:"请输入车牌号，如浙12345"},model:{value:e.formModel.defaultCarInfo.plateNumber,callback:function(t){e.$set(e.formModel.defaultCarInfo,"plateNumber",t)},expression:"formModel.defaultCarInfo.plateNumber"}})],1),i("el-form-item",{attrs:{label:"品牌"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择，如宝马",filterable:""},on:{change:e.brandChange},model:{value:e.formModel.defaultCarInfo.brand,callback:function(t){e.$set(e.formModel.defaultCarInfo,"brand",t)},expression:"formModel.defaultCarInfo.brand"}},e._l(e.brandData,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),i("el-form-item",{attrs:{label:"系列"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择，如宝马3系",filterable:""},on:{change:e.seriesChange},model:{value:e.formModel.defaultCarInfo.series,callback:function(t){e.$set(e.formModel.defaultCarInfo,"series",t)},expression:"formModel.defaultCarInfo.series"}},e._l(e.seriesData,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),i("el-form-item",{attrs:{label:"车型"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择，如宝马3系2016款"},model:{value:e.formModel.defaultCarInfo.type,callback:function(t){e.$set(e.formModel.defaultCarInfo,"type",t)},expression:"formModel.defaultCarInfo.type"}},e._l(e.modeData,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),i("el-form-item",{attrs:{label:"车辆识别代码"}},[i("el-input",{attrs:{placeholder:"请输入车辆识别代码，如1G1BL52P7TR115520"},model:{value:e.formModel.defaultCarInfo.vin,callback:function(t){e.$set(e.formModel.defaultCarInfo,"vin",t)},expression:"formModel.defaultCarInfo.vin"}})],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.createMember()}}},[e._v("确 定")])],1)],1),i("biz-dialog-selector",{staticClass:"memberDialog",attrs:{title:"选择会员",visibility:e.showDialog,appendToBody:!0,keyField:"id",selectionKeys:e.selectionKeys,loading:e.dialogLoading,tableData:e.dialogTableData,pagination:e.dialogPagination,selectionMode:"single",filters:e.dialogFilters},on:{"update:visibility":function(t){e.showDialog=t},confirmed:e.handleConfirmed,open:e.opened,operate:e.dialogOperate,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange}},[i("el-table-column",{attrs:{label:"用户名",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"customer-info"},[t.row.head?i("img",{attrs:{src:t.row.head}}):i("img",{attrs:{src:a("624d")}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"title"},[e._v(e._s(t.row.name))]),i("div",{staticClass:"gender"},["0"===t.row.gender?i("i",{staticClass:"male iconfont biz-icon-i-web-m"}):e._e(),"1"===t.row.gender?i("i",{staticClass:"female iconfont biz-icon-i-web-f"}):e._e(),"2"===t.row.gender?i("i",{staticClass:"none iconfont biz-icon-i-web-bm"}):e._e(),i("span",[e._v(e._s(t.row.mobile))])])])])]}}])}),i("el-table-column",{attrs:{prop:"mobile",label:"手机号"}}),i("el-table-column",{attrs:{prop:"createDate",label:"创建日期",formatter:e.createDateConverter,sortable:"custom"}}),i("el-table-column",{attrs:{label:"状态",formatter:e.stateConverter}}),i("el-table-column",{attrs:{prop:"",label:"店铺名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",e._l(t.row.shops,(function(t,a){return i("div",{key:a,staticClass:"customer-info"},[e._v(e._s(t.name))])})),0)]}}])}),i("el-table-column",{attrs:{prop:"lastLoginIp",label:"最后登录地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"customer-info"},[i("span",{staticStyle:{display:"block"}},[e._v(e._s(t.row.loginAddress||t.row.lastLoginIp))])])]}}])}),i("el-table-column",{attrs:{prop:"lastLoginDate",label:"最后登录时间",formatter:e.loginDateConverter,sortable:"custom"}})],1),i("biz-dialog-selector",{attrs:{title:"选择车型",visibility:e.showProductSelector,tableData:e.productTableData,pagination:e.productPagination,selectionMode:"single"},on:{"update:visibility":function(t){e.showProductSelector=t},pageSizeChange:e.productPageSizeChange,currentPageChange:e.productCurrentPageChange,confirmed:e.confirmedProduct}},[i("el-table-column",{attrs:{property:"fullName",label:"名称"}}),i("el-table-column",{attrs:{property:"price",label:"销售价"}})],1)],1)},r=[],o=(a("99af"),a("4de4"),a("7db0"),a("c740"),a("4160"),a("c975"),a("d81d"),a("a434"),a("b0c0"),a("a9e3"),a("b680"),a("d3b7"),a("ac1f"),a("25f0"),a("3ca3"),a("5319"),a("1276"),a("159b"),a("ddb0"),a("b85c")),n=(a("96cf"),a("1da1")),s=a("5530"),l=a("f36f"),c=a("e42c"),d=a("8330"),p=a("46fc"),m=a("c466"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:e.title,visible:e.dialogVisible,"append-to-body":e.appendToBody},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close,open:e.open}},[a("biz-flex-table",{ref:"table",attrs:{operations:e.operations,filters:e.filters,tags:e.tags,pagination:e.pagination,tableData:e.tableData,loading:e.loading,checkable:e.checkable},on:{operate:e.operate,"row-click":e.rowClick,"filter-data-change":e.filterDataChange,"select-all":e.handleSelectAll,select:e.handleSelectionChange,"size-change":e.pageSizeChange,"current-change":e.currentPageChange}},[e._t("default")],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmed}},[e._v("确定")])],1)],1)},f=[],g=a("04d3"),h={name:"BizDialogSelector",components:{BizFlexTable:g["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},selectionKeys:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],innerSelection:[]}},methods:{generateSelectionKeys:function(e,t){if(e.indexOf(t)>=0)this.innerSelectionKeys.push(t[this.keyField]);else{var a=this.innerSelectionKeys.indexOf(t[this.keyField]);this.innerSelectionKeys.splice(a,1)}},open:function(e){console.log(this.selectionKeys),this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(e){this.innerSelectionKeys=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){this.innerSelectionKeys.length>0?(this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1):this.$message("请选择一项")},operate:function(e){this.$emit("operate",e)},filterDataChange:function(e){this.$emit("filterDataChange",e)},handleSelectAll:function(e){var t=this;0===e.length?this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a>=0&&t.innerSelectionKeys.splice(a,1)})):this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a<0&&t.innerSelectionKeys.push(e[t.keyField])}))},handleSelectionChange:function(e,t){this.generateSelectionKeys(e,t)},pageSizeChange:function(e){this.$emit("pageSizeChange",e)},currentPageChange:function(e){this.$emit("currentPageChange",e)},rowClick:function(e,t,a){"single"===this.selectionMode&&(this.innerSelectionKeys=[e[this.keyField]],this.innerSelection=[e])}},watch:{visibility:function(e,t){this.dialogVisible=e}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){}},b=h,v=(a("1029"),a("2877")),y=Object(v["a"])(b,u,f,!1,null,null,null),C=y.exports,I=a("2f62"),w=a("18eb"),S=a("0e5e"),_=a("1ab1"),D=a("c596"),T={stateConverter:function(e){return"0"===e.enableState?"停用":"1"===e.enableState?"启用":"--"},createDateConverter:function(e){if(e.createDate){e.createDate=e.createDate.replace(/-/g,"/");var t=new Date(e.createDate);return m["a"].dateConverter(t)}return"--"},loginDateConverter:function(e){if(e.lastLoginDate){e.lastLoginDate=e.lastLoginDate.replace(/-/g,"/");var t=new Date(e.lastLoginDate);return m["a"].dateConverter(t)}return"--"},ipConverter:function(e){return e.lastLoginIp?e.lastLoginIp:"--"}},k={name:"baseInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},open:{type:Boolean,default:function(){return!1}},handler:{type:String},activeNames:{type:Array,default:function(){return["1","2","3","4","5"]}}},components:{BizGrid:l["a"],BizSaveButton:d["a"],BizDialogSelector:C,TagSelect:w["a"]},data:function(){var e=this;return{isShipped:!1,beanCanUse:"",maxOffsetBean:0,minOffsetBean:0,originalAmount:"",orderStateTypeList:[{label:"订单已执行",value:"1"},{label:"交易完成",value:"2"}],beanRate:0,tagList:[],selectedTags:[],restaurants:[],dialogRules:{userName:[{required:!0,trigger:"blur",message:"请输入用户名"},{pattern:/^[0-9a-zA-Z]+$/,message:"用户名只能为数字或字母",trigger:"blur"},{min:4,max:20,message:"长度在4-20位",trigger:"blur"}],mobile:[{required:!0,trigger:"blur",message:"请输入手机号"}],nickname:[{required:!0,trigger:"blur",message:"请输入昵称"}],name:[{required:!0,trigger:"blur",message:"请输入姓名"}],password:[{required:!0,trigger:"blur",message:"请输入密码"},{min:6,max:20,message:"密码应在6-20位之间",trigger:"blur"}],rePassword:[{required:!0,trigger:"blur",message:"请再次输入密码"},{trigger:"blur",validator:function(t,a,i){e.formModel.password===e.formModel.rePassword?i():i(new Error("两次输入密码不一致"))}}]},loading:!1,picDialogVisible:!1,showProductSelector:!1,dialogImageUrl:"",isFirst:!0,showDialog:!1,dialogVisible:!1,showDelivery:!1,showReceiver:!1,flag:!1,data:{type:"",method:""},productTableData:[],imageList:[],consultants:[],shippingMethod:[],deliveryCorps:[],paymentTypes:[],paymentMethods:[],listExistCard:[],brandList:[],seriesList:[],modeList:[],brandData:[],seriesData:[],modeData:[],financialPlans:[],selectionKeys:[],rescueOrganizations:[],cars:[],reasons:[],workers:[],orderItems:[],areaId:"1568",useTime:"",useMileage:"",appointmentDate:"",downPaymentPrice:"",loanPrice:"",formModel:{userName:"",mobile:"",name:"",password:"123456",nickname:"",gender:"2",defaultCarInfo:{plateNumber:"",brand:"",series:"",type:"",vin:""}},form:{bean:"",appointmentData:{appontmentDate:"",driveEndDate:"",driveStartDate:"",startMileage:"",endMileage:"",level:"",palteNumber:"",productId:"",drivingRange:"",onTime:"",downPayment:"",year:"",price:"",fee:"",personId:"",workUnit:"",houseState:"",onCity:"",intentionTime:"",monthIncome:"",carState:"",way:"",rescueUnit:"",rescuerId:"",rescueCar:"",distance:"",workerLocation:"",reasons:[],images:[],voices:[],financialPlan:{id:"",name:"",loanTerm:[],downPayments:[]},product:{brandId:"",seriesIs:"",id:"",fullName:""},car:{type:""}},appointmentDate:"",appointmentEndDate:"",sn:"",type:"",amount:"",amountPrepay:"",amountFinalpay:"",originalAmount:"",offsetAmount:"",curAmount:"",memberCardId:"",userId:"",consultant:{id:""},area:{id:"1568"},car:{id:"",tpye:"",drivingRange:""},address:"",areaName:"",consignee:"",phone:"",zipCode:"",remarks:"",memo:"",promotionDiscount:"",couponDiscount:"",couponCodeId:"",couponCode:{},couponList:[],beanDiscount:"",point:"",giftBean:"",shippingMethodName:"",paymentMethodId:"",shippingMethodId:"",invoiceState:"",orderTime:"",deliveryTime:"",paymentTime:"",completeTime:"",orderItems:[{appointment:{appontmentDate:"",driveEndDate:"",driveStartDate:"",startMileage:"",endMileage:"",level:"",palteNumber:"",productId:"",drivingRange:"",onTime:"",downPayment:"",year:"",price:"",fee:"",personId:"",workUnit:"",houseState:"",onCity:"",intentionTime:"",monthIncome:"",carState:"",way:"",rescueUnit:"",rescuerId:"",rescueCar:"",distance:"",plateNumber:"",workerLocation:"",reasons:[],images:[],voices:[],financialPlan:{id:"",name:"",loanTerm:[],downPayments:[]},product:{brandId:"",seriesIs:"",id:"",fullName:""},car:{type:""}}}],payments:[{paymentType:"",payBank:"",payAccount:""}],member:{nickname:"",gender:"",mobile:""},shippings:[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:"",consignee:"",isLCL:"0",phone:"",zipCode:""}]},operations:[{label:"保存",name:"save",type:"primary"}],adminCurrent:[],dialogLoading:!0,dialogTableData:[],dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},productPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},isCreated:!1,dialogFilters:[{type:"input",label:"",placeholder:"请输入店铺名称",name:"searchValue",value:""}]}},computed:Object(s["a"])(Object(s["a"])({},Object(I["c"])(["currentUser"])),{},{getCouponCode:function(){var e,t=this;return this.form.couponList.forEach((function(a){if(a.id===t.form.couponCodeId)return e=a,!1})),e},showInfo:function(){return!0},showPayment:function(){return!!this.itemId||"1"!==this.form.type},isCreate:function(){return!this.itemId}}),created:function(){this.queryBrandList(),this.getBrandList(),this.getFinancialPlans(),!this.itemId&&this.orderOptions(),this.getStoreTags(),this.testDrives()},watch:{itemId:function(e){this.itemId&&this.init(),this.itemId||(this.resetFormData(),this.form.type="2",this.getStoreTags())},open:function(e){this.isShipped=!1,!this.itemId&&e&&this.isCreated&&this.resetFormData()},form:{deep:!0,immediate:!0,handler:function(e){var t=this;this.showDelivery=!1,this.showReceiver=!1,this.shippingMethod.map((function(a){a.name===e.shippingMethodName&&"1"===a.isNeedDelivery&&(t.showDelivery=!0),a.name===e.shippingMethodName&&"1"===a.isNeedReceiver&&(t.showReceiver=!0)}))}}},methods:Object(s["a"])(Object(s["a"])(Object(s["a"])({},Object(I["c"])(["getUser"])),T),{},{getDefaultForm:function(){return{bean:"",curAmount:"",couponCodeId:"",couponCode:{},couponList:[],appointmentData:{appontmentDate:"",driveEndDate:"",driveStartDate:"",startMileage:"",endMileage:"",level:"",palteNumber:"",productId:"",drivingRange:"",onTime:"",downPayment:"",year:"",price:"",fee:"",personId:"",workUnit:"",houseState:"",onCity:"",intentionTime:"",monthIncome:"",carState:"",way:"",rescueUnit:"",rescuerId:"",rescueCar:"",distance:"",workerLocation:"",reasons:[],images:[],voices:[],financialPlan:{id:"",name:"",loanTerm:[],downPayments:[]},product:{brandId:"",seriesIs:"",id:"",fullName:""},car:{type:""}},appointmentDate:"",appointmentEndDate:"",sn:"",type:"",amount:"",amountPrepay:"",amountFinalpay:"",originalAmount:"",offsetAmount:"0",memberCardId:"",userId:"",consultant:{id:""},area:{id:"1568",fullanme:""},car:{id:"",tpye:"",drivingRange:""},address:"",areaName:"",consignee:"",phone:"",zipCode:"",remarks:"",memo:"",promotionDiscount:"",couponDiscount:"",beanDiscount:"",point:"",giftBean:"",shippingMethodName:"",paymentMethodId:"",shippingMethodId:"",invoiceState:"",orderTime:"",deliveryTime:"",paymentTime:"",completeTime:"",orderItems:[{appointment:{appontmentDate:"",driveEndDate:"",driveStartDate:"",startMileage:"",endMileage:"",level:"",palteNumber:"",productId:"",drivingRange:"",onTime:"",downPayment:"",year:"",price:"",fee:"",plateNumber:"",personId:"",workUnit:"",houseState:"",onCity:"",intentionTime:"",monthIncome:"",carState:"",way:"",rescueUnit:"",rescuerId:"",rescueCar:"",distance:"",workerLocation:"",reasons:[],images:[],voices:[],financialPlan:{id:"",name:"",loanTerm:[],downPayments:[]},product:{brandId:"",seriesIs:"",id:"",fullName:""},car:{type:""}}}],payments:[{paymentType:"",payBank:"",payAccount:""}],member:{nickname:"",gender:"",mobile:""},shippings:[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:"",consignee:"",phone:"",zipCode:""}]}},onShippingChange:function(){this.form.shippingMethodName&&this.showDelivery||(this.form.shippings[0].freight="",this.getOriginalAmount())},mobileBlur:function(){this.formModel.id||this.formModel.nickname||this.$set(this.formModel,"nickname",this.formModel.mobile),this.formModel.id||this.formModel.userName||this.$set(this.formModel,"userName",this.formModel.mobile)},brandChange:function(e){this.getSeriesList(e),this.formModel.defaultCarInfo.series="",this.formModel.defaultCarInfo.type=""},seriesChange:function(e){this.getModeList(e),this.formModel.defaultCarInfo.type=""},getStoreTags:function(){var e=this,t={categoryType:"订单/服务业务类型",shopId:window.top.SHOP_ID||""};_["a"].get(D["g"].systemSetting.storeTags,t).then((function(t){console.log("订单/服务业务类型标签",t),e.tagList=t.content})).catch((function(e){console.log(e.errorMessage)}))},beanChange:function(){this.getOriginalAmount()},getOriginalAmount:function(){this.isCreate&&(this.form.originalAmount=(Number(this.originalAmount)-Number(this.form.beanDiscount*this.beanRate||"0")-Number(this.form.couponDiscount||"0")+Number(this.form.shippings[0].freight||"0")).toFixed(2),this.getCurAmount())},getCurAmount:function(){this.form.curAmount=(Number(this.form.originalAmount)+Number(this.form.offsetAmount||"0")).toFixed(2),this.form.curAmount<=0&&(this.form.curAmount=0),this.form.curAmount=this.form.curAmount.toString()},freightChange:function(){this.getOriginalAmount()},offsetAmountChange:function(){this.getCurAmount()},curAmountChange:function(){this.form.offsetAmount=Number(this.form.curAmount)+Number(this.form.beanDiscount*this.beanRate)+Number(this.form.couponDiscount)-Number(this.form.originalAmount),this.form.offsetAmount=this.form.offsetAmount.toString()},couponChange:function(){var e=this;this.form.couponList.forEach((function(t){if(t.id===e.form.couponCodeId)return e.form.couponDiscount=t.coupon.amount,!1})),this.getOriginalAmount()},tagMapping:function(){var e={refId:this.itemId,type:"7",tags:this.$refs.tagSelect.getCurSelectedTags(),shopId:window.top.SHOP_ID||""};_["a"].post(D["g"].systemSetting.tagMapping,e).then((function(e){console.log("映射成功")})).catch((function(e){console.log(e.errorMessage)}))},getTagMapping:function(){var e=this;this.selectedTags=[];var t={refId:this.itemId,type:"7",shopId:window.top.SHOP_ID||""};_["a"].get(D["g"].systemSetting.tagMapping,t).then((function(t){console.log("查看映射信息",t),t.data.tags&&(e.selectedTags=t.data.tags)})).catch((function(e){console.log(e.errorMessage)}))},onAddSuccess:function(){this.getStoreTags()},operate:function(e){this[e]()},dateInterval:function(e,t){if(e&&t)return Object(p["a"])(e.split(" ")[1],t.split(" ")[1])},showDialogFc:function(){this.showDialog=!0,this.dialogFilters[0].value=""},monthPay:function(){var e=this;if(this.form.orderItems[0].appointment.year)return this.form.orderItems[0].appointment.financialPlan.loanTerms.map((function(t){t.year===e.form.orderItems[0].appointment.year&&(e.form.orderItems[0].appointment.rate=t.rate)})),((this.form.orderItems[0].appointment.product.price-this.form.orderItems[0].appointment.product.price*this.form.orderItems[0].appointment.downPayment/100)*this.form.orderItems[0].appointment.rate/12*Math.pow(1+this.form.orderItems[0].appointment.rate/12,12*this.form.orderItems[0].appointment.year)/(Math.pow(1+this.form.orderItems[0].appointment.rate/12,12*this.form.orderItems[0].appointment.year)-1)).toFixed(2)},queryProduct:function(){var e=this;c["a"].listProductByTestDrive({clientType:"2",methodName:"ListProductByTestDrive",shopId:this.getUser().shop?this.getUser().shop.id:window.top.SHOP_ID,pageSize:this.productPagination.pageSize,pageNumber:this.productPagination.currentPage},(function(t){e.productTableData=t.content,e.showProductSelector=!0}),(function(t){e.$message.warning(t.errorMessage)}))},confirmedProduct:function(e,t){this.form.orderItems[0].appointment.product.id=t[0].id,this.form.orderItems[0].appointment.product.fullName=t[0].fullName},handleConfirmed:function(e,t){this.form.member.nickname=t[0].nickname,this.form.member.mobile=t[0].mobile,this.form.memberCardId="",this.form.userId=t[0].id,this.$set(this.form.member,"gender",t[0].gender),this.$set(this.form,"selectionKeys",e),this.listExistCardTemplate(),this.form.plateNumber=t[0].defaultCarInfo.plateNumber,this.form.drivingRange=t[0].defaultCarInfo.drivingRange||"",this.form.car.type=t[0].defaultCarInfo.type||"",this.form.car.drivingRange="",this.form.shippings[0].address&&this.itemId||(this.form.shippings[0].address=t[0].defaultReceiver.areaName+t[0].defaultReceiver.address),this.form.shippings[0].consignee&&this.itemId||(this.form.shippings[0].consignee=t[0].name),this.form.shippings[0].phone&&this.itemId||(this.form.shippings[0].phone=t[0].mobile),this.carOptions(this.form.userId),this.getCouponList()},carOptions:function(e){var t,a=this;c["a"].carOptions({memberId:e},(function(e){a.cars=e.cars,a.cars.length>0&&(a.cars.forEach((function(e){if(e.plateNumber===a.form.plateNumber)return t=e,!1})),a.form.car.id=t?t.id:"",a.cars.map((function(e){if(e.id===a.form.car.id)return a.form.car.type=e.type,!1})))}),(function(e){a.$message.warning(e.errorMessage)}))},carChange:function(e){var t=this;this.cars.map((function(a){a.id===e&&(t.form.car.type=a.type,t.form.car.drivingRange=a.drivingRange,t.form.drivingRange=a.drivingRange)}))},createMember:function(){var e=this;this.$refs.dialogFormModel.validate((function(t,a){t&&c["a"].createMember(e.formModel,(function(t){e.loading=!1,e.$message.success("保存成功"),e.dialogVisible=!1,e.form.member.nickname=t.data.name,e.form.member.gender=t.data.gender,e.form.member.mobile=t.data.mobile,e.form.userId=t.data.id,t.data.defaultCarInfo&&(e.cars.push({plateNumber:t.data.defaultCarInfo.plateNumber,id:t.data.defaultCarInfo.id,type:t.data.defaultCarInfo.type}),e.form.car.id=t.data.defaultCarInfo.id,e.form.car.type=t.data.defaultCarInfo.type)}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))}))},resetFormData:function(){this.form=this.getDefaultForm(),this.form.userId="",this.form.memberCardId="",this.listExistCard=[],this.form.member={},this.form.couponList=[],this.form.couponCodeId="",this.form.beanDiscount="",this.paymentTypes=[],this.form.payments[0].paymentType="",this.form.shippings[0].deliveryCorpId="",this.form.originalAmount="",this.form.curAmount="",this.form.car.type="",this.form.car.drivingRange="",this.form.drivingRange="",this.form.plateNumber="",this.form.car.id="",this.form.offsetAmount="",this.form.orderItems[0].appointment.product.brandId="",this.form.orderItems[0].appointment.product.seriesId="",this.form.orderItems[0].appointment.product.id=""},init:function(){var e=this;c["a"].viewOrder(this.getSaveParams(),(function(t){e.form=Object.assign(e.getDefaultForm(),t.order),e.form.curAmount=Number(e.form.originalAmount)+Number(e.form.offsetAmount),console.log(e.form),0===e.form.payments.length?(e.form.payments=[{paymentType:"",payBank:"",payAccount:""}],e.form.payments[0].paymentType=e.form.paymentTypeName):e.form.memberCardId=e.form.payments[0].memberCardId,0===e.form.shippings.length&&(e.form.shippings=[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:e.form.area&&e.form.area.fullName?e.form.area.fullName+e.form.address:e.form.address,consignee:e.form.consignee,phone:e.form.phone,zipCode:e.form.zipCode}]),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.product&&e.form.orderItems[0].appointment.product.brandId&&e.querySeriesList(e.form.orderItems[0].appointment.product.brandId),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.product&&e.form.orderItems[0].appointment.product.seriesId&&e.queryTypeList(e.form.orderItems[0].appointment.product.seriesId),t.order.appointmentDate&&(e.appointmentDate=t.order.appointmentDate),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.reasons&&(e.form.orderItems[0].appointment.reasons=e.form.orderItems[0].appointment.reasons.map((function(e){return e.id}))),e.carOptions(e.form.member.id),e.shippingMethod=t.shippingMethods,e.deliveryCorps=t.deliveryCorps,e.paymentTypes=t.paymentTypes,e.paymentMethods=t.paymentMethods,e.paymentMethods.map((function(a){a.name===t.order.paymentMethodName&&(e.form.paymentMethodId=a.id)})),e.reasons=t.reasons,e.adminCurrent=[{id:t.adminCurrent.id,name:t.adminCurrent.realName}],e.form.consultant.id?e.adminCurrent=[{id:e.form.consultant.id,name:e.form.consultant.realName}]:e.form.consultant={id:t.adminCurrent.id},e.form.area&&(e.areaId=e.form.area.id),"rescue"===e.$route.params.orderType&&(e.imageList=e.form.orderItems[0].appointment.images.map((function(e){return{url:e.path}}))),e.form.type=e.getOrderStatus(e.form.type),e.listExistCardTemplate(),e.listAdminByRole(),"2"===e.form.orderType&&(console.log("查询映射",e.form.orderType),e.getTagMapping(),e.getStoreTags()),e.offsetAmountChange()}),(function(t){e.$message.warning(t.errorMessage)}))},paymentTypeChange:function(e){"会员卡余额"!==e&&(this.form.memberCardId="",this.form.beanDiscount="",this.getOriginalAmount())},memberCardChange:function(){this.getMemberCardInfo(),this.getBeanRate()},getMemberCardInfo:function(){var e=this,t={userCardId:this.form.memberCardId};_["a"].get("/admin/memberCard/memberCard.jhtml",t).then((function(t){e.form.bean=t.content.bean,e.getCouponList()})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getBeanRate:function(){var e=this,t={id:this.form.memberCardId};_["a"].get("/admin/memberCard/memberCard.jhtml",t).then((function(t){e.beanRate=Number(t.rewardSet.cash)/Number(t.rewardSet.vBean)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getCouponList:function(){var e=this;if(0!==this.orderItems.length){this.form.couponList=[];var t=this.orderItems.map((function(e){return{product:{id:e.productId},quantity:e.quantity||""}})),a={shopId:window.top.SHOP_ID||"",cartItems:t,userId:this.form.userId,userCardId:this.form.memberCardId};_["a"].post("/admin/order/couponCodes.jhtml",a).then((function(t){e.form.couponList=t.content,e.maxOffsetBean=t.maxOffsetBean,e.minOffsetBean=t.minOffsetBean})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))}},listAdminByRole:function(){var e=this,t="";t="car"===this.$route.params.orderType?["salesman"]:["afterSale","reception","testDriver"],c["a"].listAdminByRole({roleTypes:t},(function(t){e.loading=!1,e.flag=!1,console.log(e.form.consultant.id),t.dataList.map((function(t){t.id===e.adminCurrent[0].id&&(e.flag=!0)})),e.flag?e.consultants=t.dataList:e.consultants=t.dataList.concat(e.adminCurrent)}),(function(e){console.log(e)}))},loanTerm:function(e){var t=this;c["a"].loanTerms({financialId:e},(function(e){t.loading=!1,t.form.orderItems[0].appointment.financialPlan.downPayments=[e.downPayment,e.downPayment+10,e.downPayment+20,e.downPayment+30],t.form.orderItems[0].appointment.downPayment="",t.form.orderItems[0].appointment.financialPlan.loanTerms=e.loanTerms}),(function(e){t.loading=!1,t.$message.warning(e.errorMessage)}))},orderOptions:function(){var e=this,t=!1;this.form.type="交易完成",c["a"].options({shopId:window.top.SHOP_ID},(function(a){e.loading=!1,e.paymentMethods=a.paymentMethods,e.paymentTypes=a.paymentTypes,e.shippingMethod=a.shippingMethods,e.deliveryCorps=a.deliveryCorps,e.reasons=a.reasons,e.rescueOrganizations=a.rescueOrganizations,e.workers=a.workers,e.adminCurrent=[{id:a.adminCurrent.id,name:a.adminCurrent.realName}],e.form.consultant={id:a.adminCurrent.id},e.listAdminByRole(),!e.itemId&&e.showInfo&&(e.paymentTypes.forEach((function(e){if("会员卡余额"===e.name)return t=!0,!1})),e.form.payments[0].paymentType=t?"会员卡余额":e.paymentTypes[0].name),e.form.userId&&e.listExistCardTemplate()}),(function(t){e.loading=!1,"店铺不存在"!==t.errorMessage&&e.$message.warning(t.errorMessage)}))},submitOrder:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,s,l,c,d,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.analysisAddress(e.currentUser.shop.address);case 2:return a=t.sent,t.next=5,e.analysisAddress(e.form.shippings[0].address);case 5:i=t.sent,r=e.form.orderItems,n=[],s=Object(o["a"])(r);try{for(s.s();!(l=s.n()).done;)for(c=l.value,d=0;d<c.quantity;d++)p={cname:e.currentUser.shop.name,spro:a.province,scity:a.city,num:c.product.vins[d].number,epro:i.province,ecity:i.city,depname:e.form.shippings[0].consignee},n.push(_["a"].post("/admin/order/shipping2XinYue.jhtml",p))}catch(m){s.e(m)}finally{s.f()}Promise.all(n).then((function(t){e.$emit("xrorder")})).catch((function(t){e.$emit("xrorder")}));case 11:case"end":return t.stop()}}),t)})))()},analysisAddress:function(e){return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("开始解析, "+e),t.abrupt("return",new Promise((function(t,a){var i=new window.BMap.Geocoder;i.getPoint(e,(function(e){i.getLocation(e,(function(e){console.log(e),t({province:e.addressComponents.province,city:e.addressComponents.city})}))}))})));case 2:case"end":return t.stop()}}),t)})))()},save:function(){var e=this;if(this.reasons&&this.reasons.length>0&&this.itemId&&this.form.orderItems[0].appointment&&(this.form.orderItems[0].appointment.reasons=this.reasons.map((function(t){return e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.reasons&&-1!==e.form.orderItems[0].appointment.reasons.indexOf(t.id)?{id:t.id,content:t.content}:{id:"",content:""}}))),""===this.form.consultant.id)return this.$message.warning("请输入顾问"),!1;if("ride"===this.$route.params.orderType){if(console.log(this.form.orderItems[0].appointment.plateNumber),""===this.form.orderItems[0].appointment.plateNumber)return this.$message.warning("请输入试驾车号"),!1;if(""===this.form.orderItems[0].appointment.product.fullName)return this.$message.warning("请输入试驾车型"),!1}if(this.itemId)if("shipping"===this.handler){if(this.loading=!0,this.shippingMethod.map((function(t){t.name===e.form.shippingMethodName&&(e.form.shippingMethodId=t.id)})),this.form.deliveryCorpId=this.form.shippings[0].deliveryCorpId,this.showDelivery){if(""===this.form.shippings[0].deliveryCorpId&&"0"===this.form.shippings[0].isLCL)return this.$message.warning("请输入物流公司"),this.loading=!1,!1;if(""===this.form.shippings[0].expressSn&&"0"===this.form.shippings[0].isLCL)return this.$message.warning("请输入物流单号"),this.loading=!1,!1;if(""===this.form.shippings[0].freight||!/^(0|[0-9][0-9]*)(\.\d+)?$/.test(this.form.shippings[0].freight))return this.$message.warning("请输入正确的物流费用"),this.loading=!1,!1;this.showReceiver?this.$set(this.form,"shippingData",{isLCL:this.form.shippings[0].isLCL,phone:this.form.shippings[0].phone||this.form.phone,address:this.form.shippings[0].address||this.form.areaName,consignee:this.form.shippings[0].consignee||this.form.consignee,expressSn:this.form.shippings[0].expressSn,freight:this.form.shippings[0].freight}):this.$set(this.form,"shippingData",{expressSn:this.form.shippings[0].expressSn,freight:this.form.shippings[0].freight})}else this.showReceiver&&!this.showDelivery&&(this.$set(this.form,"shippingData",{phone:this.form.shippings[0].phone||this.form.phone,address:this.form.shippings[0].address||this.form.areaName,consignee:this.form.shippings[0].consignee||this.form.consignee}),this.$set(this.form,"deliveryCorpId",this.form.shippings[0].deliveryCorpId));this.loading=!0,c["a"].shippingOrder(this.form,(function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("operationSuccess"),console.log("shipping-success"),e.isShipped=!0}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))}else if("service"===this.handler)this.loading=!0,c["a"].excuteOrder(this.form,(function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("operationSuccess")}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}));else if("payment"===this.handler){if(this.loading=!0,this.paymentTypes.map((function(t){t.name===e.form.payments[0].paymentType&&(e.form.paymentTypeId=t.id)})),this.form.payment={payBank:this.form.payments[0].payBank,payAccount:this.form.payments[0].payAccount,amount:this.form.amount},!this.form.payments[0].paymentType||("刷卡"===this.form.payments[0].paymentType||"汇款"===this.form.payments[0].paymentType)&&(""===this.form.payments[0].payBank||""===this.form.payments[0].payAccount))return this.$message.warning("请输入付款信息"),this.loading=!1,!1;this.$refs.form.validate((function(t,a){t?c["a"].paymentOrder(e.form,(function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("operationSuccess")}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)})):e.loading=!1}))}else this.loading=!0,c["a"].updateOrder(this.form,(function(t){e.loading=!1,e.$message.success("保存成功"),e.$emit("operationSuccess"),"2"===e.form.orderType&&e.tagMapping()}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}));else{if(!this.form.payments[0].paymentType)return this.$message.warning("请输入付款信息"),this.loading=!1,!1;this.createOrder()}var t=this.deliveryCorps.find((function(t){return t.id===e.form.shippings[0].deliveryCorpId})).name;"shipping"===this.handler&&"新悦物流"===t&&this.submitOrder()},setOrderItems:function(e){this.orderItems=e,this.orderItems.forEach((function(e){e.productId=e.productId?e.productId:e.id}));var t=0;e.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.originalAmount=t,this.form.originalAmount=t,this.offsetAmountChange(),this.form.member.nickname&&this.getCouponList()},createOrder:function(){var e=this;if(this.shippingMethod.map((function(t){t.name===e.form.shippingMethodName&&(e.form.shippingMethodId=t.id)})),this.paymentTypes.map((function(t){t.name===e.form.payments[0].paymentType&&(e.form.paymentTypeId=t.id)})),this.form.appointmentData=this.form.orderItems[0].appointment,"rescue"===this.$route.params.orderType&&(this.form.appointmentData.reasons=this.reasons.map((function(t){return-1!==e.form.appointmentData.reasons.indexOf(t.id)?{id:t.id,content:t.content}:{id:"",content:""}}))),this.showInfo&&!this.form.payments[0].paymentType||this.showInfo&&("刷卡"===this.form.payments[0].paymentType||"汇款"===this.form.payments[0].paymentType)&&(""===this.form.payments[0].payBank||""===this.form.payments[0].payAccount))return this.$message.warning("请输入付款信息"),this.loading=!1,!1;this.loading=!0,this.$refs.form.validate((function(t,a){t&&c["a"].createOrder({appointmentData:e.form.orderItems[0].appointment,appointmentDate:e.form.appointmentDate,appointmentEndDate:e.form.appointmentEndDate,sn:e.form.sn,type:e.form.type,orderType:e.$route.params.orderType,orderStatus:"交易完成"===e.form.type?"2":e.form.type,bean:e.form.beanDiscount,couponCode:e.getCouponCode,amount:e.form.amount,amountPrepay:e.form.amountPrepay,paymentTypeId:e.form.paymentTypeId,shippingMethod:{id:e.form.shippingMethodId},amountFinalpay:e.form.amountFinalpay,originalAmount:e.form.originalAmount,offsetAmount:e.form.offsetAmount,freight:e.form.shippings&&e.form.shippings.length?e.form.shippings[0].freight:"",memberCardId:e.form.memberCardId,amountPaid:e.form.curAmount,userId:e.form.userId,consultant:{id:e.form.consultant.id},car:{id:e.form.car.id},area:{id:e.areaId},address:e.form.address,areaName:e.form.areaName,consignee:e.form.consignee,phone:e.form.phone,zipCode:e.form.zipCode,remarks:e.form.remarks,memo:e.form.memo,promotionDiscount:e.form.promotionDiscount,couponDiscount:e.form.couponDiscount,beanDiscount:e.form.beanDiscount,point:e.form.point,giftBean:e.form.giftBean,shippingMethodName:e.form.shippingMethodName,paymentMethodId:e.form.paymentMethodId,invoiceState:e.form.invoiceState,orderTime:e.form.orderTime,deliveryTime:e.form.deliveryTime,paymentTime:e.form.paymentTime,completeTime:e.form.completeTime,orderItems:e.orderItems,payments:[{paymentType:e.form.payments[0].paymentType,payBank:e.form.payments[0].payBank,payAccount:e.form.payments[0].payAccount}],member:{nickname:e.form.member.nickname,gender:e.form.member.gender,mobile:e.form.member.mobile},shippings:[{isLCL:e.form.shippings[0].isLCL,shippingMethod:e.form.shippings[0].shippingMethod,deliveryCorpId:e.form.shippings[0].deliveryCorpId,expressSn:e.form.shippings[0].expressSn,freight:e.form.shippings[0].freight,address:e.form.shippings[0].address,consignee:e.form.shippings[0].consignee,phone:e.form.shippings[0].phone,zipCode:e.form.shippings[0].zipCode}]},(function(t){e.loading=!1,e.$message.success("保存成功"),e.form=e.getDefaultForm(),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.driveStartDate&&(e.form.orderItems[0].appointment.driveStartDate=e.form.orderItems[0].appointment.driveStartDate.split(" ")[1]),e.form.orderItems[0].appointment&&e.form.orderItems[0].appointment.driveEndDate&&(e.form.orderItems[0].appointment.driveEndDate=e.form.orderItems[0].appointment.driveEndDate.split(" ")[1]),e.$emit("operationSuccess"),e.isCreated=!0,e.itemId=t.id,e.tagMapping()}),(function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))}))},productChange:function(){var e=this;this.modeList.map((function(t){t.id===e.form.orderItems[0].appointment.product.id&&(e.form.orderItems[0].appointment.product.price=t.price)}))},listExistCardTemplate:function(){var e=this;c["a"].listExistCardTemplate({userId:this.form.userId},(function(t){e.loading=!1,e.listExistCard=t.content,e.listExistCard.forEach((function(e){e.template.name+=" ¥"+e.balance}))}),(function(e){console.log(e)}))},getFinancialPlans:function(){var e=this;c["a"].getFinancialPlans({shopId:window.top.SHOP_ID||""},(function(t){e.loading=!1,e.financialPlans=t.financials}),(function(e){console.log(e)}))},getSaveParams:function(){return{orderId:this.itemId}},areaChanged:function(e){this.areaId=e,this.isFirst&&(this.areaId="1568",this.isFirst=!1)},handleBrandChange:function(e){this.querySeriesList(e),this.$set(this.form.orderItems[0].appointment.product,"seriesId",""),this.$set(this.form.orderItems[0].appointment.product,"id","")},handleSeriesChange:function(e){this.queryTypeList(e),this.$set(this.form.orderItems[0].appointment.product,"id","")},queryMemberList:function(e){var t=this;c["a"].memberList(e,(function(e){t.dialogLoading=!1,t.dialogTableData=e.content,t.dialogPagination.total=Number(e.total)}),(function(e){console.log(e),console.log("code错误")}))},opened:function(){this.dialogPagination.currentPage=1,this.dialogPagination.pageSize=20,this.dialogFilters=[{type:"input",label:"",placeholder:"请输入名称或手机号",name:"searchValue",value:""}],this.queryMemberList(this.getDialogQueryParams())},getDialogQueryParams:function(){return{pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[0].value}},productPageSizeChange:function(e){this.$set(this.productPagination,"pageSize",e)},productCurrentPageChange:function(e){this.$set(this.productPagination,"currentPage",e)},dialogFilterDataChange:function(e){this.dialogPagination.currentPage=1,this.queryMemberList(this.getDialogQueryParams())},dialogPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.queryMemberList(this.getDialogQueryParams())},dialogCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.queryMemberList(this.getDialogQueryParams())},handleSuccess:function(e,t,a){this.form.orderItems[0].appointment.images.push({path:e.fis[0].url})},handleRemove:function(e,t){var a=this.form.orderItems[0].appointment.images.findIndex((function(t){return t.path===e.path}));-1!==a&&this.form.orderItems[0].appointment.images.splice(a,1)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.picDialogVisible=!0},dialogOperate:function(e){},queryBrandList:function(){var e=this;c["a"].brands({},(function(t){e.brandList=t.dataList}),(function(e){console.log(e),console.log("code错误")}))},querySeriesList:function(e){var t=this;c["a"].series({brandId:e},(function(e){t.seriesList=e.dataList}),(function(e){console.log(e),console.log("code错误")}))},getBrandList:function(){var e=this;S["a"].queryBrandList({},(function(t){e.brandData=t.dataList}),(function(e){console.log(e),console.log("code错误")}))},getSeriesList:function(e){var t=this;S["a"].querySeriesList({brand:e},(function(e){t.seriesData=e.dataList}),(function(e){console.log(e),console.log("code错误")}))},getModeList:function(e){var t=this;S["a"].queryTypeList({series:e,brand:this.formModel.defaultCarInfo.brand},(function(e){t.modeData=e.dataList}),(function(e){console.log(e),console.log("code错误")}))},queryTypeList:function(e){var t=this;c["a"].types({seriesId:e,brandId:this.form.brand},(function(e){t.modeList=e.dataList}),(function(e){console.log(e),console.log("code错误")}))},beforeAvatarUpload:function(e){var t=/^image\/(.*)$/.test(e.type);if(!t)return this.$message.error("请选择符合图片格式的文件上传!"),!1;var a=e.size/1024<=200;return!!a||(this.$message.error("上传图片大小不能超过 200K!"),!1)},addMember:function(){this.formModel={userName:"",mobile:"",name:"",password:"123456",nickname:"",gender:"2",defaultCarInfo:{plateNumber:"",vin:"",brand:"",series:"",type:""}},this.dialogVisible=!0},getOrderStatus:function(e){switch(e){case"11":return"卖家已发货";case"10":return"退款退货完成";case"9":return"退款退货中";case"8":return"已过期";case"7":return"已评价";case"6":return"订单关闭";case"5":return"交易完成";case"4":return"订单已执行";case"3":return"买家已付款";case"2":return"商家已确认";case"1":return"待商家确认";default:return"无"}},testDrives:function(){var e=this,t={pageSize:1e3,pageNumber:1,shopId:window.top.SHOP_ID||""};_["a"].get("/admin/testDriveMgmt/testDrives.jhtml",t).then((function(t){e.restaurants=t.dataList.map((function(e){return{value:e.car.plateNumber,id:e.car.id,type:e.car.type}}))})).catch((function(e){console.log(e.errorMessage)}))},querySearchAsync:function(e,t){var a=this.restaurants,i=e?a.filter(this.createStateFilter(e)):a;t(i)},createStateFilter:function(e){return function(e){return!0}},handleSelect:function(e){this.form.orderItems[0].appointment.product.fullName=e.type}})},M=k,x=(a("0f32"),Object(v["a"])(M,i,r,!1,null,null,null));t["a"]=x.exports},b15b:function(e,t,a){"use strict";var i=a("bbfa"),r=a.n(i);r.a},b547:function(e,t,a){},bbfa:function(e,t,a){},c466:function(e,t,a){"use strict";a("99af"),a("d3b7"),a("ac1f"),a("25f0"),a("5319");t["a"]={nowDate:function(){var e=new Date,t=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()+1<10?"0"+e.getDate():e.getDate();return e.getFullYear().toString()+"-"+t+"-"+a},getMonthDays:function(e){var t=new Date(Date.parse(e.replace(/-/g,"/"))),a=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,1),r=(i-a)/864e5;return r},halfYearAgo:function(e){var t="";return t=e?new Date(Date.parse(e.replace(/-/g,"/"))):new Date,console.log(t),t.setMonth(t.getMonth()-6),"".concat(t.getFullYear(),"-").concat(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,"-").concat(t.getDate()<10?"0"+t.getDate():t.getDate())},lastMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1<10?"0"+e.getMonth():e.getMonth(),i=e.getDate()+1<10?"0"+e.getDate():e.getDate();return"00"===a&&(a="12",t--),t.toString()+"-"+a+"-"+i},nextMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),r=parseInt(a)+1;13===r&&(t=parseInt(t)+1,r=1);var o=new Date(t,r,0);return o=o.getDate(),i>o&&(i=o),r<10&&(r="0"+r),t+"-"+r+"-"+i},lastYearDate:function(){var e=new Date,t=new Date(e.getFullYear()-1,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastTwoYearDate:function(){var e=new Date,t=new Date(e.getFullYear()+2,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastNYearDate:function(e,t){var a=new Date(e),i=new Date(a.getFullYear()+parseInt(t),a.getMonth(),a.getDate());return i.getFullYear()+"-"+this.convertToFullMode(i.getMonth()+1)+"-"+this.convertToFullMode(i.getDate())},dateConverter:function(e){return e instanceof Date?e.getFullYear()+"-"+this.convertToFullMode(e.getMonth()+1)+"-"+this.convertToFullMode(e.getDate()):e},timeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes())+":"+this.convertToFullMode(e.getSeconds()):e},shortTimeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes()):e},dateTimeConverter:function(e){return e instanceof Date?this.dateConverter(e)+" "+this.timeConverter(e):e},convertToFullMode:function(e){return e=e.toString(),1===e.length?"0"+e:e}}},d47e:function(e,t,a){},d74a:function(e,t,a){"use strict";var i=a("21c5"),r=a.n(i);r.a},ec6b:function(e,t,a){"use strict";var i=a("b547"),r=a.n(i);r.a},f3ac:function(e,t,a){e.exports=a.p+"static/img/pic_default_none_100.6603f4ac.png"},f9a5:function(e,t,a){},fc46:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"my-evaluate"},[a("div",{staticClass:"evaluate-content"},[e.orderInfo&&e.reviews.length?a("div",e._l(e.orderInfo.orderItems,(function(t,i){return a("div",{key:i,staticClass:"my-evaluate-div"},[a("div",{staticClass:"order-info"},[a("div",{staticClass:"info"},[a("img",{attrs:{src:t.thumbnail?t.thumbnail:e.defaultImg},on:{error:e.errorHandle}}),a("div",{staticClass:"info-right"},[a("span",[e._v(e._s(t.name))]),a("span",[e._v("￥"+e._s(e.getAmount(t)))])])])]),e.editable&&t.product?a("div",{staticClass:"evaluate"},[a("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[a("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px",padding:"0px 30px"}}),a("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),a("el-radio-group",{staticStyle:{height:"10px"},attrs:{horizontal:!0},model:{value:e.reviews[i].score,callback:function(t){e.$set(e.reviews[i],"score",t)},expression:"reviews[index].score"}},e._l(e.options,(function(e,t){return a("el-radio",{key:t,attrs:{label:e}})})),1)],1),a("el-input",{attrs:{type:"textarea",size:"mini",placeholder:"来分享您的使用感受吧...",maxlength:e.maxlength},model:{value:e.reviews[i].content,callback:function(t){e.$set(e.reviews[i],"content",t)},expression:"reviews[index].content"}}),a("img-uploader",{model:{value:e.reviews[i].images,callback:function(t){e.$set(e.reviews[i],"images",t)},expression:"reviews[index].images"}})],1):e._e(),!e.editable&&t.product?a("div",{staticClass:"evaluate-dis"},[a("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[a("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px"}}),a("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),a("span",[e._v(e._s(e.reviews[i].score?e.已reviews[i].score:""))])]),a("div",{staticClass:"eva-content"},[a("p",{staticStyle:{"margin-bottom":"10px","margin-left":"20px"}},[e._v(e._s(e.reviews[i].content?e.reviews[i].content:"很遗憾，您没有留下任何评价。"))]),a("div",{staticClass:"img-group",staticStyle:{"margin-left":"20px"}},e._l(e.reviews[i].images,(function(t,r){return a("div",{key:r,staticClass:"img-eva"},[t?a("img",{attrs:{src:t},on:{click:function(t){return e.handleImagePreview(e.reviews[i].images,r)}}}):e._e()])})),0)])]):e._e()])})),0):e._e(),a("div",{staticClass:"shop-evaluate"},[a("div",{staticClass:"shop-title"},[a("img",{attrs:{src:e.iconShop}}),a("span",{staticStyle:{fontSize:"14px"}},[e._v("店铺评分")])]),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("服务态度")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.serValue,callback:function(t){e.serValue=t},expression:"serValue"}})],1),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("服务速度")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.speedValue,callback:function(t){e.speedValue=t},expression:"speedValue"}})],1),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("专业技能")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.proValue,callback:function(t){e.proValue=t},expression:"proValue"}})],1)])]),e.editable?a("div",{staticClass:"submit"},[a("span",{staticClass:"btn-submit",on:{click:e.submitEvaluate}},[e._v("提交评价")])]):e._e()])},r=[],o=(a("4160"),a("d81d"),a("a434"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("159b"),a("b85c")),n=a("5530"),s=a("2f62"),l=a("1ab1"),c=a("c596"),d=a("624d"),p=a.n(d),m=a("517a"),u=a.n(m),f=a("2119"),g=a("f606"),h=a.n(g),b={name:"my-evaluate",data:function(){return{iconShop:h.a,defaultImg:p.a,defaultFailImg:u.a,selected:"好评",options:["好评","中评","差评"],evaluateValue:"",maxlength:100,serValue:5,speedValue:5,proValue:5,reviews:[],info:null,initialIndex:0}},props:{orderId:{type:String,default:""},editable:{type:Boolean,default:function(){return!0}}},components:{ImgUploader:f["a"]},computed:Object(n["a"])(Object(n["a"])({},Object(s["c"])("Order",["orderInfo"])),Object(s["c"])(["getUser"])),watch:{orderId:function(e,t){this.getParams(),this.getOrderInfo()}},methods:Object(n["a"])(Object(n["a"])({},Object(s["d"])("Order",["updateOrderInfo"])),{},{showToast:function(e){this.$createToast({time:1e3,txt:e,type:"warn"}).show()},images:function(e){var t,a=[],i=Object(o["a"])(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;a.push(r)}}catch(n){i.e(n)}finally{i.f()}return a},handleImagePreview:function(e,t){var a=this;this.initialIndex=t;var i=[];e.map((function(e){i.push(e)}));var r={$props:{imgs:i,initialIndex:"initialIndex",loop:!1},$events:{change:function(e){a.initialIndex=e}}};this.$createImagePreview(Object(n["a"])({},r)).show()},getAmount:function(e){var t=Number(e.price)*Number(e.quantity);return t.toFixed(2)},submitEvaluate:function(){for(var e=this,t={serviceAttitude:this.serValue.toString(),serviceSpeed:this.speedValue.toString(),professional:this.proValue.toString(),methodName:"CreateProductReview",clientType:"2",shopId:this.getUser.shop.id,orderId:this.orderInfo.id,userId:this.getUser.id},a=this.orderInfo.orderItems,i=a.length,r=this.reviews,o=!1,n=0;n<i;n++){if(r[n]&&("好评"===r[n].score?(r[n].score="5",o=!0):"中评"===r[n].score?(r[n].score="3",o=!0):"差评"===r[n].score&&(r[n].score="1",o=!0)),!o&&a[n].product)return void this.$message.warning("请选择商品评分");a[n].product&&(r[n].images=this.images(r[n].images))}a.forEach((function(e,t){if(!e.product)return r.splice(t,1),!1})),o&&(t.reviews=this.reviews),l["a"].post(c["g"].hypermarketMgmt.review,t).then((function(t){e.$message.success("评价成功"),e.$emit("operationSuccess")})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){}))},errorHandle:function(e){e.currentTarget.src=this.defaultFailImg},getOrderInfo:function(e){var t=this;this.open=!1;var a="";a=e||this.orderId;var i={clientType:this.clientType,methodName:"QueryOrderDetail",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:a};l["a"].get(c["g"].hypermarketMgmt.queryOrder,i).then((function(e){console.log("订单信息",e);var i,r,o=e.order.orderItems,n=o.length;for(t.reviews=[],r=0;r<n;r++)i={score:"",content:"",reviewOrderId:e.order.id,images:[]},o[r].product&&(i.productId=o[r].product.id),t.reviews.push(i);t.editable?t.updateOrderInfo(e.order):(t.info=e.order,t.getEvaluationInfo(a))})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))},getParams:function(){this.editable=!0},getEvaluationInfo:function(e){var t=this,a={clientType:this.clientType,methodName:"QueryOrderReview",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:e};l["a"].get(c["g"].hypermarketMgmt.reviews,a).then((function(e){if(console.log(e),t.serValue=parseInt(e.serviceAttitude),t.speedValue=parseInt(e.serviceSpeed),t.proValue=parseInt(e.professional),e.reviews.length!==t.reviews.length){var a={score:"",content:"",images:[]};e.reviews.unshift(a)}t.reviews=e.reviews;for(var i=t.reviews,r=i.length,o=0;o<r;o++)"5"===i[o].score?i[o].score="好评":"3"===i[o].score?i[o].score="中评":"1"===i[o].score&&(i[o].score="差评");t.updateOrderInfo(t.info)})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))}}),created:function(){}},v=b,y=(a("9b2e"),a("2877")),C=Object(y["a"])(v,i,r,!1,null,null,null);t["a"]=C.exports}}]);