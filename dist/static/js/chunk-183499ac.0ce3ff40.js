(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-183499ac"],{"0943":function(t,e,a){"use strict";var i=a("1fac"),n=a.n(i);n.a},1148:function(t,e,a){"use strict";var i=a("a691"),n=a("1d80");t.exports="".repeat||function(t){var e=String(n(this)),a="",r=i(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(a+=e);return a}},"1fac":function(t,e,a){},"225d":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.tableShow,expression:"tableShow"}],ref:"template"},[t._t("default",[a("span",[t._v("编写你自己的打印区域组件，然后slot插入到vue-easy-print")])],{getChineseNumber:t.getChineseNumber})],2),t.buttonShow?a("button",{class:t.buttonClass,attrs:{type:"button"},on:{click:t.print}},[a("span",[t._v("开始打印")])]):t._e()])},n=[],r=(a("a9e3"),a("d3b7"),a("ac1f"),a("25f0"),a("466d"),a("5319"),a("1276"),{name:"vue-easy-print",components:{},props:{spaceRow:{type:Boolean,default:!1},tableData:{type:Object,default:function(){}},tableShow:{type:Boolean,default:!1},buttonShow:{type:Boolean,default:!1},buttonClass:{type:String,default:"el-button el-button--default"},onePageRow:{type:Number,default:5},beforeCopy:Function,beforePrint:Function},data:function(){return{}},mounted:function(){this.init()},methods:{init:function(){var t=this,e=document.getElementById("easyPrintIframe");e?this.getStyle():(e=document.createElement("iframe"),e.id="easyPrintIframe",e.style.position="fixed",e.style.width="0",e.style.height="0",e.style.top="-100px",window.location.hostname!==document.domain&&navigator.userAgent.match(/msie/i)&&(e.src='javascript:document.write("<head><script>document.domain=\\"'+document.domain+'\\";<\/script></head><body></body>")'),e.onload=function(){t.getStyle()},document.body.appendChild(e))},print:function(){"function"===typeof this.beforeCopy&&this.beforeCopy();var t=document.getElementById("easyPrintIframe");t.contentDocument.body.innerHTML=this.$refs.template.innerHTML,"function"===typeof this.beforePrint&&this.beforePrint(),setTimeout((function(){t.contentWindow.print()}),100)},getStyle:function(){for(var t=document.getElementById("easyPrintIframe"),e="",a=document.querySelectorAll("style"),i=0;i<a.length;i++)e+=a[i].outerHTML;t.contentDocument.head.innerHTML=e;for(var n=document.querySelectorAll("link"),r=0;r<n.length;r++){var o=document.createElement("link");o.setAttribute("rel","stylesheet"),n[r].type?o.setAttribute("type",n[r].type):o.setAttribute("type","text/css"),o.setAttribute("href",n[r].href),o.setAttribute("media","all"),t.contentDocument.head.appendChild(o)}},getChineseNumber:function(t){var e,a,i,n,r,o,s,l,c,u,d,p,f,g,h=99999999999.99,m="零",b="壹",v="贰",y="叁",w="肆",S="伍",I="陆",C="柒",_="捌",D="玖",P="拾",N="佰",x="仟",F="万",R="亿",k="",$="元",z="角",E="分",L="整";if(void 0===t)return"";if(t=t.toString(),""==t)return"";if(null!=t.match(/[^,.\d]/))return"";if(null==t.match(/^((\d{1,3}(,\d{3})*(.((\d{3},)*\d{1,3}))?)|(\d+(.\d+)?))$/))return"";if(t=t.replace(/,/g,""),t=t.replace(/^0+/,""),Number(t)>h)return alert("您输入的金额太大，请重新输入!"),"";if(n=t.split("."),n.length>1?(e=n[0],a=n[1],a=a.substr(0,2)):(e=n[0],a=""),r=new Array(m,b,v,y,w,S,I,C,_,D),o=new Array("",P,N,x),s=new Array("",F,R),l=new Array(z,E),i="",Number(e)>0){for(c=0,u=0;u<e.length;u++)d=e.length-u-1,p=e.substr(u,1),f=d/4,g=d%4,"0"==p?c++:(c>0&&(i+=r[0]),c=0,i+=r[Number(p)]+o[g]),0==g&&c<4&&(i+=s[f]);i+=$}if(""!=a)for(u=0;u<a.length;u++)p=a.substr(u,1),"0"!=p&&(i+=r[Number(p)]+l[u]);return""==i&&(i=m+$),""==a&&(i+=L),i=k+i,i}}}),o=r,s=a("2877"),l=Object(s["a"])(o,i,n,!1,null,null,null),c=l.exports;e["a"]=c},"2ace":function(t,e,a){},"2bba":function(t,e,a){},"408a":function(t,e,a){var i=a("c6b6");t.exports=function(t){if("number"!=typeof t&&"Number"!=i(t))throw TypeError("Incorrect invocation");return+t}},"40ab":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-grid",{staticClass:"product-info"},[t.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operate},slot:"top"}):t._e(),a("el-form",{attrs:{inline:!0,disabled:!t.isEdit}},[a("el-form-item",{staticClass:"subTotal",attrs:{label:"合计:",prop:"totalFee"}},[t._v("￥"+t._s(t.totalFee?t.totalFee:"0"))])],1),a("biz-list",{key:Math.random(),ref:"table",attrs:{tableData:t.tableData,height:"100%",loading:t.loading}},[a("el-table-column",{attrs:{prop:"productName",label:"商品名称","min-width":"100"}}),a("el-table-column",{attrs:{prop:"price",label:"采购单价(元)","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input",{attrs:{size:"small",disabled:!t.isEdit},on:{change:function(a){return t.priceChange(e.row.price)}},model:{value:e.row.price,callback:function(a){t.$set(e.row,"price",a)},expression:"scope.row.price"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"amount",label:"退货数量","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{staticStyle:{width:"90px"},attrs:{size:"mini",min:1,disabled:!t.isEdit},on:{change:function(a){return t.amountChange(e.row.amount)}},model:{value:e.row.amount,callback:function(a){t.$set(e.row,"amount",a)},expression:"scope.row.amount"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"totalFee",label:"金额(元)","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("div",{staticClass:"biz-customcol"},[t._v(t._s(e.row.amount?(Number(e.row.amount)*Number(e.row.price)).toFixed(2):""))])])}}])}),a("el-table-column",{attrs:{prop:"depotId",label:"仓库","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{placeholder:"请选择类型",size:"mini",disabled:!t.isEdit},model:{value:e.row.depotId,callback:function(a){t.$set(e.row,"depotId",a)},expression:"scope.row.depotId"}},t._l(t.storeList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)]}}])}),t.isEdit?a("el-table-column",{attrs:{prop:"date",label:"操作",type:"index","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return t.deleteHandeler(e)}}},[t._v("删除")])],1)])}}],null,!1,2138999389)}):t._e()],1),a("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:t.showDialog,tableData:t.giftList,pagination:t.dialogPagination,filters:t.dialogFilters,selectionKeys:t.selectedGiftIds},on:{"update:visibility":function(e){t.showDialog=e},pageSizeChange:t.dialogPageSizeChange,currentPageChange:t.dialogCurrentPageChange,confirmed:t.confirmedProduct,filterDataChange:t.dialogFilterDataChange,selectionChange:t.selectionChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"400px"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("div",{staticClass:"biz-two-column"},[a("img",{attrs:{src:e.row.image||t.DefaultImg,onerror:t.errorImg}}),a("div",{staticClass:"biz-two-row"},[a("div",{staticStyle:{"margin-left":"10px","font-size":"14px"}},[t._v(t._s(e.row.name))]),a("div",{staticStyle:{"margin-left":"10px"}},[t._v("编号："+t._s(e.row.sn))]),a("div",{staticStyle:{"margin-left":"10px"}},[t._v("规格："+t._s(e.row.fullName&&-1!==e.row.fullName.indexOf("[")?e.row.fullName.split("[")[1].split("]")[0]:""))])])])])}}])}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{label:"库存"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticStyle:{width:"120px"}},[t._v(t._s(e.row.realStock))])]}}])})],1)],1)},n=[],r=(a("99af"),a("4160"),a("c975"),a("d81d"),a("a434"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("159b"),a("b85c")),o=a("5530"),s=a("7558"),l=a("8330"),c=a("f36f"),u=a("2f62"),d=a("c596"),p=a("1ab1"),f=a("af3f"),g=a("f3ac"),h=a.n(g),m={name:"ProductInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},returnId:{type:String}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},selectedGiftList:[],selectedGiftIds:[],showDialog:!1,DefaultImg:h.a,dialogFilters:[{type:"input",placeholder:"请输入编号或商品名",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,totalFee:"",height:"585",tableData:[],restaurants:[],selections:[],itemDatas:[],dialogTableVisible:!1,storeList:[],selectionList:[],title:"",operations:[{label:"新增商品",name:"addProduct",type:"primary"},{label:"保存",name:"save",type:"primary"}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:s["a"],BizGrid:c["a"],BizSaveButton:l["a"],BizDialogSelector:f["a"]},watch:{itemId:function(t){this.tableData=[],this.totalFee="",this.storeList=[],this.itemId&&this.getList(),this.queryStoreHouseList()},returnId:function(t){this.tableData=[],this.totalFee="",this.storeList=[],this.returnId&&this.getList(),this.queryStoreHouseList()}},mounted:function(){var t=document.documentElement.clientHeight||window.innerHeight;this.height=String(t-175)},methods:Object(o["a"])(Object(o["a"])({},Object(u["c"])(["getUser"])),{},{addProduct:function(){this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(t){this.dialogPagination.pageSize=t,this.getGiftList()},dialogCurrentPageChange:function(t){this.dialogPagination.currentPage=t,this.getGiftList()},dialogFilterDataChange:function(t){this.dialogFilters=t,this.dialogPagination.currentPage=1,this.getGiftList()},getGiftList:function(){var t=this,e={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[0].value,shopId:window.top.SHOP_ID||""};p["a"].get(d["g"].commodity.getCommodityList,e).then((function(e){t.giftList=e.content,t.dialogPagination.total=Number(e.total)})).catch((function(t){t.errorMessage&&console.log(t.errorMessage)}))},selectionChange:function(t){var e=this;t.forEach((function(t){-1===e.selectionList.indexOf(t)&&e.selectionList.push(t)}))},confirmedProduct:function(t){var e=this;this.selectedGiftIds=t.concat(),this.selectedGiftList=[],this.selectionList.map((function(t){-1!==e.selectedGiftIds.indexOf(t.id)&&(t.amount="1",t.productName=t.fullName,e.selectedGiftList.push(t))}));this.selectedGiftList.map((function(t){Number(t.amount)*Number(t.price)})),this.selectedGiftList.forEach((function(t){e.handleSelect(t)})),this.storeList=[],this.queryStoreHouseList()},operate:function(t){this[t]()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},getList:function(){var t=this;this.loading=!0;var e={id:this.itemId||this.returnId,shopId:window.top.SHOP_ID||""};p["a"].get(d["g"].invoicing.purchaseReturnApplyMgmt.shopPurchaseReturnApplyItems,e).then((function(e){t.tableData=e.itemList,t.totalFee=e.data.totalFee})).catch((function(t){t.errorMessage&&console.log(t.errorMessage)}))},queryStoreHouseList:function(){var t=this;this.loading=!0;var e={shopId:window.top.SHOP_ID||""};p["a"].get(d["g"].invoicing.storeHouseMgmt.shopDepotList,e).then((function(e){var a,i=Object(r["a"])(e.dataList);try{for(i.s();!(a=i.n()).done;){var n=a.value;"1"===n.enabled&&t.storeList.push(n)}}catch(o){i.e(o)}finally{i.f()}})).catch((function(e){console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))},handleSelect:function(t){var e=!1;if(t.productId=t.id,t.id="",this.totalFee=(Number(this.totalFee)+Number(t.amount)*Number(t.price)).toFixed(2),0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].productId===t.productId){this.tableData[a].amount=(Number(this.tableData[a].amount)+1).toString(),e=!0;break}e||this.tableData.push(t)}else this.tableData.push(t)},deleteHandeler:function(t){var e=this;""===t.row.id?this.tableData.splice(t.$index,1):this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,p["a"].delete(d["g"].invoicing.purchaseReturnApplyMgmt.shopPurchaseReturnApplyItem,{ids:[t.row.id]}).then((function(t){e.$message.success("删除成功"),e.getList()})).catch((function(t){t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))})),this.totalFee=(Number(this.totalFee)-Number(t.row.price)*Number(t.row.amount)).toFixed(2)},save:function(){var t=this;this.itemDatas=this.tableData.map((function(e){return{id:e.id||"",billId:t.itemId||t.returnId,productId:e.productId?e.productId:e.id,amount:e.amount||"",price:e.price||"",depotId:e.depotId||"",productName:e.fullName,specId:e.specId||"",specValue:e.specValue||"",totalFee:e.amount*e.price||"",categoryId:e.categoryId,categoryName:e.categoryName}}));var e=!1;if(this.tableData.forEach((function(a){-1!==String(a.amount).indexOf(".")&&(t.$message.warning("数量不能为小数"),e=!0),""!==a.price&&""!==a.depotId&&void 0!==a.depotId||(t.$message.warning("商品信息不完整!"),e=!0)})),e)return!1;var a={itemDatas:this.itemDatas};p["a"].post(d["g"].invoicing.purchaseReturnApplyMgmt.shopPurchaseReturnApplyItem,a).then((function(e){t.$message.success("保存成功"),t.$emit("setOrderItems",t.itemDatas),t.$emit("operationSuccess"),t.getList(),t.loading=!1})).catch((function(e){t.loading=!1,t.getList(),t.$message.warning(e.errorMessage)}))},amountChange:function(t){var e=0;this.tableData.map((function(t){e+=Number(t.amount)*Number(t.price)})),this.totalFee=e?e.toFixed(2):""},priceChange:function(t){var e=0;this.tableData.map((function(t){e+=Number(t.amount)*Number(t.price)})),this.totalFee=e?e.toFixed(2):""},handleSizeChange:function(t){this.pagination.pageSize=t,this.refresh()},handleCurrentChange:function(t){this.pagination.currentPage=t,this.refresh()}})},b=m,v=(a("78c2"),a("2877")),y=Object(v["a"])(b,i,n,!1,null,null,null);e["a"]=y.exports},"4e34":function(t,e,a){"use strict";var i=a("2ace"),n=a.n(i);n.a},"54c1":function(t,e,a){},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,a){var i=a("1d80"),n=a("5899"),r="["+n+"]",o=RegExp("^"+r+r+"*"),s=RegExp(r+r+"*$"),l=function(t){return function(e){var a=String(i(e));return 1&t&&(a=a.replace(o,"")),2&t&&(a=a.replace(s,"")),a}};t.exports={start:l(1),end:l(2),trim:l(3)}},"5b8e":function(t,e,a){"use strict";var i=a("9678"),n=a.n(i);n.a},"5ea3":function(t,e,a){"use strict";var i=a("54c1"),n=a.n(i);n.a},"697f":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:t.title,visible:t.dialogVisible,"append-to-body":t.appendToBody},on:{"update:visible":function(e){t.dialogVisible=e},close:t.close,open:t.open}},[t._t("top"),a("biz-flex-table",{ref:"table",attrs:{showTable:t.showTable,operations:t.operations,filters:t.filters,tags:t.tags,rowKeys:t.rowKeys,pagination:t.pagination,tableData:t.tableData,rowClassName:t.rowClassName,loading:t.loading,memberIds:t.memberIds,checkable:t.checkable,isDepotOutNew:t.isDepotOutNew,checkedTable:t.checkedTable},on:{operate:t.operate,"row-click":t.rowClick,"filter-data-change":t.filterDataChange,"select-all":t.handleSelectAll,select:t.handleSelectionChange,"size-change":t.pageSizeChange,"current-change":t.currentPageChange,"cascader-change":t.cascaderChange,"active-item-change":t.activeItemChange,"sort-change":t.handleSortChange}},[t._t("default")],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.isClear?a("el-button",{attrs:{size:"small"},on:{click:t.clear}},[t._v("清除")]):t._e(),a("el-button",{attrs:{size:"small"},on:{click:t.close}},[t._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.confirmed}},[t._v("确定")])],1)],2)},n=[],r=(a("99af"),a("4160"),a("c975"),a("a434"),a("a9e3"),a("159b"),a("04d3")),o={name:"BizDialogSelector",components:{BizFlexTable:r["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},max:{type:Number,default:0},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},isClear:{default:!0,type:Boolean},rowClassName:{type:Function,default:function(){return null}},selectionKeys:{type:Array,default:function(){return[]}},memberIds:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},isDepotOut:{type:Boolean,default:function(){return!1}},checkTable:{type:Array,default:function(){return[]}},showTable:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],isDepotOutNew:!1,checkedTable:[],innerSelection:[]}},methods:{rowKeys:function(t){return t.id},generateSelectionKeys:function(t,e){if(t.indexOf(e)>=0)this.innerSelectionKeys.push(e[this.keyField]),this.innerSelection.push(e);else{var a=this.innerSelectionKeys.indexOf(e[this.keyField]);this.innerSelectionKeys.splice(a,1),this.innerSelection.splice(a,1)}},open:function(t){this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(t){this.innerSelectionKeys=[],this.innerSelection=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){if(this.innerSelectionKeys.length>0||!this.showTable){if(!this.showTable&&!/(http|https):\/\/([\w.]+\/?)\S*/.test(this.filters[2].value))return void this.$message.warning("必须以http,https开头,且需符合URL规范,检查格式是否正确");this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1}else this.$message("请选择一项")},clear:function(){var t=this;this.tableData.forEach((function(e){t.$refs.table.toggleRowSelection(e,!1)})),this.innerSelectionKeys=[],this.innerSelection=[]},updateSelection:function(){var t=this;this.$refs&&this.$refs.table&&this.tableData.forEach((function(e){t.innerSelectionKeys.indexOf(e[t.keyField])>=0?(t.$refs.table.toggleRowSelection(e,!0),"single"===t.selectionMode&&(t.$refs.table.$refs.table.setCurrentRow(e),t.innerSelection=[e])):t.$refs.table.toggleRowSelection(e,!1)}))},operate:function(t){this.$emit("operate",t)},filterDataChange:function(t){this.$emit("filterDataChange",t)},handleSelectAll:function(t){var e=this;0===t.length?this.tableData.forEach((function(t){var a=e.innerSelectionKeys.indexOf(t[e.keyField]);a>=0&&e.innerSelectionKeys.splice(a,1)})):this.tableData.forEach((function(t){var a=e.innerSelectionKeys.indexOf(t[e.keyField]);a<0&&e.innerSelectionKeys.push(t[e.keyField])})),this.$emit("selectionChange",t)},handleSelectionChange:function(t,e){this.generateSelectionKeys(t,e),this.$emit("selectionChange",t)},pageSizeChange:function(t){this.$emit("pageSizeChange",t)},currentPageChange:function(t){this.$emit("currentPageChange",t)},cascaderChange:function(t){this.$emit("cascaderChange",t)},activeItemChange:function(t){this.$emit("active-item-change",t)},handleSortChange:function(t){this.$emit("sort-change",t)},rowClick:function(t,e,a){"single"===this.selectionMode&&(this.innerSelectionKeys=[t[this.keyField]],this.innerSelection=[t])}},watch:{visibility:function(t,e){this.dialogVisible=t,this.isDepotOutNew=this.isDepotOut,this.checkedTable=this.checkTable}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){},updated:function(){this.updateSelection()}},s=o,l=(a("0943"),a("2877")),c=Object(l["a"])(s,i,n,!1,null,null,null);e["a"]=c.exports},7132:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"biz-fade-t"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"biz-popup",on:{click:function(e){return e.target!==e.currentTarget?null:t.close(e)}}},[a("transition",{attrs:{name:"biz-fade-t-right"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"popup-content",style:t.contentStyle},[t._t("default")],2)])],1)])},n=[],r={name:"BizPopup",props:{open:{type:Boolean,default:function(){return!1}},contentStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{close:function(){this.$emit("close")}}},o=r,s=(a("5b8e"),a("2877")),l=Object(s["a"])(o,i,n,!1,null,null,null),c=l.exports,u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"biz-popup-tabs"},[a("biz-popup",{attrs:{open:t.open,contentStyle:t.contentStyle},on:{close:t.close}},[a("el-tabs",{attrs:{type:"border-card",value:t.value},on:{"tab-click":t.tabClick}},[t._t("default")],2)],1)],1)},d=[],p=(a("b0c0"),{name:"BizPopupTabs",data:function(){return{}},props:{open:{type:Boolean,default:!1},value:{type:String,required:!0},contentStyle:{type:Object,default:function(){return{}}}},components:{BizPopup:c},methods:{close:function(){var t=this;this.$confirm("是否保存当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("close")}))},tabClick:function(t){this.$emit("input",t.name)}}}),f=p,g=(a("d4c2"),Object(s["a"])(f,u,d,!1,null,null,null)),h=g.exports;a.d(e,"a",(function(){return h}))},"78c2":function(t,e,a){"use strict";var i=a("bd50"),n=a.n(i);n.a},9678:function(t,e,a){},a9e3:function(t,e,a){"use strict";var i=a("83ab"),n=a("da84"),r=a("94ca"),o=a("6eeb"),s=a("5135"),l=a("c6b6"),c=a("7156"),u=a("c04e"),d=a("d039"),p=a("7c73"),f=a("241c").f,g=a("06cf").f,h=a("9bf2").f,m=a("58a8").trim,b="Number",v=n[b],y=v.prototype,w=l(p(y))==b,S=function(t){var e,a,i,n,r,o,s,l,c=u(t,!1);if("string"==typeof c&&c.length>2)if(c=m(c),e=c.charCodeAt(0),43===e||45===e){if(a=c.charCodeAt(2),88===a||120===a)return NaN}else if(48===e){switch(c.charCodeAt(1)){case 66:case 98:i=2,n=49;break;case 79:case 111:i=8,n=55;break;default:return+c}for(r=c.slice(2),o=r.length,s=0;s<o;s++)if(l=r.charCodeAt(s),l<48||l>n)return NaN;return parseInt(r,i)}return+c};if(r(b,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var I,C=function(t){var e=arguments.length<1?0:t,a=this;return a instanceof C&&(w?d((function(){y.valueOf.call(a)})):l(a)!=b)?c(new v(S(e)),a,C):S(e)},_=i?f(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),D=0;_.length>D;D++)s(v,I=_[D])&&!s(C,I)&&h(C,I,g(v,I));C.prototype=y,y.constructor=C,o(n,b,C)}},aa26:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"purchase-return-apply-mgmt"},[a("biz-flex-table",{ref:"table",staticClass:"purchase-apply-mgmt-tabel",attrs:{operations:t.operations,filters:t.filters,tableData:t.tableData,loading:t.loading,pagination:t.pagination},on:{operate:t.operate,"filter-data-change":t.filterDataChange,"selection-change":t.handleSelectionChange,"row-click":t.rowClick,"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}},[a("el-table-column",{attrs:{label:"编号",prop:"sn","min-width":"125"}}),a("el-table-column",{attrs:{label:"商品信息",width:"400"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("div",{staticStyle:{width:"100%","margin-right":"30px"}},t._l(e.row.itemDatas,(function(e){return a("div",{key:e.id,staticClass:"product-info"},[a("div",{staticClass:"wrapper"},[a("div",{staticClass:"titleClass",attrs:{title:e.productName}},[t._v(t._s(e.productName))])]),a("div",{staticClass:"info-bottom"},[a("div",[t._v(" *"+t._s(e.amount))])])])})),0)])]}}])}),a("el-table-column",{attrs:{label:"供应商信息",prop:"relatePartnerName"}}),a("el-table-column",{attrs:{label:"单据总金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("￥"+t._s(e.row.totalFee))]}}])}),a("el-table-column",{attrs:{prop:"applierName",label:"申请人"}}),a("el-table-column",{attrs:{prop:"state",label:"申请状态",formatter:t.getStatus}}),a("el-table-column",{attrs:{prop:"date",label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[a("div",{staticClass:"biz-customcol"},["1"!==e.row.state&&"2"!==e.row.state||"1"!==e.row.audit?t._e():a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.statusChange(e.row,"1")}}},[t._v("通过")]),"0"===e.row.state?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.statusChange(e.row,"0")}}},[t._v("提交")]):t._e(),"1"!==e.row.state&&"2"!==e.row.state||"1"!==e.row.audit?t._e():a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.statusChange(e.row,"2")}}},[t._v("驳回")]),"3"!==e.row.state||"2"!==e.row.state?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.deleteReturnApply(a,e.row)}}},[t._v("删除")]):t._e(),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.printReturnApply(e.row)}}},[t._v("打印")])],1)])}}])})],1),a("biz-popup-tabs",{attrs:{open:t.open},on:{close:function(e){t.open=!1}},model:{value:t.tabName,callback:function(e){t.tabName=e},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[a("base-info",{ref:"baseInfo",attrs:{itemId:t.itemId,isEdit:t.isEdit},on:{setBaseItems:t.setBaseItems,operationSuccess:t.operationSuccess}})],1),t.isCreate?a("el-tab-pane",{attrs:{label:"商品信息",name:"productinfo"}},[a("product-info",{ref:"productinfo",attrs:{itemId:t.itemId,isEdit:t.isEdit,returnId:t.returnId},on:{setOrderItems:t.setOrderItems,operationSuccess:t.operationSuccess}})],1):t._e(),t.isCreate?a("el-tab-pane",{attrs:{label:"关联单据",name:"orderinfo"}},[a("order-info",{ref:"orderinfo",attrs:{itemId:t.itemId,isEdit:t.isEdit},on:{operationSuccess:t.operationSuccess}})],1):t._e()],1),a("el-dialog",{attrs:{visible:t.dialogTableVisible,center:"",width:"800px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"left"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.print}},[t._v("打印")])],1)])],1),a("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[t._v(t._s(t.title))])]),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"center"}},[t._v("打印日期："+t._s(t.formatDate((new Date).getTime())))])])],1),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("编号："+t._s(t.form.sn))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("创建时间："+t._s(t.form.createDate))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("供应商："+t._s(t.form.relatePartnerName))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("优惠率(%)："+t._s(t.form.discountRate))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("优惠金额(元)："+t._s(t.form.discontFee))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("总金额(元)："+t._s(t.form.totalFee))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("申请人："+t._s(t.form.applierName))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("状态："+t._s(t.form.state))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("备注："+t._s(t.form.remark))])])],1),a("el-table",{staticClass:"table-class",attrs:{data:t.gridData}},[a("el-table-column",{attrs:{property:"productName",label:"商品"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.productName))]}}])}),a("el-table-column",{attrs:{property:"price",label:"退货单价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("￥"+t._s(e.row.price))]}}])}),a("el-table-column",{attrs:{property:"amount",label:"退货数量"}}),a("el-table-column",{attrs:{property:"totalFee",label:"金额(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("￥"+t._s(e.row.totalFee))]}}])}),a("el-table-column",{attrs:{property:"depotName",label:"仓库"}})],1)],1)])],1)],1)},n=[],r=(a("99af"),a("4160"),a("a15b"),a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("159b"),a("5530")),o=a("7132"),s=a("04d3"),l=a("d819"),c=a("40ab"),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-grid",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"purchase-return-order-info"},[a("el-form",{attrs:{"label-width":"110px",size:"small","inline-message":!0}},[a("el-form-item",{attrs:{label:"入库单"}},t._l(t.orderLists,(function(e){return a("span",{key:e.id,staticClass:"tel-style",attrs:{label:e.sn,value:e.id},on:{click:function(a){return t.onClickOrderList(e)}}},[t._v(t._s(e.sn))])})),0)],1),a("el-dialog",{attrs:{visible:t.dialogOrderTableVisible,center:"",width:"800px","append-to-body":"","custom-class":"orderDialog"},on:{"update:visible":function(e){t.dialogOrderTableVisible=e}}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[t._v("入库单")])]),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("编号："+t._s(t.form.sn))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("创建时间："+t._s(t.form.createDate))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("供应商："+t._s(t.form.relatePartnerName))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("创建人："+t._s(t.form.creatorName))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("状态："+t._s(t.form.state))])]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[t._v("备注："+t._s(t.form.remark))])])],1),a("el-table",{staticClass:"table-class",attrs:{data:t.gridReturnOrderData}},[a("el-table-column",{attrs:{property:"productName",label:"商品"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.productName))]}}])}),a("el-table-column",{attrs:{property:"amount",label:"入库数量"}}),a("el-table-column",{attrs:{property:"depotName",label:"仓库"}})],1)],1)])],1)},d=[],p=a("f36f"),f=a("1ab1"),g=a("c596"),h={name:"OrderInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},components:{BizGrid:p["a"]},data:function(){return{loading:!1,dialogVisible:!1,orderLists:[],form:{},gridReturnOrderData:[],dialogOrderTableVisible:!1}},created:function(){},watch:{itemId:function(t){this.orderLists=[],this.itemId&&this.getList()}},mounted:function(){},methods:{getList:function(){var t=this;f["a"].get(g["g"].invoicing.purchaseReturnApplyMgmt.relateBill,{id:this.itemId||""}).then((function(e){t.orderLists=e.dataList})).catch((function(t){console.log(t),console.log("code错误")}))},queryReturnOrderList:function(t){var e=this,a={id:t};f["a"].get(g["g"].invoicing.depotInMgmt.print,a).then((function(t){e.dialogOrderTableVisible=!0,e.title="入库单",e.form=t.data,"0"===e.form.state?e.form.state="已创建":"1"===e.form.state&&(e.form.state="已提交"),e.gridReturnOrderData=t.data.itemDatas,e.loading=!1})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(t){e.loading=!1}))},onClickOrderList:function(t){this.queryReturnOrderList(t.id)}}},m=h,b=(a("d584"),a("2877")),v=Object(b["a"])(m,u,d,!1,null,null,null),y=v.exports,w=a("2f62"),S=a("225d"),I={name:"PurchaseReturnApplyMgmtList",data:function(){return{tabName:"info",itemId:"",title:"",isEdit:!0,isCreate:!1,returnId:"",form:{},loading:!1,open:!1,dialogTableVisible:!1,selections:[],operations:[{label:"添加",name:"add",type:"primary"},{label:"删除",name:"delete",type:"",disabled:!0},{label:"刷新",name:"refresh",type:""},{label:"导出",name:"export",type:""}],filters:[{type:"select",label:"供应商",name:"supplier",value:"",options:[]},{type:"select",label:"申请人",name:"people",value:"",options:[]},{type:"select",label:"申请状态",name:"state",value:"",options:[]},{type:"daterange",label:"创建日期",name:"publishDate",value:[]},{type:"input",label:"",placeholder:"请输入采购退货申请单编号",name:"searchValue",value:""}],tableData:[],gridData:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:9}}},components:{BizPopupTabs:o["a"],BizFlexTable:s["c"],BaseInfo:l["a"],vueEasyPrint:S["a"],ProductInfo:c["a"],OrderInfo:y},created:function(){this.getList(),this.queryFilters()},watch:{},computed:{},mounted:function(){},methods:Object(r["a"])(Object(r["a"])({},Object(w["c"])(["getUser"])),{},{operate:function(t){this[t]()},refresh:function(){this.getList()},operationSuccess:function(t){var e=this;this.$nextTick((function(){t&&(e.itemId=String(t))})),this.refresh()},setOrderItems:function(t){this.$refs.baseInfo.setOrderItems(t)},setBaseItems:function(t){var e=this;this.isCreate=!0,this.tabName="productinfo",this.$nextTick((function(){e.returnId=String(t)}))},formatDate:function(t){var e=new Date(t),a=e.getFullYear(),i=e.getMonth()+1,n=e.getDate(),r=a+"-"+(i<10?"0"+i:i)+"-"+(n<10?"0"+n:n);return r},statusChange:function(t,e){var a=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var i={shopId:window.top.SHOP_ID||"",id:t.id,actionType:e};f["a"].get(g["g"].invoicing.purchaseReturnApplyMgmt.state,i).then((function(t){a.$message.success("操作成功！"),a.refresh()})).catch((function(t){t.errorMessage&&a.$message.warning(t.errorMessage)})).finally((function(){}))}))},deleteReturnApply:function(t,e){t.stopPropagation(),this.deleteItem([e.id])},deleteItem:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,f["a"].delete(g["g"].invoicing.purchaseReturnApplyMgmt.shopPurchaseReturnApply,{ids:t}).then((function(t){e.$message.success("删除成功"),e.refresh()})).catch((function(t){console.log(t),console.log("code错误"),t.errorMessage&&e.$message.warning(t.errorMessage)})).finally((function(){e.loading=!1}))}))},delete:function(){if(this.selections&&this.selections.length>0){var t=[];this.selections.forEach((function(e){t.push(e.id)})),this.deleteItem(t)}else this.$message("请选择一条数据")},printReturnApply:function(t){var e=this,a={id:t.id};f["a"].get(g["g"].invoicing.purchaseReturnApplyMgmt.print,a).then((function(t){e.dialogTableVisible=!0,e.title="采购退货申请单",e.form=t.data,"0"===e.form.state?e.form.state="已创建":"1"===e.form.state?e.form.state="已提交":"2"===e.form.state?e.form.state="审核中":"3"===e.form.state?e.form.state="已通过":"4"===e.form.state?e.form.state="已驳回":e.form.state="",e.gridData=t.data.itemDatas,e.loading=!1})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},print:function(){this.$refs.easyPrint.print()},export:function(){var t=this,e={pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage,shopId:window.top.SHOP_ID||"",searchValue:this.filters[4].value,supplierId:this.filters[0].value,applierId:this.filters[1].value,applyState:this.filters[2].value,beginTime:this.filters[3].value[0]?this.filters[3].value[0]+" 00:00:00":"",endTime:this.filters[3].value[1]?this.filters[3].value[1]+" 23:59:59":""};f["a"].get(g["g"].invoicing.purchaseReturnApplyMgmt.export,e).then().catch((function(a){if(a.errorMessage||"没有符合条件的数据"===a)"没有符合条件的数据"===a?t.$message.warning("没有符合条件的数据"):(t.$message.warning(a.errorMessage),console.log("ERR_EXPORT: ",a));else{var i=[];for(var n in e)i.push("".concat(n,"=").concat(e[n]));var r="".concat(g["g"].invoicing.purchaseReturnApplyMgmt.export,"?")+i.join("&");location.href=r}}),(function(t){console.log(t)}))},add:function(){this.tabName="info",this.open=!0,this.isCreate=!1,this.itemId="",this.isEdit=!0},rowClick:function(t,e,a){var i=this;this.tabName="info",this.open=!0,this.isCreate=!0,this.$nextTick((function(){i.itemId=t.id})),"0"===t.state?this.isEdit=!0:this.isEdit=!1},getList:function(){var t=this,e={pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage,shopId:window.top.SHOP_ID||"",searchValue:this.filters[4].value,supplierId:this.filters[0].value,applierId:this.filters[1].value,applyState:this.filters[2].value,beginTime:this.filters[3].value[0]?this.filters[3].value[0]+" 00:00:00":"",endTime:this.filters[3].value[1]?this.filters[3].value[1]+" 23:59:59":""};this.loading=!0,f["a"].get(g["g"].invoicing.purchaseReturnApplyMgmt.shopPurchaseReturnApplyList,e).then((function(e){console.log(e),t.tableData=e.dataList,t.pagination.total=Number(e.total),t.loading=!1})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)})).finally((function(e){t.loading=!1}))},queryFilters:function(){var t=this,e={shopId:window.top.SHOP_ID||""};f["a"].get(g["g"].invoicing.purchaseReturnApplyMgmt.queryInfos,e).then((function(e){t.filters[0].options=[{label:"全部",value:""}].concat(e.supplierList.map((function(t){return{label:t.name,value:t.id}}))),t.filters[1].options=[{label:"全部",value:""}].concat(e.applierList.map((function(t){return{label:t.name,value:t.id}}))),t.filters[2].options=[{label:"全部",value:""}].concat(e.stateList.map((function(t){return{label:t.name,value:t.id}})))})).catch((function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)})).finally((function(t){}))},getStatus:function(t){switch(t.state){case"0":return"已创建";case"1":return"已提交";case"2":return"审核中";case"3":return"已通过";case"4":return"已驳回";default:return"--"}},handleSelectionChange:function(t){this.selections=t,this.operations[1].disabled=!0,t.length>0&&(this.operations[1].disabled=!1)},filterDataChange:function(t){this.filters=t,this.pagination.currentPage=1,this.refresh()},handleSizeChange:function(t){this.pagination.pageSize=t,this.refresh()},handleCurrentChange:function(t){this.pagination.currentPage=t,this.refresh()}})},C=I,_=(a("5ea3"),Object(b["a"])(C,i,n,!1,null,null,null));e["default"]=_.exports},af3f:function(t,e,a){"use strict";var i=a("697f");e["a"]=i["a"]},b680:function(t,e,a){"use strict";var i=a("23e7"),n=a("a691"),r=a("408a"),o=a("1148"),s=a("d039"),l=1..toFixed,c=Math.floor,u=function(t,e,a){return 0===e?a:e%2===1?u(t,e-1,a*t):u(t*t,e/2,a)},d=function(t){var e=0,a=t;while(a>=4096)e+=12,a/=4096;while(a>=2)e+=1,a/=2;return e},p=l&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!s((function(){l.call({})}));i({target:"Number",proto:!0,forced:p},{toFixed:function(t){var e,a,i,s,l=r(this),p=n(t),f=[0,0,0,0,0,0],g="",h="0",m=function(t,e){var a=-1,i=e;while(++a<6)i+=t*f[a],f[a]=i%1e7,i=c(i/1e7)},b=function(t){var e=6,a=0;while(--e>=0)a+=f[e],f[e]=c(a/t),a=a%t*1e7},v=function(){var t=6,e="";while(--t>=0)if(""!==e||0===t||0!==f[t]){var a=String(f[t]);e=""===e?a:e+o.call("0",7-a.length)+a}return e};if(p<0||p>20)throw RangeError("Incorrect fraction digits");if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(g="-",l=-l),l>1e-21)if(e=d(l*u(2,69,1))-69,a=e<0?l*u(2,-e,1):l/u(2,e,1),a*=4503599627370496,e=52-e,e>0){m(0,a),i=p;while(i>=7)m(1e7,0),i-=7;m(u(10,i,1),0),i=e-1;while(i>=23)b(1<<23),i-=23;b(1<<i),m(1,1),b(2),h=v()}else m(0,a),m(1<<-e,0),h=v()+o.call("0",p);return p>0?(s=h.length,h=g+(s<=p?"0."+o.call("0",p-s)+h:h.slice(0,s-p)+"."+h.slice(s-p))):h=g+h,h}})},bd50:function(t,e,a){},d4c2:function(t,e,a){"use strict";var i=a("e725"),n=a.n(i);n.a},d584:function(t,e,a){"use strict";var i=a("2bba"),n=a.n(i);n.a},d819:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("biz-grid",{staticClass:"return-apply-base-info"},[t.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operate},slot:"top"}):t._e(),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small",disabled:!t.isEdit,"inline-message":!0}},[t.itemId?a("el-form-item",{attrs:{label:"编号",prop:"sn"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.form.sn,callback:function(e){t.$set(t.form,"sn",e)},expression:"form.sn"}})],1):t._e(),a("el-form-item",{staticClass:"isRequired",attrs:{label:"供应商",prop:"relatePartnerId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择供应商",disabled:!("0"===t.form.state||!t.itemId)},on:{change:t.relatePartnerNameChange},model:{value:t.form.relatePartnerId,callback:function(e){t.$set(t.form,"relatePartnerId",e)},expression:"form.relatePartnerId"}},t._l(t.relatePartnerList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"关联的采购入库单",prop:"relateBillSn"}},[a("el-input",{attrs:{disabled:""===t.form.relatePartnerId||t.isPend,placeholder:"请选择关联的采购入库单"},on:{focus:t.showDialog},model:{value:t.form.relateBillSn,callback:function(e){t.$set(t.form,"relateBillSn",e)},expression:"form.relateBillSn"}})],1),a("el-form-item",{attrs:{label:"优惠率(%)",prop:"discountRate"}},[a("el-input",{attrs:{disabled:t.isPend},on:{change:t.rateChange},model:{value:t.form.discountRate,callback:function(e){t.$set(t.form,"discountRate",e)},expression:"form.discountRate"}})],1),t.itemId?a("el-form-item",{attrs:{label:"优惠金额(元)",prop:"discontFee"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.form.discontFee,callback:function(e){t.$set(t.form,"discontFee",e)},expression:"form.discontFee"}})],1):t._e(),t.itemId?a("el-form-item",{attrs:{label:"总金额(元)",prop:"totalFee"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.form.totalFee,callback:function(e){t.$set(t.form,"totalFee",e)},expression:"form.totalFee"}})],1):t._e(),t.itemId?a("el-form-item",{attrs:{label:"创建人",prop:"applierName"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.form.applierName,callback:function(e){t.$set(t.form,"applierName",e)},expression:"form.applierName"}})],1):t._e(),t.itemId?a("el-form-item",{attrs:{label:"状态",prop:"state"}},[a("el-input",{attrs:{value:t.stateFormatter,disabled:!0}})],1):t._e(),t.itemId?a("el-form-item",{attrs:{label:"创建时间",prop:"createDate"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.form.createDate,callback:function(e){t.$set(t.form,"createDate",e)},expression:"form.createDate"}})],1):t._e(),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),a("biz-dialog-selector",{staticClass:"depotInDialog",attrs:{title:"选择关联入库单",visibility:t.showRelateDialog,appendToBody:!0,tableData:t.dialogTableData,pagination:t.dialogPagination,selectionMode:"single",isClear:!1,filters:t.dialogFilters},on:{"update:visibility":function(e){t.showRelateDialog=e},open:t.opened,confirmed:t.handleConfirmed,filterDataChange:t.dialogFilterDataChange,pageSizeChange:t.dialogPageSizeChange,currentPageChange:t.dialogCurrentPageChange}},[a("el-table-column",{attrs:{label:"编号",prop:"sn","min-width":"200"}}),a("el-table-column",{attrs:{label:"商品信息","min-width":"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("div",{staticStyle:{width:"100%","margin-right":"30px"}},t._l(e.row.itemDatas,(function(e){return a("div",{key:e.id,staticClass:"product-info",staticStyle:{display:"flex",width:"100%"}},[a("div",{staticClass:"wrapper"},[a("div",{staticClass:"titleClass",staticStyle:{"text-overflow":"ellipsis",overflow:"hidden",width:"250px","white-space":"nowrap"},attrs:{title:e.productName}},[t._v(t._s(e.productName))])]),a("div",{staticClass:"info-bottom"},[a("div",[t._v(" *"+t._s(e.amount))])])])})),0)])]}}])}),a("el-table-column",{attrs:{label:"往来方",prop:"relatePartnerName","min-width":"200"}})],1)],1)},n=[],r=(a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("b85c")),o=a("5530"),s=a("f36f"),l=a("8330"),c=a("af3f"),u=a("2f62"),d=a("1ab1"),p=a("c596"),f=function(){return{relatePartnerId:"",relatePartnerName:"",relatePartnerType:"",totalFee:"",billType:"",sn:"",applierId:"",applierName:"",relateBill:"",relateBillSn:"",relateBillType:"",discountRate:"0",discontFee:"",auditLevel:"",state:"",id:"",createDate:"",shopId:"",shop:{}}},g={name:"baseInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}},isPend:{type:Boolean,default:function(){return!1}}},components:{BizGrid:s["a"],BizSaveButton:l["a"],BizDialogSelector:c["a"]},data:function(){var t=this,e=function(e,a,i){""===t.form.discountRate&&i(new Error("请输入优惠率")),Number(t.form.discountRate)>=0&&Number(t.form.discountRate)<=100?i():i(new Error("优惠率必须为0~100的数字值"))};return{loading:!1,showRelateDialog:!1,dialogVisible:!1,relatePartnerList:[],relateBillList:[],form:f(),totalFee:0,itemDatas:[],operations:[{label:"保存",name:"save",type:"primary"}],dialogTableData:[],dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},dialogFilters:[{type:"input",label:"",placeholder:"请输入供应商名称",name:"searchValue",value:""}],rules:{relatePartnerId:[{required:!0,message:"请选择供应商",trigger:["blur","change"]}],discountRate:[{required:!0,trigger:"blur",validator:e}],relateBillSn:[{required:!0,message:"请选择关联的采购入库单",trigger:"blur"}]}}},computed:{stateFormatter:function(){switch(this.form.state){case"0":return"已创建";case"1":return"已提交";case"2":return"审核中";case"3":return"已通过";case"4":return"已驳回";default:return"--"}}},created:function(){this.getSupplier()},watch:{itemId:function(t){this.form=this.getDefaultModel(),this.totalFee="",this.queryPurchase()}},methods:Object(o["a"])(Object(o["a"])({},Object(u["c"])(["getUser"])),{},{operate:function(t){this[t]()},showDialog:function(){this.showRelateDialog=!0,this.form.relateBillSn&&this.$refs.form.clearValidate("relateBillSn")},initModel:function(t){t?(this.form=Object.assign(this.getDefaultModel(),t),this.totalFee=Number(t.totalFee)+Number(t.discontFee)):this.resetModel()},resetModel:function(){this.form=this.getDefaultModel(),this.$refs.form.resetFields()},rateChange:function(t){this.form.discontFee=this.totalFee*(Number(t)/100),this.form.totalFee=this.totalFee-Number(this.form.discontFee)},queryPurchase:function(){var t=this;this.loading=!0,d["a"].get(p["g"].invoicing.purchaseReturnApplyMgmt.shopPurchaseReturnApply,{shopId:window.top.SHOP_ID||"",id:this.itemId}).then((function(e){t.loading=!1,t.initModel(e.data)})).catch((function(e){t.loading=!1,console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))},getDefaultModel:function(){return f()},getSaveParams:function(){return{id:this.form.id,relatePartnerId:this.form.relatePartnerId,totalFee:this.form.totalFee,discountRate:this.form.discountRate,discontFee:this.form.discontFee,relateBill:this.form.relateBill,relateBillSn:this.form.relateBillSn,remark:this.form.remark,shopId:window.top.SHOP_ID||""}},save:function(){var t=this;this.$refs.form.validate((function(e,a){if(!e)return!1;t.loading=!0;var i=function(e){t.$message.success("保存成功"),t.form.id||(t.form.id=e.id,t.$emit("setBaseItems",t.form.id)),t.$emit("operationSuccess",t.form.id)},n=function(e){e.errorMessage&&t.$message.warning(e.errorMessage)},r=function(e){t.loading=!1};t.form.id?d["a"].put(p["g"].invoicing.purchaseReturnApplyMgmt.shopPurchaseReturnApply,t.getSaveParams()).then(i).catch(n).finally(r):d["a"].post(p["g"].invoicing.purchaseReturnApplyMgmt.shopPurchaseReturnApply,t.getSaveParams()).then(i).catch(n).finally(r)}))},opened:function(){this.dialogTableData=[],this.getSupplierDepotIn(this.form.relatePartnerId)},getSupplier:function(){var t=this,e={shopId:window.top.SHOP_ID||""};d["a"].get(p["g"].invoicing.purchaseReturnApplyMgmt.relateSupplier,e).then((function(e){t.relatePartnerList=e.dataList})).catch((function(e){"店铺不存在"!==e.errorMessage&&(t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e))})).finally((function(e){t.loading=!1}))},getSupplierDepotIn:function(t){var e=this,a={shopId:window.top.SHOP_ID||"",supplierId:t};d["a"].get(p["g"].invoicing.purchaseReturnApplyMgmt.supplierDepotIn,a).then((function(t){e.dialogTableData=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},relatePartnerNameChange:function(t){var e,a=Object(r["a"])(this.relatePartnerList);try{for(a.s();!(e=a.n()).done;){var i=e.value;t===i.id&&(this.form.relatePartnerId=i.id,this.form.relatePartnerName=i.name,this.form.relateBill="")}}catch(n){a.e(n)}finally{a.f()}},setOrderItems:function(t){this.itemDatas=t;var e=0;t.map((function(t){e+=Number(t.amount)*Number(t.price)})),this.totalFee=e,this.form.discontFee=e*(this.form.discountRate/100),this.form.totalFee=e-this.form.discontFee},dialogPageSizeChange:function(t){this.dialogPagination.pageSize=t,this.getSupplierDepotIn(this.form.relatePartnerId)},dialogCurrentPageChange:function(t){this.dialogPagination.currentPage=t,this.getSupplierDepotIn(this.form.relatePartnerId)},dialogFilterDataChange:function(t){this.dialogFilters=t,this.dialogPagination.currentPage=1,this.getSupplierDepotIn(this.form.relatePartnerId)},getDepotInDiscountRate:function(t){var e=this,a={id:t};d["a"].get(p["g"].invoicing.purchaseReturnApplyMgmt.depotInDiscountRate,a).then((function(t){e.form.discountRate=t.data.discountRate})).catch((function(t){e.$message.warning(t.errorMessage),console.log("ERR_REFRESH: ",t)})).finally((function(t){e.loading=!1}))},handleConfirmed:function(t,e){this.form.relateBill=e[0].id,this.form.relateBillSn=e[0].sn,this.getDepotInDiscountRate(this.form.relateBill),this.$refs.form.clearValidate("relateBillSn")}})},h=g,m=(a("4e34"),a("2877")),b=Object(m["a"])(h,i,n,!1,null,null,null);e["a"]=b.exports},e725:function(t,e,a){},f3ac:function(t,e,a){t.exports=a.p+"static/img/pic_default_none_100.6603f4ac.png"}}]);