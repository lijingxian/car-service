(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a6a14fe"],{"108b":function(t,e,n){"use strict";var i=n("3336"),a=n.n(i);a.a},"1e07":function(t,e,n){"use strict";var i=n("6275"),a=n.n(i);a.a},2497:function(t,e,n){"use strict";var i=n("4360"),a=n("a18c");e["a"]=function(t,e){return function(n){var o=n.data;"100"===o.resultCode?t(o):"709"===o.resultCode?(i["a"].commit("updateUser",{shop:{}}),console.log("未登录: ",i["a"].getters.currentUser),a["a"].push("/login")):e(o)}}},"2a8a":function(t,e,n){t.exports=n.p+"static/img/iphone-b.b7d883a0.png"},3336:function(t,e,n){},"5b8e":function(t,e,n){"use strict";var i=n("9678"),a=n.n(i);a.a},6275:function(t,e,n){},"6a69":function(t,e,n){},7132:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"biz-fade-t"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"biz-popup",on:{click:function(e){return e.target!==e.currentTarget?null:t.close(e)}}},[n("transition",{attrs:{name:"biz-fade-t-right"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"popup-content",style:t.contentStyle},[t._t("default")],2)])],1)])},a=[],o={name:"BizPopup",props:{open:{type:Boolean,default:function(){return!1}},contentStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{close:function(){this.$emit("close")}}},r=o,s=(n("5b8e"),n("2877")),c=Object(s["a"])(r,i,a,!1,null,null,null),l=c.exports,u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"biz-popup-tabs"},[n("biz-popup",{attrs:{open:t.open,contentStyle:t.contentStyle},on:{close:t.close}},[n("el-tabs",{attrs:{type:"border-card",value:t.value},on:{"tab-click":t.tabClick}},[t._t("default")],2)],1)],1)},f=[],d=(n("b0c0"),{name:"BizPopupTabs",data:function(){return{}},props:{open:{type:Boolean,default:!1},value:{type:String,required:!0},contentStyle:{type:Object,default:function(){return{}}}},components:{BizPopup:l},methods:{close:function(){var t=this;this.$confirm("是否保存当前页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("close")}))},tabClick:function(t){this.$emit("input",t.name)}}}),p=d,h=(n("d4c2"),Object(s["a"])(p,u,f,!1,null,null,null)),g=h.exports;n.d(e,"a",(function(){return g}))},9678:function(t,e,n){},"971c5":function(t,e,n){"use strict";var i=n("b800"),a=n.n(i);a.a},a48c:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content-mgmt-wechat-publication"},[n("biz-grid",[n("biz-header",{attrs:{slot:"top",operations:t.operations,filters:t.filters},on:{operate:t.operate,"filter-data-change":t.filterDataChange},slot:"top"}),n("div",{staticClass:"wechat-list-area"},[t._l(t.columnCount,(function(e){return n("div",{key:e,staticClass:"columns"},t._l(t.tableData,(function(i,a){return(a-e+1)%t.columnCount===0?n("wechat-preview",{key:i.index,attrs:{date:i.createDate,previewList:i.newsList,isReadOnly:!0},on:{"card-click":t.cardClick}}):t._e()})),1)})),0===t.tableData.length?n("div",{staticClass:"no-content",style:t.styleObject}):t._e()],2),t.pagination?n("biz-pagination",{attrs:{slot:"bottom",pagination:t.pagination},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange},slot:"bottom"}):t._e()],1),n("biz-popup-tabs",{attrs:{open:t.open},on:{close:t.close},model:{value:t.tabName,callback:function(e){t.tabName=e},expression:"tabName"}},[n("el-tab-pane",{attrs:{label:"推送到微信",name:"first"}},[n("base-info",{attrs:{itemId:t.itemId},on:{update:t.refresh}})],1)],1)],1)},a=[],o=(n("99af"),n("c975"),n("d81d"),n("a9e3"),n("7132")),r=n("04d3"),s=n("f36f"),c=n("ba8a"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("biz-grid",{staticClass:"wechat-publication-base-info"},[n("biz-save-button",{attrs:{slot:"top",operations:t.operations},on:{operate:t.operate},slot:"top"}),n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{rules:t.rules,model:t.form,"label-width":"100px",size:"small",disabled:!0,"inline-message":!0}},[n("el-form-item",{attrs:{label:"标题",prop:"title",error:t.errTitle}},[n("el-input",{attrs:{placeholder:"请输入标题"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),n("el-form-item",{attrs:{label:"作者",prop:"author"}},[n("el-input",{attrs:{placeholder:"请输入作者"},model:{value:t.form.author,callback:function(e){t.$set(t.form,"author",e)},expression:"form.author"}})],1),n("el-form-item",{attrs:{label:"原文地址",prop:"contentSourceUrl"}},[n("el-input",{attrs:{placeholder:"请输入原文地址"},model:{value:t.form.contentSourceUrl,callback:function(e){t.$set(t.form,"contentSourceUrl",e)},expression:"form.contentSourceUrl"}})],1),n("el-form-item",{attrs:{label:"摘要",prop:"digest"}},[n("el-input",{attrs:{placeholder:"请输入摘要",rows:2,type:"textarea"},model:{value:t.form.digest,callback:function(e){t.$set(t.form,"digest",e)},expression:"form.digest"}})],1),n("biz-editor",{ref:"editor",attrs:{width:"440px",height:"550px"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),n("article-preview",{attrs:{previewDialog:t.previewDialog,form:t.form},on:{"update:previewDialog":function(e){t.previewDialog=e},"update:preview-dialog":function(e){t.previewDialog=e}}})],1)},u=[],f=n("8330"),d=n("40ae"),p=n("ce74"),h=n("e0dc"),g={name:"ArticleMgmtBaseInfo",props:{ifShowConfig:{type:Boolean,default:!0},itemId:{type:Object,default:function(){return{id:""}}}},data:function(){return{id:"",previewDialog:!1,errTitle:"",categories:[],rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}]},operations:[{label:"预览",name:"preview",type:""}],loading:!1,form:{title:"",category:"",author:"",content:"",isPublication:"0",isTop:"0",titleImage:"",summary:"",contentSourceUrl:"",digest:"",seoKeywords:""}}},methods:{operate:function(t){this[t]()},handleLogoSuccess:function(t){this.form.titleImage=t},back:function(){this.$router.go(-1)},save:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return!1;t.submit()}))},submit:function(){var t=this,e=Object.assign({},this.form);h["a"].updateBaseInfo(e,(function(e){t.loading=!1,t.$message({message:"更新成功",type:"success",showClose:!0}),t.refresh(),t.$emit("created")}),(function(e){t.loading=!1,t.$message.warning(e.errorMessage)}))},del:function(){var t=this,e=Array(this.id);this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n={ids:e};h["a"].delete(n,(function(e){t.$message.success("操作成功"),t.refresh()}),(function(e){t.$message.warning(e.errorMessage),console.log("ERR_DELETE: ",e)}))})).catch()},clear:function(){this.$refs.form.resetFields()},refresh:function(){var t=this;this.clear();var e={id:this.id};h["a"].queryBaseInfo(e,(function(e){t.loading=!1,t.form.title=e.content.title,t.form.author=e.content.author,t.form.isPublication=e.content.isPublication,t.form.isTop=e.content.isTop,t.form.contentSourceUrl=e.content.contentSourceUrl,t.form.digest=e.content.digest,t.form.content=e.content.content}),(function(e){t.loading=!1}))},queryTypeList:function(){var t=this,e={};h["a"].queryTypeList(e,(function(e){t.categories=e.dataList}),(function(t){}))},preview:function(){this.previewDialog=!0},checkVideo:function(t){this.$message(t)}},watch:{itemId:function(t,e){this.id=this.itemId.id,this.refresh()}},computed:{categoryClass:function(){var t=this,e={};return this.categories.map((function(n){n.id===t.form.category&&(e=n)})),e}},created:function(){},mounted:function(){this.queryTypeList(),this.id?this.refresh():this.clear()},components:{BizGrid:s["a"],BizSaveButton:f["a"],BizEditor:d["a"],ArticlePreview:p["a"]}},m=g,v=(n("1e07"),n("2877")),b=Object(v["a"])(m,l,u,!1,null,null,null),w=b.exports,y=n("c466"),D=n("f260"),C=n.n(D),M={name:"WechatPublication",data:function(){return{clientWidth:document.documentElement.clientWidth,open:!1,tabName:"first",itemId:{id:""},operations:[{label:"新建",name:"add",type:"primary"}],beginDate:"",endDate:"",filters:[{label:"日期区间",type:"daterange",value:[y["a"].lastMonthDate(),y["a"].nowDate()]},{label:"公众号",type:"select",placeholder:"请选择公众号",name:"wechat",value:"",options:[]}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},tableData:[],form:{title:"",author:"",content:""},multiSelected:[],stateFilter:[{text:"未发布",value:"0"},{text:"已发布",value:"1"}]}},methods:{operate:function(t){this[t]()},add:function(){this.$router.push({path:"/marketing/recommend/wechat-create"})},del:function(t){var e=this,n=t?Array(t):this.multiSelected;0!==n.length?this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t={ids:n};h["a"].delete(t,(function(t){e.$message.success("操作成功"),e.refresh()}),(function(t){e.$message.warning(t.errorMessage),console.log("ERR_DELETE: ",t)}))})):this.$message.warning("未选择删除条目")},filterDataChange:function(t){this.refresh()},handleSelectionChange:function(t){var e=this;this.multiSelected=[],t.map((function(t){e.multiSelected=e.multiSelected.concat(t.id)}))},cardClick:function(t){this.itemId={id:t},this.open=!0},handleSizeChange:function(t){this.pagination.pageSize=t,this.refresh()},handleCurrentChange:function(t){this.pagination.currentPage=t,this.refresh()},close:function(){this.open=!1},queryList:function(){var t=this,e={shopId:window.top.SHOP_ID};h["a"].queryWechatList(e,(function(e){t.filters[1].options=e.wechatDataList.map((function(t){return{value:t.id,label:t.showName}})),t.filters[1].value=t.filters[1].options[0].value}),(function(t){}))},refresh:function(){var t=this,e={shopId:window.top.SHOP_ID,beginTime:this.filters[0].value[0]||"",endTime:this.filters[0].value[1]||"",wechatOpenId:this.filters[1].value,pageSize:this.pagination.pageSize,pageNumber:this.pagination.currentPage};h["a"].query(e,(function(e){t.tableData=e.content,t.pagination.total=Number(e.total)}),(function(e){t.$message.warning(e.errorMessage),console.log("ERR_REFRESH: ",e)}))},preview:function(t){this.queryArticle(t)},queryArticle:function(t){var e=this,n={id:t};h["a"].queryBaseInfo(n,(function(t){e.form.title=t.article.title,e.form.author=t.article.author,e.form.content=t.article.content}),(function(t){e.$message.warning(t.errorMessage),console.log("ERR_PREVIEW: ",t)}))},showMessage:function(t,e){this.$message({showClose:!0,message:t,type:e})},handleResize:function(){this.clientWidth=document.documentElement.clientWidth}},computed:{dateRange:{get:function(){return[this.beginDate,this.endDate]},set:function(t){console.log("dateRange: ",t),t.length?(this.beginDate=t[0],this.endDate=t[1]):(this.beginDate="",this.endDate="")}},columnCount:function(){return Math.floor(Number(this.clientWidth)/400)},styleObject:function(){return{position:"absolute",top:0,bottom:0,left:0,right:0,margin:"auto",background:"url("+C.a+") 50% 50% / auto 200px no-repeat"}},previewList:function(){var t=this,e=[];return this.tableData.map((function(n){-1!==t.multiSelected.indexOf(n.id)&&e.push(n)})),e}},created:function(){},beforeDestroy:function(){window.removeEventListener("resize",this.handleResize())},mounted:function(){var t=this;window.addEventListener("resize",(function(){t.handleResize()})),this.queryList()},watch:{},components:{BizPopupTabs:o["a"],BizHeader:r["d"],BizPagination:r["f"],WechatPreview:c["a"],BizGrid:s["a"],BaseInfo:w}},_=M,L=(n("971c5"),Object(v["a"])(_,i,a,!1,null,null,null));e["default"]=L.exports},b800:function(t,e,n){},ba8a:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wechat-preview"},[n("el-card",{staticClass:"card-list",attrs:{"body-style":{padding:0}}},[t.isReadOnly?n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[t._v(t._s(t.date))])]):t._e(),t.previewList.length>0?n("div",{staticClass:"big-cover",style:t.bgImgStyle(t.previewList[0].titleImage),attrs:{disabled:1===t.previewList.length},on:{click:function(e){return t.cardClick(t.previewList[0].id)}}},[t.previewList.length>1?n("div",{staticClass:"big-title"},[t._v(t._s(t.previewList[0].title))]):t._e()]):t._e(),1===t.previewList.length?n("div",{staticClass:"article",on:{click:function(e){return t.cardClick(t.previewList[0].id)}}},[n("div",{staticClass:"title"},[t._v(t._s(t.previewList[0].title))])]):t._e(),t._l(t.previewList,(function(e,i){return i>0?n("div",{key:e.id,staticClass:"article",on:{click:function(n){return t.cardClick(e.id)}}},[n("div",{staticClass:"title"},[t._v(t._s(e.title))]),n("div",{staticClass:"cover",style:t.bgImgStyle(e.titleImage)}),t.isReadOnly?t._e():n("div",{staticClass:"option-panel flex-box"},[n("div",{staticClass:"flex-box"},[i>0?n("el-button",{attrs:{type:"text"},on:{click:function(e){return e.stopPropagation(),t.moveUp(i)}}},[n("i",{staticClass:"iconfont"},[t._v("↑")])]):t._e(),i<t.previewList.length-1?n("el-button",{attrs:{type:"text"},on:{click:function(e){return e.stopPropagation(),t.moveDown(i)}}},[n("i",{staticClass:"iconfont"},[t._v("↓")])]):t._e()],1),0!==i?n("el-button",{attrs:{type:"text"},on:{click:function(e){return e.stopPropagation(),t.moveAway(i)}}},[n("i",{staticClass:"el-icon-delete"})]):t._e()],1)]):t._e()})),t.previewList.length<8&&!t.isReadOnly?n("div",{staticClass:"add-article",on:{click:t.addArticle}},[n("i",{staticClass:"el-icon-plus"})]):t._e()],2)],1)},a=[],o=(n("a434"),{name:"WechatPreview",model:{prop:"previewList",event:"input"},props:{date:{type:String,default:""},isReadOnly:{type:Boolean,default:!1},previewList:{type:Array,default:function(){return[]}}},data:function(){return{selectedCardId:"",operations:[{label:"上移",name:"moveUp",type:"primary"},{label:"下移",name:"moveDown",type:"primary"},{label:"移除",name:"moveAway",type:"primary"}],imgStyle:"background: #ffffff url() no-repeat fixed center; background-size: 100%",imgUrl:"/upload/image/201805/fe63fb12-f0f5-4cca-9301-6a8d8b0bd951.jpg"}},methods:{cardClick:function(t){this.$emit("card-click",t)},operate:function(t){this[t]()},bgImgStyle:function(t){return{background:"url(".concat(t,") center/cover no-repeat")}},moveUp:function(t){console.log("index: ",t);var e=this.previewList[t-1];this.$set(this.previewList,t-1,this.previewList[t]),this.$set(this.previewList,t,e),this.$emit("input",this.previewList)},moveDown:function(t){console.log("index: ",t);var e=this.previewList[t+1];this.$set(this.previewList,t+1,this.previewList[t]),this.$set(this.previewList,t,e),this.$emit("input",this.previewList)},moveAway:function(t){var e=this;console.log("index: ",t),this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.previewList.splice(t,1),e.$emit("input",e.previewList)})).catch()},isSelected:function(t){return this.selectedCardId===t},addArticle:function(){this.$emit("add-new")}},computed:{itemIndex:function(){for(var t=0;t<this.previewList.length;t++)if(this.previewList[t].id===this.selectedCardId)return t;return 0}},mounted:function(){},watch:{previewList:{deep:!0,handler:function(t,e){this.$emit("update:previewList",t)}}},components:{}}),r=o,s=(n("108b"),n("2877")),c=Object(s["a"])(r,i,a,!1,null,null,null),l=c.exports;e["a"]=l},c466:function(t,e,n){"use strict";n("99af"),n("d3b7"),n("ac1f"),n("25f0"),n("5319");e["a"]={nowDate:function(){var t=new Date,e=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()+1<10?"0"+t.getDate():t.getDate();return t.getFullYear().toString()+"-"+e+"-"+n},getMonthDays:function(t){var e=new Date(Date.parse(t.replace(/-/g,"/"))),n=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,1),a=(i-n)/864e5;return a},halfYearAgo:function(t){var e="";return e=t?new Date(Date.parse(t.replace(/-/g,"/"))):new Date,console.log(e),e.setMonth(e.getMonth()-6),"".concat(e.getFullYear(),"-").concat(e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1,"-").concat(e.getDate()<10?"0"+e.getDate():e.getDate())},lastMonthDate:function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1<10?"0"+t.getMonth():t.getMonth(),i=t.getDate()+1<10?"0"+t.getDate():t.getDate();return"00"===n&&(n="12",e--),e.toString()+"-"+n+"-"+i},nextMonthDate:function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),a=parseInt(n)+1;13===a&&(e=parseInt(e)+1,a=1);var o=new Date(e,a,0);return o=o.getDate(),i>o&&(i=o),a<10&&(a="0"+a),e+"-"+a+"-"+i},lastYearDate:function(){var t=new Date,e=new Date(t.getFullYear()-1,t.getMonth(),t.getDate());return e.getFullYear()+"-"+this.convertToFullMode(e.getMonth()+1)+"-"+this.convertToFullMode(e.getDate())},lastTwoYearDate:function(){var t=new Date,e=new Date(t.getFullYear()+2,t.getMonth(),t.getDate());return e.getFullYear()+"-"+this.convertToFullMode(e.getMonth()+1)+"-"+this.convertToFullMode(e.getDate())},lastNYearDate:function(t,e){var n=new Date(t),i=new Date(n.getFullYear()+parseInt(e),n.getMonth(),n.getDate());return i.getFullYear()+"-"+this.convertToFullMode(i.getMonth()+1)+"-"+this.convertToFullMode(i.getDate())},dateConverter:function(t){return t instanceof Date?t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate()):t},timeConverter:function(t){return t instanceof Date?this.convertToFullMode(t.getHours())+":"+this.convertToFullMode(t.getMinutes())+":"+this.convertToFullMode(t.getSeconds()):t},shortTimeConverter:function(t){return t instanceof Date?this.convertToFullMode(t.getHours())+":"+this.convertToFullMode(t.getMinutes()):t},dateTimeConverter:function(t){return t instanceof Date?this.dateConverter(t)+" "+this.timeConverter(t):t},convertToFullMode:function(t){return t=t.toString(),1===t.length?"0"+t:t}}},ce74:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"article-preview",attrs:{"append-to-body":"",title:"预览",visible:t.previewDialog,width:"450px"},on:{close:t.close}},[n("div",{staticClass:"bg",style:{background:t.background}},[n("div",{staticClass:"cpreview"},[n("div",{staticClass:"pcontent"},[n("div",{staticClass:"title"},[n("div",[t._v(t._s(t.form.title))]),n("div",{staticClass:"date"},[t._v(t._s(t.dateNow))])]),n("div",{domProps:{innerHTML:t._s(t.form.content)}})])])])])},a=[],o=n("2a8a"),r=n.n(o),s=n("c466"),c={name:"ArticlePreview",props:{previewDialog:{type:Boolean,default:!1},form:{type:Object,default:function(){return{}}}},data:function(){return{background:"url("+r.a+") no-repeat no-repeat",dateNow:s["a"].nowDate()}},methods:{close:function(){this.$emit("update:previewDialog",!1)}},components:{}},l=c,u=(n("e3b9"),n("2877")),f=Object(u["a"])(l,i,a,!1,null,null,null),d=f.exports;e["a"]=d},d4c2:function(t,e,n){"use strict";var i=n("e725"),a=n.n(i);a.a},e0dc:function(t,e,n){"use strict";var i=n("2497"),a=n("bc3a"),o=n.n(a),r=n("c596");e["a"]={query:function(t,e,n){o.a.get(r["g"].contentMgmt.Wechat_queryList,{params:t}).then(Object(i["a"])(e,n)).catch((function(t){console.error(t)}))},queryWechatList:function(t,e,n){o.a.get(r["g"].contentMgmt.WechatPublication_queryWechatList,{params:t}).then(Object(i["a"])(e,n)).catch((function(t){console.error(t)}))},queryBaseInfo:function(t,e,n){o.a.get(r["g"].contentMgmt.Wechat_queryBaseInfo,{params:t}).then(Object(i["a"])(e,n)).catch((function(t){console.error(t)}))},updateBaseInfo:function(t,e,n){o.a.put(r["g"].contentMgmt.ArticleMgmt_updateBaseInfo,t).then(Object(i["a"])(e,n)).catch((function(t){console.error(t)}))},createBaseInfo:function(t,e,n){o.a.post(r["g"].contentMgmt.ArticleMgmt_createBaseInfo,t).then(Object(i["a"])(e,n)).catch((function(t){console.error(t)}))},delete:function(t,e,n){o.a.delete(r["g"].contentMgmt.ArticleMgmt_queryList,t).then(Object(i["a"])(e,n)).catch((function(t){console.error(t)}))},queryTypeList:function(t,e,n){o.a.get(r["g"].contentMgmt.ArticleMgmt_queryTypeList,{params:t}).then(Object(i["a"])(e,n)).catch((function(t){console.error(t)}))}}},e3b9:function(t,e,n){"use strict";var i=n("6a69"),a=n.n(i);a.a},e725:function(t,e,n){}}]);