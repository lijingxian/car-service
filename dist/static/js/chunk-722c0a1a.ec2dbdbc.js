(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-722c0a1a"],{1972:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"smart-to-shop-analysis"},[a("biz-header",{attrs:{views:t.views,filters:t.filters,operations:t.operations},on:{operate:t.operate,"filter-data-change":t.filterDataChange,"on-switch":t.onSwitch}}),"table"===t.view?a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{size:"small",stripe:"",border:"","tooltip-effect":"dark",height:t.height,data:t.currentTableData}},[a("el-table-column",{attrs:{prop:"date",label:"日期"}}),a("el-table-column",{attrs:{prop:"accessCount",label:"到店人数"}}),a("el-table-column",{attrs:{prop:"receptionCount",label:"接待人数"}}),a("el-table-column",{attrs:{prop:"memberReceptionCount",label:"接待会员数"}}),a("el-table-column",{attrs:{prop:"rate",label:"占比"}}),a("el-table-column",{attrs:{prop:"money",label:"消费金额"}})],1):t._e(),"table"===t.view?a("biz-pagination",{attrs:{pagination:t.pagination},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}):t._e(),"chart"===t.view?a("div",{staticClass:"chart-group"},[a("biz-chart",{attrs:{chartData:t.chartData,chartHeight:t.chartHeight,showSearch:!1}})],1):t._e()],1)},n=[],r=(a("99af"),a("a15b"),a("fb6a"),a("a434"),a("a9e3"),a("ade3")),s=a("04d3"),o=a("562e"),l=a("c596"),h=a("1ab1"),c=a("c466"),u={name:"SmartToShopAnalysis",data:function(){return{height:"700",chartHeight:"600px",view:"table",views:[{actived:!0,class:"iconfont biz-icon-liebiaoshitu",name:"table"},{actived:!1,class:"iconfont biz-icon-tongjishitu",name:"chart"}],operations:[{label:"导出",name:"export",type:"primary",disabled:!1}],filters:[{type:"select",value:"month",label:"查看类型",options:[{label:"月",value:"month"},{label:"天",value:"day"}]},{type:"daterange",value:[c["a"].halfYearAgo(),c["a"].nowDate()],label:"日期区间"}],loading:!1,tableData:[],chartData:{},multiSelected:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},open:!1,tabName:"first"}},components:{BizPagination:s["f"],BizHeader:s["d"],BizChart:o["a"]},methods:{operate:function(t){this[t]()},export:function(){var t={dateType:this.filters[0].value,beginDate:this.filters[2]?this.filters[2].value[0]:this.filters[1].value[0],endDate:this.filters[2]?this.filters[2].value[1]:this.filters[1].value[1]},e=[];for(var a in t)e.push("".concat(a,"=").concat(t[a]));var i="".concat(l["f"].SmartToShop.statisticsAnalysisExport,"?")+e.join("&");console.log("url: ",i),window.open(i)},dateConverter:function(t){return c["a"].dateConverter(new Date(t))},resize:function(){var t=this;this.$nextTick((function(){var e=document.documentElement.clientHeight||window.innerHeight;t.height=String(e-82)}))},onSwitch:function(t){switch(t){case"table":this.views[0].actived=!0,this.views[1].actived=!1,this.view="table";break;case"chart":this.views[0].actived=!1,this.views[1].actived=!0,this.view="chart";break;default:break}},filterDataChange:function(t){this.chartData=this.formatToChart(this.tableData),this.refresh()},handleSizeChange:function(t){this.pagination.pageSize=t},handleCurrentChange:function(t){this.pagination.currentPage=t},refresh:function(){var t=this,e=new Date(this.filters[this.filters.length-1].value[0]),a=new Date(this.filters[this.filters.length-1].value[1]);if("chart"===this.view&&"month"===this.filters[0].value&&e.getFullYear()===a.getFullYear()&&e.getMonth()===a.getMonth())return this.$message({message:"按月查询时起止时间请选择不同月份",showClose:!0,type:"warning"}),void(this.filters[0].value="day");if("chart"===this.view&&(this.filters[2].value[0]>this.today||this.filters[2].value[1]>this.today))return this.$message.warning({message:"不能选择将来的时间",showClose:!0}),this.filters[0].value="month",void this.getFormatDate();if("chart"===this.view&&"day"===this.filters[0].value&&(e.getFullYear()!==a.getFullYear()||e.getMonth()!==a.getMonth()))return this.$message({showClose:!0,message:"按日查询时开始与结束日期应在同一个月",type:"warning"}),void(this.filters[0].value="month");this.pagination={pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},this.loading=!0;var i={dateType:this.filters[0].value,beginDate:this.filters[2]?this.filters[2].value[0]:this.filters[1].value[0],endDate:this.filters[2]?this.filters[2].value[1]:this.filters[1].value[1]};h["a"].get(l["f"].SmartToShop.statisticsAnalysisQueryList,i).then((function(e){t.loading=!1,t.tableData=t.formatToList(e.data),t.chartData=t.formatToChart(t.tableData),t.pagination.total=Number(t.tableData.length)})).catch((function(e){t.loading=!1,t.$message({showClose:!0,message:e.errorMessage,type:"warning"}),console.log("ERR_INIT: ",e)}))},formatToList:function(t){var e=[];for(var a in t)e.push(Object.assign({date:a},t[a]));return e},formatToChart:function(t){for(var e=[],a=0;a<t.length;a++){var i;e.push((i={"日期":"day"===this.filters[0].value?t[a].date.slice(5,10):t[a].date},Object(r["a"])(i,this.kpiName[0],t[a][this.filters[1].value]),Object(r["a"])(i,this.kpiName[1],Number(t[a].rate.slice(0,-1))/100),i))}var n={type:"histogram",data:{columns:["日期",this.kpiName[0],this.kpiName[1]],rows:e},settings:{metrics:[this.kpiName[0],"money"===this.filters[1].value?"":this.kpiName[1]],showLine:this.kpiName[1],yAxisType:["normal","percent"],yAxisName:[this.kpiName[0],"money"===this.filters[1].value?"":this.kpiName[1]]}};return"receptionCount"===this.filters[1].value&&this.$set(n.settings,"axisSite",{right:[this.kpiName[1]]}),n},showMessage:function(t,e){this.$message({message:t,type:e,showClose:!0})}},created:function(){},mounted:function(){var t=this;this.resize(),h["a"].get(l["f"].SmartToShop.statisticsAnalysisQueryList,{}).then((function(e){t.showMessage("查看近期到店情况，可生成报表或进行图表分析。上次统计时间：".concat(e.lastTime),"info")})).catch(),this.refresh()},computed:{currentTableData:function(){return this.tableData.slice((this.pagination.currentPage-1)*this.pagination.pageSize,this.pagination.currentPage*this.pagination.pageSize)},kpiName:function(){return"money"===this.filters[1].value?["  消费金额"]:["  接待人数","会员占比"]}},watch:{view:function(t,e){var a={type:"select",value:"receptionCount",label:"统计指标",options:[{label:"接待人数",value:"receptionCount"},{label:"消费金额",value:"money"}]};3===this.filters.length?this.filters.splice(1,1):this.filters.splice(1,0,a)}}},g=u,f=(a("a50b"),a("2877")),v=Object(f["a"])(g,i,n,!1,null,null,null);e["default"]=v.exports},a50b:function(t,e,a){"use strict";var i=a("e523"),n=a.n(i);n.a},c466:function(t,e,a){"use strict";a("99af"),a("d3b7"),a("ac1f"),a("25f0"),a("5319");e["a"]={nowDate:function(){var t=new Date,e=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,a=t.getDate()+1<10?"0"+t.getDate():t.getDate();return t.getFullYear().toString()+"-"+e+"-"+a},getMonthDays:function(t){var e=new Date(Date.parse(t.replace(/-/g,"/"))),a=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,1),n=(i-a)/864e5;return n},halfYearAgo:function(t){var e="";return e=t?new Date(Date.parse(t.replace(/-/g,"/"))):new Date,console.log(e),e.setMonth(e.getMonth()-6),"".concat(e.getFullYear(),"-").concat(e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1,"-").concat(e.getDate()<10?"0"+e.getDate():e.getDate())},lastMonthDate:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1<10?"0"+t.getMonth():t.getMonth(),i=t.getDate()+1<10?"0"+t.getDate():t.getDate();return"00"===a&&(a="12",e--),e.toString()+"-"+a+"-"+i},nextMonthDate:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1,i=t.getDate(),n=parseInt(a)+1;13===n&&(e=parseInt(e)+1,n=1);var r=new Date(e,n,0);return r=r.getDate(),i>r&&(i=r),n<10&&(n="0"+n),e+"-"+n+"-"+i},lastYearDate:function(){var t=new Date,e=new Date(t.getFullYear()-1,t.getMonth(),t.getDate());return e.getFullYear()+"-"+this.convertToFullMode(e.getMonth()+1)+"-"+this.convertToFullMode(e.getDate())},lastTwoYearDate:function(){var t=new Date,e=new Date(t.getFullYear()+2,t.getMonth(),t.getDate());return e.getFullYear()+"-"+this.convertToFullMode(e.getMonth()+1)+"-"+this.convertToFullMode(e.getDate())},lastNYearDate:function(t,e){var a=new Date(t),i=new Date(a.getFullYear()+parseInt(e),a.getMonth(),a.getDate());return i.getFullYear()+"-"+this.convertToFullMode(i.getMonth()+1)+"-"+this.convertToFullMode(i.getDate())},dateConverter:function(t){return t instanceof Date?t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate()):t},timeConverter:function(t){return t instanceof Date?this.convertToFullMode(t.getHours())+":"+this.convertToFullMode(t.getMinutes())+":"+this.convertToFullMode(t.getSeconds()):t},shortTimeConverter:function(t){return t instanceof Date?this.convertToFullMode(t.getHours())+":"+this.convertToFullMode(t.getMinutes()):t},dateTimeConverter:function(t){return t instanceof Date?this.dateConverter(t)+" "+this.timeConverter(t):t},convertToFullMode:function(t){return t=t.toString(),1===t.length?"0"+t:t}}},e523:function(t,e,a){}}]);