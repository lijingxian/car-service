(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a84b68ea"],{"0943":function(e,t,a){"use strict";var i=a("1fac"),n=a.n(i);n.a},"0a05":function(e,t,a){},"1dad":function(e,t,a){"use strict";var i=a("fdfa"),n=a.n(i);n.a},"1fac":function(e,t,a){},2086:function(e,t,a){"use strict";var i=a("2497"),n=a("bc3a"),r=a.n(n),o=a("c596");t["a"]={getList:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.getMemberCardList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getRightsList:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listDistributeRights:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.listDistributeRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listCardTemplate:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.listCardTemplate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistVbean:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.getlistVbean,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getIntegralList:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.getIntegralList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listProduct:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.listProduct,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryUserRights:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.queryUserRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryUserCoupons:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.queryUserCoupons,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listByRights:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.listByRights,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardInfo:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.getVipCardInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardTemplate:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.getVipCardTemplate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},memberRankList:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.memberRankList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},setting:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.setting,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},settingUpdate:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.setting,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryPeople:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.queryPeople,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delete:function(e,t,a){r.a.delete(o["g"].memberCardMgmt.memberCard.deleteManage,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},verification:function(e,t,a){r.a.post(o["g"].memberCardMgmt.vipRights.verification,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateTemplate:function(e,t,a){r.a.put(o["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createTemplate:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.updateTemplate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delTemplate:function(e,t,a){r.a.delete(o["g"].memberCardMgmt.memberCard.updateTemplate,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},distributeRights:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.distributeRights,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},distributeAssignedRights:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.distributeAssignedRights,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateVipCardState:function(e,t,a){r.a.put(o["g"].memberCardMgmt.memberCard.updateVipCardState,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createVipCard:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.createVipCard,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createBean:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.createBean,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createPoint:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.createPoint,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},addScore:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.addScore,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},reduceDeposit:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.reduceDeposit,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistUpgrade:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.getlistUpgrade,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getlistStore:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.getlistStore,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},updateGrade:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.updateGrade,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getVipCardGradeInfo:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.getVipCardGradeInfo,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},editVipCardGrade:function(e,t,a){r.a.put(o["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},addVipCardGrade:function(e,t,a){r.a.post(o["g"].memberCardMgmt.memberCard.VipCardGrade,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},delVipCardGrade:function(e,t,a){r.a.delete(o["g"].memberCardMgmt.memberCard.VipCardGrade,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},listAuthority:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.listAuthority,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},vipRightsList:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.getList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryrightsClass:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.get,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},getFirstClassifies:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.getFirstClassifies,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponList:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.rightsCouponList,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},queryRightsCoupon:function(e,t,a){r.a.get(o["g"].memberCardMgmt.vipRights.queryRightsCoupon,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},memberCardBox:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.memberCardBox,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},editRightsClass:function(e,t,a){r.a.put(o["g"].memberCardMgmt.vipRights.edit,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},createRightsClass:function(e,t,a){r.a.post(o["g"].memberCardMgmt.vipRights.add,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponUpdate:function(e,t,a){r.a.put(o["g"].memberCardMgmt.vipRights.rightsCouponUpdate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},rightsCouponCreate:function(e,t,a){r.a.post(o["g"].memberCardMgmt.vipRights.rightsCouponCreate,e).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},deleteRightscoupon:function(e,t,a){r.a.delete(o["g"].memberCardMgmt.vipRights.deleteRightscoupon,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},deleteRights:function(e,t,a){r.a.delete(o["g"].memberCardMgmt.vipRights.delete,{data:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))},certificate:function(e,t,a){r.a.get(o["g"].memberCardMgmt.memberCard.certificate,{params:e}).then(Object(i["a"])(t,a)).catch((function(e){console.error(e)}))}}},2119:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"biz-avatar-uploader-multi"},[a("div",{staticClass:"el-upload-list el-upload-list--picture-card"},[e._l(e.value,(function(t){return a("div",{key:t.index,staticClass:"el-upload-list__item is-success",attrs:{tabindex:"0"}},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:t,alt:""}}),a("span",{staticClass:"el-upload-list__item-actions"},[a("span",{staticClass:"el-upload-list__item-preview",on:{click:function(a){return e.handlePictureCardPreview(t)}}},[a("i",{staticClass:"el-icon-zoom-in"})]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isShowDelete,expression:"isShowDelete"}],staticClass:"el-upload-list__item-delete",on:{click:function(a){return e.handleRemove(t)}}},[a("i",{staticClass:"el-icon-delete"})])])])})),e.showUploader?a("el-upload",{ref:"upload",class:e.disabled?"avatar-uploader-disabled":"avatar-uploader",style:e.avatarStyle,attrs:{multiple:"","show-file-list":!1,accept:"image/*",limit:Number(e.limit),"file-list":e.fileList,data:e.fileData,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,name:"file",action:"/admin/file/uploads.jhtml",disabled:e.disabled}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:e.plusStyle})]):e._e()],2),a("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},n=[],r=(a("99af"),a("d81d"),a("a434"),a("ac1f"),a("1276"),{name:"ImgUploader",props:{value:{type:Array,default:function(){return[]}},imageForm:{type:Array,default:function(){return[]}},showUploader:{type:Boolean,default:function(){return!0}},size:{type:Object,default:function(){return{width:100,height:100}}},limit:{default:"9"},disabled:{type:Boolean,default:function(){return!1}},isShowDelete:{type:Boolean,default:function(){return!0}}},data:function(){return{fileData:{type:"0"},fileList:[],dialogVisible:!1,dialogImageUrl:""}},methods:{handleSuccess:function(e){var t=this.value.concat(e.fis[0].url);this.$emit("input",t)},handleExceed:function(e,t){this.$message.warning("只能上传".concat(this.limit,"张图片"))},handleRemove:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.removePic(e)}))},removePic:function(e){for(var t=this.value,a=0;a<t.length;a++)t[a]===e&&t.splice(a,1);this.$emit("input",t)},handlePictureCardPreview:function(e){this.dialogImageUrl=e,this.dialogVisible=!0}},computed:{plusStyle:function(){return{"line-height":this.size.height+"px"}},avatarStyle:function(){return{height:this.size.height+"px",width:this.size.width+"px"}}},watch:{value:function(e,t){console.log("value: ",this.value),this.fileList=e.map((function(e){return{name:e.split("/")[e.split("/").length-1],url:e}}))}},components:{}}),o=r,s=(a("d74a"),a("2877")),l=Object(s["a"])(o,i,n,!1,null,null,null);t["a"]=l.exports},"21c5":function(e,t,a){},4382:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logistic-following"},[a("div",{staticClass:"product-info"},[a("div",{staticClass:"img"},[a("img",{attrs:{src:e.image||e.defaultProductImg}})]),a("div",{staticClass:"info"},[a("div",{staticClass:"i-item"},[e._v("物流状态： "),a("span",{staticClass:"l-state"},[e._v(e._s(e.logisticState))])]),a("div",{staticClass:"i-item"},[e._v("物流公司："+e._s(e.logistics))]),a("div",{staticClass:"i-item"},[e._v("快递单号："+e._s(e.expressSn))])])]),e.shippingTraces&&e.shippingTraces.length>0?a("div",{staticClass:"logistic-info"},[a("div",{staticClass:"track-list"},[a("ul",e._l(e.shippingTraces,(function(t){return a("li",{key:t.id},[a("i",{staticClass:"node-icon"}),a("span",{staticClass:"txt"},[e._v(e._s(t.station))]),a("span",{staticClass:"time"},[e._v(e._s(t.happenTime))])])})),0)])]):e._e()])},n=[],r=a("5530"),o=a("2f62"),s=a("1ab1"),l=a("c596"),c=a("e83a"),d=a.n(c),u={name:"LogisticsFollowing",components:{},data:function(){return{shippingSn:"",defaultProductImg:d.a,shippingTraces:[],state:"",logistics:"",expressSn:"",image:""}},computed:Object(r["a"])(Object(r["a"])(Object(r["a"])({},Object(o["c"])(["getUser"])),Object(o["c"])("Order",["curApplySaleItem","orderInfo"])),{},{logisticState:function(){switch(this.state){case"0":return"无轨迹";case"1":return"已揽收";case"2":return"在途中";case"201":return"到达派件城市";case"3":return"签收";case"4":return"问题件";default:return""}}}),props:{sn:{type:String,default:""}},watch:{},created:function(){},methods:{getLogisticsInfo:function(){var e=this,t={methodName:"QueryLogistics",clientType:"2",shopId:this.getUser.shop.id,userId:this.getUser.id,shippingSn:this.sn};s["a"].get(l["g"].hypermarketMgmt.logistics,t).then((function(t){console.log("物流追踪",t),e.state=t.shipping.state,e.image=t.shipping.shippingItems.length>0?t.shipping.shippingItems[0].image:"",e.logistics=t.shipping.logistics,e.expressSn=t.shipping.expressSn,e.shippingTraces=t.shipping.shippingTraces})).catch((function(t){e.$message.warning(t.errorMessage)}))}}},p=u,m=(a("b15b"),a("2877")),g=Object(m["a"])(p,i,n,!1,null,null,null);t["a"]=g.exports},"443b":function(e,t,a){"use strict";a("4de4");var i=a("c596"),n=a("1ab1"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":"",visible:e.visible,title:"自定义列","custom-class":"biz-columns",width:"500px"},on:{close:e.onClose}},[a("div",{staticClass:"columns-wrap"},[a("biz-flex-table",{ref:"table",attrs:{checkable:!1,tableData:e.tableData},on:{"selection-change":e.selectionChangeHandler}},[a("el-table-column",{attrs:{type:"selection",width:"50",selectable:e.getSelectable}}),a("el-table-column",{attrs:{label:"信息",prop:"name"}}),a("el-table-column",{attrs:{prop:"tag",label:"排序"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.$index;return[a("el-button",{attrs:{icon:"el-icon-sort-up",type:"text",disabled:0===i},on:{click:function(t){return e.onUp(i)}}}),a("el-button",{attrs:{icon:"el-icon-sort-down",type:"text",disabled:i===e.tableData.length-1},on:{click:function(t){return e.onBottom(i)}}})]}}])})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.onClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v("确 定")])],1)])},o=[],s=(a("7db0"),a("a434"),a("b85c")),l=a("04d3"),c={name:"biz-columns",components:{BizFlexTable:l["c"]},props:{visible:Boolean,tableId:String},data:function(){return{id:"",tableName:"",selections:[],tableData:[]}},computed:{},watch:{visible:function(e){e?this.makeRowDisplayable():this.saveSelection()},tableId:function(){this.getTableColumns()}},mounted:function(){this.getTableColumns()},methods:{getTableColumns:function(){var e=this;n["a"].get(i["g"].user.columns,{tableId:this.tableId}).then((function(t){e.tableData=t.data.columnDatas,e.id=t.data.id,e.tableName=t.data.tableName}))},getSelectable:function(e){return e.isEditable},selectionChangeHandler:function(e){this.selections=e},saveSelection:function(){var e,t=this,a=Object(s["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var i=e.value;i.displayable=!1}}catch(l){a.e(l)}finally{a.f()}var n,r=Object(s["a"])(this.selections);try{var o=function(){var e=n.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(r.s();!(n=r.n()).done;)o()}catch(l){r.e(l)}finally{r.f()}},onUp:function(e){this.tableData[e]=this.tableData.splice(e-1,1,this.tableData[e])[0]},onBottom:function(e){this.tableData[e]=this.tableData.splice(e+1,1,this.tableData[e])[0]},onClose:function(){this.$emit("update:visible",!1)},update:function(){var e,t=this,a=Object(s["a"])(this.tableData);try{for(a.s();!(e=a.n()).done;){var r=e.value;r.displayable=!1}}catch(u){a.e(u)}finally{a.f()}var o,l=Object(s["a"])(this.selections);try{var c=function(){var e=o.value;t.tableData.find((function(t){return t.id===e.id})).displayable=!0};for(l.s();!(o=l.n()).done;)c()}catch(u){l.e(u)}finally{l.f()}var d={columnDatas:this.tableData,id:this.id,tableId:this.tableId,tableName:this.tableName};console.log(d),n["a"].put(i["g"].user.columns,d).then((function(e){t.$emit("update"),t.$emit("update:visible",!1)}))},makeRowDisplayable:function(){var e=this;setTimeout((function(){var t,a=Object(s["a"])(e.tableData);try{for(a.s();!(t=a.n()).done;){var i=t.value;e.$refs.table.$refs.table.toggleRowSelection(i,i.displayable)}}catch(n){a.e(n)}finally{a.f()}}),20)}}},d=c,u=(a("ec6b"),a("2877")),p=Object(u["a"])(d,r,o,!1,null,null,null),m=p.exports,g=m;t["a"]={components:{BizColumnOperation:l["a"],BizColumns:g},data:function(){return{columnsSettingVisible:!1,columns:[]}},created:function(){this.getTableId(),this.getColumns()},methods:{onCustomColumns:function(){this.columnsSettingVisible=!0},getColumns:function(){var e=this;console.log(12),n["a"].get(i["A"].columns,{tableId:this.tableId}).then((function(t){e.columns=[],setTimeout((function(){e.columns=t.data.columnDatas.filter((function(e){return e.displayable})),e.$refs.table&&setTimeout((function(){e.$refs.table.doLayout()}),50)}),20)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getTableId:function(){}}}},"5e5c":function(e,t,a){"use strict";var i=a("c6d7"),n=a.n(i);n.a},"650f":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"receipt-mgmt"},[a("div",{staticClass:"toggle-btn",on:{click:e.isShow}},[e._v(" "+e._s(e.toggleRecommendTxt)+" "),a("div",{staticClass:"iconfont biz-icon-i-web-zd1",class:{"rotate-180":e.showRecommend}})]),a("biz-flex-table",{attrs:{operations:e.operations,loading:e.loading,tableData:e.tableData,pagination:e.pagination,filters:e.filters},on:{"filter-data-change":e.filterDataChange,operate:e.operate,"selection-change":e.handleSelectionChange,"row-click":e.rowClick,"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{label:"单据","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("div",[e._v(" "+e._s(t.row.sn)+" ")]),a("div",[e._v(" 创建日期："+e._s(t.row.createDate)+" ")]),a("div",[e._v(" 状态："+e._s(e.formatStatus(t.row.state))+" ")])])]}}])}),a("el-table-column",{attrs:{label:"往来","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("div",[e._v(" 往来方："+e._s(t.row.relateUnit.name)+" ")]),a("div",[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.clickRelateBill(a,t.row)}}},[a("span",{staticStyle:{"white-space":"normal"}},[e._v("往来单据："+e._s(t.row.relateBill&&t.row.relateBill.sn?t.row.relateBill.sn:""))])])],1),a("div",[e._v(" 状态："+e._s(e.formatStatus(t.row.state))+" ")])])]}}])}),a("el-table-column",{attrs:{label:"支付"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("div",[e._v(" 支付方式："+e._s(t.row.paymentMethod.name)+" ")]),a("div",[e._v(" 收款方式："+e._s(t.row.paymentType.name)+" ")]),a("div",[e._v(" 收款金额："+e._s(t.row.amount)+" ")])])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"===t.row.state?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.handleCommitClick(t.row.id)}}},[e._v("提交")]):e._e(),"0"===t.row.state&&e.hasAuthDel?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.handleDeleteClick(a,t.row)}}},[e._v("删除")]):e._e()]}}])})],1),a("biz-popup-tabs",{attrs:{open:e.open},on:{close:function(t){e.open=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[e.openRelateBill?e._e():a("el-tab-pane",{attrs:{label:"单据信息",name:"info"}},[a("base-info",{ref:"baseInfo",attrs:{itemId:e.itemId,isEdit:e.isEdit},on:{operationSuccess:e.operationSuccess}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openReview},on:{close:function(t){e.openReview=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"评价",name:"reviewinfo"}},[a("my-evaluate",{ref:"reviewinfo",attrs:{orderId:e.orderId,editable:e.editable},on:{operationSuccess:e.operationSuccess}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openRelateBill},on:{close:function(t){e.openRelateBill=!1}},model:{value:e.relateBillSn,callback:function(t){e.relateBillSn=t},expression:"relateBillSn"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"baseinfo"}},[a("purchase-order-info",{ref:"orderinfo",attrs:{orderId:e.relateBillId,isEdit:e.isEdit},on:{operationSuccess:e.refresh,closeTabByLogistics:e.closeTabByLogistics,closeTabByEvaluate:e.closeTabByEvaluate}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openRelateBillOrder},on:{close:function(t){e.openRelateBillOrder=!1}},model:{value:e.relateBillOrder,callback:function(t){e.relateBillOrder=t},expression:"relateBillOrder"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"baseinfo"}},[a("order-base-info",{attrs:{itemId:e.relateBillOrderId,isEdit:e.isEdit},on:{operationSuccess:e.refresh}})],1),a("el-tab-pane",{attrs:{label:"商品信息",name:"productinfo"}},[a("order-product-info",{attrs:{itemId:e.relateBillProductId,isEdit:e.isEdit},on:{operationSuccess:e.refresh}})],1)],1),a("biz-popup-tabs",{attrs:{open:e.openLogistics},on:{close:function(t){e.openLogistics=!1}},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[a("el-tab-pane",{attrs:{label:"物流追踪",name:"loginfo"}},[a("logistics-following",{ref:"logistics",attrs:{orderId:e.logisticsId,sn:e.sn}})],1)],1),a("biz-columns",{attrs:{visible:e.columnsSettingVisible,tableId:e.tableId},on:{"update:visible":function(t){e.columnsSettingVisible=t},update:e.getColumns}})],1)},n=[],r=(a("99af"),a("4160"),a("caad"),a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("ac1f"),a("2532"),a("3ca3"),a("466d"),a("1276"),a("159b"),a("ddb0"),a("2b3d"),a("5530")),o=(a("96cf"),a("1da1")),s=a("04d3"),l=a("7132"),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("biz-grid",{staticClass:"receipt-mgmt-base-info"},[e.isEdit?i("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"125px",size:"small",disabled:!e.isEdit,"inline-message":!0}},[this.itemId?i("el-form-item",{attrs:{label:"单据编号",prop:"sn"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.sn,callback:function(t){e.$set(e.form,"sn",t)},expression:"form.sn"}})],1):e._e(),i("el-form-item",{attrs:{label:"业务类型",prop:"type"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择业务类型",disabled:!0},on:{change:e.typeChange},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.accountInTypeList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{staticClass:"isRequired",attrs:{label:"往来方",prop:"relateUnitType"}},[i("el-select",{attrs:{placeholder:"",disabled:"0"===this.form.type},on:{change:e.relatUnitTypeChange},model:{value:e.form.relateUnitType,callback:function(t){e.$set(e.form,"relateUnitType",t)},expression:"form.relateUnitType"}},e._l(e.relateUnitTypeList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),"0"===e.form.relateUnitType?i("el-input",{attrs:{prop:"relateUnit",placeholder:"请选择供应商"},on:{focus:function(t){e.showSupplierDialog=!0}},model:{value:e.form.relateUnit.name,callback:function(t){e.$set(e.form.relateUnit,"name",t)},expression:"form.relateUnit.name"}}):e._e(),"1"===e.form.relateUnitType?i("el-input",{attrs:{prop:"relateUnit",placeholder:"请选择会员"},on:{focus:function(t){e.showMemberDialog=!0}},model:{value:e.form.relateUnit.name,callback:function(t){e.$set(e.form.relateUnit,"name",t)},expression:"form.relateUnit.name"}}):e._e(),"2"===e.form.relateUnitType?i("el-input",{attrs:{placeholder:"请选择代理商"},on:{focus:function(t){e.showAgentDialog=!0}},model:{value:e.form.relateUnit.name,callback:function(t){e.$set(e.form.relateUnit,"name",t)},expression:"form.relateUnit.name"}}):e._e()],1),"2"!==e.form.type?i("el-form-item",{attrs:{label:"关联单据",prop:"relateBill"}},[i("el-input",{attrs:{placeholder:"请选择关联单据",disabled:""===e.form.relateUnit.name},on:{focus:function(t){e.showRelateDialog=!0}},model:{value:e.form.relateBill.sn,callback:function(t){e.$set(e.form.relateBill,"sn",t)},expression:"form.relateBill.sn"}})],1):e._e(),i("el-form-item",{attrs:{label:"收款金额",prop:"amount"}},[i("el-input",{attrs:{placeholder:""},model:{value:e.form.amount,callback:function(t){e.$set(e.form,"amount",t)},expression:"form.amount"}})],1),i("el-form-item",{staticClass:"isRequired",attrs:{label:"支付方式",prop:"paymentMethod"}},[i("el-select",{attrs:{placeholder:"",disabled:!0},model:{value:e.form.paymentMethod.name,callback:function(t){e.$set(e.form.paymentMethod,"name",t)},expression:"form.paymentMethod.name"}},e._l(e.paymentMethodList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"付款方式",prop:"paymentType"}},[i("el-select",{attrs:{placeholder:""},on:{change:e.paymentTypeChange},model:{value:e.form.paymentType.name,callback:function(t){e.$set(e.form.paymentType,"name",t)},expression:"form.paymentType.name"}},e._l(e.paymentTypeList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id,disabled:e.disabled}})})),1)],1),"会员卡余额"===e.form.paymentType.name?i("el-form-item",{staticClass:"isRequired",attrs:{label:"会员卡",prop:"userCard"}},[i("el-select",{attrs:{placeholder:"请选择会员卡"},model:{value:e.form.userCard.id,callback:function(t){e.$set(e.form.userCard,"id",t)},expression:"form.userCard.id"}},e._l(e.listExistCard,(function(e,t){return i("el-option",{key:t,attrs:{label:e.template.name,value:e.id}})})),1)],1):e._e(),"刷卡"===e.form.paymentType.name||"汇款"===e.form.paymentType.name?i("el-form-item",{attrs:{label:"往来方银行",prop:"relateUnitBank"}},[i("el-select",{attrs:{placeholder:"请选择往来方银行"},model:{value:e.form.relateUnitBank,callback:function(t){e.$set(e.form,"relateUnitBank",t)},expression:"form.relateUnitBank"}},[i("el-option",{attrs:{label:"中国工商银行",value:"中国工商银行"}}),i("el-option",{attrs:{label:"中国农业银行",value:"中国农业银行"}}),i("el-option",{attrs:{label:"中国银行",value:"中国银行"}}),i("el-option",{attrs:{label:"中国建设银行",value:"中国建设银行"}}),i("el-option",{attrs:{label:"交通银行",value:"交通银行"}}),i("el-option",{attrs:{label:"中信银行",value:"中信银行"}}),i("el-option",{attrs:{label:"广发银行",value:"广发银行"}}),e._v("、 "),i("el-option",{attrs:{label:"深圳发展银行",value:"深圳发展银行"}}),i("el-option",{attrs:{label:"招商银行",value:"招商银行"}}),i("el-option",{attrs:{label:"中国光大银行",value:"中国光大银行"}}),i("el-option",{attrs:{label:"华夏银行",value:"华夏银行"}}),i("el-option",{attrs:{label:"中国民生银行",value:"中国民生银行"}}),i("el-option",{attrs:{label:"兴业银行",value:"兴业银行"}}),i("el-option",{attrs:{label:"上海浦东发展银行",value:"上海浦东发展银行"}}),i("el-option",{attrs:{label:"恒丰银行",value:"恒丰银行"}}),i("el-option",{attrs:{label:"浙商银行",value:"浙商银行"}}),i("el-option",{attrs:{label:"渤海银行",value:"渤海银行"}}),i("el-option",{attrs:{label:"中国邮政储蓄银行",value:"中国邮政储蓄银行"}}),i("el-option",{attrs:{label:"其他银行",value:"其他银行"}})],1)],1):e._e(),"刷卡"===e.form.paymentType.name||"汇款"===e.form.paymentType.name?i("el-form-item",{attrs:{label:"往来方账号",prop:"relateUnitAccount"}},[i("el-input",{attrs:{placeholder:""},model:{value:e.form.relateUnitAccount,callback:function(t){e.$set(e.form,"relateUnitAccount",t)},expression:"form.relateUnitAccount"}})],1):e._e(),e.itemId?i("el-form-item",{attrs:{label:"状态",prop:"state"}},[i("el-input",{attrs:{value:e.stateFormatter,disabled:!0}})],1):e._e(),e.itemId?i("el-form-item",{attrs:{label:"操作者",prop:"creator"}},[i("el-input",{attrs:{placeholder:"",disabled:!0},model:{value:e.form.creator,callback:function(t){e.$set(e.form,"creator",t)},expression:"form.creator"}})],1):e._e(),e.itemId?i("el-form-item",{attrs:{label:"创建时间",prop:"createDate"}},[i("el-input",{attrs:{placeholder:"",disabled:!0},model:{value:e.form.createDate,callback:function(t){e.$set(e.form,"createDate",t)},expression:"form.createDate"}})],1):e._e(),i("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[i("el-input",{attrs:{type:"textarea",placeholder:""},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],1),i("biz-dialog-selector",{staticClass:"memberDialog",attrs:{title:"选择会员",visibility:e.showMemberDialog,appendToBody:!0,loading:e.dialogLoading,tableData:e.dialogMemberTableData,pagination:e.dialogPagination,selectionMode:"single",filters:e.dialogMemberFilters,isClear:!1},on:{"update:visibility":function(t){e.showMemberDialog=t},confirmed:e.handleMemberConfirmed,open:e.opened,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange}},[i("el-table-column",{attrs:{label:"用户名",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"customer-info"},[t.row.head?i("img",{attrs:{src:t.row.head}}):i("img",{attrs:{src:a("624d")}}),i("div",{staticClass:"wrapper"},[i("div",{staticClass:"title"},[e._v(e._s(t.row.name))]),i("div",{staticClass:"gender"},["0"===t.row.gender?i("i",{staticClass:"male iconfont biz-icon-i-web-m"}):e._e(),"1"===t.row.gender?i("i",{staticClass:"female iconfont biz-icon-i-web-f"}):e._e(),"2"===t.row.gender?i("i",{staticClass:"none iconfont biz-icon-i-web-bm"}):e._e(),i("span",[e._v(e._s(t.row.mobile))])])])])]}}])}),i("el-table-column",{attrs:{label:"状态",formatter:e.stateConverter}}),i("el-table-column",{attrs:{prop:"",label:"店铺名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",e._l(t.row.shops,(function(t,a){return i("div",{key:a,staticClass:"customer-info"},[e._v(e._s(t.name))])})),0)]}}])}),i("el-table-column",{attrs:{prop:"lastLoginIp",label:"最后登录地址",formatter:e.ipConverter}}),i("el-table-column",{attrs:{prop:"lastLoginDate",label:"最后登录时间",formatter:e.loginDateConverter,sortable:"custom"}})],1),i("biz-dialog-selector",{staticClass:"supplierDialog",attrs:{title:"选择供应商",visibility:e.showSupplierDialog,appendToBody:!0,isClear:!1,tableData:e.dialogSupplierTableData,pagination:e.dialogPagination,selectionMode:"single",filters:e.dialogSupplierFilters},on:{"update:visibility":function(t){e.showSupplierDialog=t},open:e.openedSupplier,confirmed:e.handleSupplierConfirmed,filterDataChange:e.supplierFilterDataChange,pageSizeChange:e.supplierPageSizeChange,currentPageChange:e.supplierCurrentPageChange}},[i("el-table-column",{attrs:{label:"供应商名称",width:"200px",prop:"name"}}),i("el-table-column",{attrs:{prop:"address",label:"地址"}}),i("el-table-column",{attrs:{prop:"phone",label:"电话"}})],1),i("biz-dialog-selector",{staticClass:"agentDialog",attrs:{title:"选择代理商",visibility:e.showAgentDialog,appendToBody:!0,tableData:e.dialogAgentTableData,pagination:e.dialogPagination,selectionMode:"single",isClear:!1,filters:e.dialogAgentFilters},on:{"update:visibility":function(t){e.showAgentDialog=t},open:e.openedAgent,confirmed:e.handleAgentConfirmed,filterDataChange:e.agentFilterDataChange,pageSizeChange:e.agentPageSizeChange,currentPageChange:e.agentCurrentPageChange}},[i("el-table-column",{attrs:{label:"代理商名称",width:"200px",prop:"name"}}),i("el-table-column",{attrs:{prop:"address",label:"地址"}}),i("el-table-column",{attrs:{prop:"phone",label:"电话"}})],1),i("biz-dialog-selector",{staticClass:"supplierDialog",attrs:{title:"选择关联单据",visibility:e.showRelateDialog,appendToBody:!0,tableData:e.dialogRelateTableData,pagination:e.dialogPagination,selectionMode:"single",isClear:!1,filters:e.dialogRelateFilters},on:{"update:visibility":function(t){e.showRelateDialog=t},open:e.openedRelate,confirmed:e.handleRelateConfirmed,filterDataChange:e.dialogFilterDataChange,pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange}},[i("el-table-column",{attrs:{prop:"sn",label:"编号"}}),i("el-table-column",{attrs:{prop:"billType",label:"单据类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.typeFormatter(t.row.billType)))]}}])}),i("el-table-column",{attrs:{label:"商品信息","min-width":"185"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[i("div",{staticStyle:{width:"100%","margin-right":"30px"}},e._l(t.row.itemDatas,(function(t){return i("div",{key:t.id,staticClass:"product-info"},[i("div",{staticClass:"wrapper"},[i("div",{staticClass:"titleClass",attrs:{title:t.name}},[e._v(" "+e._s(t.productName)+" "),""!==t.specValue?i("div",[e._v(" ("+e._s(t.specValue)+")")]):e._e()])])])})),0)])]}}])}),i("el-table-column",{attrs:{prop:"relatePartnerName",label:"往来方"}}),i("el-table-column",{attrs:{label:"单据总金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("￥"+e._s(t.row.totalFee))]}}])})],1)],1)},d=[],u=(a("a434"),a("5319"),a("b85c")),p=a("f36f"),m=a("8330"),g=a("af3f"),h=a("c596"),f=a("1ab1"),b=a("c466"),v=a("e42c"),y={stateConverter:function(e){return"0"===e.enableState?"停用":"1"===e.enableState?"启用":"--"},stateSupplierConverter:function(e){return"0"===e.enabled?"X":"1"===e.enabled?"√":"--"},createDateConverter:function(e){if(e.createDate){e.createDate=e.createDate.replace(/-/g,"/");var t=new Date(e.createDate);return b["a"].dateConverter(t)}return"--"},loginDateConverter:function(e){if(e.lastLoginDate){e.lastLoginDate=e.lastLoginDate.replace(/-/g,"/");var t=new Date(e.lastLoginDate);return b["a"].dateConverter(t)}return"--"},ipConverter:function(e){return e.lastLoginIp?e.lastLoginIp:"--"}},C={name:"ReceiptMgmtBaseInfo",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){var e=this,t=function(t,a,i){""===e.form.amount&&i(new Error("请输入有效的收款金额")),Number(e.form.amount)>=0?i():Number(e.form.amount<0)?i(new Error("收款金额不能为负数")):i(new Error("收款金额必须为数字值"))},a=function(t,a,i){""===e.form.relateUnit.id?i(new Error("请选择往来方")):i()},i=function(t,a,i){""===e.form.relateBill.id?i(new Error("请选择关联单据")):i()},n=function(t,a,i){""===e.form.paymentType.id?i(new Error("请选择付款方式")):i()};return{loading:!1,operations:[{label:"保存",name:"save",type:"primary",auth:["admin:finance.payment.edit"]}],rules:{type:[{required:!0,message:"请选择业务类型",trigger:["blur","change"]}],relateUnitType:[{required:!0,trigger:"blur",validator:a}],relateBill:[{required:!0,trigger:"blur",validator:i}],amount:[{required:!0,trigger:"blur",validator:t}],paymentType:[{required:!0,trigger:"blur",validator:n}],relateUnitBank:[{required:!0,trigger:"blur",message:"请选择往来方银行"}],relateUnitAccount:[{required:!0,trigger:"blur",message:"请输入往来方账号"}]},form:this.resetForm(),showSupplierDialog:!1,showMemberDialog:!1,showAgentDialog:!1,showRelateDialog:!1,dialogLoading:!0,dialogMemberTableData:[],dialogSupplierTableData:[],dialogAgentTableData:[],dialogRelateTableData:[],dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},isCreated:!1,dialogMemberFilters:[{type:"input",label:"",placeholder:"请输入会员姓名/电话",name:"searchValue",value:""}],dialogSupplierFilters:[{type:"input",label:"",placeholder:"请输入供应商名称",name:"searchValue",value:""}],dialogAgentFilters:[{type:"input",label:"",placeholder:"请输入代理商名称",name:"searchValue",value:""}],dialogRelateFilters:[{type:"input",label:"",placeholder:"请输入单据编号/商品名称",name:"searchValue",value:""}],paymentMethodId:"",relateUnitTypeList:[],accountInTypeList:[],financeBillStateList:[],paymentMethodList:[],paymentTypeList:[],listExistCard:[],userId:""}},components:{BizGrid:p["a"],BizSaveButton:m["a"],BizDialogSelector:g["a"]},computed:{stateFormatter:function(){switch(this.form.state){case"0":return"已创建";case"1":return"已提交";default:return"--"}}},created:function(){this.queryBackgroundInfo(),this.getPaymentMethods()},methods:Object(r["a"])(Object(r["a"])({},y),{},{operate:function(e){this[e]()},resetForm:function(){return{id:"",type:"2",amount:"",relateUnitType:"0",relateUnit:{id:""},relateUnitAccount:"",relateUnitBank:"",relateBill:{id:""},remarks:"",userCard:{id:"",template:{id:"",name:""}},paymentMethod:{id:"",name:""},paymentType:{id:"",name:""}}},clear:function(){this.form=this.resetForm(),this.listExistCard=[],this.$refs.form.resetFields(),this.getPaymentMethods()},typeFormatter:function(e){var t={0:"采购申请单",1:"采购退货申请单",2:"采购订单",3:"采购退货订单",4:"入库单",5:"出库单",6:"收款单",7:"付款单",8:"销售订单",9:"销售退款订单"};return t[e]},typeChange:function(e){"0"===e&&(this.form.relateUnitType="0"),this.form.relateUnit.name="",this.form.relateUnit.id="",this.form.relateBill.sn="",this.form.amount="",this.form.paymentType.id="",this.form.userCard.id="",this.form.relateUnitBank="",this.form.relateUnitAccount="",this.$refs.form.clearValidate("type")},refresh:function(e){var t=this;this.loading=!0;var a={id:e};f["a"].get(h["g"].finance.receiptMgmt.receipt,a).then((function(e){if(t.loading=!1,e.data){if("1"===e.data.relateUnitType){t.listExistCardTemplate(e.data.relateUnit.id);var a,i=Object(u["a"])(t.listExistCard);try{for(i.s();!(a=i.n()).done;){var n=a.value;n.id===e.data.userCard.id&&(t.form.userCard.template.name=n.template.name+" ¥"+n.balance)}}catch(r){i.e(r)}finally{i.f()}}t.form=Object.assign(t.resetForm(),e.data)}else t.clear()})).catch((function(e){t.loading=!1,console.log("ERR_REFRESH: ",e),t.$message.warning(e.errorMessage)}))},queryMemberList:function(e){var t=this;v["a"].memberList(e,(function(e){t.dialogLoading=!1,t.dialogMemberTableData=e.content,t.dialogPagination.total=Number(e.total)}),(function(e){console.log(e),console.log("code错误")}))},querySupplierList:function(e){var t=this;f["a"].get(h["g"].invoicing.supplierMgmt.shopSupplierList,e).then((function(e){t.dialogSupplierTableData=e.dataList;var a,i=Object(u["a"])(t.dialogSupplierTableData);try{for(i.s();!(a=i.n()).done;){var n,r=a.value,o=Object(u["a"])(t.shopList);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.shopId===s.id&&(r.shopName=s.name)}}catch(l){o.e(l)}finally{o.f()}}}catch(l){i.e(l)}finally{i.f()}t.dialogPagination.total=Number(e.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},getAgent:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogAgentFilters[0].value,shopId:window.top.SHOP_ID||"",cooperationType:"1",state:""};f["a"].get(h["g"].invoicing.supplierMgmt.shopSupplierList,t).then((function(t){e.dialogAgentTableData=t.dataList,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},queryRelateList:function(e){var t=this;f["a"].get(h["g"].finance.receiptMgmt.relateBill,e).then((function(e){var a,i=Object(u["a"])(e.content);try{for(i.s();!(a=i.n()).done;){var n=a.value;t.dialogRelateTableData.push(n)}}catch(r){i.e(r)}finally{i.f()}t.dialogPagination.total=Number(t.dialogRelateTableData.length)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},opened:function(){this.dialogMemberTableData=[],this.dialogMemberFilters[0].value="",this.queryMemberList(this.getDialogQueryParams())},openedAgent:function(){this.dialogAgentTableData=[],this.getAgent()},openedSupplier:function(){this.shopList=[],this.dialogSupplierTableData=[],this.dialogSupplierFilters[0].value="",this.querySupplierList(this.getSupplierDialogParams())},openedRelate:function(){this.dialogRelateTableData=[],this.dialogRelateFilters[0].value="",this.queryRelateList(this.getRelateDialogParams())},getDialogQueryParams:function(){return{pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogMemberFilters[0].value}},getSupplierDialogParams:function(){return{pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogSupplierFilters[0].value,shopId:window.top.SHOP_ID||"",cooperationType:"0",state:""}},getRelateDialogParams:function(){return{pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogRelateFilters[0].value,shopId:window.top.SHOP_ID||"",supplierId:this.form.relateUnit.id}},dialogFilterDataChange:function(e){this.dialogPagination.currentPage=1,this.queryMemberList(this.getDialogQueryParams())},dialogPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.queryMemberList(this.getDialogQueryParams())},dialogCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.queryMemberList(this.getDialogQueryParams())},supplierFilterDataChange:function(e){this.dialogPagination.currentPage=1,this.querySupplierList(this.getSupplierDialogParams())},supplierPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.querySupplierList(this.getSupplierDialogParams())},supplierCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.querySupplierList(this.getSupplierDialogParams())},agentPageSizeChange:function(e){this.$set(this.dialogPagination,"pageSize",e),this.getAgent()},agentCurrentPageChange:function(e){this.$set(this.dialogPagination,"currentPage",e),this.getAgent()},agentFilterDataChange:function(e){this.dialogAgentFilters=e,this.dialogPagination.currentPage=1,this.getAgent()},handleSupplierConfirmed:function(e,t){this.form.relateUnit.id=t[0].id,this.form.relateUnit.name=t[0].name,this.$refs.form.clearValidate("relateUnitType")},handleMemberConfirmed:function(e,t){this.form.relateUnit.id=t[0].id,this.form.relateUnit.name=t[0].name,this.userId=t[0].id,this.form.paymentType.id="",this.form.paymentType.name="",this.form.userCard.id="",this.$refs.form.clearValidate("relateUnitType")},handleAgentConfirmed:function(e,t){this.form.relateUnit.id=t[0].id,this.form.relateUnit.name=t[0].name,this.$refs.form.clearValidate("relateUnitType")},handleRelateConfirmed:function(e,t){this.form.relateBill.id=t[0].id,this.form.relateBill.sn=t[0].sn,this.form.amount=t[0].totalFee,this.$refs.form.clearValidate("relateBill"),this.$refs.form.clearValidate("amount")},queryBackgroundInfo:function(){var e=this,t={shopId:window.top.SHOP_ID||""};f["a"].get(h["g"].finance.receiptMgmt.backgrounds,t).then((function(t){e.relateUnitTypeList=t.relateUnitTypeList,e.accountInTypeList=t.accountInTypeList})).catch((function(t){console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},paymentTypeChange:function(e){var t,a=Object(u["a"])(this.paymentTypeList);try{for(a.s();!(t=a.n()).done;){var i=t.value;i.id===e&&(this.form.paymentType.name=i.name,this.form.paymentType.id=e)}}catch(n){a.e(n)}finally{a.f()}"会员卡余额"===this.form.paymentType.name?this.listExistCardTemplate(this.userId):this.form.userCard.id="",this.$refs.form.clearValidate("paymentType")},listExistCardTemplate:function(e){var t=this;v["a"].listExistCardTemplate({userId:e},(function(e){t.loading=!1,t.listExistCard=e.content,t.listExistCard.forEach((function(e){e.template.name+=" ¥"+e.balance}))}),(function(e){console.log(e)}))},getPaymentMethods:function(){var e=this,t={shopId:window.top.SHOP_ID||""};f["a"].get(h["g"].finance.receiptMgmt.getPaymentMethods,t).then((function(t){e.paymentMethodList=t.paymentMethods,e.form.paymentMethod.id=e.paymentMethodList[1].id,e.form.paymentMethod.name=e.paymentMethodList[1].name,e.getPaymentType(e.form.paymentMethod.id)})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(e){}))},relatUnitTypeChange:function(e){this.form.relateUnit.name="",this.form.relateBill.sn="",this.form.amount="",this.form.paymentType.id="",this.form.paymentType.name="",this.form.relateUnitBank="",this.form.relateUnitAccount="",this.getPaymentType(this.form.paymentMethod.id)},getPaymentType:function(e){var t=this,a={paymentMethodId:e};f["a"].get(h["g"].finance.receiptMgmt.getPaymentType,a).then((function(e){t.paymentTypeList=e.paymentTypes,t.paymentTypeList.forEach((function(e,a){"0"!==t.form.relateUnitType&&"2"!==t.form.type||"会员卡余额"===e.name&&t.paymentTypeList.splice(a,1)}))})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(e){}))},save:function(){var e=this;this.$refs.form.validate((function(t,a){if(!t)return!1;e.loading=!0,e.form.id?e.update():e.create()}))},create:function(){var e=this;this.loading=!0;var t=this.form;f["a"].post(h["g"].finance.receiptMgmt.receipt,t).then((function(t){e.loading=!1,e.$message.success("操作成功"),e.$emit("operationSuccess",t.id),e.refresh(t.id)})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},update:function(){var e=this;this.loading=!0;var t=this.form;f["a"].put(h["g"].finance.receiptMgmt.receipt,t).then((function(t){e.loading=!1,e.$message.success("操作成功"),e.$emit("operationSuccess")})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},showMessage:function(e,t){this.$notify({message:e,type:t,showClose:!0})}}),mounted:function(){this.itemId&&this.refresh(this.itemId)},watch:{itemId:function(e){this.clear(),this.queryBackgroundInfo(),e&&this.refresh(e)}}},w=C,S=(a("5e5c"),a("2877")),D=Object(S["a"])(w,c,d,!1,null,null,null),I=D.exports,T=a("bc3a"),M=a.n(T),_=a("2f62"),x=a("276c"),k=a("934e"),$=a("c954"),P=a("4382"),O=a("443b"),z=a("fc46"),B={name:"ReceiptMgmt",data:function(){return{tableId:"18",openRelateBill:!1,openRelateBillOrder:!1,openLogistics:!1,openReview:!1,relateBillId:"",logisticsId:"",orderId:"",relateBillOrderId:{id:""},relateBillProductId:"",relateBillSn:"baseinfo",sn:"",relateBillOrder:"baseinfo",exportFile:!1,showRecommend:!1,itemId:"",operations:[{label:"添加",name:"add",type:"primary",auth:["admin:finance.payment.add"]},{label:"删除",name:"delete",type:"",disabled:!0,auth:["admin:finance.payment.delete"]},{label:"刷新",name:"refresh",type:""},{label:"导出",name:"export",type:"",auth:["admin:finance.payment.export"]}],filters:[{label:"业务类型",type:"select",value:"",class:"hidden",options:[{label:"全部",value:""},{label:"采购退货收款",value:"0"},{label:"销售收款",value:"1"},{label:"其它收款",value:"2"}]},{label:"状态",type:"select",value:"",name:"state",class:"hidden",options:[]},{label:"支付方式",type:"select",value:"",name:"",class:"hidden",options:[]},{label:"收款方式",type:"select",value:"",name:"",class:"hidden",options:[]},{type:"daterange",label:"创建日期",name:"publishDate",class:"hidden",value:[]},{type:"input",value:"",placeholder:"请输入单据编号/往来方名称"}],loading:!1,tableData:[],editable:!1,multiSelected:[],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},open:!1,tabName:"info",isEdit:!0,paymentMethodId:""}},components:{BizFlexTable:s["c"],BizPopupTabs:l["a"],BaseInfo:I,PurchaseOrderInfo:x["a"],OrderBaseInfo:k["a"],OrderProductInfo:$["a"],LogisticsFollowing:P["a"],MyEvaluate:z["a"]},created:function(){this.getList(),this.getState(),this.getPaymentMethods(),this.getPaymentType()},mixins:[O["a"]],methods:{getWidth:function(e){switch(e.id){case"1":return"200";case"2":return"100";case"3":return"150";case"4":return"100";case"5":return"180";case"6":return"100";case"7":return"100";case"8":return"100";case"9":return"160";default:return""}},operate:function(e){this[e]()},isShow:function(){this.showRecommend?(this.filters[0].class="hidden",this.filters[1].class="hidden",this.filters[2].class="hidden",this.filters[3].class="hidden",this.filters[4].class="hidden",document.getElementsByClassName("biz-table-filter")[0].style.marginTop=""):(this.filters[0].class="show",this.filters[1].class="show",this.filters[2].class="show",this.filters[3].class="show",this.filters[4].class="show",document.getElementsByClassName("biz-table-filter")[0].style.marginTop="30px"),this.showRecommend=!this.showRecommend},closeTabByEvaluate:function(e,t){var a=this;this.openRelateBill=!1,this.tabName="reviewinfo",this.orderId=e,this.editable=!1,this.$nextTick((function(){a.openReview=!0,a.$refs.reviewinfo.getOrderInfo(e)}))},closeTabByLogistics:function(e){var t=this;this.tabName="loginfo",this.sn=e,this.openLogistics=!0,this.openRelateBill=!1,this.$nextTick((function(){t.$refs.logistics.getLogisticsInfo()}))},add:function(){this.isEdit=!0,this.itemId="",this.open=!0},operationSuccess:function(e){this.open=!1,this.itemId=e,this.refresh()},clickRelateBill:function(e,t){var a=this;e.stopPropagation(),"8"===t.relateBillType?(window.dType=t.dType,this.relateBillOrderId={id:t.relateBill.id},this.relateBillProductId=t.relateBill.id,this.openRelateBillOrder=!0,this.isEdit=!1):(this.openRelateBill=!0,this.relateBillId=t.relateBill.id,this.$nextTick((function(){a.$refs.orderinfo.getOrderInfo()})),this.isEdit=!1)},handleDeleteClick:function(e,t){e.stopPropagation(),this.deleteItem([t.id])},deleteItem:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,f["a"].delete(h["g"].finance.receiptMgmt.receipt,{ids:e}).then((function(e){t.$message.success("删除成功"),t.refresh()})).catch((function(e){console.log(e),console.log("code错误"),e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){t.loading=!1}))}))},delete:function(){if(this.multiSelected&&this.multiSelected.length>0){var e=[];this.multiSelected.forEach((function(t){e.push(t)})),this.deleteItem(e)}else this.$message("请选择一条数据")},export:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n,r,o,s,l,c,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.filters[4].value[0]||!e.filters[4].value[0]){t.next=11;break}if(a=Date.parse(e.filters[4].value[0]+" 00:00:00"),i=Date.parse(e.filters[4].value[1]+" 23:59:59"),n=i-a,r=Math.floor(n/1e3/60/60/24),console.log(r),!(r>93)){t.next=9;break}return e.$message.warning("单次导出日期间隔不能大于90天"),t.abrupt("return");case 9:t.next=14;break;case 11:if(0!==e.multiSelected.length){t.next=14;break}return e.$message.warning("单次导出日期间隔不能大于90天"),t.abrupt("return");case 14:return o={ids:e.multiSelected,shopId:window.top.SHOP_ID||"",type:e.filters[0].value,state:e.filters[1].value,paymentMethod:e.filters[2].value,paymentType:e.filters[3].value,beginDate:e.filters[4].value[0]?e.filters[4].value[0]+" 00:00:00":"",endDate:e.filters[4].value[1]?e.filters[4].value[1]+" 23:59:59":"",searchValue:e.filters[5].value},t.prev=15,t.next=18,M.a.post(h["g"].finance.receiptMgmt.export,o,{responseType:"blob"});case 18:return s=t.sent,console.log("response => ",s),l=new Blob([s.data],{type:"application/vnd.ms-excel"}),console.log(decodeURI(s.headers["content-disposition"])),c=decodeURI(s.headers["content-disposition"].split("filename=")[1]),d=document.createElement("a"),d.download=c.match(/"(\S*)"/)[1],d.style.display="none",d.href=URL.createObjectURL(l),document.body.appendChild(d),d.click(),URL.revokeObjectURL(d.href),document.body.removeChild(d),t.abrupt("return");case 34:throw t.prev=34,t.t0=t["catch"](15),new Error(t.t0);case 37:case"end":return t.stop()}}),t,null,[[15,34]])})))()},filterDataChange:function(e){this.pagination.currentPage=1,this.refresh()},handleSelectionChange:function(e){this.operations.map((function(e){"delete"===e.name&&(e.disabled=!0)})),e.length>0&&this.operations.map((function(e){"delete"===e.name&&(e.disabled=!1)})),this.multiSelected=e.map((function(e){return e.id}))},rowClick:function(e){var t=this;this.tabName="info",this.open=!0,this.$nextTick((function(){t.itemId=e.id})),"0"===e.state?this.isEdit=!0:this.isEdit=!1},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()},refresh:function(){this.getList()},getList:function(){var e=this;this.loading=!0;var t={pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize,shopId:window.top.SHOP_ID||"",type:this.filters[0].value,state:this.filters[1].value,paymentMethod:this.filters[2].value,paymentType:this.filters[3].value,beginDate:this.filters[4].value[0]?this.filters[4].value[0]+" 00:00:00":"",endDate:this.filters[4].value[1]?this.filters[4].value[1]+" 23:59:59":"",searchValue:this.filters[5].value};f["a"].get(h["g"].finance.receiptMgmt.getList,t).then((function(t){e.loading=!1,e.pagination.total=Number(t.total),e.tableData=t.content})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},getState:function(){var e=this,t={shopId:window.top.SHOP_ID||""};f["a"].get(h["g"].finance.receiptMgmt.backgrounds,t).then((function(t){e.filters[1].options=[{label:"全部",value:""}].concat(t.financeBillStateList.map((function(e){return{label:e.label,value:e.value}})))})).catch((function(t){console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},getPaymentMethods:function(){var e=this,t={shopId:window.top.SHOP_ID||""};f["a"].get(h["g"].finance.receiptMgmt.getPaymentMethods,t).then((function(t){e.filters[2].options=[{label:"全部",value:""}].concat(t.paymentMethods.map((function(e){return{label:e.name,value:e.name}})))})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(e){}))},getPaymentType:function(){var e=this,t={};f["a"].get("/admin/payment_method/paymentTypes.jhtml",t).then((function(t){e.filters[3].options=[{label:"全部",value:""}].concat(t.paymentTypeList.map((function(e){return{label:e.label,value:e.label}})))})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(e){}))},handleCommitClick:function(e){var t=this;this.$confirm("确定执行此操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a={ids:[e]};f["a"].post(h["g"].finance.receiptMgmt.submmit,a).then((function(e){t.$message.success("操作成功！"),t.refresh()})).catch((function(e){e.errorMessage&&t.$message.warning(e.errorMessage)})).finally((function(){}))}))},formatStatus:function(e){var t={0:"已创建",1:"已提交"};return t[e]},typeFormatter:function(e){switch(e.type){case"0":return"采购退货收款";case"1":return"销售收款";case"2":return"其它收款";default:return"--"}},showMessage:function(e,t){this.$message({message:e,type:t,showClose:!0})}},mounted:function(){},computed:Object(r["a"])(Object(r["a"])({},Object(_["c"])("Authority",["currentAuth"])),{},{hasAuthDel:function(){return this.currentAuth.includes("admin:finance.payment.delete")},toggleRecommendTxt:function(){var e=this.showRecommend;return e?"收起":"筛选"}}),watch:{}},R=B,N=(a("d8683"),Object(S["a"])(R,i,n,!1,null,null,null));t["default"]=N.exports},"697f":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"biz-dialog-selector",attrs:{title:e.title,visible:e.dialogVisible,"append-to-body":e.appendToBody},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close,open:e.open}},[e._t("top"),a("biz-flex-table",{ref:"table",attrs:{showTable:e.showTable,operations:e.operations,filters:e.filters,tags:e.tags,rowKeys:e.rowKeys,pagination:e.pagination,tableData:e.tableData,rowClassName:e.rowClassName,loading:e.loading,memberIds:e.memberIds,checkable:e.checkable,isDepotOutNew:e.isDepotOutNew,checkedTable:e.checkedTable},on:{operate:e.operate,"row-click":e.rowClick,"filter-data-change":e.filterDataChange,"select-all":e.handleSelectAll,select:e.handleSelectionChange,"size-change":e.pageSizeChange,"current-change":e.currentPageChange,"cascader-change":e.cascaderChange,"active-item-change":e.activeItemChange,"sort-change":e.handleSortChange}},[e._t("default")],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isClear?a("el-button",{attrs:{size:"small"},on:{click:e.clear}},[e._v("清除")]):e._e(),a("el-button",{attrs:{size:"small"},on:{click:e.close}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmed}},[e._v("确定")])],1)],2)},n=[],r=(a("99af"),a("4160"),a("c975"),a("a434"),a("a9e3"),a("159b"),a("04d3")),o={name:"BizDialogSelector",components:{BizFlexTable:r["c"]},props:{selectionMode:{type:String,default:function(){return"multi"}},max:{type:Number,default:0},title:{require:!0,type:String,default:function(){return" "}},visibility:{require:!0,type:Boolean},appendToBody:{default:!0,type:Boolean},keyField:{type:String,default:function(){return"id"}},isClear:{default:!0,type:Boolean},rowClassName:{type:Function,default:function(){return null}},selectionKeys:{type:Array,default:function(){return[]}},memberIds:{type:Array,default:function(){return[]}},operations:{type:Array,default:function(){return[]}},filters:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},isDepotOut:{type:Boolean,default:function(){return!1}},checkTable:{type:Array,default:function(){return[]}},showTable:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogVisible:!1,innerSelectionKeys:[],isDepotOutNew:!1,checkedTable:[],innerSelection:[]}},methods:{rowKeys:function(e){return e.id},generateSelectionKeys:function(e,t){if(e.indexOf(t)>=0)this.innerSelectionKeys.push(t[this.keyField]),this.innerSelection.push(t);else{var a=this.innerSelectionKeys.indexOf(t[this.keyField]);this.innerSelectionKeys.splice(a,1),this.innerSelection.splice(a,1)}},open:function(e){this.innerSelectionKeys=this.selectionKeys.concat(),this.$emit("open",!1)},close:function(e){this.innerSelectionKeys=[],this.innerSelection=[],this.$emit("update:visibility",!1),this.$emit("close",!1)},confirmed:function(){if(this.innerSelectionKeys.length>0||!this.showTable){if(!this.showTable&&!/(http|https):\/\/([\w.]+\/?)\S*/.test(this.filters[2].value))return void this.$message.warning("必须以http,https开头,且需符合URL规范,检查格式是否正确");this.$emit("confirmed",this.innerSelectionKeys,this.innerSelection),this.dialogVisible=!1}else this.$message("请选择一项")},clear:function(){var e=this;this.tableData.forEach((function(t){e.$refs.table.toggleRowSelection(t,!1)})),this.innerSelectionKeys=[],this.innerSelection=[]},updateSelection:function(){var e=this;this.$refs&&this.$refs.table&&this.tableData.forEach((function(t){e.innerSelectionKeys.indexOf(t[e.keyField])>=0?(e.$refs.table.toggleRowSelection(t,!0),"single"===e.selectionMode&&(e.$refs.table.$refs.table.setCurrentRow(t),e.innerSelection=[t])):e.$refs.table.toggleRowSelection(t,!1)}))},operate:function(e){this.$emit("operate",e)},filterDataChange:function(e){this.$emit("filterDataChange",e)},handleSelectAll:function(e){var t=this;0===e.length?this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a>=0&&t.innerSelectionKeys.splice(a,1)})):this.tableData.forEach((function(e){var a=t.innerSelectionKeys.indexOf(e[t.keyField]);a<0&&t.innerSelectionKeys.push(e[t.keyField])})),this.$emit("selectionChange",e)},handleSelectionChange:function(e,t){this.generateSelectionKeys(e,t),this.$emit("selectionChange",e)},pageSizeChange:function(e){this.$emit("pageSizeChange",e)},currentPageChange:function(e){this.$emit("currentPageChange",e)},cascaderChange:function(e){this.$emit("cascaderChange",e)},activeItemChange:function(e){this.$emit("active-item-change",e)},handleSortChange:function(e){this.$emit("sort-change",e)},rowClick:function(e,t,a){"single"===this.selectionMode&&(this.innerSelectionKeys=[e[this.keyField]],this.innerSelection=[e])}},watch:{visibility:function(e,t){this.dialogVisible=e,this.isDepotOutNew=this.isDepotOut,this.checkedTable=this.checkTable}},computed:{checkable:function(){return"single"!==this.selectionMode}},created:function(){},updated:function(){this.updateSelection()}},s=o,l=(a("0943"),a("2877")),c=Object(l["a"])(s,i,n,!1,null,null,null);t["a"]=c.exports},"934e":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"store-value-mgmt-base-info"},[e.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"order",attrs:{rules:e.rules,model:e.order,disabled:"","label-width":"100px",size:"small","inline-message":!0}},[a("el-form-item",{attrs:{label:"订单编号",prop:"sn"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.sn,callback:function(t){e.$set(e.order,"sn",t)},expression:"order.sn"}})],1),a("el-form-item",{attrs:{label:"订单状态",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择状态"},model:{value:e.order.type,callback:function(t){e.$set(e.order,"type",t)},expression:"order.type"}},[a("el-option",{attrs:{value:"0",label:"全部"}}),a("el-option",{attrs:{value:"1",label:"待商家确认"}}),a("el-option",{attrs:{value:"2",label:"商家已确认"}}),a("el-option",{attrs:{value:"3",label:"买家已付款"}}),a("el-option",{attrs:{value:"4",label:"订单已执行"}}),a("el-option",{attrs:{value:"5",label:"交易完成"}}),a("el-option",{attrs:{value:"6",label:"交易关闭"}}),a("el-option",{attrs:{value:"7",label:"已评价"}}),a("el-option",{attrs:{value:"8",label:"订单过期"}}),a("el-option",{attrs:{value:"9",label:"退款退货中"}}),a("el-option",{attrs:{value:"10",label:"退款退货完成"}})],1)],1),a("el-form-item",{attrs:{label:"订单金额",prop:"amount"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.amount,callback:function(t){e.$set(e.order,"amount",t)},expression:"order.amount"}})],1),a("el-form-item",{attrs:{label:"调整金额",prop:"offsetAmount"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.offsetAmount,callback:function(t){e.$set(e.order,"offsetAmount",t)},expression:"order.offsetAmount"}})],1),a("el-form-item",{attrs:{label:"实付金额",prop:"amountPaid"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.amountPaid,callback:function(t){e.$set(e.order,"amountPaid",t)},expression:"order.amountPaid"}})],1),a("el-collapse",{model:{value:e.activeTabName,callback:function(t){e.activeTabName=t},expression:"activeTabName"}},[a("el-collapse-item",{attrs:{name:"customerInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("客户信息")])]),a("el-form-item",{attrs:{label:"会员昵称"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.member.nickname,callback:function(t){e.$set(e.order.member,"nickname",t)},expression:"order.member.nickname"}})],1),a("el-form-item",{attrs:{label:"性别"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.order.member.gender,callback:function(t){e.$set(e.order.member,"gender",t)},expression:"order.member.gender"}},[a("el-option",{attrs:{label:"男",value:"0"}}),a("el-option",{attrs:{label:"女",value:"1"}}),a("el-option",{attrs:{label:"保密",value:"2"}})],1)],1),a("el-form-item",{attrs:{label:"电话"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.member.mobile,callback:function(t){e.$set(e.order.member,"mobile",t)},expression:"order.member.mobile"}})],1),a("el-form-item",{attrs:{label:"车辆"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.car.plateNumber,callback:function(t){e.$set(e.order.car,"plateNumber",t)},expression:"order.car.plateNumber"}})],1)],2),a("el-collapse-item",{attrs:{name:"serviceInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("服务信息")])]),a("el-form-item",{attrs:{label:"顾问"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.order.consultant.id,callback:function(t){e.$set(e.order.consultant,"id",t)},expression:"order.consultant.id"}},[a("el-option",{attrs:{label:e.order.consultant.userName,value:e.order.consultant.id}})],1)],1),a("el-form-item",{attrs:{label:"地区"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.areaName,callback:function(t){e.$set(e.order,"areaName",t)},expression:"order.areaName"}})],1),a("el-form-item",{attrs:{label:"服务地址"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.address,callback:function(t){e.$set(e.order,"address",t)},expression:"order.address"}})],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{placeholder:"",type:"textarea"},model:{value:e.order.memo,callback:function(t){e.$set(e.order,"memo",t)},expression:"order.memo"}})],1)],2),a("el-collapse-item",{attrs:{name:"promotionInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("优惠信息")])]),a("el-form-item",{attrs:{label:"销售折扣"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.promotionDiscount,callback:function(t){e.$set(e.order,"promotionDiscount",t)},expression:"order.promotionDiscount"}})],1),a("el-form-item",{attrs:{label:"优惠券折扣"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.couponDiscount,callback:function(t){e.$set(e.order,"couponDiscount",t)},expression:"order.couponDiscount"}})],1),a("el-form-item",{attrs:{label:"V豆抵扣"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.beanDiscount,callback:function(t){e.$set(e.order,"beanDiscount",t)},expression:"order.beanDiscount"}})],1),a("el-form-item",{attrs:{label:"赠送积分"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.point,callback:function(t){e.$set(e.order,"point",t)},expression:"order.point"}})],1),a("el-form-item",{attrs:{label:"赠送V豆"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.giftBean,callback:function(t){e.$set(e.order,"giftBean",t)},expression:"order.giftBean"}})],1)],2),a("el-collapse-item",{attrs:{name:"paymentInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("付款信息")])]),a("el-form-item",{attrs:{label:"支付方式"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.paymentMethodName,callback:function(t){e.$set(e.order,"paymentMethodName",t)},expression:"order.paymentMethodName"}})],1),a("el-form-item",{attrs:{label:"付款方式"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.order.paymentTypeName,callback:function(t){e.$set(e.order,"paymentTypeName",t)},expression:"order.paymentTypeName"}})],1),"会员卡余额"===e.order.payments[0].paymentType?a("el-form-item",{attrs:{label:"会员卡",prop:"payments[0].memberCardId"}},[a("el-select",{attrs:{disabled:"",placeholder:"请选择会员卡"},model:{value:e.order.payments[0].memberCardId,callback:function(t){e.$set(e.order.payments[0],"memberCardId",t)},expression:"order.payments[0].memberCardId"}},e._l(e.listExistCard,(function(e,t){return a("el-option",{key:t,attrs:{label:e.template.name,value:e.id}})})),1)],1):e._e(),"刷卡"===e.order.payments[0].paymentType||"汇款"===e.order.payments[0].paymentType?a("el-form-item",{attrs:{label:"付款银行",prop:"payments[0].payBank"}},[a("el-input",{attrs:{placeholder:"请输入付款银行"},model:{value:e.order.payments[0].payBank,callback:function(t){e.$set(e.order.payments[0],"payBank",t)},expression:"order.payments[0].payBank"}})],1):e._e(),"刷卡"===e.order.payments[0].paymentType||"汇款"===e.order.payments[0].paymentType?a("el-form-item",{attrs:{label:"付款账号",prop:"payments[0].payAccount"}},[a("el-input",{attrs:{placeholder:"请输入付款账号"},model:{value:e.order.payments[0].payAccount,callback:function(t){e.$set(e.order.payments[0],"payAccount",t)},expression:"order.payments[0].payAccount"}})],1):e._e()],2),a("el-collapse-item",{attrs:{name:"logisticsInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("物流信息")])]),a("el-form-item",{attrs:{label:"配送方式"}},[a("el-select",{attrs:{placeholder:"请选择配送方式"},model:{value:e.shippingMethodId,callback:function(t){e.shippingMethodId=t},expression:"shippingMethodId"}},e._l(e.shippingMethods,(function(e){return a("el-option",{key:e.index,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"物流公司",prop:"shippings[0].logistics"}},[a("el-input",{attrs:{placeholder:"请选择物流公司"},model:{value:e.order.shippings[0].logistics,callback:function(t){e.$set(e.order.shippings[0],"logistics",t)},expression:"order.shippings[0].logistics"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"物流单号",prop:"shippings[0].expressSn"}},[a("el-input",{attrs:{placeholder:"请输入物流单号"},model:{value:e.order.shippings[0].expressSn,callback:function(t){e.$set(e.order.shippings[0],"expressSn",t)},expression:"order.shippings[0].expressSn"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"物流费用",prop:"shippings[0].freight"}},[a("el-input",{attrs:{placeholder:"请输入物流费用"},model:{value:e.order.shippings[0].freight,callback:function(t){e.$set(e.order.shippings[0],"freight",t)},expression:"order.shippings[0].freight"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"收货地址",prop:"shippings[0].address"}},[a("el-input",{attrs:{placeholder:"请输入收货地址"},model:{value:e.order.shippings[0].address,callback:function(t){e.$set(e.order.shippings[0],"address",t)},expression:"order.shippings[0].address"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"收货人",prop:"shippings[0].consignee"}},[a("el-input",{attrs:{placeholder:"请输入收货人"},model:{value:e.order.shippings[0].consignee,callback:function(t){e.$set(e.order.shippings[0],"consignee",t)},expression:"order.shippings[0].consignee"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.shippingMethodId,expression:"shippingMethodId"}],attrs:{label:"电话",prop:"shippings[0].phone"}},[a("el-input",{attrs:{placeholder:"请输入电话"},model:{value:e.order.shippings[0].phone,callback:function(t){e.$set(e.order.shippings[0],"phone",t)},expression:"order.shippings[0].phone"}})],1)],2),a("el-collapse-item",{attrs:{name:"invoiceInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("发票信息")])]),a("el-form-item",{attrs:{label:"是否需要发票",prop:"invoiceState"}},[a("el-select",{attrs:{disabled:!0},model:{value:e.order.invoiceState,callback:function(t){e.$set(e.order,"invoiceState",t)},expression:"order.invoiceState"}},[a("el-option",{attrs:{label:"否",value:e.order.invoiceState}}),a("el-option",{attrs:{label:"是",value:e.order.invoiceState}})],1)],1)],2),a("el-collapse-item",{attrs:{name:"otherInfo"}},[a("template",{slot:"title"},[a("span",{staticClass:"collapse-title"},[e._v("其他信息")])]),a("el-form-item",{attrs:{label:"创建时间"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd"},model:{value:e.order.orderTime,callback:function(t){e.$set(e.order,"orderTime",t)},expression:"order.orderTime"}})],1),a("el-form-item",{attrs:{label:"执行时间"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd"},model:{value:e.order.deliveryTime,callback:function(t){e.$set(e.order,"deliveryTime",t)},expression:"order.deliveryTime"}})],1),a("el-form-item",{attrs:{label:"付款时间"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd"},model:{value:e.order.payments[0].paymentDate,callback:function(t){e.$set(e.order.payments[0],"paymentDate",t)},expression:"order.payments[0].paymentDate"}})],1),a("el-form-item",{attrs:{label:"完成时间"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd"},model:{value:e.order.orderTime,callback:function(t){e.$set(e.order,"orderTime",t)},expression:"order.orderTime"}})],1)],2)],1)],1)],1)},n=[],r=(a("99af"),a("d81d"),a("b0c0"),a("f36f")),o=a("8330"),s=a("e42c"),l=a("c596"),c=a("1ab1"),d={name:"StoreValueMgmtBaseInfo",props:{itemId:{type:Object,default:function(){return{id:""}}},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{activeTabName:"",loading:!1,operations:[],rules:{},adminCurrentId:"",afterSales:[],listExistCard:[],consultants:[],adminCurrent:[],order:this.resetOrder(),shippingMethodId:"",shippingMethods:[]}},components:{BizGrid:r["a"],BizSaveButton:o["a"]},methods:{operate:function(e){this[e]()},resetOrder:function(){return{sn:"",type:"",userId:"",amount:"",offsetAmount:"",amountPaid:"",member:{},car:{},consultant:{},area:"",consignee:"",areaName:"",address:"",phone:"",memo:"",promotionDiscount:"",couponDiscount:"",beanDiscount:"",point:"",giftBean:"",paymentMethodName:"",paymentTypeName:"",payments:[{}],payAccount:"",shippings:[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:"",consignee:"",phone:"",zipCode:""}],invoiceState:"",invoiceType:"",invoiceTitle:"",taxNumber:"",orderTime:"",deliveryTime:"",paymentTime:"",completeTime:""}},resetForm:function(){return{order:{}}},clear:function(){this.activeTabName="",this.form=this.resetForm()},refresh:function(){var e=this;this.loading=!0;var t={orderId:this.itemId.id};c["a"].get(l["i"].store.baseInfo.query,t).then((function(t){e.loading=!1,e.adminCurrentId=t.adminCurrent.id,e.afterSales=t.afterSales,e.shippingMethods=t.shippingMethods,t.shippingMethods.map((function(a){t.order.shippingMethodName===a.name&&(e.shippingMethodId=a.id)})),e.order=Object.assign(e.resetOrder(),t.order),e.order.payments.length||(e.order.payments=[{}]),0===e.order.shippings.length&&(e.order.shippings=[{shippingMethod:"",deliveryCorpId:"",expressSn:"",freight:"",address:e.order.areaName?e.order.areaName+e.order.address:e.order.address,consignee:e.order.consignee,phone:e.order.phone,zipCode:e.order.zipCode}]),e.adminCurrent=[{id:t.adminCurrent.id,name:t.adminCurrent.realName}],e.order.consultant.id?e.adminCurrent=[{id:e.order.consultant.id,name:e.order.consultant.realName}]:e.order.consultant={id:t.adminCurrent.id,userName:t.adminCurrent.realName},e.listExistCardTemplate()})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},listAdminByRole:function(){var e=this,t="";t="car"===this.$route.params.orderType?["salesman"]:["afterSale","reception","testDriver"],s["a"].listAdminByRole({roleTypes:t},(function(t){e.loading=!1,e.flag=!1,console.log(e.form.consultant.id),t.dataList.map((function(t){t.id===e.adminCurrent[0].id&&(e.flag=!0)})),e.flag?e.consultants=t.dataList:e.consultants=t.dataList.concat(e.adminCurrent)}),(function(e){console.log(e)}))},save:function(){var e=this;this.$refs.form.validate((function(t){t&&e.submit()}))},submit:function(){this.itemId.id?this.update():this.create()},listExistCardTemplate:function(){var e=this;s["a"].listExistCardTemplate({userId:this.order.userId},(function(t){e.loading=!1,e.listExistCard=t.content}),(function(e){console.log(e)}))},create:function(){var e=this;this.loading=!0;var t=this.form;c["a"].post(l["i"].store.baseInfo.create,t).then((function(t){e.loading=!1,e.$message.success("操作成功"),e.$emit("update"),e.form=e.resetForm()})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},update:function(){var e=this;this.loading=!0;var t=Object.assign(this.form,this.itemId);c["a"].put(l["i"].store.baseInfo.update,t).then((function(t){e.loading=!1,e.$message.success("操作成功"),e.$emit("update"),e.refresh()})).catch((function(t){e.loading=!1,e.$message.warning(t.errorMessage)}))},showMessage:function(e,t){this.$notify({message:e,type:t,showClose:!0})}},mounted:function(){this.itemId.id&&this.refresh()},watch:{itemId:function(e,t){this.clear(),""!==e.id&&this.refresh()}}},u=d,p=(a("d1ce"),a("2877")),m=Object(p["a"])(u,i,n,!1,null,null,null);t["a"]=m.exports},"9b2e":function(e,t,a){"use strict";var i=a("0a05"),n=a.n(i);n.a},af3f:function(e,t,a){"use strict";var i=a("697f");t["a"]=i["a"]},b15b:function(e,t,a){"use strict";var i=a("bbfa"),n=a.n(i);n.a},b4ab:function(e,t,a){},b547:function(e,t,a){},bbfa:function(e,t,a){},c466:function(e,t,a){"use strict";a("99af"),a("d3b7"),a("ac1f"),a("25f0"),a("5319");t["a"]={nowDate:function(){var e=new Date,t=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()+1<10?"0"+e.getDate():e.getDate();return e.getFullYear().toString()+"-"+t+"-"+a},getMonthDays:function(e){var t=new Date(Date.parse(e.replace(/-/g,"/"))),a=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,1),n=(i-a)/864e5;return n},halfYearAgo:function(e){var t="";return t=e?new Date(Date.parse(e.replace(/-/g,"/"))):new Date,console.log(t),t.setMonth(t.getMonth()-6),"".concat(t.getFullYear(),"-").concat(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,"-").concat(t.getDate()<10?"0"+t.getDate():t.getDate())},lastMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1<10?"0"+e.getMonth():e.getMonth(),i=e.getDate()+1<10?"0"+e.getDate():e.getDate();return"00"===a&&(a="12",t--),t.toString()+"-"+a+"-"+i},nextMonthDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),n=parseInt(a)+1;13===n&&(t=parseInt(t)+1,n=1);var r=new Date(t,n,0);return r=r.getDate(),i>r&&(i=r),n<10&&(n="0"+n),t+"-"+n+"-"+i},lastYearDate:function(){var e=new Date,t=new Date(e.getFullYear()-1,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastTwoYearDate:function(){var e=new Date,t=new Date(e.getFullYear()+2,e.getMonth(),e.getDate());return t.getFullYear()+"-"+this.convertToFullMode(t.getMonth()+1)+"-"+this.convertToFullMode(t.getDate())},lastNYearDate:function(e,t){var a=new Date(e),i=new Date(a.getFullYear()+parseInt(t),a.getMonth(),a.getDate());return i.getFullYear()+"-"+this.convertToFullMode(i.getMonth()+1)+"-"+this.convertToFullMode(i.getDate())},dateConverter:function(e){return e instanceof Date?e.getFullYear()+"-"+this.convertToFullMode(e.getMonth()+1)+"-"+this.convertToFullMode(e.getDate()):e},timeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes())+":"+this.convertToFullMode(e.getSeconds()):e},shortTimeConverter:function(e){return e instanceof Date?this.convertToFullMode(e.getHours())+":"+this.convertToFullMode(e.getMinutes()):e},dateTimeConverter:function(e){return e instanceof Date?this.dateConverter(e)+" "+this.timeConverter(e):e},convertToFullMode:function(e){return e=e.toString(),1===e.length?"0"+e:e}}},c6d7:function(e,t,a){},c954:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("biz-grid",{staticClass:"order-product-info"},[e.isEdit?a("biz-save-button",{attrs:{slot:"top",operations:e.operations},on:{operate:e.operate},slot:"top"}):e._e(),a("el-form",{attrs:{inline:!0,disabled:!e.isEdit,"inline-message":!0}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addProduct}},[e._v("新增")]),a("el-form-item",{staticClass:"subTotal",attrs:{label:"合计:",prop:"subTotal"}},[e._v(" "+e._s(e.subTotal)+" ")])],1),a("biz-list",{key:Math.random(),ref:"table",attrs:{tableData:e.tableData,loading:e.loading}},[a("el-table-column",{attrs:{prop:"sn",label:"编号"}}),a("el-table-column",{attrs:{prop:"name",label:"商品名称"}}),a("el-table-column",{attrs:{prop:"price",label:"商品价格","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{attrs:{size:"mini",min:0},on:{change:function(a){return e.priceChange(t.row.price)}},model:{value:t.row.price,callback:function(a){e.$set(t.row,"price",a)},expression:"scope.row.price"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"quantity",label:"数量","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[a("el-input-number",{attrs:{size:"mini",min:1},on:{change:function(a){return e.quantityChange(t.row.quantity)}},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})],1)])}}])}),a("el-table-column",{attrs:{prop:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-customcol"},[e._v(" "+e._s(t.row.quantity?(Number(t.row.quantity)*Number(t.row.price)).toFixed(2):"")+" ")])])}}])}),a("el-table-column",{attrs:{prop:"date",label:"操作",type:"index"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[e.isEdit?a("div",{staticClass:"biz-customcol"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteHandeler(t)}}},[e._v(" 删除 ")])],1):e._e()])}}])})],1),a("biz-pagination",{attrs:{pagination:e.pagination},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),a("el-dialog",{attrs:{visible:e.dialogTableVisible,center:"",width:"1200px","append-to-body":""},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"right"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.print}},[e._v("打印")])],1)])],1),a("vue-easy-print",{ref:"easyPrint",attrs:{tableShow:""}},[a("div",{staticClass:"d-p-wrap"},[a("el-row",{attrs:{gutter:10}},[a("div",{staticClass:"p-title"},[e._v(" "+e._s(e.title)+" ")])]),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple",attrs:{align:"right"}},[e._v("打印日期："+e._s(e.formatDate((new Date).getTime())))])])],1),a("el-row",{staticClass:"row-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("订单编号："+e._s(e.formData.sn))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("配送方式："+e._s(e.shippingData.shippingMethod))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("收货人："+e._s(e.shippingData.consignee))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("电话："+e._s(e.shippingData.phone))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("地址："+e._s(e.shippingData.address))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("买家留言："+e._s(e.formData.memo))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"})])],1),a("el-table",{staticClass:"table-class",attrs:{data:e.gridData}},[a("el-table-column",{attrs:{property:"isTotal",width:"50",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isTotal?a("div",[e._v("合计")]):a("div",[e._v(e._s(t.$index+1))])]}}])}),a("el-table-column",{attrs:{property:"name",label:"商品名",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(" "+e._s(t.row.name)+" ")]}}],null,!0)}),a("el-table-column",{attrs:{property:"address",label:"规格"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(" "+e._s(-1!==t.row.fullName.indexOf("[")?t.row.fullName.split("[")[1].split("]")[0]:"")+" ")]}}],null,!0)}),a("el-table-column",{attrs:{property:"price",label:"单价"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.isTotal?void 0:[e._v(" ￥"+e._s(t.row.price)+" ")]}}],null,!0)}),a("el-table-column",{attrs:{property:"quantity",label:"数量"}}),a("el-table-column",{attrs:{property:"subTotal",label:"小计"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" ￥"+e._s(t.row.subTotal)+" ")]}}])})],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("运费：￥"+e._s(e.formData.freight))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("优惠金额：￥"+e._s(e.formData.couponDiscount))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("调整金额：￥"+e._s(e.formData.offsetAmount))])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("订单金额：￥"+e._s(e.formData.originalAmount))])])],1),a("el-row",{staticClass:"row",attrs:{gutter:10}},[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"grid18"})]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("仓库签字：")])])],1)],1)])],1),a("biz-dialog-selector",{staticClass:"product-info-dailog",attrs:{title:"选择商品",visibility:e.showDialog,tableData:e.giftList,pagination:e.dialogPagination,filters:e.dialogFilters,selectionKeys:e.selectedGiftIds},on:{"update:visibility":function(t){e.showDialog=t},pageSizeChange:e.dialogPageSizeChange,currentPageChange:e.dialogCurrentPageChange,confirmed:e.confirmedProduct,filterDataChange:e.dialogFilterDataChange,selectionChange:e.selectionChange}},[a("el-table-column",{attrs:{property:"fullName",label:"商品名称",width:"400px"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[a("div",{staticClass:"biz-two-column"},[a("img",{attrs:{src:t.row.image||e.DefaultImg,onerror:e.errorImg}}),a("div",{staticClass:"biz-two-row"},[a("div",{staticStyle:{"margin-left":"10px","font-size":"14px"}},[e._v(e._s(t.row.name))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("编号："+e._s(t.row.sn))]),a("div",{staticStyle:{"margin-left":"10px"}},[e._v("规格："+e._s(t.row.fullName&&-1!==t.row.fullName.indexOf("[")?t.row.fullName.split("[")[1].split("]")[0]:""))])])])])}}])}),a("el-table-column",{attrs:{property:"categoryName",label:"分类"}}),a("el-table-column",{attrs:{property:"brandName",label:"品牌"}}),a("el-table-column",{attrs:{property:"price",label:"价格"}}),a("el-table-column",{attrs:{label:"剩余库存/库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"120px"}},[e._v(e._s(t.row.availableStock)+"/"+e._s(t.row.stock))])]}}])})],1)],1)},n=[],r=(a("99af"),a("4de4"),a("4160"),a("c975"),a("d81d"),a("a434"),a("b0c0"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("159b"),a("5530")),o=a("7558"),s=a("5c40"),l=a("8330"),c=a("f36f"),d=a("e42c"),u=a("2086"),p=a("225d"),m=a("2f62"),g=a("c596"),h=a("1ab1"),f=a("af3f"),b=a("f3ac"),v=a.n(b),y={name:"NewsMgmt",props:{itemId:{type:String},isEdit:{type:Boolean,default:function(){return!0}}},data:function(){return{dialogPagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0},errorImg:'this.src="/resources/admin/images/default/product-default.png"',DefaultImg:v.a,selectedGiftList:[],selectedGiftIds:[],showDialog:!1,dialogFilters:[{type:"input",placeholder:"请输入编号或商品名",name:"searchbar",value:""}],giftList:[],loading:!1,open:!1,subTotal:"",height:"585",subTotalAll:"",tableData:[],restaurants:[],selections:[],orderItems:[],selectionList:[],dialogTableVisible:!1,gridData:[],formData:{},shippingData:{},title:"",form:{products:""},operations:[{label:"保存",name:"save",type:"primary"},{label:"打印",name:"certificate",type:"primary"}],pagination:{pageSize:20,currentPage:1,pageSizes:[10,20,50,100],total:0}}},components:{BizList:o["a"],BizPagination:s["a"],BizGrid:c["a"],BizSaveButton:l["a"],vueEasyPrint:p["a"],BizDialogSelector:f["a"]},watch:{itemId:function(e){this.tableData=[],this.subTotal="",this.itemId&&this.getList()}},mounted:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},methods:Object(r["a"])(Object(r["a"])({},Object(m["c"])(["getUser"])),{},{addProduct:function(){this.dialogFilters[0].value="",this.getGiftList(),this.selectedGiftIds.splice(0,this.selectedGiftIds.length),this.selectedGiftList.splice(0,this.selectedGiftList.length),this.showDialog=!0},dialogPageSizeChange:function(e){this.dialogPagination.pageSize=e,this.getGiftList()},dialogCurrentPageChange:function(e){this.dialogPagination.currentPage=e,this.getGiftList()},dialogFilterDataChange:function(e){this.dialogFilters=e,this.dialogPagination.currentPage=1,this.getGiftList()},getGiftList:function(){var e=this,t={pageSize:this.dialogPagination.pageSize,pageNumber:this.dialogPagination.currentPage,searchValue:this.dialogFilters[0].value,shopId:window.top.SHOP_ID||"",isOutOfStock:"0",type:"couponOrder"===this.$route.params.orderType?"7":"",orderType:this.$route.params.orderType};h["a"].get("purchaseOrder"===window.top.dType?"/admin/purchaseOrderManage/product/list.jhtml":g["g"].memberCardMgmt.memberCard.listProduct,t).then((function(t){e.giftList=t.content,e.dialogPagination.total=Number(t.total)})).catch((function(e){e.errorMessage&&console.log(e.errorMessage)}))},selectionChange:function(e){var t=this;e.forEach((function(e){-1===t.selectionList.indexOf(e)&&t.selectionList.push(e)}))},confirmedProduct:function(e){var t=this;this.selectedGiftIds=e.concat(),this.selectedGiftList=[],this.selectionList.map((function(e){-1!==t.selectedGiftIds.indexOf(e.id)&&(e.quantity="1",t.selectedGiftList.push(e))}));this.selectedGiftList.map((function(e){Number(e.quantity)*Number(e.price)})),this.selectedGiftList.forEach((function(e){t.handleSelect(e),t.listProduct(e)}))},print:function(){this.$refs.easyPrint.print()},certificate:function(){var e=this;if(!this.itemId)return this.$message.warning("请先生成一个订单"),!1;var t={orderId:this.itemId,shopId:window.top.SHOP_ID||""};h["a"].get("purchaseOrder"===window.dType?g["l"].delivery.queryShippingVoucherPurchase:g["l"].delivery.queryShippingVoucher,t).then((function(t){e.dialogTableVisible=!0,e.title=e.getUser().shop?e.getUser().shop.name+"发货单":"发货单",e.formData=t.order,e.shippingData=t.shipping||{},e.userCard=t.userCard,e.gridData=t.order.orderItems})).catch((function(t){e.loading=!1,console.log("ERR_REFRESH: ",t),e.$message.warning(t.errorMessage)}))},formatDate:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),r=a+"-"+(i<10?"0"+i:i)+"-"+(n<10?"0"+n:n);return r},resize:function(){var e=document.documentElement.clientHeight||window.innerHeight;this.height=String(e-175)},operate:function(e){this[e]()},refresh:function(){this.flag=!0,this.getList()},operationSuccess:function(){this.getList()},getList:function(){var e=this;console.log("window.top.dType"+window.top.dType),this.loading=!0;var t={orderId:this.itemId,pageNumber:this.pagination.currentPage,pageSize:this.pagination.pageSize};d["a"].viewProducts(t,(function(t){e.loading=!1,e.tableData=t.orderItems,e.subTotal=t.order.price,e.pagination.total=Number(t.total),console.log("this.tableData",e.tableData)}),(function(e){console.log(e)}))},handleSelect:function(e){var t=!1;if(e.productId=e.id,e.id="",this.subTotal=(Number(this.subTotal)+Number(e.quantity)*Number(e.price)).toFixed(2),0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].productId===e.productId){this.tableData[a].quantity=(Number(this.tableData[a].quantity)+1).toString(),t=!0;break}t||this.tableData.push(e)}else this.tableData.push(e)},deleteHandeler:function(e){console.log(1),this.tableData.splice(e.$index,1),this.tableData.length>0?this.subTotal=(Number(this.subTotal)-Number(e.row.price)*Number(e.row.quantity)).toFixed(2):this.subTotal=0},quantityChange:function(e){var t=0;this.tableData.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.subTotal=t?t.toFixed(2):""},priceChange:function(e){var t=0;this.tableData.map((function(e){t+=Number(e.quantity)*Number(e.price)})),this.subTotal=t?t.toFixed(2):""},save:function(){var e=this;this.orderItems=this.tableData.map((function(e){return{id:e.id||"",productId:e.productId?e.productId:e.id,quantity:e.quantity||"",price:e.price||""}}));var t=!1;if(this.tableData.forEach((function(e){console.log(e.quantity),-1!==String(e.quantity).indexOf(".")&&(t=!0)})),t)return this.$message.warning("数量不能为小数"),!1;!this.itemId&&this.$emit("setOrderItems",this.orderItems),this.itemId&&d["a"].addOrderItems({orderId:this.itemId,orderData:{orderItems:this.orderItems},shopId:window.top.SHOP_ID},(function(t){e.$emit("setOrderItems",e.orderItems),e.$emit("operationSuccess"),e.loading=!1}),(function(t){e.loading=!1,e.getList(),e.$message.warning(t.errorMessage)}))},listProduct:function(e){var t=this;u["a"].listProduct({searchValue:e.name},(function(e){t.restaurants=e.content.map((function(e){return{fullName:e.fullName,sn:e.sn,price:e.price,quantity:"1",subTotal:e.price,productId:e.id,value:e.fullName}})),t.loading=!1}),(function(e){console.log(e),console.log("code错误")}))},querySearchAsync:function(e,t){var a=this.restaurants,i=e?a.filter(this.createStateFilter(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout((function(){t(i)}),300*Math.random())},createStateFilter:function(e){return function(e){return!0}},handleSizeChange:function(e){this.pagination.pageSize=e,this.refresh()},handleCurrentChange:function(e){this.pagination.currentPage=e,this.refresh()}})},C=y,w=(a("1dad"),a("2877")),S=Object(w["a"])(C,i,n,!1,null,null,null);t["a"]=S.exports},d1ce:function(e,t,a){"use strict";var i=a("b4ab"),n=a.n(i);n.a},d74a:function(e,t,a){"use strict";var i=a("21c5"),n=a.n(i);n.a},d8683:function(e,t,a){"use strict";var i=a("ecef"),n=a.n(i);n.a},ec6b:function(e,t,a){"use strict";var i=a("b547"),n=a.n(i);n.a},ecef:function(e,t,a){},f3ac:function(e,t,a){e.exports=a.p+"static/img/pic_default_none_100.6603f4ac.png"},fc46:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"my-evaluate"},[a("div",{staticClass:"evaluate-content"},[e.orderInfo&&e.reviews.length?a("div",e._l(e.orderInfo.orderItems,(function(t,i){return a("div",{key:i,staticClass:"my-evaluate-div"},[a("div",{staticClass:"order-info"},[a("div",{staticClass:"info"},[a("img",{attrs:{src:t.thumbnail?t.thumbnail:e.defaultImg},on:{error:e.errorHandle}}),a("div",{staticClass:"info-right"},[a("span",[e._v(e._s(t.name))]),a("span",[e._v("￥"+e._s(e.getAmount(t)))])])])]),e.editable&&t.product?a("div",{staticClass:"evaluate"},[a("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[a("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px",padding:"0px 30px"}}),a("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),a("el-radio-group",{staticStyle:{height:"10px"},attrs:{horizontal:!0},model:{value:e.reviews[i].score,callback:function(t){e.$set(e.reviews[i],"score",t)},expression:"reviews[index].score"}},e._l(e.options,(function(e,t){return a("el-radio",{key:t,attrs:{label:e}})})),1)],1),a("el-input",{attrs:{type:"textarea",size:"mini",placeholder:"来分享您的使用感受吧...",maxlength:e.maxlength},model:{value:e.reviews[i].content,callback:function(t){e.$set(e.reviews[i],"content",t)},expression:"reviews[index].content"}}),a("img-uploader",{model:{value:e.reviews[i].images,callback:function(t){e.$set(e.reviews[i],"images",t)},expression:"reviews[index].images"}})],1):e._e(),!e.editable&&t.product?a("div",{staticClass:"evaluate-dis"},[a("div",{staticClass:"title",staticStyle:{"align-items":"center",float:"left"}},[a("span",{staticClass:"iconfont biz-icon-shangpin",staticStyle:{"font-size":"26px"}}),a("span",{staticStyle:{"padding-right":"30px","font-size":"14px"}},[e._v("商品评分")]),a("span",[e._v(e._s(e.reviews[i].score?e.已reviews[i].score:""))])]),a("div",{staticClass:"eva-content"},[a("p",{staticStyle:{"margin-bottom":"10px","margin-left":"20px"}},[e._v(e._s(e.reviews[i].content?e.reviews[i].content:"很遗憾，您没有留下任何评价。"))]),a("div",{staticClass:"img-group",staticStyle:{"margin-left":"20px"}},e._l(e.reviews[i].images,(function(t,n){return a("div",{key:n,staticClass:"img-eva"},[t?a("img",{attrs:{src:t},on:{click:function(t){return e.handleImagePreview(e.reviews[i].images,n)}}}):e._e()])})),0)])]):e._e()])})),0):e._e(),a("div",{staticClass:"shop-evaluate"},[a("div",{staticClass:"shop-title"},[a("img",{attrs:{src:e.iconShop}}),a("span",{staticStyle:{fontSize:"14px"}},[e._v("店铺评分")])]),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("服务态度")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.serValue,callback:function(t){e.serValue=t},expression:"serValue"}})],1),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("服务速度")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.speedValue,callback:function(t){e.speedValue=t},expression:"speedValue"}})],1),a("div",{staticClass:"shop-item"},[a("span",{staticClass:"label"},[e._v("专业技能")]),a("el-rate",{staticClass:"rate",attrs:{disabled:!e.editable},model:{value:e.proValue,callback:function(t){e.proValue=t},expression:"proValue"}})],1)])]),e.editable?a("div",{staticClass:"submit"},[a("span",{staticClass:"btn-submit",on:{click:e.submitEvaluate}},[e._v("提交评价")])]):e._e()])},n=[],r=(a("4160"),a("d81d"),a("a434"),a("a9e3"),a("b680"),a("d3b7"),a("25f0"),a("159b"),a("b85c")),o=a("5530"),s=a("2f62"),l=a("1ab1"),c=a("c596"),d=a("624d"),u=a.n(d),p=a("517a"),m=a.n(p),g=a("2119"),h=a("f606"),f=a.n(h),b={name:"my-evaluate",data:function(){return{iconShop:f.a,defaultImg:u.a,defaultFailImg:m.a,selected:"好评",options:["好评","中评","差评"],evaluateValue:"",maxlength:100,serValue:5,speedValue:5,proValue:5,reviews:[],info:null,initialIndex:0}},props:{orderId:{type:String,default:""},editable:{type:Boolean,default:function(){return!0}}},components:{ImgUploader:g["a"]},computed:Object(o["a"])(Object(o["a"])({},Object(s["c"])("Order",["orderInfo"])),Object(s["c"])(["getUser"])),watch:{orderId:function(e,t){this.getParams(),this.getOrderInfo()}},methods:Object(o["a"])(Object(o["a"])({},Object(s["d"])("Order",["updateOrderInfo"])),{},{showToast:function(e){this.$createToast({time:1e3,txt:e,type:"warn"}).show()},images:function(e){var t,a=[],i=Object(r["a"])(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;a.push(n)}}catch(o){i.e(o)}finally{i.f()}return a},handleImagePreview:function(e,t){var a=this;this.initialIndex=t;var i=[];e.map((function(e){i.push(e)}));var n={$props:{imgs:i,initialIndex:"initialIndex",loop:!1},$events:{change:function(e){a.initialIndex=e}}};this.$createImagePreview(Object(o["a"])({},n)).show()},getAmount:function(e){var t=Number(e.price)*Number(e.quantity);return t.toFixed(2)},submitEvaluate:function(){for(var e=this,t={serviceAttitude:this.serValue.toString(),serviceSpeed:this.speedValue.toString(),professional:this.proValue.toString(),methodName:"CreateProductReview",clientType:"2",shopId:this.getUser.shop.id,orderId:this.orderInfo.id,userId:this.getUser.id},a=this.orderInfo.orderItems,i=a.length,n=this.reviews,r=!1,o=0;o<i;o++){if(n[o]&&("好评"===n[o].score?(n[o].score="5",r=!0):"中评"===n[o].score?(n[o].score="3",r=!0):"差评"===n[o].score&&(n[o].score="1",r=!0)),!r&&a[o].product)return void this.$message.warning("请选择商品评分");a[o].product&&(n[o].images=this.images(n[o].images))}a.forEach((function(e,t){if(!e.product)return n.splice(t,1),!1})),r&&(t.reviews=this.reviews),l["a"].post(c["g"].hypermarketMgmt.review,t).then((function(t){e.$message.success("评价成功"),e.$emit("operationSuccess")})).catch((function(t){e.$message.warning(t.errorMessage)})).finally((function(){}))},errorHandle:function(e){e.currentTarget.src=this.defaultFailImg},getOrderInfo:function(e){var t=this;this.open=!1;var a="";a=e||this.orderId;var i={clientType:this.clientType,methodName:"QueryOrderDetail",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:a};l["a"].get(c["g"].hypermarketMgmt.queryOrder,i).then((function(e){console.log("订单信息",e);var i,n,r=e.order.orderItems,o=r.length;for(t.reviews=[],n=0;n<o;n++)i={score:"",content:"",reviewOrderId:e.order.id,images:[]},r[n].product&&(i.productId=r[n].product.id),t.reviews.push(i);t.editable?t.updateOrderInfo(e.order):(t.info=e.order,t.getEvaluationInfo(a))})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))},getParams:function(){this.editable=!0},getEvaluationInfo:function(e){var t=this,a={clientType:this.clientType,methodName:"QueryOrderReview",shopId:this.getUser.shop.id,userId:this.getUser.id,orderId:e};l["a"].get(c["g"].hypermarketMgmt.reviews,a).then((function(e){if(console.log(e),t.serValue=parseInt(e.serviceAttitude),t.speedValue=parseInt(e.serviceSpeed),t.proValue=parseInt(e.professional),e.reviews.length!==t.reviews.length){var a={score:"",content:"",images:[]};e.reviews.unshift(a)}t.reviews=e.reviews;for(var i=t.reviews,n=i.length,r=0;r<n;r++)"5"===i[r].score?i[r].score="好评":"3"===i[r].score?i[r].score="中评":"1"===i[r].score&&(i[r].score="差评");t.updateOrderInfo(t.info)})).catch((function(e){t.$message.warning(e.errorMessage)})).finally((function(){}))}}),created:function(){}},v=b,y=(a("9b2e"),a("2877")),C=Object(y["a"])(v,i,n,!1,null,null,null);t["a"]=C.exports},fdfa:function(e,t,a){}}]);